!function(e){function t(t){for(var r,s,o=t[0],l=t[1],c=t[2],d=0,m=[];d<o.length;d++)s=o[d],Object.prototype.hasOwnProperty.call(n,s)&&n[s]&&m.push(n[s][0]),n[s]=0;for(r in l)Object.prototype.hasOwnProperty.call(l,r)&&(e[r]=l[r]);for(u&&u(t);m.length;)m.shift()();return i.push.apply(i,c||[]),a()}function a(){for(var e,t=0;t<i.length;t++){for(var a=i[t],r=!0,o=1;o<a.length;o++){var l=a[o];0!==n[l]&&(r=!1)}r&&(i.splice(t--,1),e=s(s.s=a[0]))}return e}var r={},n={0:0},i=[];function s(t){if(r[t])return r[t].exports;var a=r[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,s),a.l=!0,a.exports}s.m=e,s.c=r,s.d=function(e,t,a){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(s.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)s.d(a,r,function(t){return e[t]}.bind(null,r));return a},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="/static/";var o=window.webpackJsonp=window.webpackJsonp||[],l=o.push.bind(o);o.push=t,o=o.slice();for(var c=0;c<o.length;c++)t(o[c]);var u=l;i.push([713,2]),a()}({103:function(e,t,a){e.exports=a.p+"images/redash_icon_small.png"},1093:function(e,t,a){var r={"./en-SG":547,"./en-SG.js":547,"./en-au":548,"./en-au.js":548,"./en-ca":549,"./en-ca.js":549,"./en-gb":550,"./en-gb.js":550,"./en-ie":551,"./en-ie.js":551,"./en-il":552,"./en-il.js":552,"./en-nz":553,"./en-nz.js":553};function n(e){var t=i(e);return a(t)}function i(e){if(!a.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}n.keys=function(){return Object.keys(r)},n.resolve=i,e.exports=n,n.id=1093},1452:function(e,t,a){},1453:function(e,t,a){},1456:function(e,t,a){},1458:function(e,t,a){},1469:function(e,t,a){},1472:function(e,t,a){},1473:function(e,t,a){},1474:function(e,t,a){},1475:function(e,t,a){},1476:function(e,t,a){},1488:function(e,t,a){},1489:function(e,t,a){},1490:function(e,t,a){},1493:function(e,t,a){},1494:function(e,t,a){},1497:function(e,t,a){},1498:function(e,t,a){},1513:function(e,t,a){},1514:function(e,t,a){},1515:function(e,t,a){},1516:function(e,t,a){},1543:function(e,t,a){},1551:function(e,t,a){},1552:function(e,t,a){},1553:function(e,t,a){},1554:function(e,t,a){},1555:function(e,t,a){},1556:function(e,t,a){},1557:function(e,t,a){},1559:function(e,t,a){},1560:function(e,t,a){},1561:function(e,t,a){},1562:function(e,t,a){},1563:function(e,t,a){},1564:function(e,t,a){},1570:function(e,t,a){},1595:function(e,t,a){},1596:function(e,t,a){},1601:function(e,t,a){},1660:function(e,t,a){},1661:function(e,t,a){},1662:function(e,t,a){},1663:function(e,t,a){},1664:function(e,t,a){},1665:function(e,t,a){},1666:function(e,t,a){},1667:function(e,t,a){},1678:function(e,t,a){},1759:function(e,t,a){},1760:function(e,t,a){},1761:function(e,t,a){},1762:function(e,t,a){},1765:function(e,t,a){},1766:function(e,t,a){},1767:function(e,t,a){},1772:function(e,t,a){},1773:function(e,t,a){},1774:function(e,t,a){},1775:function(e,t,a){},1776:function(e,t,a){var r={"./avatar.svg":437,"./db-logos/Cassandra.png":1777,"./db-logos/athena.png":1778,"./db-logos/aws_es.png":1779,"./db-logos/axibasetsd.png":1780,"./db-logos/azure_kusto.png":1781,"./db-logos/bigquery.png":1782,"./db-logos/bigquery_gce.png":1783,"./db-logos/clickhouse.png":1784,"./db-logos/cloudwatch.png":1785,"./db-logos/cloudwatch_insights.png":1786,"./db-logos/cockroach.png":1787,"./db-logos/corporate_memory.png":1788,"./db-logos/couchbase.png":1789,"./db-logos/csv.png":1790,"./db-logos/databricks.png":1791,"./db-logos/db2.png":1792,"./db-logos/dgraph.png":1793,"./db-logos/drill.png":1794,"./db-logos/druid.png":1795,"./db-logos/dynamodb_sql.png":1796,"./db-logos/elasticsearch.png":1797,"./db-logos/exasol.png":1798,"./db-logos/excel.png":1799,"./db-logos/firebolt.png":1800,"./db-logos/google_analytics.png":1801,"./db-logos/google_spreadsheets.png":1802,"./db-logos/graphite.png":1803,"./db-logos/hive.png":1804,"./db-logos/hive_http.png":1805,"./db-logos/impala.png":1806,"./db-logos/influxdb.png":1807,"./db-logos/jirajql.png":1808,"./db-logos/json.png":1809,"./db-logos/kibana.png":1810,"./db-logos/kylin.png":1811,"./db-logos/mapd.png":1812,"./db-logos/memsql.png":1813,"./db-logos/mongodb.png":1814,"./db-logos/mssql.png":1815,"./db-logos/mssql_odbc.png":1816,"./db-logos/mysql.png":1817,"./db-logos/oracle.png":1818,"./db-logos/pg.png":1819,"./db-logos/phoenix.png":1820,"./db-logos/presto.png":1821,"./db-logos/prometheus.png":1822,"./db-logos/python.png":1823,"./db-logos/qubole.png":1824,"./db-logos/rds_mysql.png":1825,"./db-logos/redshift.png":1826,"./db-logos/redshift_iam.png":1827,"./db-logos/results.png":1828,"./db-logos/rockset.png":1829,"./db-logos/salesforce.png":1830,"./db-logos/scylla.png":1831,"./db-logos/snowflake.png":1832,"./db-logos/sparql_endpoint.png":1833,"./db-logos/sqlite.png":1834,"./db-logos/treasuredata.png":1835,"./db-logos/trino.png":1836,"./db-logos/uptycs.png":1837,"./db-logos/url.png":1838,"./db-logos/vertica.png":1839,"./db-logos/yandex_appmetrika.png":1840,"./db-logos/yandex_metrika.png":1841,"./destinations/chatwork.png":1842,"./destinations/email.png":1843,"./destinations/hangouts_chat.png":1844,"./destinations/hipchat.png":1845,"./destinations/mattermost.png":1846,"./destinations/pagerduty.png":1847,"./destinations/slack.png":1848,"./destinations/webhook.png":1849,"./favicon-16x16.png":1850,"./favicon-32x32.png":1851,"./favicon-96x96.png":1852,"./fixtures/map-tile.png":1853,"./google_logo.svg":1854,"./illustrations/alert.svg":1855,"./illustrations/dashboard.svg":1856,"./illustrations/no-query-results.svg":1857,"./illustrations/query.svg":1858,"./logo.png":1859,"./logo_white.png":1860,"./redash_icon_small.png":103};function n(e){var t=i(e);return a(t)}function i(e){if(!a.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}n.keys=function(){return Object.keys(r)},n.resolve=i,e.exports=n,n.id=1776},1777:function(e,t,a){e.exports=a.p+"images/db-logos/Cassandra.png"},1778:function(e,t,a){e.exports=a.p+"images/db-logos/athena.png"},1779:function(e,t,a){e.exports=a.p+"images/db-logos/aws_es.png"},1780:function(e,t,a){e.exports=a.p+"images/db-logos/axibasetsd.png"},1781:function(e,t,a){e.exports=a.p+"images/db-logos/azure_kusto.png"},1782:function(e,t,a){e.exports=a.p+"images/db-logos/bigquery.png"},1783:function(e,t,a){e.exports=a.p+"images/db-logos/bigquery_gce.png"},1784:function(e,t,a){e.exports=a.p+"images/db-logos/clickhouse.png"},1785:function(e,t,a){e.exports=a.p+"images/db-logos/cloudwatch.png"},1786:function(e,t,a){e.exports=a.p+"images/db-logos/cloudwatch_insights.png"},1787:function(e,t,a){e.exports=a.p+"images/db-logos/cockroach.png"},1788:function(e,t,a){e.exports=a.p+"images/db-logos/corporate_memory.png"},1789:function(e,t,a){e.exports=a.p+"images/db-logos/couchbase.png"},1790:function(e,t,a){e.exports=a.p+"images/db-logos/csv.png"},1791:function(e,t,a){e.exports=a.p+"images/db-logos/databricks.png"},1792:function(e,t,a){e.exports=a.p+"images/db-logos/db2.png"},1793:function(e,t,a){e.exports=a.p+"images/db-logos/dgraph.png"},1794:function(e,t,a){e.exports=a.p+"images/db-logos/drill.png"},1795:function(e,t,a){e.exports=a.p+"images/db-logos/druid.png"},1796:function(e,t,a){e.exports=a.p+"images/db-logos/dynamodb_sql.png"},1797:function(e,t,a){e.exports=a.p+"images/db-logos/elasticsearch.png"},1798:function(e,t,a){e.exports=a.p+"images/db-logos/exasol.png"},1799:function(e,t,a){e.exports=a.p+"images/db-logos/excel.png"},1800:function(e,t,a){e.exports=a.p+"images/db-logos/firebolt.png"},1801:function(e,t,a){e.exports=a.p+"images/db-logos/google_analytics.png"},1802:function(e,t,a){e.exports=a.p+"images/db-logos/google_spreadsheets.png"},1803:function(e,t,a){e.exports=a.p+"images/db-logos/graphite.png"},1804:function(e,t,a){e.exports=a.p+"images/db-logos/hive.png"},1805:function(e,t,a){e.exports=a.p+"images/db-logos/hive_http.png"},1806:function(e,t,a){e.exports=a.p+"images/db-logos/impala.png"},1807:function(e,t,a){e.exports=a.p+"images/db-logos/influxdb.png"},1808:function(e,t,a){e.exports=a.p+"images/db-logos/jirajql.png"},1809:function(e,t,a){e.exports=a.p+"images/db-logos/json.png"},1810:function(e,t,a){e.exports=a.p+"images/db-logos/kibana.png"},1811:function(e,t,a){e.exports=a.p+"images/db-logos/kylin.png"},1812:function(e,t,a){e.exports=a.p+"images/db-logos/mapd.png"},1813:function(e,t,a){e.exports=a.p+"images/db-logos/memsql.png"},1814:function(e,t,a){e.exports=a.p+"images/db-logos/mongodb.png"},1815:function(e,t,a){e.exports=a.p+"images/db-logos/mssql.png"},1816:function(e,t,a){e.exports=a.p+"images/db-logos/mssql_odbc.png"},1817:function(e,t,a){e.exports=a.p+"images/db-logos/mysql.png"},1818:function(e,t,a){e.exports=a.p+"images/db-logos/oracle.png"},1819:function(e,t,a){e.exports=a.p+"images/db-logos/pg.png"},1820:function(e,t,a){e.exports=a.p+"images/db-logos/phoenix.png"},1821:function(e,t,a){e.exports=a.p+"images/db-logos/presto.png"},1822:function(e,t,a){e.exports=a.p+"images/db-logos/prometheus.png"},1823:function(e,t,a){e.exports=a.p+"images/db-logos/python.png"},1824:function(e,t,a){e.exports=a.p+"images/db-logos/qubole.png"},1825:function(e,t,a){e.exports=a.p+"images/db-logos/rds_mysql.png"},1826:function(e,t,a){e.exports=a.p+"images/db-logos/redshift.png"},1827:function(e,t,a){e.exports=a.p+"images/db-logos/redshift_iam.png"},1828:function(e,t,a){e.exports=a.p+"images/db-logos/results.png"},1829:function(e,t,a){e.exports=a.p+"images/db-logos/rockset.png"},1830:function(e,t,a){e.exports=a.p+"images/db-logos/salesforce.png"},1831:function(e,t,a){e.exports=a.p+"images/db-logos/scylla.png"},1832:function(e,t,a){e.exports=a.p+"images/db-logos/snowflake.png"},1833:function(e,t,a){e.exports=a.p+"images/db-logos/sparql_endpoint.png"},1834:function(e,t,a){e.exports=a.p+"images/db-logos/sqlite.png"},1835:function(e,t,a){e.exports=a.p+"images/db-logos/treasuredata.png"},1836:function(e,t,a){e.exports=a.p+"images/db-logos/trino.png"},1837:function(e,t,a){e.exports=a.p+"images/db-logos/uptycs.png"},1838:function(e,t,a){e.exports=a.p+"images/db-logos/url.png"},1839:function(e,t,a){e.exports=a.p+"images/db-logos/vertica.png"},1840:function(e,t,a){e.exports=a.p+"images/db-logos/yandex_appmetrika.png"},1841:function(e,t,a){e.exports=a.p+"images/db-logos/yandex_metrika.png"},1842:function(e,t,a){e.exports=a.p+"images/destinations/chatwork.png"},1843:function(e,t,a){e.exports=a.p+"images/destinations/email.png"},1844:function(e,t,a){e.exports=a.p+"images/destinations/hangouts_chat.png"},1845:function(e,t,a){e.exports=a.p+"images/destinations/hipchat.png"},1846:function(e,t,a){e.exports=a.p+"images/destinations/mattermost.png"},1847:function(e,t,a){e.exports=a.p+"images/destinations/pagerduty.png"},1848:function(e,t,a){e.exports=a.p+"images/destinations/slack.png"},1849:function(e,t,a){e.exports=a.p+"images/destinations/webhook.png"},1850:function(e,t,a){e.exports=a.p+"images/favicon-16x16.png"},1851:function(e,t,a){e.exports=a.p+"images/favicon-32x32.png"},1852:function(e,t,a){e.exports=a.p+"images/favicon-96x96.png"},1853:function(e,t,a){e.exports=a.p+"images/fixtures/map-tile.png"},1854:function(e,t,a){e.exports=a.p+"images/google_logo.svg"},1855:function(e,t,a){e.exports=a.p+"images/illustrations/alert.svg"},1856:function(e,t,a){e.exports=a.p+"images/illustrations/dashboard.svg"},1857:function(e,t,a){e.exports=a.p+"images/illustrations/no-query-results.svg"},1858:function(e,t,a){e.exports=a.p+"images/illustrations/query.svg"},1859:function(e,t,a){e.exports=a.p+"images/logo.png"},1860:function(e,t,a){e.exports=a.p+"images/logo_white.png"},1861:function(e,t){function a(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}a.keys=function(){return[]},a.resolve=a,e.exports=a,a.id=1861},1862:function(e,t,a){},1863:function(e,t,a){},1866:function(e,t,a){"use strict";a.r(t);var r=a(0),n=a.n(r),i=a(30),s=a.n(i),o=(a(6),a(4),a(11)),l=a.n(o),c=a(2),u=a.n(c),d=(a(437),a(47)),m=a(46),p=a.n(m),h=(a(9),a(5)),f=a.n(h);function b(){return(b=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function g(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},i=Object.keys(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function y(e){var t=e.children,a=g(e,["children"]);return n.a.createElement(y.Component,a,t)}function v(e){return n.a.createElement(v.Component,e)}y.Component=function(e){var t=e.children,a=g(e,["children"]);return n.a.createElement("a",a,t)},y.WithIcon=function(e){var t=e.icon,a=e.alt,r=e.children,i=g(e,["icon","alt","children"]);return n.a.createElement(y.Component,i,r," ",t," ",n.a.createElement("span",{className:"sr-only"},a))},y.External=function(e){var t=e.icon,a=void 0===t?n.a.createElement("i",{className:"fa fa-external-link","aria-hidden":"true"}):t,r=e.alt,i=void 0===r?"(opens in a new tab)":r,s=g(e,["icon","alt"]);return n.a.createElement(y.WithIcon,b({target:"_blank",rel:"noopener noreferrer",icon:a,alt:i},s))},v.Component=function(e){return n.a.createElement(f.a,e)},y.Button=v;var O=y,E=(a(16),a(18),a(130)),j=a.n(E),w=a(149),S=a.n(w),P=(a(219),a(76),a(135)),C=a.n(P),N=a(712),k=Object(N.a)();function x(e){var t=e.pathname,a=e.search,r=e.hash,n={};return n.path=t,n.search=Object(c.mapValues)(C.a.parse(a),e=>!!Object(c.isNil)(e)||e),n.hash=Object(c.trimStart)(r,"#"),n.url="".concat(t).concat(a).concat(r),n}var A={listen:e=>Object(c.isFunction)(e)?k.listen((t,a)=>e(A,a)):()=>{},confirmChange:e=>Object(c.isFunction)(e)?k.block(t=>e(x(t),A)):()=>{},update(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Object(c.isObject)(e)&&(e=Object(c.omitBy)({pathname:e.path,search:e.search,hash:e.hash},c.isUndefined),e=Object(c.extend)({pathname:A.path,search:A.search,hash:A.hash},e),Object(c.isObject)(e.search)&&(e.search=Object(c.omitBy)(Object(c.extend)({},A.search,e.search),c.isNil),e.search=Object(c.mapValues)(e.search,e=>!0===e?null:e),e.search=C.a.stringify(e.search))),t?k.replace(e):k.push(e)},url:void 0,path:void 0,setPath(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];A.update({path:e},t)},search:void 0,setSearch(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];A.update({search:e},t)},hash:void 0,setHash(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];A.update({hash:e},t)}};function _(){Object(c.extend)(A,x(k.location))}k.listen(_),_();var q=A,T=a(414),I=a.n(T),D=a(418),R=a.n(D),M=a(20),z=a.n(M);function F(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function U(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?F(Object(a),!0).forEach((function(t){V(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):F(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function V(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function L(e,t){var a=null;z.a.warning({content:"Your session has expired. Please login to continue.",okText:n.a.createElement(n.a.Fragment,null,"Login ",n.a.createElement("i",{className:"fa fa-external-link m-r-5","aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},"(opens in a new tab)")),centered:!0,mask:!0,maskClosable:!1,keyboard:!1,onOk:r=>{if(!a||a.closed){var n,i,s,o,l,u,d=U(U({},(n=640,i=640,s=window.screenX,o=window.screenY,l=window.innerWidth,u=window.innerHeight,{left:Math.floor((l-n)/2+s),top:Math.floor((u-i)/2+o),width:Math.floor(n),height:Math.floor(i)})),{},{menubar:"no",toolbar:"no",location:"yes",resizable:"yes",scrollbars:"yes",status:"yes"});a=window.open(e,"Restore Session",Object(c.map)(d,(e,t)=>"".concat(t,"=").concat(e)).join(","));var m=e=>{"redash_session_restored"===e.data.type&&(a&&a.close(),a=null,window.removeEventListener("message",m),r(),t())};window.addEventListener("message",m,!1)}else a.focus()}})}var B=null;var Q=I.a.create({paramsSerializer:e=>C.a.stringify(e),xsrfCookieName:"csrf_token",xsrfHeaderName:"X-CSRF-TOKEN"});Q.interceptors.response.use(e=>e.data);R()(Q,e=>{var t=Object(c.get)(e,"response.data.message");return e.isAxiosError&&Object(c.includes)(t,"CSRF")?Q.get("/ping"):Promise.reject(e)},{statusCodes:[400]}),R()(Q,e=>{var t=parseInt(Object(c.get)(e,"response.status")),a=Object(c.get)(e,"response.data.message"),r=Object(c.get)(e,"config.url");return e.isAxiosError&&(401===t||Object(c.includes)(a,"Please login"))&&"api/session"!==r?(B||(B=new Promise(e=>{L(X.getLoginUrl(),()=>{B=null,e()})})),B):Promise.reject(e)},{statusCodes:[401,404],pauseInstanceWhileRefreshing:!1});Q.interceptors.request.use(e=>{var t=X.getApiKey();return t&&(e.headers.Authorization="Key ".concat(t)),e});var W={_isAdmin:void 0,canEdit(e){var t=e.user_id||e.user&&e.user.id;return this.isAdmin||t&&t===this.id},canCreate(){return this.hasPermission("create_query")||this.hasPermission("create_dashboard")||this.hasPermission("list_alerts")},hasPermission(e){return"admin"===e&&void 0!==this._isAdmin?this._isAdmin:Object(c.includes)(this.permissions,e)},get isAdmin(){return this.hasPermission("admin")},set isAdmin(e){this._isAdmin=e}},H={},G=[],K=S()("redash:auth"),Y={loaded:!1},$={Login:"login"};function J(e){K("Updating session to be:",e),Object(c.extend)(Y,e,{loaded:!0}),Object(c.extend)(W,Y.user),Object(c.extend)(H,Y.client_config),Object(c.extend)(G,Y.messages)}var X={isAuthenticated:()=>Y.loaded&&Y.user.id,getLoginUrl:()=>$.Login,setLoginUrl(e){$.Login=e},login(){var e=encodeURI(q.url);K("Calling login with next = %s",e),window.location.href="".concat($.Login,"?next=").concat(e)},logout(){K("Logout."),window.location.href="logout"},loadSession:()=>(K("Loading session"),Y.loaded&&Y.user.id?(K("Resolving with local value."),Promise.resolve(Y)):(X.setApiKey(null),Q.get("api/session").then(e=>(J(e),Y)))),loadConfig:()=>(K("Loading config"),Q.get("/api/config").then(e=>(J({client_config:e.client_config,user:{permissions:[]},messages:[]}),e))),setApiKey(e){K("Set API key to: %s",e),X.apiKey=e},getApiKey:()=>X.apiKey,requireSession:()=>(K("Requested authentication"),X.isAuthenticated()?Promise.resolve(Y):X.loadSession().then(()=>{if(X.isAuthenticated())return K("Loaded session"),window.opener&&window.opener.postMessage({type:"redash_session_restored"},window.location.origin),Y;K("Need to login, redirecting"),X.login()}).catch(()=>{K("Need to login, redirecting"),X.login()}))};var Z=new class{refresh(){return Promise.resolve(this)}canCreateDataSource(){return W.isAdmin}isCreateDataSourceEnabled(){return W.isAdmin}canCreateDestination(){return W.isAdmin}isCreateDestinationEnabled(){return W.isAdmin}canCreateDashboard(){return W.hasPermission("create_dashboard")}isCreateDashboardEnabled(){return W.hasPermission("create_dashboard")}canCreateAlert(){return!0}canCreateUser(){return W.isAdmin}isCreateUserEnabled(){return W.isAdmin}isCreateQuerySnippetEnabled(){return!0}getDashboardRefreshIntervals(){var e=H.dashboardRefreshIntervals;return Object(c.isArray)(e)?e:null}getQueryRefreshIntervals(){var e=H.queryRefreshIntervals;return Object(c.isArray)(e)?e:null}canEdit(e){return Object(c.get)(e,"can_edit",!1)}canRun(){return!0}};var ee=new class{constructor(){this.objectCounters={}}refresh(){return Q.get("api/organization/status").then(e=>(this.objectCounters=e.object_counters,this))}},te=(a(384),a(386),a(1)),ae=a.n(te);function re(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},i=Object.keys(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function ne(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var ie=new Map,se=new Set;function oe(e,t){Object(c.isString)(e)&&""!==e&&(ie.set(e,Object(c.isFunction)(t)?t:null),se.forEach(t=>{t.props.name===e&&t.forceUpdate()}))}class le extends n.a.Component{componentDidMount(){se.add(this)}componentWillUnmount(){se.delete(this)}render(){var e=this.props,t=e.name,a=e.children,r=e.fallback,i=re(e,["name","children","fallback"]),s=ie.get(t);return s?n.a.createElement(s,i,a):Object(c.isUndefined)(r)?a:r}}ne(le,"propTypes",{name:ae.a.string.isRequired,fallback:ae.a.node,children:ae.a.node}),ne(le,"defaultProps",{children:null});var ce=a(12),ue=a.n(ce),de=a(3),me=a.n(de);a(1452);function pe(){return(pe=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function he(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},i=Object.keys(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var fe=function(e){var t=e.className,a=e.type,r=he(e,["className","type"]);return n.a.createElement("button",pe({className:me()("plain-button","clickable",{"plain-button-link":"link"===a},t),type:"button"},r))},be=a(77),ge=a.n(be);function ye(){return(ye=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function ve(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},i=Object.keys(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function Oe(e){var t=e.title,a=ve(e,["title"]),r=Object(c.isNil)(t)?null:n.a.createElement("span",{role:"status","aria-live":"assertive","aria-relevant":"additions"},t);return n.a.createElement(ge.a,ye({trigger:["hover","focus"],title:r},a))}var Ee=a(683),je=a.n(Ee),we=a(51),Se=a.n(we);function Pe(e){var t,a;return(t=()=>Object(c.uniqueId)(e),null===(a=Object(r.useRef)(null)).current&&(a.current=t()),a).current}function Ce(e){var t=e.message,a=e.icon,r=e.children,i=e.className,s=Pe("bm-message");return n.a.createElement("div",{className:"big-message p-15 text-center "+i,role:"status","aria-live":"assertive","aria-relevant":"additions removals"},n.a.createElement("h3",{className:"m-t-0 m-b-0","aria-labelledby":s},n.a.createElement("i",{className:me()("fa",a),"aria-hidden":"true"})),n.a.createElement("br",null),n.a.createElement("span",{id:s},t),r)}Ce.propTypes={message:ae.a.string,icon:ae.a.string.isRequired,children:ae.a.node,className:ae.a.string},Ce.defaultProps={message:"",children:null,className:"tiled bg-white"};var Ne=Ce;a(1453);function ke(){return(ke=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function xe(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function Ae(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?xe(Object(a),!0).forEach((function(t){_e(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):xe(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function _e(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function qe(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);r=!0);}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Te(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Te(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Te(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}var Ie=Object(c.mapValues)({HOME:["","Help"],VALUE_SOURCE_OPTIONS:["/user-guide/querying/query-parameters#Value-Source-Options","Guide: Value Source Options"],SHARE_DASHBOARD:["/user-guide/dashboards/sharing-dashboards","Guide: Sharing and Embedding Dashboards"],AUTHENTICATION_OPTIONS:["/user-guide/users/authentication-options","Guide: Authentication Options"],USAGE_DATA_SHARING:["/open-source/admin-guide/usage-data","Help: Anonymous Usage Data Sharing"],DS_ATHENA:["/data-sources/amazon-athena-setup","Guide: Help Setting up Amazon Athena"],DS_BIGQUERY:["/data-sources/bigquery-setup","Guide: Help Setting up BigQuery"],DS_URL:["/data-sources/querying-urls","Guide: Help Setting up URL"],DS_MONGODB:["/data-sources/mongodb-setup","Guide: Help Setting up MongoDB"],DS_GOOGLE_SPREADSHEETS:["/data-sources/querying-a-google-spreadsheet","Guide: Help Setting up Google Spreadsheets"],DS_GOOGLE_ANALYTICS:["/data-sources/google-analytics-setup","Guide: Help Setting up Google Analytics"],DS_AXIBASETSD:["/data-sources/axibase-time-series-database","Guide: Help Setting up Axibase Time Series"],DS_RESULTS:["/user-guide/querying/query-results-data-source","Guide: Help Setting up Query Results"],ALERT_SETUP:["/user-guide/alerts/setting-up-an-alert","Guide: Setting Up a New Alert"],MAIL_CONFIG:["/open-source/setup/#Mail-Configuration","Guide: Mail Configuration"],ALERT_NOTIF_TEMPLATE_GUIDE:["/user-guide/alerts/custom-alert-notifications","Guide: Custom Alerts Notifications"],FAVORITES:["/user-guide/querying/favorites-tagging/#Favorites","Guide: Favorites"],MANAGE_PERMISSIONS:["/user-guide/querying/writing-queries#Managing-Query-Permissions","Guide: Managing Query Permissions"],NUMBER_FORMAT_SPECS:["/user-guide/visualizations/formatting-numbers","Formatting Numbers"],GETTING_STARTED:["/user-guide/getting-started","Guide: Getting Started"],DASHBOARDS:["/user-guide/dashboards","Guide: Dashboards"],QUERIES:["/user-guide/querying","Guide: Queries"],ALERTS:["/user-guide/alerts","Guide: Alerts"]},e=>{var t=qe(e,2);return["https://redash.io/help"+t[0],t[1]]}),De={type:ae.a.string,href:ae.a.string,title:ae.a.node,className:ae.a.string,showTooltip:ae.a.bool,renderAsLink:ae.a.bool,children:ae.a.node},Re={type:null,href:null,title:null,className:null,showTooltip:!0,renderAsLink:!1,children:n.a.createElement("i",{className:"fa fa-question-circle","aria-hidden":"true"})};function Me(e){return n.a.createElement(le,ke({},e,{name:"HelpTrigger"}))}oe("HelpTrigger",function(e){var t,a,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return a=t=class extends n.a.Component{constructor(){super(...arguments),_e(this,"iframeRef",n.a.createRef()),_e(this,"iframeLoadingTimeout",null),_e(this,"state",{visible:!1,loading:!1,error:!1,currentUrl:null}),_e(this,"loadIframe",e=>{clearTimeout(this.iframeLoadingTimeout),this.setState({loading:!0,error:!1}),this.iframeRef.current.src=e,this.iframeLoadingTimeout=setTimeout(()=>{this.setState({error:e,loading:!1})},2e4)}),_e(this,"onIframeLoaded",()=>{this.setState({loading:!1}),clearTimeout(this.iframeLoadingTimeout)}),_e(this,"onPostMessageReceived",e=>{if(Object(c.some)(r,t=>Object(c.startsWith)(e.origin,t))){var t=e.data||{},a=t.type,n=t.message;"iframe_url"===a&&this.setState({currentUrl:n})}}),_e(this,"getUrl",()=>{var t=Object(c.get)(e,this.props.type);return t?t[0]:this.props.href}),_e(this,"openDrawer",e=>{e.shiftKey||e.ctrlKey||e.metaKey||(e.preventDefault(),this.setState({visible:!0}),setTimeout(()=>this.loadIframe(this.getUrl()),300))}),_e(this,"closeDrawer",e=>{e&&e.preventDefault(),this.setState({visible:!1}),this.setState({visible:!1,currentUrl:null})})}componentDidMount(){window.addEventListener("message",this.onPostMessageReceived,!1)}componentWillUnmount(){window.removeEventListener("message",this.onPostMessageReceived),clearTimeout(this.iframeLoadingTimeout)}render(){var t=this.getUrl();if(!t)return null;var a=Object(c.get)(e,"".concat(this.props.type,"[1]"),this.props.title),s=me()("help-trigger",this.props.className),o=this.state.currentUrl,l=Object(c.some)(r,e=>Object(c.startsWith)(o||t,e)),u=this.props.renderAsLink||!l;return n.a.createElement(n.a.Fragment,null,n.a.createElement(Oe,{title:this.props.showTooltip?n.a.createElement(n.a.Fragment,null,a,u&&n.a.createElement(n.a.Fragment,null," ",n.a.createElement("i",{className:"fa fa-external-link",style:{marginLeft:5},"aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},"(opens in a new tab)"))):null},n.a.createElement(O,{href:o||this.getUrl(),className:s,rel:"noopener noreferrer",target:"_blank",onClick:u?()=>{}:this.openDrawer},this.props.children)),n.a.createElement(je.a,{placement:"right",closable:!1,onClose:this.closeDrawer,visible:this.state.visible,className:me()("help-drawer",i),destroyOnClose:!0,width:400},n.a.createElement("div",{className:"drawer-wrapper"},n.a.createElement("div",{className:"drawer-menu"},o&&n.a.createElement(Oe,{title:"Open page in a new window",placement:"left"},n.a.createElement(O,{href:o,target:"_blank"},n.a.createElement("i",{className:"fa fa-external-link","aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},"(opens in a new tab)"))),n.a.createElement(Oe,{title:"Close",placement:"bottom"},n.a.createElement(fe,{onClick:this.closeDrawer},n.a.createElement(Se.a,null)))),!this.state.error&&n.a.createElement("iframe",{ref:this.iframeRef,title:"Usage Help",src:"about:blank",className:me()({ready:!this.state.loading}),onLoad:this.onIframeLoaded}),this.state.loading&&n.a.createElement(Ne,{icon:"fa-spinner fa-2x fa-pulse",message:"Loading...",className:"help-message"}),this.state.error&&n.a.createElement(Ne,{icon:"fa-exclamation-circle",className:"help-message"},"Something went wrong.",n.a.createElement("br",null),n.a.createElement(O,{href:this.state.error,target:"_blank",rel:"noopener"},"Click here")," ","to open the page in a new window.")),n.a.createElement(le,{name:"HelpDrawerExtraContent",onLeave:this.closeDrawer,openPageUrl:this.loadIframe})))}},_e(t,"propTypes",Ae(Ae({},De),{},{type:ae.a.oneOf(Object.keys(e))})),_e(t,"defaultProps",Re),a}(Ie,["https://redash.io"])),Me.propTypes=De,Me.defaultProps=Re;var ze=a(19),Fe=a.n(ze);a(52);function Ue(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function Ve(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Ue(Object(a),!0).forEach((function(t){Le(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Ue(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Le(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function Be(){return(Be=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}var Qe=ae.a.shape({props:ae.a.shape({visible:ae.a.bool,onOk:ae.a.func,onCancel:ae.a.func,afterClose:ae.a.func}).isRequired,close:ae.a.func.isRequired,dismiss:ae.a.func.isRequired});function We(e){return{Component:e,showModal:t=>function(e,t){var a={props:{visible:!0,okButtonProps:{},cancelButtonProps:{},onOk:()=>{},onCancel:()=>{},afterClose:()=>{}},close:()=>{},dismiss:()=>{}},r=null,i={onClose:()=>{},onDismiss:()=>{}},o=document.createElement("div");function l(){s.a.render(n.a.createElement(e,Be({},t,{dialog:a})),o)}function u(e,t){return a.props.okButtonProps={disabled:!0},a.props.cancelButtonProps={disabled:!0},t(),l(),Promise.resolve(e).then(()=>{a.props.visible=!1}).finally(()=>{a.props.okButtonProps={},a.props.cancelButtonProps={},l()})}function d(e){return r||(r=u(i.onClose(e),()=>{a.props.okButtonProps.loading=!0}).finally(()=>{r=null})),r}function m(e){return r||(r=u(i.onDismiss(e),()=>{a.props.cancelButtonProps.loading=!0}).finally(()=>{r=null})),r}document.body.appendChild(o),a.props.onOk=d,a.props.onCancel=m,a.props.afterClose=function(){setTimeout(()=>{s.a.unmountComponentAtNode(o),document.body.removeChild(o)},10)},a.close=d,a.dismiss=m;var p={close:d,dismiss:m,update:e=>{t=Ve(Ve({},t),e),l()},onClose:e=>(Object(c.isFunction)(e)&&(i.onClose=e),p),onDismiss:e=>(Object(c.isFunction)(e)&&(i.onDismiss=e),p)};return l(),p}(e,t)}}var He=document.createElement("a");He.style.display="none",document.body.appendChild(He);var Ge=["origin","protocol","host","hostname","port","pathname","search","hash","href"];var Ke={parse:function(e){return He.setAttribute("href",e),Object(c.pick)(He,Ge)},stringify:function(e){return Object(c.extend)(He,Object(c.pick)(e,Ge)),He.href},normalize:function(e){return He.setAttribute("href",e),He.href}},Ye=a(684);a(1456);function $e(e){return n.a.createElement("h4",null,e.message)}function Je(){return(Je=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Xe(e,t){switch(e){case 404:return"It seems like the page you're looking for cannot be found.";case 401:case 403:return"It seems like you donâ€™t have permission to see this page.";default:return t}}function Ze(e){var t="It seems like we encountered an error. Try refreshing this page or contact your administrator.";if(Object(c.isObject)(e)){if(e.isAxiosError&&Object(c.isObject)(e.response))return Xe(e.response.status,Object(c.get)(e,"response.data.message",t));if(e.status)return Xe(e.status,t)}return t}function et(e){var t=e.error,a=e.message;if(!t)return null;console.error(t);var r={error:t,message:a||Ze(t)};return n.a.createElement("div",{className:"error-message-container","data-test":"ErrorMessage",role:"alert"},n.a.createElement("div",{className:"error-state bg-white tiled"},n.a.createElement("div",{className:"error-state__icon"},n.a.createElement("i",{className:"zmdi zmdi-alert-circle-o","aria-hidden":"true"})),n.a.createElement("div",{className:"error-state__details"},n.a.createElement(le,Je({name:"ErrorMessageDetails",fallback:n.a.createElement($e,r)},r)))))}function tt(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function at(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?tt(Object(a),!0).forEach((function(t){rt(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):tt(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function rt(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function nt(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);r=!0);}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return it(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return it(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function it(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}$e.propTypes={error:ae.a.instanceOf(Error).isRequired,message:ae.a.string.isRequired},et.propTypes={error:ae.a.object.isRequired,message:ae.a.string};var st=n.a.createContext(null);function ot(e){var t=Object(c.trimEnd)(Ke.normalize(""),"/")+"/";return e=Ke.normalize(e),!!Object(c.startsWith)(e,t)&&"/"+Object(c.trimStart)(e.substr(t.length),"/")}function lt(e){var t=e.routes,a=e.onRouteChange,i=nt(Object(r.useState)(null),2),s=i[0],o=i[1],l=Object(r.useRef)(null),u=Object(r.useRef)();return Object(r.useEffect)(()=>{var e=!1,a=new Ye.a(t,{resolveRoute(e,t){var a=e.route;if(Object(c.isFunction)(a.render))return at(at({},a),{},{routeParams:t})}});function r(t){if(!e){u.current&&u.current.reset();var r=ot(q.path)||"/";if(r===l.current)return;if(l.current=r,"REPLACE"===t)return;a.resolve({pathname:r}).then(t=>{e||l.current!==r||o(at(at({},t),{},{key:Math.random().toString(32).substr(2)}))}).catch(t=>{e||l.current!==r||o({render:e=>n.a.createElement(et,e.routeParams),routeParams:{error:t}})})}}r("PUSH");var i=q.listen((e,t)=>r(t));return()=>{e=!0,l.current=null,i()}},[t]),Object(r.useEffect)(()=>{a(s)},[s,a]),s?n.a.createElement(st.Provider,{value:s},n.a.createElement(j.a,{ref:u,renderError:e=>n.a.createElement(et,{error:e})},s.render(s))):null}function ct(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];setTimeout(()=>{!1===ot(e)?window.location=e:(e=Ke.parse(e),q.update({path:e.pathname,search:e.search,hash:e.hash},t))},10)}lt.propTypes={routes:ae.a.arrayOf(ae.a.shape({path:ae.a.string.isRequired,render:ae.a.func,resolve:ae.a.objectOf(ae.a.any)})),onRouteChange:ae.a.func},lt.defaultProps={routes:[],onRouteChange:()=>{}};var ut=[],dt=Object(c.debounce)(()=>{var e=ut;ut=[],Q.post("api/events",e)},1e3);function mt(e,t,a,r){var n={action:e,object_type:t,object_id:a,timestamp:Date.now()/1e3,screen_resolution:"".concat(window.screen.width,"x").concat(window.screen.height)};Object(c.extend)(n,r),ut.push(n),dt()}var pt=6,ht=50,ft=15,bt=800,gt=3,yt=3,vt=1,Ot=6,Et=1,jt=1e3;var wt=class{constructor(e,t){this.title=e.title,this.name=e.name,this.type=e.type,this.global=e.global,this.parentQueryId=t,this.locals=[],this.urlPrefix="p_"}static getExecutionValue(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(c.isObject)(e)&&Object(c.isFunction)(e.getExecutionValue)?e.getExecutionValue(t):null}static setValue(e,t){return Object(c.isObject)(e)&&Object(c.isFunction)(e.setValue)?e.setValue(t):null}get isEmpty(){return Object(c.isNull)(this.normalizedValue)}get hasPendingValue(){return void 0!==this.pendingValue&&!Object(c.isEqual)(this.pendingValue,this.normalizedValue)}get normalizedValue(){return this.$$value}isEmptyValue(e){return Object(c.isNull)(this.normalizeValue(e))}normalizeValue(e){return Object(c.isUndefined)(e)?null:e}updateLocals(){Object(c.isArray)(this.locals)&&Object(c.each)(this.locals,e=>{e.setValue(this.value)})}setValue(e){var t=this.normalizeValue(e);return this.value=t,this.$$value=t,this.updateLocals(),this.clearPendingValue(),this}getExecutionValue(){return this.value}setPendingValue(e){this.pendingValue=this.normalizeValue(e)}applyPendingValue(){this.hasPendingValue&&this.setValue(this.pendingValue)}clearPendingValue(){this.pendingValue=void 0}toUrlParams(){var e=this.urlPrefix;return{["".concat(e).concat(this.name)]:this.isEmpty?null:this.value}}fromUrlParams(e){var t=this.urlPrefix,a="".concat(t).concat(this.name);Object(c.has)(e,a)&&this.setValue(e[a])}toQueryTextFragment(){return"{{ ".concat(this.name," }}")}toSaveableObject(){return Object(c.omit)(this,["$$value","urlPrefix","pendingValue","parentQueryId"])}};var St=class extends wt{constructor(e,t){super(e,t),this.setValue(e.value)}normalizeValue(e){var t=Object(c.toString)(e);return Object(c.isEmpty)(t)?null:t}};var Pt=class extends wt{constructor(e,t){super(e,t),this.setValue(e.value)}normalizeValue(e){if(Object(c.isNull)(e))return null;var t=Object(c.toNumber)(e);return isNaN(t)?null:t}};a(128);var Ct=class extends wt{constructor(e,t){super(e,t),this.enumOptions=e.enumOptions,this.multiValuesOptions=e.multiValuesOptions,this.setValue(e.value)}normalizeValue(e){if(Object(c.isEmpty)(this.enumOptions))return null;var t=this.enumOptions.split("\n")||[];return this.multiValuesOptions?(Object(c.isArray)(e)||(e=[e]),e=Object(c.intersection)(e,t)):e&&!Object(c.isArray)(e)&&Object(c.includes)(t,e)||(e=t[0]),Object(c.isArray)(e)&&Object(c.isEmpty)(e)?null:e}getExecutionValue(){if((arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).joinListValues&&Object(c.isArray)(this.value)){var e=Object(c.get)(this.multiValuesOptions,"separator",","),t=Object(c.get)(this.multiValuesOptions,"prefix",""),a=Object(c.get)(this.multiValuesOptions,"suffix",""),r=Object(c.map)(this.value,e=>"".concat(t).concat(e).concat(a));return Object(c.join)(r,e)}return this.value}toUrlParams(){var e=this.urlPrefix,t=this.value;return this.multiValuesOptions&&Object(c.isArray)(this.value)&&(t=JSON.stringify(this.value)),{["".concat(e).concat(this.name)]:this.isEmpty?null:t}}fromUrlParams(e){var t=this.urlPrefix,a="".concat(t).concat(this.name);if(Object(c.has)(e,a))if(this.multiValuesOptions)try{var r=JSON.parse(e[a]);this.setValue(Object(c.isArray)(r)?r:e[a])}catch(t){this.setValue(e[a])}else this.setValue(e[a])}},Nt=(a(621),a(236)),kt=a.n(Nt),xt=S()("redash:services:QueryResult"),At=["filter","multi-filter","multiFilter"];function _t(e){return function(e){var t;if(-1!==e.indexOf("::"))t="::";else{if(-1===e.indexOf("__"))return e;t="__"}var a=e.split(t);return""===a[0]&&2===a.length?a[1]:Object(c.includes)(At,a[1])?a[0]:e}(e).replace(/(?:^|\s)\S/g,e=>e.toUpperCase())}var qt=e=>{var t=e.id;return Q.get("api/query_results/".concat(t))},Tt=e=>Q.post((e=>e.id?"api/query_results/".concat(e.id):"api/query_results")(e),e),It="waiting",Dt="processing",Rt="done",Mt="failed",zt="loading-result",Ft={1:It,2:Dt,3:Rt,4:Mt};function Ut(e,t){switch(Object(c.get)(t,"response.status")){case 403:return void e.update(t.response.data);case 400:if("job"in t.response.data)return void e.update(t.response.data);break;case 404:return void e.update({job:{error:"cached query result unavailable, please execute again.",status:4}})}xt("Unknown error",t),e.update({job:{error:Object(c.get)(t,"response.data.message","Unknown error occurred. Please try again later."),status:4}})}function Vt(e){return new Promise(t=>setTimeout(t,e))}function Lt(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3;return Q.get("api/jobs/".concat(e)).then(e=>{var a=Ft[e.job.status];return a===It||a===Dt?Vt(t).then(()=>Lt(e.job.id)):a===Rt?e.job.result:a===Mt?Promise.reject(e.job.error):void 0})}class Bt{constructor(e){var t;this.deferred=((t={onStatusChange:e=>{}}).promise=new Promise((e,a)=>{t.resolve=e,t.reject=a}),t),this.job={},this.query_result={},this.status="waiting",this.updatedAt=l()(),this.isLoadingResult=!1,e&&this.update(e)}update(e){if(Object(c.extend)(this,e),"query_result"in e){this.status=Rt,this.deferred.onStatusChange(Rt);var t={};Object(c.each)(this.query_result.data.rows,e=>{Object(c.forOwn)(e,(a,r)=>{var n=null;Object(c.isNumber)(a)?n="float":Object(c.isString)(a)&&a.match(/^\d{4}-\d{2}-\d{2}T/)?(e[r]=l.a.utc(a),n="datetime"):Object(c.isString)(a)&&a.match(/^\d{4}-\d{2}-\d{2}$/)?(e[r]=l.a.utc(a),n="date"):"object"==typeof a&&null!==a?e[r]=JSON.stringify(a):n="string",null!==n&&(void 0!==t[r]&&t[r]!==n?t[r]="string":t[r]=n)})}),Object(c.each)(this.query_result.data.columns,e=>{e.name=""+e.name,t[e.name]&&(null!=e.type&&"string"!==e.type||(e.type=t[e.name]))}),this.deferred.resolve(this)}else 3===this.job.status||2===this.job.status?(this.deferred.onStatusChange(Dt),this.status="processing"):4===this.job.status?(this.status=Ft[this.job.status],this.deferred.reject(new ea(this.job.error))):(this.deferred.onStatusChange(void 0),this.status=void 0)}getId(){var e=null;return"query_result"in this&&(e=this.query_result.id),e}cancelExecution(){Q.delete("api/jobs/".concat(this.job.id))}getStatus(){return this.isLoadingResult?zt:this.status||Ft[this.job.status]}getError(){if("None"!==this.job.error)return this.job.error}getLog(){return this.query_result.data&&this.query_result.data.log&&0!==this.query_result.data.log.length?this.query_result.data.log:null}getUpdatedAt(){return this.query_result.retrieved_at||1e3*this.job.updated_at||this.updatedAt}getRuntime(){return this.query_result.runtime}getRawData(){return this.query_result.data?this.query_result.data.rows:null}getData(){return this.query_result.data?this.query_result.data.rows:null}isEmpty(){return null===this.getData()||0===this.getData().length}getColumns(){return void 0===this.columns&&this.query_result.data&&(this.columns=this.query_result.data.columns),this.columns}getColumnNames(){return void 0===this.columnNames&&this.query_result.data&&(this.columnNames=this.query_result.data.columns.map(e=>e.name)),this.columnNames}getColumnFriendlyNames(){return this.getColumnNames().map(e=>_t(e))}getTruncated(){return this.query_result.data?this.query_result.data.truncated:null}getFilters(){if(!this.getColumns())return[];var e=[];return this.getColumns().forEach(t=>{var a=t.name,r=a.split("::")[1]||a.split("__")[1];if(Object(c.includes)(At,r)){var n={name:a,friendlyName:_t(a),column:t,values:[],multiple:"multiFilter"===r||"multi-filter"===r};e.push(n)}},this),this.getRawData().forEach(t=>{e.forEach(e=>{e.values.push(t[e.name]),1===e.values.length&&(e.multiple?e.current=[t[e.name]]:e.current=t[e.name])})}),e.forEach(e=>{e.values=Object(c.uniqBy)(e.values,e=>l.a.isMoment(e)?e.unix():e)}),e}toPromise(e){return e&&(this.deferred.onStatusChange=e),this.deferred.promise}static getById(e,t){var a=new Bt;return a.isLoadingResult=!0,a.deferred.onStatusChange(zt),Q.get("api/queries/".concat(e,"/results/").concat(t,".json")).then(e=>{a.isLoadingResult=!1,a.update(e)}).catch(e=>{a.isLoadingResult=!1,Ut(a,e)}),a}loadLatestCachedResult(e,t){Q.post("api/queries/".concat(e,"/results"),{queryId:e,parameters:t}).then(e=>{this.update(e)}).catch(e=>{Ut(this,e)})}loadResult(e){this.isLoadingResult=!0,this.deferred.onStatusChange(zt),qt({id:this.job.query_result_id}).then(e=>{this.update(e),this.isLoadingResult=!1}).catch(t=>{void 0===e&&(e=0),e>3?(xt("Connection error while trying to load result",t),this.update({job:{error:"failed communicating with server. Please check your Internet connection and try again.",status:4}}),this.isLoadingResult=!1):setTimeout(()=>{this.loadResult(e+1)},1e3*Math.pow(2,e))})}refreshStatus(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=()=>X.isAuthenticated()?this.loadResult():this.loadLatestCachedResult(e,t);(X.isAuthenticated()?Q.get("api/jobs/".concat(this.job.id)):Q.get("api/queries/".concat(e,"/jobs/").concat(this.job.id))).then(n=>{if(this.update(n),"processing"===this.getStatus()&&this.job.query_result_id&&"None"!==this.job.query_result_id)r();else if("failed"!==this.getStatus()){setTimeout(()=>{this.refreshStatus(e,t,a+1)},a>10?3e3:500)}}).catch(e=>{xt("Connection error",e),this.update({job:{error:"failed communicating with server. Please check your Internet connection and try again.",status:4}})})}getLink(e,t,a){var r="api/queries/".concat(e,"/results/").concat(this.getId(),".").concat(t);return a&&(r="".concat(r,"?api_key=").concat(a)),r}getName(e,t){return"".concat(e.replace(/ /g,"_")+l()(this.getUpdatedAt()).format("_YYYY_MM_DD"),".").concat(t)}static getByQueryId(e,t,a,r){var n=new Bt;return Q.post("api/queries/".concat(e,"/results"),{id:e,parameters:t,apply_auto_limit:a,max_age:r}).then(a=>{n.update(a),"job"in a&&n.refreshStatus(e,t)}).catch(e=>{Ut(n,e)}),n}static get(e,t,a,r,n,i){var s=new Bt,o={data_source_id:e,parameters:a,query:t,apply_auto_limit:r,max_age:n};return void 0!==i&&(o.query_id=i),Tt(o).then(e=>{s.update(e),"job"in e&&s.refreshStatus(t,a)}).catch(e=>{Ut(s,e)}),s}}var Qt=Bt,Wt="localOptions:";var Ht={get:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,a=Wt+e;return a in window.localStorage?JSON.parse(window.localStorage.getItem(a)):t},set:function(e,t){var a=Wt+e;window.localStorage.setItem(a,JSON.stringify(t))}};function Gt(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function Kt(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Gt(Object(a),!0).forEach((function(t){Yt(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Gt(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Yt(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function $t(){return($t=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}kt.a.escape=c.identity;var Jt=S()("redash:services:query");class Xt{constructor(e){Object(c.extend)(this,e),Object(c.has)(this,"options")||(this.options={}),this.options.apply_auto_limit=!!this.options.apply_auto_limit,Object(c.isArray)(this.options.parameters)||(this.options.parameters=[])}isNew(){return void 0===this.id}hasDailySchedule(){return this.schedule&&null!==this.schedule.match(/\d\d:\d\d/)}scheduleInLocalTime(){var e=this.schedule.split(":");return l.a.utc().hour(e[0]).minute(e[1]).local().format("HH:mm")}hasResult(){return!(!this.latest_query_data&&!this.latest_query_data_id)}paramsRequired(){return this.getParameters().isRequired()}hasParameters(){return this.getParametersDefs().length>0}prepareQueryResultExecution(e,t){var a=this.getParameters(),r=a.getMissing();if(r.length>0){var n="parameter",i="value";return r.length>1&&(n="parameters",i="values"),new Qt({job:{error:"missing ".concat(i," for ").concat(r.join(", ")," ").concat(n,"."),status:4}})}return a.isRequired()&&(this.latest_query_data=null,this.latest_query_data_id=null),this.latest_query_data&&0!==t?this.queryResult||(this.queryResult=new Qt({query_result:this.latest_query_data})):this.latest_query_data_id&&0!==t?this.queryResult||(this.queryResult=Qt.getById(this.id,this.latest_query_data_id)):this.queryResult=e(),this.queryResult}getQueryResult(e){return this.prepareQueryResultExecution(()=>Qt.getByQueryId(this.id,this.getParameters().getExecutionValues(),this.getAutoLimit(),e),e)}getQueryResultByText(e,t){var a=t||this.query;if(!a)return new ea("Can't execute empty query.");var r=this.getParameters().getExecutionValues({joinListValues:!0});return this.prepareQueryResultExecution(()=>Qt.get(this.data_source_id,a,r,this.getAutoLimit(),e,this.id),e)}getUrl(e,t){var a="queries/".concat(this.id);e&&(a+="/source");var r={};return this.getParameters().isRequired()&&this.getParametersDefs().forEach(e=>{Object(c.extend)(r,e.toUrlParams())}),Object.keys(r).forEach(e=>null==r[e]&&delete r[e]),""!==(r=Object(c.map)(r,(e,t)=>"".concat(encodeURIComponent(t),"=").concat(encodeURIComponent(e))).join("&"))&&(a+="?".concat(r)),t&&(a+="#".concat(t)),a}getQueryResultPromise(){return this.getQueryResult().toPromise()}getParameters(){return this.$parameters||(this.$parameters=new Zt(this,q.search)),this.$parameters}getAutoLimit(){return this.options.apply_auto_limit}getParametersDefs(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.getParameters().get(e)}favorite(){return Xt.favorite(this)}unfavorite(){return Xt.unfavorite(this)}clone(){var e=Object(c.clone)(this);return e.$parameters=null,e.getParameters(),e}}class Zt{constructor(e,t){this.query=e,this.updateParameters(),this.initFromQueryString(t)}parseQuery(){var e=()=>Object(c.map)(this.query.options.parameters,e=>e.name),t=[];if(void 0!==this.query.query)try{var a=kt.a.parse(this.query.query);t=Object(c.uniq)(function e(t){var a=[];return t.forEach(t=>{"name"===t[0]||"&"===t[0]?a.push(t[1].split(".")[0]):"#"===t[0]&&(a=Object(c.union)(a,e(t[4])))}),a}(a))}catch(a){Jt("Failed parsing parameters: ",a),t=e()}else t=e();return t}updateParameters(e){if(this.query.query!==this.cachedQueryText){this.cachedQueryText=this.query.query;var t=e?this.parseQuery():Object(c.map)(this.query.options.parameters,e=>e.name);this.query.options.parameters=this.query.options.parameters||[];var a={};this.query.options.parameters.forEach(e=>{a[e.name]=e}),t.forEach(e=>{Object(c.has)(a,e)||this.query.options.parameters.push(Pa({title:e,name:e,type:"text",value:null,global:!1}))});var r=this.query.options.parameters;this.query.options.parameters=r.filter(e=>Object(c.includes)(t,e.name)).map(e=>e instanceof wt?e:Pa(e,this.query.id))}else{var n=this.query.options.parameters;Object(c.find)(n,e=>!(e instanceof wt))&&(this.query.options.parameters=Object(c.map)(n,e=>e instanceof wt?e:Pa(e,this.query.id)))}}initFromQueryString(e){this.get().forEach(t=>{t.fromUrlParams(e)})}get(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.updateParameters(e),this.query.options.parameters}add(e){this.query.options.parameters=this.query.options.parameters.filter(t=>t.name!==e.name);var t=Pa(e);return this.query.options.parameters.push(t),t}getMissing(){return Object(c.map)(Object(c.filter)(this.get(),e=>e.isEmpty),e=>e.title)}isRequired(){return!Object(c.isEmpty)(this.get())}getExecutionValues(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this.get();return Object(c.zipObject)(Object(c.map)(t,e=>e.name),Object(c.map)(t,t=>t.getExecutionValue(e)))}hasPendingValues(){return Object(c.some)(this.get(),e=>e.hasPendingValue)}applyPendingValues(){Object(c.each)(this.get(),e=>e.applyPendingValue())}toUrlParams(){if(0===this.get().length)return"";var e=$t(...this.get().map(e=>e.toUrlParams()));return Object.keys(e).forEach(t=>null==e[t]&&delete e[t]),Object.keys(e).map(t=>"".concat(encodeURIComponent(t),"=").concat(encodeURIComponent(e[t]))).join("&")}}class ea{constructor(e){this.errorMessage=e,this.updatedAt=l.a.utc()}getUpdatedAt(){return this.updatedAt}getError(){return this.errorMessage}toPromise(){return Promise.reject(this)}getStatus(){return"failed"}getData(){return null}getLog(){return null}}var ta=e=>new Xt(e),aa=e=>Kt(Kt({},e),{},{results:Object(c.map)(e.results,ta)}),ra={query:e=>Q.get("api/queries",{params:e}).then(aa),get:e=>Q.get("api/queries/".concat(e.id),e).then(ta),save:e=>Q.post((e=>e.id?"api/queries/".concat(e.id):"api/queries")(e),e).then(ta),delete:e=>Q.delete("api/queries/".concat(e.id)),recent:e=>Q.get("api/queries/recent",{params:e}).then(e=>Object(c.map)(e,ta)),archive:e=>Q.get("api/queries/archive",{params:e}).then(aa),myQueries:e=>Q.get("api/queries/my",{params:e}).then(aa),fork:e=>{var t=e.id;return Q.post("api/queries/".concat(t,"/fork"),{id:t}).then(ta)},resultById:e=>Q.get("api/queries/".concat(e.id,"/results.json")),asDropdown:e=>Q.get("api/queries/".concat(e.id,"/dropdown")),associatedDropdown:e=>{var t=e.queryId,a=e.dropdownQueryId;return Q.get("api/queries/".concat(t,"/dropdowns/").concat(a))},favorites:e=>Q.get("api/queries/favorites",{params:e}).then(aa),favorite:e=>Q.post("api/queries/".concat(e.id,"/favorite")),unfavorite:e=>Q.delete("api/queries/".concat(e.id,"/favorite")),newQuery:function(){return new Xt({query:"",name:"New Query",schedule:null,user:W,options:{apply_auto_limit:Ht.get("applyAutoLimit",!0)},tags:[],can_edit:!0})}};Object(c.extend)(Xt,ra);var na=class extends wt{constructor(e,t){super(e,t),this.queryId=e.queryId,this.multiValuesOptions=e.multiValuesOptions,this.setValue(e.value)}normalizeValue(e){return Object(c.isUndefined)(e)||Object(c.isNull)(e)||Object(c.isArray)(e)&&Object(c.isEmpty)(e)?null:e=this.multiValuesOptions?Object(c.isArray)(e)?e:[e]:Object(c.isArray)(e)?e[0]:e}getExecutionValue(){if((arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).joinListValues&&Object(c.isArray)(this.value)){var e=Object(c.get)(this.multiValuesOptions,"separator",","),t=Object(c.get)(this.multiValuesOptions,"prefix",""),a=Object(c.get)(this.multiValuesOptions,"suffix",""),r=Object(c.map)(this.value,e=>"".concat(t).concat(e).concat(a));return Object(c.join)(r,e)}return this.value}toUrlParams(){var e=this.urlPrefix,t=this.value;return this.multiValuesOptions&&Object(c.isArray)(this.value)&&(t=JSON.stringify(this.value)),{["".concat(e).concat(this.name)]:this.isEmpty?null:t}}fromUrlParams(e){var t=this.urlPrefix,a="".concat(t).concat(this.name);if(Object(c.has)(e,a))if(this.multiValuesOptions)try{var r=JSON.parse(e[a]);this.setValue(Object(c.isArray)(r)?r:e[a])}catch(t){this.setValue(e[a])}else this.setValue(e[a])}loadDropdownValues(){return this.parentQueryId?Xt.associatedDropdown({queryId:this.parentQueryId,dropdownQueryId:this.queryId}).catch(()=>Promise.resolve([])):Xt.asDropdown({id:this.queryId}).catch(Promise.resolve([]))}},ia={date:"YYYY-MM-DD","datetime-local":"YYYY-MM-DD HH:mm","datetime-with-seconds":"YYYY-MM-DD HH:mm:ss"},sa={now:{name:"Today/Now",value:()=>l()()},yesterday:{name:"Yesterday",value:()=>l()().subtract(1,"day")}},oa=ae.a.oneOf(Object(c.values)(sa));function la(e){return Object(c.startsWith)(e,"d_")&&Object(c.has)(sa,e.substring("d_".length))}function ca(e){return Object(c.includes)(sa,e)}function ua(e){return la(e)?sa[e.substring("d_".length)]:null}var da=class extends wt{constructor(e,t){super(e,t),this.useCurrentDateTime=e.useCurrentDateTime,this.setValue(e.value)}get hasDynamicValue(){return ca(this.normalizedValue)}normalizeValue(e){if(la(e))return ua(e);if(ca(e))return e;var t=l()(e);return t.isValid()?t:null}setValue(e){var t=this.normalizeValue(e);return ca(t)?this.value="d_"+Object(c.findKey)(sa,t):l.a.isMoment(t)?this.value=t.format(ia[this.type]):this.value=t,this.$$value=t,this.updateLocals(),this.clearPendingValue(),this}getExecutionValue(){return this.hasDynamicValue?this.normalizedValue.value().format(ia[this.type]):Object(c.isNull)(this.value)&&this.useCurrentDateTime?l()().format(ia[this.type]):this.value}};function ma(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);r=!0);}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return pa(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return pa(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function pa(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}var ha={"date-range":"YYYY-MM-DD","datetime-range":"YYYY-MM-DD HH:mm","datetime-range-with-seconds":"YYYY-MM-DD HH:mm:ss"},fa=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:()=>l()();return function(){var a=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return[e(),a?t():void 0]}},ba={today:{name:"Today",value:()=>[l()().startOf("day"),l()().endOf("day")]},yesterday:{name:"Yesterday",value:()=>[l()().subtract(1,"day").startOf("day"),l()().subtract(1,"day").endOf("day")]},this_week:{name:"This week",value:()=>[l()().startOf("week"),l()().endOf("week")]},this_month:{name:"This month",value:()=>[l()().startOf("month"),l()().endOf("month")]},this_year:{name:"This year",value:()=>[l()().startOf("year"),l()().endOf("year")]},last_week:{name:"Last week",value:()=>[l()().subtract(1,"week").startOf("week"),l()().subtract(1,"week").endOf("week")]},last_month:{name:"Last month",value:()=>[l()().subtract(1,"month").startOf("month"),l()().subtract(1,"month").endOf("month")]},last_year:{name:"Last year",value:()=>[l()().subtract(1,"year").startOf("year"),l()().subtract(1,"year").endOf("year")]},last_hour:{name:"Last hour",value:fa(()=>l()().subtract(1,"hour"))},last_8_hours:{name:"Last 8 hours",value:fa(()=>l()().subtract(8,"hour"))},last_24_hours:{name:"Last 24 hours",value:fa(()=>l()().subtract(24,"hour"))},last_7_days:{name:"Last 7 days",value:fa(()=>l()().subtract(7,"days").startOf("day"),()=>l()().endOf("day"))},last_14_days:{name:"Last 14 days",value:fa(()=>l()().subtract(14,"days").startOf("day"),()=>l()().endOf("day"))},last_30_days:{name:"Last 30 days",value:fa(()=>l()().subtract(30,"days").startOf("day"),()=>l()().endOf("day"))},last_60_days:{name:"Last 60 days",value:fa(()=>l()().subtract(60,"days").startOf("day"),()=>l()().endOf("day"))},last_90_days:{name:"Last 90 days",value:fa(()=>l()().subtract(90,"days").startOf("day"),()=>l()().endOf("day"))},last_12_months:{name:"Last 12 months",value:fa(()=>l()().subtract(12,"months").startOf("day"),()=>l()().endOf("day"))}},ga=ae.a.oneOf(Object(c.values)(ba));function ya(e){return!!Object(c.startsWith)(e,"d_")&&!!ba[e.substring("d_".length)]}function va(e){return Object(c.includes)(ba,e)}function Oa(e){return ya(e)?ba[e.substring("d_".length)]:null}var Ea=class extends wt{constructor(e,t){super(e,t),this.setValue(e.value)}get hasDynamicValue(){return va(this.normalizedValue)}normalizeValue(e){return ya(e)?Oa(e):va(e)?e:(Object(c.isObject)(e)&&!Object(c.isArray)(e)&&(e=[e.start,e.end]),Object(c.isArray)(e)&&2===e.length&&(e=[l()(e[0]),l()(e[1])])[0].isValid()&&e[1].isValid()?e:null)}setValue(e){var t=this.normalizeValue(e);return va(t)?this.value="d_"+Object(c.findKey)(ba,t):Object(c.isArray)(t)?this.value={start:t[0].format(ha[this.type]),end:t[1].format(ha[this.type])}:this.value=t,this.$$value=t,this.updateLocals(),this.clearPendingValue(),this}getExecutionValue(){if(this.hasDynamicValue){var e=ma(this.normalizedValue.value().map(e=>e.format(ha[this.type])),2);return{start:e[0],end:e[1]}}return this.value}toUrlParams(){var e=this.urlPrefix;return Object(c.isObject)(this.value)&&this.value.start&&this.value.end?{["".concat(e).concat(this.name)]:"".concat(this.value.start,"--").concat(this.value.end)}:super.toUrlParams()}fromUrlParams(e){var t=this.urlPrefix,a="".concat(t).concat(this.name),r="".concat(t).concat(this.name,".start"),n="".concat(t).concat(this.name,".end");if(Object(c.has)(e,a)){var i=e[a].split("--");2===i.length?this.setValue(i):this.setValue(e[a])}else Object(c.has)(e,r)&&Object(c.has)(e,n)&&this.setValue([e[r],e[n]])}toQueryTextFragment(){return"{{ ".concat(this.name,".start }} {{ ").concat(this.name,".end }}")}};function ja(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function wa(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?ja(Object(a),!0).forEach((function(t){Sa(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):ja(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Sa(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function Pa(e,t){switch(e.type){case"number":return new Pt(e,t);case"enum":return new Ct(e,t);case"query":return new na(e,t);case"date":case"datetime-local":case"datetime-with-seconds":return new da(e,t);case"date-range":case"datetime-range":case"datetime-range-with-seconds":return new Ea(e,t);default:return new St(wa(wa({},e),{},{type:"text"}),t)}}function Ca(e){return Pa(e,e.parentQueryId)}var Na="textbox",ka="visualization",xa="restricted";var Aa,_a,qa,Ta={DashboardLevel:"dashboard-level",WidgetLevel:"widget-level",StaticValue:"static-value"};class Ia{constructor(e){Object(c.extend)(this,e);var t=function(e){e.width=1;var t={autoHeight:!1,sizeX:Math.round(pt/2),sizeY:yt,minSizeX:vt,maxSizeX:Ot,minSizeY:Et,maxSizeY:jt},a=e.visualization?d.registeredVisualizations[e.visualization.type]:null;if(Object(c.isObject)(a)){Object.prototype.hasOwnProperty.call(a,"autoHeight")&&(t.autoHeight=a.autoHeight);var r=parseInt(a.minColumns,10);isFinite(r)&&r>=0&&(t.minSizeX=r);var n=parseInt(a.maxColumns,10);isFinite(n)&&n>=0&&(t.maxSizeX=Math.min(n,pt));var i=parseInt(a.height,10);isFinite(i)&&(t.minSizeY=Math.ceil(i/ht));var s=parseInt(a.minRows,10);isFinite(s)&&(t.minSizeY=s);var o=parseInt(a.maxRows,10);isFinite(o)&&o>=0&&(t.maxSizeY=o);var l=parseInt(a.defaultColumns,10);isFinite(l)&&l>0&&(t.sizeX=l);var u=parseInt(a.defaultRows,10);isFinite(u)&&u>0&&(t.sizeY=u)}return t}(this);this.options=this.options||{},this.options.position=Object(c.extend)({},t,Object(c.pick)(this.options.position,["col","row","sizeX","sizeY","autoHeight"])),this.options.position.sizeY<0&&(this.options.position.autoHeight=!0)}get type(){return this.visualization?ka:this.restricted?xa:Na}getQuery(){return!this.query&&this.visualization&&(this.query=new Xt(this.visualization.query)),this.query}getQueryResult(){return this.data}getName(){return this.visualization?"".concat(this.visualization.query.name," (").concat(this.visualization.name,")"):Object(c.truncate)(this.text,20)}load(e,t){if(!this.visualization)return Promise.resolve();if(e||void 0===this.queryResult){this.loading=!0,this.refreshStartedAt=l()(),(void 0===t||e)&&(t=e?0:void 0);var a=this.getQuery().getQueryResult(t);this.queryResult=a,a.toPromise().then(e=>(this.queryResult===a&&(this.loading=!1,this.data=e),e)).catch(e=>(this.queryResult===a&&(this.loading=!1,this.data=e),e))}return this.queryResult.toPromise()}save(e,t){var a=Object(c.pick)(this,"options","text","id","width","dashboard_id","visualization_id");e&&t&&(a[e]=Object(c.merge)({},a[e],t));var r="api/widgets";return this.id&&(r="".concat(r,"/").concat(this.id)),Q.post(r,a).then(e=>(Object(c.each)(e,(e,t)=>{this[t]=e}),this))}delete(){var e="api/widgets/".concat(this.id);return Q.delete(e)}isStaticParam(e){return this.getParameterMappings()[e.name].type===Ia.MappingType.StaticValue}getParametersDefs(){var e=this.getParameterMappings(),t=this.getQuery()?this.getQuery().getParametersDefs():[],a=q.search,r=[Ia.MappingType.WidgetLevel,Ia.MappingType.StaticValue],n=Object(c.map)(Object(c.filter)(t,t=>r.indexOf(e[t.name].type)>=0),t=>{var r=e[t.name],n=Ca(t);return n.title=r.title||t.title,n.locals=[t],n.urlPrefix="p_w".concat(this.id,"_"),r.type===Ia.MappingType.StaticValue?n.setValue(r.value):n.fromUrlParams(a),n});return Object(c.sortBy)(n,e=>Object(c.includes)(this.options.paramOrder,e.name)?Object(c.indexOf)(this.options.paramOrder,e.name):Object(c.size)(this.options.paramOrder))}getParameterMappings(){Object(c.isObject)(this.options.parameterMappings)||(this.options.parameterMappings={});var e={},t=this.getQuery()?this.getQuery().getParametersDefs(!1):[];Object(c.each)(t,t=>{e[t.name]=!0,Object(c.isObject)(this.options.parameterMappings[t.name])||(this.options.parameterMappings[t.name]={name:t.name,type:t.global?Ia.MappingType.DashboardLevel:Ia.MappingType.WidgetLevel,mapTo:t.name,value:null,title:""})});var a=Object(c.difference)(Object(c.keys)(this.options.parameterMappings),Object(c.keys)(e));return Object(c.each)(a,e=>{delete this.options.parameterMappings[e]}),this.options.parameterMappings}getLocalParameters(){return Object(c.filter)(this.getParametersDefs(),e=>!this.isStaticParam(e))}}qa=Ta,(_a="MappingType")in(Aa=Ia)?Object.defineProperty(Aa,_a,{value:qa,enumerable:!0,configurable:!0,writable:!0}):Aa[_a]=qa;var Da=Ia;function Ra(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function Ma(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Ra(Object(a),!0).forEach((function(t){za(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Ra(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function za(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function Fa(e,t,a){var r={};return u.a.each(t,t=>{var n=t&&t.getFilters?t.getFilters():[];u.a.each(n,t=>{var n=u.a.has(a,t.name);if(n||e.dashboard_filters_enabled){n&&(t.current=a[t.name]);var i=Ma({},t);u.a.has(r,t.name)?r[i.name].values=u.a.union(r[i.name].values,i.values):r[i.name]=i}})}),u.a.values(r)}function Ua(e){var t=Math.max(u.a.chain(e).map(e=>e.options.position.sizeY).max().value(),20)+5;return u.a.chain(e).sortBy(e=>e.options.position.row).groupBy(e=>e.options.position.row).reduce((e,a)=>{var r=1;return u.a.each(a,a=>{r=Math.max(r,a.options.position.autoHeight?t:a.options.position.sizeY),a.options.position.row=e,a.options.position.sizeY<1&&(a.options.position.sizeY=t)}),e+r},0).value(),e=u.a.sortBy(e,e=>e.options.position.col),e=u.a.sortBy(e,e=>e.options.position.row)}function Va(e,t){var a=u.a.extend({sizeX:gt},u.a.extend({},t.options).position).sizeX,r=u.a.chain(e).map(e=>{var t=u.a.extend({},e.options),a=u.a.extend({row:0,sizeY:0},t.position);return{left:a.col,top:a.row,right:a.col+a.sizeX,bottom:a.row+a.sizeY,width:a.sizeX,height:a.sizeY}}).reduce((e,t)=>{for(var a=Math.max(t.left,0),r=Math.min(t.right,e.length+1),n=a;n<r;n+=1)e[n]=Math.max(e[n],t.bottom);return e},u.a.map(new Array(pt),u.a.constant(0))).value();return u.a.chain(u.a.range(0,pt-a+1)).map(e=>({col:e,row:u.a.chain(r).slice(e,e+a).max().value()})).sortBy("row").first().value()}function La(e){u.a.extend(this,e),Object.defineProperty(this,"url",{get:function(){return t=(e=this).id,a=e.slug,"dashboards/".concat(t,"-").concat(a);var e,t,a}})}function Ba(e){return Ua(u.a.map(e,e=>new Da(e)))}function Qa(e){return(e=new La(e)).widgets&&(e.widgets=Ba(e.widgets)),e.publicAccessEnabled=void 0!==e.public_url,e}function Wa(e){return e=e.results?Ma(Ma({},e),{},{results:u.a.map(e.results,Qa)}):Qa(e)}var Ha={get:e=>{var t=e.id,a=e.slug,r={};return t||(r.legacy=null),Q.get("api/dashboards/".concat(t||a),{params:r}).then(Wa)},getByToken:e=>{var t=e.token;return Q.get("api/dashboards/public/".concat(t)).then(Wa)},save:e=>Q.post((e=>e.id?"api/dashboards/".concat(e.id):"api/dashboards")(e),e).then(Wa),delete:e=>{var t=e.id;return Q.delete("api/dashboards/".concat(t)).then(Wa)},query:e=>Q.get("api/dashboards",{params:e}).then(Wa),recent:e=>Q.get("api/dashboards/recent",{params:e}).then(Wa),myDashboards:e=>Q.get("api/dashboards/my",{params:e}).then(Wa),favorites:e=>Q.get("api/dashboards/favorites",{params:e}).then(Wa),favorite:e=>{var t=e.id;return Q.post("api/dashboards/".concat(t,"/favorite"))},unfavorite:e=>{var t=e.id;return Q.delete("api/dashboards/".concat(t,"/favorite"))}};function Ga(){return(Ga=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Ka(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);r=!0);}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Ya(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Ya(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ya(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function $a(e){var t=e.dialog,a=Ka(Object(r.useState)(""),2),i=a[0],s=a[1],o=Ka(Object(r.useState)(!1),2),l=o[0],u=o[1],d=Ka(Object(r.useState)(!1),2),m=d[0],p=d[1],h=Z.isCreateDashboardEnabled();function f(){""!==i&&(p(!0),La.save({name:i}).then(e=>{t.close(),ct("".concat(e.url,"?edit"))}),mt("create","dashboard"))}return n.a.createElement(z.a,Ga({},t.props,h?{}:{footer:null},{title:"New Dashboard",okText:"Save",cancelText:"Close",okButtonProps:{disabled:!l||m,loading:m,"data-test":"DashboardSaveButton"},cancelButtonProps:{disabled:m},onOk:f,closable:!m,maskClosable:!m,wrapProps:{"data-test":"CreateDashboardDialog"}}),n.a.createElement(le,{name:"CreateDashboardDialogExtra",disabled:!h},n.a.createElement(Fe.a,{defaultValue:i,onChange:function(e){var t=Object(c.trim)(e.target.value);s(t),u(""!==t)},onPressEnter:f,placeholder:"Dashboard Name","aria-label":"Dashboard name",disabled:m,autoFocus:!0})))}u.a.extend(La,Ha),La.prepareDashboardWidgets=Ba,La.prepareWidgetsForDashboard=Ua,La.prototype.canEdit=function(){return Z.canEdit(this)},La.prototype.getParametersDefs=function(){var e={},t=q.search;u.a.each(this.widgets,t=>{if(t.getQuery()){var a=t.getParameterMappings();t.getQuery().getParametersDefs(!1).forEach(t=>{var r=a[t.name];r.type===Da.MappingType.DashboardLevel&&(e[r.mapTo]||(e[r.mapTo]=Ca(t),e[r.mapTo].name=r.mapTo,e[r.mapTo].title=r.title||t.title,e[r.mapTo].locals=[]),e[r.mapTo].locals.push(t))})}});var a=u.a.values(u.a.each(e,e=>{e.setValue(e.value),e.fromUrlParams(t)}));return u.a.sortBy(a,e=>u.a.includes(this.options.globalParamOrder,e.name)?u.a.indexOf(this.options.globalParamOrder,e.name):u.a.size(this.options.globalParamOrder))},La.prototype.addWidget=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a={dashboard_id:this.id,options:Ma(Ma({},t),{},{isHidden:!1,position:{}}),text:"",visualization_id:null,visualization:null};u.a.isString(e)?a.text=e:u.a.isObject(e)&&(a.visualization_id=e.id,a.visualization=e);var r=new Da(a),n=Va(this.widgets,r);return r.options.position.col=n.col,r.options.position.row=n.row,r.save().then(()=>(this.widgets=[...this.widgets,r],r))},La.prototype.favorite=function(){return La.favorite(this)},La.prototype.unfavorite=function(){return La.unfavorite(this)},$a.propTypes={dialog:Qe.isRequired};var Ja=We($a);function Xa(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function Za(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Xa(Object(a),!0).forEach((function(t){er(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Xa(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function er(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class tr{constructor(e){Object(c.extend)(this,{pathPrefix:"/".concat(e.path)},Object(c.omit)(e,["isActive","isAvailable"])),Object(c.isFunction)(e.isActive)&&(this.isActive=e.isActive),Object(c.isFunction)(e.isAvailable)&&(this.isAvailable=e.isAvailable)}isActive(e){return e.startsWith(this.pathPrefix)}isAvailable(){return void 0===this.permission||W.hasPermission(this.permission)}}var ar=new class{constructor(){er(this,"items",[])}add(e,t){e=Object(c.isString)(e)?e:null,this.remove(e),Object(c.isObject)(t)&&(this.items.push(new tr(Za(Za({},t),{},{id:e}))),this.items=Object(c.sortBy)(this.items,"order"))}remove(e){Object(c.isString)(e)&&(this.items=Object(c.filter)(this.items,t=>t.id!==e))}getAvailableItems(){return Object(c.filter)(this.items,e=>e.isAvailable())}getActiveItem(e){var t=ot(e);return Object(c.find)(this.items,e=>e.isActive(t))}},rr=a(103),nr=a.n(rr),ir=a(685),sr=a.n(ir),or=a(686),lr=a.n(or),cr=a(687),ur=a.n(cr),dr=a(412),mr=a.n(dr),pr=a(688),hr=a.n(pr),fr=a(689),br=a.n(fr),gr=a(419);function yr(){return n.a.createElement(n.a.Fragment,null,n.a.createElement("div",null,"Version: ",H.version,gr!==H.version&&" (".concat(gr.substring(0,8),")")),H.newVersionAvailable&&W.hasPermission("super_admin")&&n.a.createElement("div",{className:"m-t-10"},n.a.createElement(O,{href:"https://version.redash.io/",className:"update-available",target:"_blank",rel:"noopener"},"Update Available ",n.a.createElement("i",{className:"fa fa-external-link m-l-5","aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},"(opens in a new tab)"))))}a(1458);function vr(){return(vr=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Or(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},i=Object.keys(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function Er(e){var t=e.children,a=Or(e,["children"]);return n.a.createElement(ue.a,vr({selectable:!1,mode:"vertical",theme:"dark"},a),t)}function jr(){var e=Object(r.useContext)(st);return Object(r.useMemo)(()=>({dashboards:Object(c.includes)(["Dashboards.List","Dashboards.Favorites","Dashboards.My","Dashboards.ViewOrEdit","Dashboards.LegacyViewOrEdit"],e.id),queries:Object(c.includes)(["Queries.List","Queries.Favorites","Queries.Archived","Queries.My","Queries.View","Queries.New","Queries.Edit"],e.id),dataSources:Object(c.includes)(["DataSources.List"],e.id),alerts:Object(c.includes)(["Alerts.List","Alerts.New","Alerts.View","Alerts.Edit"],e.id)}),[e.id])}function wr(){var e=Object(c.first)(ar.getAvailableItems()),t=jr(),a=W.hasPermission("create_query"),r=W.hasPermission("create_dashboard"),i=W.hasPermission("list_alerts");return n.a.createElement("nav",{className:"desktop-navbar"},n.a.createElement(Er,{className:"desktop-navbar-logo"},n.a.createElement("div",{role:"menuitem"},n.a.createElement(O,{href:"./"},n.a.createElement("img",{src:nr.a,alt:"Redash"})))),n.a.createElement(Er,null,W.hasPermission("list_dashboards")&&n.a.createElement(ue.a.Item,{key:"dashboards",className:t.dashboards?"navbar-active-item":null},n.a.createElement(O,{href:"dashboards"},n.a.createElement(sr.a,{"aria-label":"Dashboard navigation button"}),n.a.createElement("span",{className:"desktop-navbar-label"},"Dashboards"))),W.hasPermission("view_query")&&n.a.createElement(ue.a.Item,{key:"queries",className:t.queries?"navbar-active-item":null},n.a.createElement(O,{href:"queries"},n.a.createElement(lr.a,{"aria-label":"Queries navigation button"}),n.a.createElement("span",{className:"desktop-navbar-label"},"Queries"))),W.hasPermission("list_alerts")&&n.a.createElement(ue.a.Item,{key:"alerts",className:t.alerts?"navbar-active-item":null},n.a.createElement(O,{href:"alerts"},n.a.createElement(ur.a,{"aria-label":"Alerts navigation button"}),n.a.createElement("span",{className:"desktop-navbar-label"},"Alerts")))),n.a.createElement(Er,{className:"desktop-navbar-spacer"},(a||r||i)&&n.a.createElement(ue.a.SubMenu,{key:"create",popupClassName:"desktop-navbar-submenu","data-test":"CreateButton",tabIndex:0,title:n.a.createElement(n.a.Fragment,null,n.a.createElement(mr.a,null),n.a.createElement("span",{className:"desktop-navbar-label"},"Create"))},a&&n.a.createElement(ue.a.Item,{key:"new-query"},n.a.createElement(O,{href:"queries/new","data-test":"CreateQueryMenuItem"},"New Query")),r&&n.a.createElement(ue.a.Item,{key:"new-dashboard"},n.a.createElement(fe,{"data-test":"CreateDashboardMenuItem",onClick:()=>Ja.showModal()},"New Dashboard")),i&&n.a.createElement(ue.a.Item,{key:"new-alert"},n.a.createElement(O,{"data-test":"CreateAlertMenuItem",href:"alerts/new"},"New Alert")))),n.a.createElement(Er,null,n.a.createElement(ue.a.Item,{key:"help"},n.a.createElement(Me,{showTooltip:!1,type:"HOME",tabIndex:0},n.a.createElement(hr.a,null),n.a.createElement("span",{className:"desktop-navbar-label"},"Help"))),e&&n.a.createElement(ue.a.Item,{key:"settings",className:t.dataSources?"navbar-active-item":null},n.a.createElement(O,{href:e.path,"data-test":"SettingsLink"},n.a.createElement(br.a,null),n.a.createElement("span",{className:"desktop-navbar-label"},"Settings")))),n.a.createElement(Er,{className:"desktop-navbar-profile-menu"},n.a.createElement(ue.a.SubMenu,{key:"profile",popupClassName:"desktop-navbar-submenu",tabIndex:0,title:n.a.createElement("span",{"data-test":"ProfileDropdown",className:"desktop-navbar-profile-menu-title"},n.a.createElement("img",{className:"profile__image_thumb",src:W.profile_image_url,alt:W.name}))},n.a.createElement(ue.a.Item,{key:"profile"},n.a.createElement(O,{href:"users/me"},"Profile")),W.hasPermission("super_admin")&&n.a.createElement(ue.a.Item,{key:"status"},n.a.createElement(O,{href:"admin/status"},"System Status")),n.a.createElement(ue.a.Divider,null),n.a.createElement(ue.a.Item,{key:"logout"},n.a.createElement(fe,{"data-test":"LogOutButton",onClick:()=>X.logout()},"Log out")),n.a.createElement(ue.a.Divider,null),n.a.createElement(ue.a.Item,{key:"version",role:"presentation",disabled:!0,className:"version-info"},n.a.createElement(yr,null)))))}var Sr=a(690),Pr=a.n(Sr),Cr=a(53),Nr=a.n(Cr);a(1469);function kr(e){var t=e.getPopupContainer,a=Object(c.first)(ar.getAvailableItems());return n.a.createElement("div",{className:"mobile-navbar"},n.a.createElement("div",{className:"mobile-navbar-logo"},n.a.createElement(O,{href:"./"},n.a.createElement("img",{src:nr.a,alt:"Redash"}))),n.a.createElement("div",null,n.a.createElement(Nr.a,{overlayStyle:{minWidth:200},trigger:["click"],getPopupContainer:t,overlay:n.a.createElement(ue.a,{mode:"vertical",theme:"dark",selectable:!1,className:"mobile-navbar-menu"},W.hasPermission("list_dashboards")&&n.a.createElement(ue.a.Item,{key:"dashboards"},n.a.createElement(O,{href:"dashboards"},"Dashboards")),W.hasPermission("view_query")&&n.a.createElement(ue.a.Item,{key:"queries"},n.a.createElement(O,{href:"queries"},"Queries")),W.hasPermission("list_alerts")&&n.a.createElement(ue.a.Item,{key:"alerts"},n.a.createElement(O,{href:"alerts"},"Alerts")),n.a.createElement(ue.a.Item,{key:"profile"},n.a.createElement(O,{href:"users/me"},"Edit Profile")),n.a.createElement(ue.a.Divider,null),a&&n.a.createElement(ue.a.Item,{key:"settings"},n.a.createElement(O,{href:a.path},"Settings")),W.hasPermission("super_admin")&&n.a.createElement(ue.a.Item,{key:"status"},n.a.createElement(O,{href:"admin/status"},"System Status")),W.hasPermission("super_admin")&&n.a.createElement(ue.a.Divider,null),n.a.createElement(ue.a.Item,{key:"help"},n.a.createElement(O,{href:"https://redash.io/help",target:"_blank",rel:"noopener"},"Help")),n.a.createElement(ue.a.Item,{key:"logout",onClick:()=>X.logout()},"Log out"))},n.a.createElement(f.a,{className:"mobile-navbar-toggle-button",ghost:!0},n.a.createElement(Pr.a,null)))))}kr.propTypes={getPopupContainer:ae.a.func},kr.defaultProps={getPopupContainer:null};a(1472);function xr(e){var t=e.children,a=Object(r.useRef)(),i=Object(r.useCallback)(()=>a.current,[]);return n.a.createElement(n.a.Fragment,null,n.a.createElement(le,{name:"ApplicationWrapper"},n.a.createElement("div",{className:"application-layout-side-menu"},n.a.createElement(le,{name:"ApplicationDesktopNavbar"},n.a.createElement(wr,null))),n.a.createElement("div",{className:"application-layout-content"},n.a.createElement("nav",{className:"application-layout-top-menu",ref:a},n.a.createElement(le,{name:"ApplicationMobileNavbar",getPopupContainer:i},n.a.createElement(kr,{getPopupContainer:i}))),t)))}function Ar(){return(Ar=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function _r(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},i=Object.keys(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function qr(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function Tr(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?qr(Object(a),!0).forEach((function(t){Ir(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):qr(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Ir(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function Dr(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);r=!0);}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Rr(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Rr(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Rr(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function Mr(e){var t=e.bodyClass,a=e.currentRoute,i=e.render,s=Dr(Object(r.useState)(!!X.isAuthenticated()),2),o=s[0],l=s[1];return Object(r.useEffect)(()=>{var e=!1;return Promise.all([X.requireSession(),ee.refresh(),Z.refresh()]).then(()=>{e||l(!!X.isAuthenticated())}).catch(()=>{e||l(!1)}),()=>{e=!0}},[]),Object(r.useEffect)(()=>{if(t)return document.body.classList.toggle(t,!0),()=>{document.body.classList.toggle(t,!1)}},[t]),o?n.a.createElement(xr,null,n.a.createElement(n.a.Fragment,{key:a.key},n.a.createElement(j.a,{renderError:e=>n.a.createElement(et,{error:e})},n.a.createElement(E.ErrorBoundaryContext.Consumer,null,e=>{var t=e.handleError;return i(Tr(Tr({},a.routeParams),{},{pageTitle:a.title,onError:t}))})))):null}xr.propTypes={children:ae.a.node},xr.defaultProps={children:null};function zr(e){var t=e.render,a=e.bodyClass;return Tr(Tr({},_r(e,["render","bodyClass"])),{},{render:e=>{var r={render:t,bodyClass:a,currentRoute:e};return n.a.createElement(le,Ar({},r,{name:"UserSessionWrapper",fallback:n.a.createElement(Mr,r)}))}})}a(1473);function Fr(){return(Fr=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Ur(e){var t=e.show,a=e.completed,r=e.text,i=e.url,s=e.urlText,o=e.onClick;if(!t)return null;var l={children:s,onClick:o};return n.a.createElement("li",{className:me()({done:a})},i?n.a.createElement(O,Fr({href:i},l)):n.a.createElement(fe,Fr({type:"link"},l))," ",r)}function Vr(e){var t=e.helpTriggerType;return n.a.createElement("p",null,"Need more support?"," ",n.a.createElement(Me,{className:"f-14",type:t,showTooltip:!1},"See our Help"))}function Lr(e){var t=e.icon,a=e.header,i=e.description,s=e.illustration,o=e.helpMessage,l=e.closable,u=e.onClose,d=e.onboardingMode,m=e.showAlertStep,p=e.showDashboardStep,h=e.showDataSourceStep,f=e.showInviteStep,b=e.getStepsItems,g=e.illustrationPath,y={dataSource:h,query:!0,alert:m,dashboard:p,inviteUsers:f},v={dataSource:ee.objectCounters.data_sources>0,query:ee.objectCounters.queries>0,alert:ee.objectCounters.alerts>0,dashboard:ee.objectCounters.dashboards>0,inviteUsers:ee.objectCounters.users>1},O=Object(r.useCallback)(()=>{Ja.showModal()},[]);if(!(!d||Object(c.some)(Object(c.keys)(y),e=>y[e]&&!v[e])))return null;var E=[{key:"dataSources",node:W.isAdmin?n.a.createElement(Ur,{key:"dataSources",show:y.dataSource,completed:v.dataSource,url:"data_sources/new",urlText:"Connect a Data Source"}):n.a.createElement(Ur,{key:"dataSources",show:y.dataSource,completed:v.dataSource,text:"Ask an account admin to connect a data source"})},{key:"queries",node:n.a.createElement(Ur,{key:"queries",show:y.query,completed:v.query,url:"queries/new",urlText:"Create your first Query"})},{key:"alerts",node:n.a.createElement(Ur,{key:"alerts",show:y.alert,completed:v.alert,url:"alerts/new",urlText:"Create your first Alert"})},{key:"dashboards",node:n.a.createElement(Ur,{key:"dashboards",show:y.dashboard,completed:v.dashboard,onClick:O,urlText:"Create your first Dashboard"})},{key:"users",node:n.a.createElement(Ur,{key:"users",show:y.inviteUsers,completed:v.inviteUsers,url:"users/new",urlText:"Invite your team members"})}],j=b?b(E):E,w=g||"static/images/illustrations/"+s+".svg";return n.a.createElement("div",{className:"empty-state-wrapper"},n.a.createElement("div",{className:"empty-state bg-white tiled"},n.a.createElement("div",{className:"empty-state__summary"},a&&n.a.createElement("h4",null,a),n.a.createElement("h2",null,n.a.createElement("i",{className:t,"aria-hidden":"true"})),n.a.createElement("p",null,i),n.a.createElement("img",{src:w,alt:s+" Illustration",width:"75%"})),n.a.createElement("div",{className:"empty-state__steps"},n.a.createElement("h4",null,"Let's get started"),n.a.createElement("ol",null,j.map(e=>e.node)),o)),l&&n.a.createElement(fe,{className:"close-button","aria-label":"Close",onClick:u},n.a.createElement(Se.a,null)))}Ur.propTypes={show:ae.a.bool.isRequired,completed:ae.a.bool.isRequired,text:ae.a.node,url:ae.a.string,urlTarget:ae.a.string,urlText:ae.a.node,onClick:ae.a.func},Ur.defaultProps={url:null,urlTarget:null,urlText:null,text:null,onClick:null},Vr.propTypes={helpTriggerType:ae.a.string.isRequired},Lr.propTypes={icon:ae.a.string,header:ae.a.string,description:ae.a.string.isRequired,illustration:ae.a.string.isRequired,illustrationPath:ae.a.string,helpMessage:ae.a.node,closable:ae.a.bool,onClose:ae.a.func,onboardingMode:ae.a.bool,showAlertStep:ae.a.bool,showDashboardStep:ae.a.bool,showDataSourceStep:ae.a.bool,showInviteStep:ae.a.bool,getStepItems:ae.a.func},Lr.defaultProps={icon:null,header:null,helpMessage:null,closable:!1,onClose:()=>{},onboardingMode:!1,showAlertStep:!1,showDashboardStep:!1,showDataSourceStep:!0,showInviteStep:!1};var Br=Lr,Qr=a(97),Wr=a.n(Qr),Hr=a(79),Gr=a.n(Hr),Kr=a(234),Yr=a.n(Kr);function $r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function Jr(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?$r(Object(a),!0).forEach((function(t){Xr(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):$r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Xr(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}Yr.a.config({placement:"bottomRight",duration:3});var Zr={};["success","error","info","warning","warn"].forEach(e=>{Zr[e]=function(t){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return Yr.a[e](Jr(Jr({},r),{},{message:t,description:a}))}});var en=Jr(Jr({},Yr.a),Zr),tn=()=>Q.get("api/settings/organization"),an=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Settings changes saved.";return Q.post("api/settings/organization",e).then(e=>(en.success(t),e)).catch(()=>{en.error("Failed saving changes.")})};function rn(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);r=!0);}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return nn(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return nn(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function nn(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}var sn=Gr.a.Text;var on=function(){var e=rn(Object(r.useState)(!1),2),t=e[0],a=e[1];if(!H.showBeaconConsentMessage||t)return null;var i=()=>{H.showBeaconConsentMessage=!1,a(!0)},s=e=>{var t="ðŸ™ Thank you.";e||(t="Settings Saved."),an({beacon_consent:e},t).finally(i)};return n.a.createElement(le,{name:"BeaconConsent"},n.a.createElement("div",{className:"m-t-10 tiled"},n.a.createElement(Wr.a,{title:n.a.createElement(n.a.Fragment,null,"Would you be ok with sharing anonymous usage data with the Redash team?"," ",n.a.createElement(Me,{type:"USAGE_DATA_SHARING"})),bordered:!1},n.a.createElement(sn,null,"Help Redash improve by automatically sending anonymous usage data:"),n.a.createElement("div",{className:"m-t-5"},n.a.createElement("ul",null,n.a.createElement("li",null," Number of users, queries, dashboards, alerts, widgets and visualizations."),n.a.createElement("li",null," Types of data sources, alert destinations and visualizations."))),n.a.createElement(sn,null,"All data is aggregated and will never include any sensitive or private data."),n.a.createElement("div",{className:"m-t-5"},n.a.createElement(f.a,{type:"primary",className:"m-r-5",onClick:()=>s(!0)},"Yes"),n.a.createElement(f.a,{type:"default",onClick:()=>s(!1)},"No")),n.a.createElement("div",{className:"m-t-15"},n.a.createElement(sn,{type:"secondary"},"You can change this setting anytime from the"," ",n.a.createElement(O,{href:"settings/organization"},"Organization Settings")," page.")))))},ln=a(235),cn=a.n(ln);function un(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function dn(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?un(Object(a),!0).forEach((function(t){mn(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):un(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function mn(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var pn=new class{constructor(){mn(this,"_items",[]),mn(this,"_sorted",!1)}get items(){return this._sorted||(this._items=Object(c.sortBy)(this._items,[e=>{return t=e.path,a=cn.a.parse(t),Object(c.filter)(a,c.isObject).length;var t,a},e=>-e.path.length,e=>e.path]),this._sorted=!0),this._items}register(e,t){var a=Object(c.isString)(e)?e:null;this.unregister(a),Object(c.isObject)(t)&&(this._items=[...this.items,dn(dn({},t),{},{id:a})],this._sorted=!1)}unregister(e){Object(c.isString)(e)&&(this._items=Object(c.filter)(this.items,t=>t.id!==e))}},hn=a(92),fn=a.n(hn);function bn(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);r=!0);}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return gn(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return gn(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function gn(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function yn(e){var t=e.title,a=e.resource,i=e.itemUrl,s=e.emptyState,o=bn(Object(r.useState)([]),2),l=o[0],u=o[1],d=bn(Object(r.useState)(!0),2),m=d[0],p=d[1];return Object(r.useEffect)(()=>{p(!0),a.favorites().then(e=>{var t=e.results;return u(t)}).finally(()=>p(!1))},[a]),n.a.createElement(n.a.Fragment,null,n.a.createElement("div",{className:"d-flex align-items-center m-b-20"},n.a.createElement("p",{className:"flex-fill f-500 c-black m-0"},t),m&&n.a.createElement(fn.a,null)),!Object(c.isEmpty)(l)&&n.a.createElement("div",{role:"list",className:"list-group"},l.map(e=>n.a.createElement(O,{key:i(e),role:"listitem",className:"list-group-item",href:i(e)},n.a.createElement("span",{className:"btn-favorite m-r-5"},n.a.createElement("i",{className:"fa fa-star","aria-hidden":"true"})),e.name,e.is_draft&&n.a.createElement("span",{className:"label label-default m-l-5"},"Unpublished")))),Object(c.isEmpty)(l)&&!m&&s)}function vn(){return n.a.createElement("div",{className:"tile"},n.a.createElement("div",{className:"t-body tb-padding"},n.a.createElement("div",{className:"row home-favorites-list"},n.a.createElement("div",{className:"col-sm-6 m-t-20"},n.a.createElement(yn,{title:"Favorite Dashboards",resource:La,itemUrl:e=>e.url,emptyState:n.a.createElement("p",null,n.a.createElement("span",{className:"btn-favorite m-r-5"},n.a.createElement("i",{className:"fa fa-star","aria-hidden":"true"})),"Favorite ",n.a.createElement(O,{href:"dashboards"},"Dashboards")," will appear here")})),n.a.createElement("div",{className:"col-sm-6 m-t-20"},n.a.createElement(yn,{title:"Favorite Queries",resource:Xt,itemUrl:e=>"queries/".concat(e.id),emptyState:n.a.createElement("p",null,n.a.createElement("span",{className:"btn-favorite m-r-5"},n.a.createElement("i",{className:"fa fa-star","aria-hidden":"true"})),"Favorite ",n.a.createElement(O,{href:"queries"},"Queries")," will appear here")})))))}yn.propTypes={title:ae.a.string.isRequired,resource:ae.a.func.isRequired,itemUrl:ae.a.func.isRequired,emptyState:ae.a.node},yn.defaultProps={emptyState:null};a(1474);function On(){return n.a.createElement(p.a,{className:"m-b-15",type:"warning",message:n.a.createElement(n.a.Fragment,null,"You have enabled ",n.a.createElement("code",null,"ALLOW_PARAMETERS_IN_EMBEDS"),". This setting is now deprecated and should be turned off. Parameters in embeds are supported by default."," ",n.a.createElement(O,{href:"https://discuss.redash.io/t/support-for-parameters-in-embedded-visualizations/3337",target:"_blank",rel:"noopener noreferrer"},"Read more"),".")})}function En(){return n.a.createElement(p.a,{className:"m-b-15",type:"warning",message:n.a.createElement(n.a.Fragment,null,"We have sent an email with a confirmation link to your email address. Please follow the link to verify your email address."," ",n.a.createElement(fe,{type:"link",onClick:()=>{Q.post("verification_email/").then(e=>{en.success(e.message)})}},"Resend email"),".")})}function jn(){return Object(r.useEffect)(()=>{mt("view","page","personal_homepage")},[]),n.a.createElement("div",{className:"home-page"},n.a.createElement("div",{className:"container"},Object(c.includes)(G,"using-deprecated-embed-feature")&&n.a.createElement(On,null),Object(c.includes)(G,"email-not-verified")&&n.a.createElement(En,null),n.a.createElement(le,{name:"Home.EmptyState"},n.a.createElement(Br,{header:"Welcome to Redash ðŸ‘‹",description:"Connect to any data source, easily visualize and share your data",illustration:"dashboard",helpMessage:n.a.createElement(Vr,{helpTriggerType:"GETTING_STARTED"}),showDashboardStep:!0,showInviteStep:!0,onboardingMode:!0})),n.a.createElement(le,{name:"HomeExtra"}),n.a.createElement(vn,null),n.a.createElement(on,null)))}pn.register("Home",zr({path:"/",title:"Redash",render:e=>n.a.createElement(jn,e)}));var wn=a(105),Sn=a.n(wn),Pn=a(61);a(1475);function Cn(e){var t=e.title,a=e.actions;return n.a.createElement("div",{className:"page-header-wrapper"},n.a.createElement("h3",null,t),a&&n.a.createElement("div",{className:"page-header-actions"},a))}Cn.propTypes={title:ae.a.string,actions:ae.a.node},Cn.defaultProps={title:"",actions:null};a(1476);function Nn(e){var t=e.activeTab,a=e.children;return n.a.createElement("div",{className:"admin-page-layout"},n.a.createElement("div",{className:"container"},n.a.createElement(Cn,{title:"Admin"}),n.a.createElement("div",{className:"bg-white tiled"},n.a.createElement(ue.a,{selectedKeys:[t],selectable:!1,mode:"horizontal"},n.a.createElement(ue.a.Item,{key:"system_status"},n.a.createElement(O,{href:"admin/status"},"System Status")),n.a.createElement(ue.a.Item,{key:"jobs"},n.a.createElement(O,{href:"admin/queries/jobs"},"RQ Status")),n.a.createElement(ue.a.Item,{key:"outdated_queries"},n.a.createElement(O,{href:"admin/queries/outdated"},"Outdated Queries"))),a)))}Nn.propTypes={activeTab:ae.a.string,children:ae.a.node},Nn.defaultProps={activeTab:"system_status",children:null};var kn=a(191),xn=a.n(kn),An=a(184),_n=a.n(An),qn=a(62),Tn=a.n(qn),In=a(68),Dn=a.n(In);function Rn(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class Mn extends n.a.Component{toggleItem(e,t,a){var r=t.is_favorite?t.unfavorite.bind(t):t.favorite.bind(t),n=t.is_favorite;r().then(()=>{t.is_favorite=!n,this.forceUpdate(),a()})}render(){var e=this.props,t=e.item,a=e.onChange,r=t.is_favorite?"fa fa-star":"fa fa-star-o",i=t.is_favorite?"Remove from favorites":"Add to favorites";return n.a.createElement(fe,{title:i,"aria-label":i,className:"favorites-control btn-favorite",onClick:e=>this.toggleItem(e,t,a)},n.a.createElement("i",{className:r,"aria-hidden":"true"}))}}Rn(Mn,"propTypes",{item:ae.a.shape({is_favorite:ae.a.bool.isRequired}).isRequired,onChange:ae.a.func}),Rn(Mn,"defaultProps",{onChange:()=>{}});ae.a.shape({syntax:ae.a.string,options:ae.a.shape({doc:ae.a.string,doc_url:ae.a.string}),type_name:ae.a.string});var zn=ae.a.shape({columns:ae.a.arrayOf(ae.a.string).isRequired}),Fn=(ae.a.arrayOf(zn),ae.a.shape({interval:ae.a.number,time:ae.a.string,day_of_week:ae.a.string,until:ae.a.string})),Un={interval:null,time:null,day_of_week:null,until:null},Vn=ae.a.shape({id:ae.a.number.isRequired,name:ae.a.string.isRequired,email:ae.a.string.isRequired,profileImageUrl:ae.a.string,apiKey:ae.a.string,isDisabled:ae.a.bool}),Ln=ae.a.shape({id:ae.a.number.isRequired,name:ae.a.string.isRequired,icon:ae.a.string.isRequired,type:ae.a.string.isRequired}),Bn=ae.a.shape({id:ae.a.any.isRequired,name:ae.a.string.isRequired,description:ae.a.string,data_source_id:ae.a.any.isRequired,created_at:ae.a.string.isRequired,updated_at:ae.a.string,user:Vn,query:ae.a.string,queryHash:ae.a.string,is_safe:ae.a.bool.isRequired,is_draft:ae.a.bool.isRequired,is_archived:ae.a.bool.isRequired,api_key:ae.a.string.isRequired}),Qn=ae.a.shape({column:ae.a.string,op:ae.a.oneOf([">",">=","<","<=","==","!="]),value:ae.a.oneOfType([ae.a.string,ae.a.number]),custom_subject:ae.a.string,custom_body:ae.a.string}),Wn=ae.a.shape({id:ae.a.any,name:ae.a.string,created_at:ae.a.string,last_triggered_at:ae.a.string,updated_at:ae.a.string,rearm:ae.a.number,state:ae.a.oneOf(["ok","triggered","unknown"]),user:Vn,query:Bn,options:ae.a.shape({column:ae.a.string,op:ae.a.string,value:ae.a.oneOfType([ae.a.string,ae.a.number])}).isRequired});function Hn(e,t,a,r){var n=t[a],i=e&&null!=n&&l.a.isMoment(n),s=!e&&(null==n||l.a.isMoment(n));if(!i&&!s)return new Error("Prop `"+a+"` supplied to `"+r+"` should be a Moment.js instance.")}var Gn=Object(c.wrap)(!1,Hn);function Kn(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);r=!0);}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Yn(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Yn(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Yn(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function $n(e){var t=e.date,a=e.placeholder,i=e.autoUpdate,s=e.variation,o=function(e){return(e=Object(c.isNil)(e)?null:l()(e))&&e.isValid()?e:null}(t),u=Kn(Object(r.useState)(null),2),d=u[0],m=u[1],p=Object(r.useMemo)(()=>o?o.format(H.dateTimeFormat):null,[o]);return Object(r.useEffect)(()=>{function e(){m(o?o.fromNow():a)}if(e(),i){var t=setInterval(e,3e4);return()=>clearInterval(t)}},[i,o,a]),"timeAgoInTooltip"===s?n.a.createElement(Oe,{title:d},n.a.createElement("span",{"data-test":"TimeAgo"},p)):n.a.createElement(Oe,{title:p},n.a.createElement("span",{"data-test":"TimeAgo"},d))}function Jn(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);r=!0);}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Xn(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Xn(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Xn(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}Gn.isRequired=Object(c.wrap)(!0,Hn),$n.propTypes={date:ae.a.oneOfType([ae.a.string,ae.a.number,ae.a.instanceOf(Date),Gn]),placeholder:ae.a.string,autoUpdate:ae.a.bool,variation:ae.a.oneOf(["timeAgoInTooltip"])},$n.defaultProps={date:null,placeholder:"",autoUpdate:!0};var Zn={NEVER:"Never",SECONDS:"second",MINUTES:"minute",HOURS:"hour",DAYS:"day",WEEKS:"week",MILLISECONDS:"millisecond"};function ei(e,t){if(!e)return"";var a=l()(e);return a.isValid()?a.format(t):"-"}function ti(e){return ei(e,H.dateTimeFormat)}function ai(e){return ei(e,H.dateFormat)}function ri(e){var t=Jn(e.split(":"),2),a=t[0],r=t[1];return l.a.utc().hour(a).minute(r).local().format("HH:mm")}function ni(e){if(!e)return{interval:Zn.NEVER};var t=Zn.SECONDS;return e>=60&&(e/=60,t=Zn.MINUTES),e>=60&&(e/=60,t=Zn.HOURS),e>=24&&t===Zn.HOURS&&(e/=24,t=Zn.DAYS),e>=7&&!(e%7)&&t===Zn.DAYS&&(e/=7,t=Zn.WEEKS),{count:e,interval:t}}function ii(e,t){return e+(1!==t?"s":"")}function si(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e)return"-";var a="",r=ni(e),n=r.interval,i=r.count,s=Math.round(i);return 1===s&&t.omitSingleValueNumber||(a="".concat(s," ")),a+=ii(n,s)}function oi(e){return e.replace(/_/g," ").replace(/(?:^|\s)\S/g,e=>e.toUpperCase())}function li(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;return Math.round(e)!==e?e.toFixed(t):e.toString()}function ci(e,t){return function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3?arguments[3]:void 0;if(isNaN(parseFloat(e))||!isFinite(e))return{value:"",unit:"",divisor:1};for(var n=0,i=1;e>=t&&n<a.length-1;)e/=t,i*=t,n+=1;return{value:li(e,r),unit:a[n],divisor:i}}(e,1024,["bytes","KB","MB","GB","TB","PB"],t)}function ui(e){var t=ci(e),a=t.value,r=t.unit;return a?a+" "+r:"?"}function di(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return l.a.isMoment(e)?"date"===t?ai(e):ti(e):"boolean"==typeof e?e.toString():e}function mi(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function pi(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?mi(Object(a),!0).forEach((function(t){hi(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):mi(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function hi(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function fi(){return(fi=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function bi(){return Object(c.extend)(this(...arguments),{sorter:!0})}var gi={favorites:e=>Object(c.extend)({width:"1%",render:(e,t)=>n.a.createElement(Mn,{item:t})},e),avatar:(e,t)=>(t=Object(c.isFunction)(t)?t:c.identity,Object(c.extend)({width:"1%",render:(e,a)=>n.a.createElement("img",{src:a.user.profile_image_url,className:"profile__image_thumb",alt:t(e.name,a),title:t(e.name,a)})},e)),date:e=>Object(c.extend)({render:e=>ai(e)},e),dateTime:e=>Object(c.extend)({render:e=>ti(e)},e),duration:e=>Object(c.extend)({width:"1%",className:"text-nowrap",render:e=>si(e)},e),timeAgo(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;return Object(c.extend)({render:e=>n.a.createElement($n,fi({date:e},t))},e)},custom:(e,t)=>Object(c.extend)({render:e},t)};gi.date.sortable=bi,gi.dateTime.sortable=bi,gi.duration.sortable=bi,gi.timeAgo.sortable=bi,gi.custom.sortable=bi;class yi extends n.a.Component{constructor(){super(...arguments),hi(this,"getRowKey",e=>{var t=this.props.rowKey;return t?Object(c.isFunction)(t)?t(e.item):e.item[t]:e.key})}prepareColumns(){var e=this.props,t=e.orderByField,a=e.orderByReverse,r=e.toggleSorting,n=a?"descend":"ascend";return Object(c.map)(Object(c.map)(Object(c.filter)(this.props.columns,e=>!Object(c.isFunction)(e.isAvailable)||e.isAvailable()),e=>Object(c.extend)(e,{orderByField:e.orderByField||e.field})),(e,a)=>{var i=e.sorter?()=>({onClick:()=>r(e.orderByField)}):null,s=Object(c.isFunction)(e.render)?(t,a)=>e.render(t,a.item):c.identity;return Object(c.extend)(Object(c.omit)(e,["field","orderByField","render"]),{key:"column"+a,dataIndex:["item",e.field],defaultSortOrder:e.orderByField===t?n:null,onHeaderCell:i,render:s})})}render(){var e={columns:this.prepareColumns(),dataSource:Object(c.map)(this.props.items,(e,t)=>({key:"row"+t,item:e}))},t=Object(c.isFunction)(this.props.onRowClick)?e=>({onClick:t=>{this.props.onRowClick(t,e.item)}}):null,a=this.props.showHeader;return this.props.loading&&(Object(c.isEmpty)(e.dataSource)?(e.columns=e.columns.map(e=>pi(pi({},e),{},{sorter:!1,render:()=>n.a.createElement(Dn.a,{active:!0,paragraph:!1})})),e.dataSource=Object(c.range)(10).map(e=>({key:"".concat(e)}))):e.loading={indicator:null}),n.a.createElement(Tn.a,fi({className:me()("table-data",{"ant-table-headerless":!a}),showHeader:a,rowKey:this.getRowKey,pagination:!1,onRow:t,"data-test":this.props["data-test"]},e))}}function vi(e){var t=e.title,a=e.value,r=e.loading;return n.a.createElement(_n.a,{spinning:r},n.a.createElement(Wr.a,null,t,n.a.createElement("div",{className:"f-20"},a)))}hi(yi,"propTypes",{loading:ae.a.bool,items:ae.a.arrayOf(ae.a.object),columns:ae.a.arrayOf(ae.a.shape({field:ae.a.string,orderByField:ae.a.string,render:ae.a.func,isAvailable:ae.a.func})),showHeader:ae.a.bool,onRowClick:ae.a.func,orderByField:ae.a.string,orderByReverse:ae.a.bool,toggleSorting:ae.a.func,"data-test":ae.a.string,rowKey:ae.a.oneOfType([ae.a.string,ae.a.func])}),hi(yi,"defaultProps",{loading:!1,items:[],columns:[],showHeader:!0,onRowClick:null,orderByField:null,orderByReverse:!1,toggleSorting:()=>{}}),vi.propTypes={title:ae.a.string.isRequired,value:ae.a.oneOfType([ae.a.number,ae.a.string]),loading:ae.a.bool.isRequired},vi.defaultProps={value:""};var Oi=[{title:"Queue",dataIndex:"origin"},{title:"Query ID",dataIndex:["meta","query_id"]},{title:"Org ID",dataIndex:["meta","org_id"]},{title:"Data Source ID",dataIndex:["meta","data_source_id"]},{title:"User ID",dataIndex:["meta","user_id"]},gi.custom(e=>e.toString(),{title:"Scheduled",dataIndex:["meta","scheduled"]}),gi.timeAgo({title:"Start Time",dataIndex:"started_at"}),gi.timeAgo({title:"Enqueue Time",dataIndex:"enqueued_at"})],Ei=[{title:"Queue",dataIndex:"origin"},{title:"Job Name",dataIndex:"name"},gi.timeAgo({title:"Start Time",dataIndex:"started_at"}),gi.timeAgo({title:"Enqueue Time",dataIndex:"enqueued_at"})],ji=[gi.custom(e=>n.a.createElement("span",null,n.a.createElement(xn.a,{status:{busy:"processing",idle:"default",started:"success",suspended:"warning"}[e]})," ",e),{title:"State",dataIndex:"state"})].concat(Object(c.map)(["Hostname","PID","Name","Queues","Current Job","Successful Jobs","Failed Jobs"],e=>({title:e,dataIndex:e.toLowerCase().replace(/\s/g,"_")}))).concat([gi.dateTime({title:"Birth Date",dataIndex:"birth_date"}),gi.duration({title:"Total Working Time",dataIndex:"total_working_time"})]),wi=Object(c.map)(["Name","Started","Queued"],e=>({title:e,dataIndex:e.toLowerCase()})),Si={loading:ae.a.bool.isRequired,items:ae.a.arrayOf(ae.a.object).isRequired};function Pi(e){var t=e.loading,a=e.items;return n.a.createElement(Tn.a,{loading:t,columns:ji,rowKey:"name",dataSource:a,pagination:{defaultPageSize:25,pageSizeOptions:["10","25","50"],showSizeChanger:!0}})}function Ci(e){var t=e.loading,a=e.items;return n.a.createElement(Tn.a,{loading:t,columns:wi,rowKey:"name",dataSource:a,pagination:{defaultPageSize:25,pageSizeOptions:["10","25","50"],showSizeChanger:!0}})}function Ni(e){var t=e.loading,a=e.items;return n.a.createElement(Tn.a,{loading:t,columns:Oi,rowKey:"id",dataSource:a,pagination:{defaultPageSize:25,pageSizeOptions:["10","25","50"],showSizeChanger:!0}})}function ki(e){var t=e.loading,a=e.items;return n.a.createElement(Tn.a,{loading:t,columns:Ei,rowKey:"id",dataSource:a,pagination:{defaultPageSize:25,pageSizeOptions:["10","25","50"],showSizeChanger:!0}})}function xi(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);r=!0);}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Ai(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Ai(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ai(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function _i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function qi(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?_i(Object(a),!0).forEach((function(t){Ii(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):_i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Ti(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},i=Object.keys(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function Ii(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}Pi.propTypes=Si,Ci.propTypes=Si,Ni.propTypes=Si,ki.propTypes=Si;class Di extends n.a.Component{constructor(){super(...arguments),Ii(this,"state",{activeTab:q.hash,isLoading:!0,error:null,queueCounters:[],overallCounters:{started:0,queued:0},startedJobs:[],workers:[]}),Ii(this,"_refreshTimer",null),Ii(this,"refresh",()=>{Q.get("/api/admin/queries/rq_status").then(e=>this.processQueues(e)).catch(e=>this.handleError(e)),this._refreshTimer=setTimeout(this.refresh,6e4)}),Ii(this,"processQueues",e=>{var t=e.queues,a=e.workers,r=Object(c.values)(t).map(e=>{var t=e.started,a=Ti(e,["started"]);return qi({started:t.length},a)}),n=r.reduce((e,t)=>({started:e.started+t.started,queued:e.queued+t.queued}),{started:0,queued:0}),i=Object(c.flatMap)(Object(c.values)(t),e=>e.started.map(e=>qi(qi({},e),{},{enqueued_at:l.a.utc(e.enqueued_at),started_at:l.a.utc(e.started_at)})));this.setState({isLoading:!1,queueCounters:r,startedJobs:i,overallCounters:n,workers:a})}),Ii(this,"handleError",e=>{this.setState({isLoading:!1,error:e})})}componentDidMount(){mt("view","page","admin/rq_status"),this.refresh()}componentWillUnmount(){clearTimeout(this._refreshTimer),this.processQueues=()=>{},this.handleError=()=>{}}render(){var e=this.state,t=e.isLoading,a=e.error,r=e.queueCounters,i=e.startedJobs,s=e.overallCounters,o=e.workers,l=e.activeTab,u=xi(Object(c.partition)(i,["name","redash.tasks.queries.execution.execute_query"]),2),d=u[0],m=u[1];return n.a.createElement(Nn,{activeTab:"jobs"},n.a.createElement("div",{className:"p-15"},a&&n.a.createElement(p.a,{type:"error",message:"Failed loading status. Please refresh."}),!a&&n.a.createElement(n.a.Fragment,null,n.a.createElement(Pn.Row,{gutter:15,className:"m-b-15"},n.a.createElement(Pn.Col,{span:8},n.a.createElement(vi,{title:"Started Jobs",value:s.started,loading:t})),n.a.createElement(Pn.Col,{span:8},n.a.createElement(vi,{title:"Queued Jobs",value:s.queued,loading:t}))),n.a.createElement(Sn.a,{activeKey:l||"queues",onTabClick:e=>{q.setHash(e),this.setState({activeTab:e})},animated:!1},n.a.createElement(Sn.a.TabPane,{key:"queues",tab:"Queues"},n.a.createElement(Ci,{loading:t,items:r})),n.a.createElement(Sn.a.TabPane,{key:"workers",tab:"Workers"},n.a.createElement(Pi,{loading:t,items:o})),n.a.createElement(Sn.a.TabPane,{key:"queries",tab:"Queries"},n.a.createElement(Ni,{loading:t,items:d})),n.a.createElement(Sn.a.TabPane,{key:"other",tab:"Other Jobs"},n.a.createElement(ki,{loading:t,items:m}))))))}}pn.register("Admin.Jobs",zr({path:"/admin/queries/jobs",title:"RQ Status",render:e=>n.a.createElement(Di,e)}));var Ri=a(131),Mi=a.n(Ri),zi=a(231),Fi=a.n(zi);function Ui(e){var t=e.page,a=e.showPageSizeSelect,r=e.pageSize,i=e.onPageSizeChange,s=e.totalCount,o=e.onChange;return s<=(a?5:r)?null:n.a.createElement("div",{className:"paginator-container"},n.a.createElement(Fi.a,{showSizeChanger:a,pageSizeOptions:["5","10","20","50","100"],onShowSizeChange:(e,t)=>i(t),defaultCurrent:t,pageSize:r,total:s,onChange:o}))}Ui.propTypes={page:ae.a.number.isRequired,showPageSizeSelect:ae.a.bool,pageSize:ae.a.number.isRequired,totalCount:ae.a.number.isRequired,onPageSizeChange:ae.a.func,onChange:ae.a.func},Ui.defaultProps={showPageSizeSelect:!1,onChange:()=>{},onPageSizeChange:()=>{}};var Vi=a(17),Li=a.n(Vi);function Bi(){return(Bi=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Qi(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);r=!0);}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Wi(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Wi(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Wi(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function Hi(e){var t=e.dialog,a=e.tags,i=e.getAvailableTags,s=Qi(Object(r.useState)([]),2),o=s[0],l=s[1],u=Qi(Object(r.useState)(!0),2),d=u[0],m=u[1],p=Qi(Object(r.useState)(()=>Object(c.uniq)(Object(c.map)(a,c.trim))),2),h=p[0],f=p[1],b=Qi(Object(r.useState)(null),2),g=b[0],y=b[1];return Object(r.useEffect)(()=>{g&&!d&&g.focus()},[g,d]),Object(r.useEffect)(()=>{var e=!1;return i().then(t=>{e||(l(Object(c.uniq)(Object(c.compact)(Object(c.map)(t,c.trim)))),m(!1))}),()=>{e=!0}},[i]),n.a.createElement(z.a,Bi({},t.props,{onOk:()=>t.close(h),title:"Add/Edit Tags",className:"shortModal",wrapProps:{"data-test":"EditTagsDialog"}}),n.a.createElement(Li.a,{ref:y,mode:"tags",className:"w-100",placeholder:"Add some tags...",defaultValue:h,onChange:e=>f(Object(c.compact)(Object(c.map)(e,c.trim))),disabled:d,loading:d},Object(c.map)(o,e=>n.a.createElement(Li.a.Option,{key:e},e))))}Hi.propTypes={dialog:Qe.isRequired,tags:ae.a.arrayOf(ae.a.string),getAvailableTags:ae.a.func.isRequired},Hi.defaultProps={tags:[]};var Gi=We(Hi);function Ki(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},i=Object.keys(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function Yi(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class $i extends n.a.Component{constructor(){super(...arguments),Yi(this,"editTags",(e,t)=>{Gi.showModal({tags:e,getAvailableTags:t}).onClose(this.props.onEdit)})}renderEditButton(){var e=Object(c.map)(this.props.tags,c.trim);return n.a.createElement(fe,{className:"label label-tag hidden-xs",onClick:()=>this.editTags(e,this.props.getAvailableTags),"data-test":"EditTagsButton"},0===e.length&&n.a.createElement(n.a.Fragment,null,n.a.createElement("i",{className:"zmdi zmdi-plus m-r-5","aria-hidden":"true"}),"Add tag"),e.length>0&&n.a.createElement(n.a.Fragment,null,n.a.createElement("i",{className:"zmdi zmdi-edit","aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},"Edit")))}render(){var e=this.props,t=e.tags,a=e.tagSeparator;return n.a.createElement("div",{className:"tags-control "+this.props.className,"data-test":"TagsControl"},this.props.children,Object(c.map)(t,(e,t)=>n.a.createElement(n.a.Fragment,{key:e},a&&t>0&&n.a.createElement("span",{className:"tag-separator"},a),n.a.createElement("span",{className:"label label-tag",key:e,title:e,"data-test":"TagLabel"},e))),this.props.canEdit&&this.renderEditButton(),this.props.tagsExtra)}}function Ji(e){var t=e.archivedTooltip;function a(e){var a=e.isDraft,r=e.isArchived,i=Ki(e,["isDraft","isArchived"]);return n.a.createElement($i,i,!r&&a&&n.a.createElement("span",{className:"label label-tag-unpublished"},"Unpublished"),r&&n.a.createElement(Oe,{placement:"right",title:t},n.a.createElement("span",{className:"label label-tag-archived"},"Archived")))}return a.propTypes={isDraft:ae.a.bool,isArchived:ae.a.bool},a.defaultProps={isDraft:!1,isArchived:!1},a}Yi($i,"propTypes",{tags:ae.a.arrayOf(ae.a.string),canEdit:ae.a.bool,getAvailableTags:ae.a.func,onEdit:ae.a.func,className:ae.a.string,tagsExtra:ae.a.node,tagSeparator:ae.a.node,children:ae.a.node}),Yi($i,"defaultProps",{tags:[],canEdit:!1,getAvailableTags:()=>Promise.resolve([]),onEdit:()=>{},className:"",tagsExtra:null,tagSeparator:null,children:null});var Xi=Ji({archivedTooltip:"This query is archived and can't be used in dashboards, or appear in search results."}),Zi=Ji({archivedTooltip:"This dashboard is archived and won't be listed in dashboards nor search results."});a(622);function es(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);r=!0);}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return ts(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return ts(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ts(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function as(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class rs extends n.a.Component{get content(){var e=(this.props.schedule||rs.defaultProps.schedule).interval;if(!e)return["Never"];var t=si(e,{omitSingleValueNumber:!0}),a="Every ".concat(t),r="Refreshes every ".concat(t),n=this.props.schedule,i=n.time,s=n.day_of_week;return i&&(r+=" at ".concat(ri(i))),s&&(r+=" on ".concat(s)),[a,r]}render(){if(this.props.isNew)return"Never";var e=es(this.content,2),t=e[0],a=e[1],r=a?n.a.createElement(Oe,{title:a},t):t;return this.props.isLink?n.a.createElement(fe,{type:"link",className:"schedule-phrase",onClick:this.props.onClick,"data-test":"EditSchedule"},r):r}}as(rs,"propTypes",{schedule:Fn,isNew:ae.a.bool.isRequired,isLink:ae.a.bool,onClick:ae.a.func}),as(rs,"defaultProps",{schedule:Un,isLink:!1,onClick:()=>{}});var ns=a(691),is=a.n(ns);function ss(){return(ss=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function os(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},i=Object.keys(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function ls(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function cs(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?ls(Object(a),!0).forEach((function(t){us(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):ls(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function us(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var ds=ae.a.shape({params:ae.a.object.isRequired,isLoaded:ae.a.bool.isRequired,isEmpty:ae.a.bool.isRequired,searchTerm:ae.a.string,updateSearch:ae.a.func.isRequired,selectedTags:ae.a.array.isRequired,updateSelectedTags:ae.a.func.isRequired,orderByField:ae.a.string,orderByReverse:ae.a.bool.isRequired,toggleSorting:ae.a.func.isRequired,page:ae.a.number.isRequired,itemsPerPage:ae.a.number.isRequired,totalItemsCount:ae.a.number.isRequired,pageSizeOptions:ae.a.arrayOf(ae.a.number).isRequired,pageItems:ae.a.array.isRequired,updatePagination:ae.a.func.isRequired,handleError:ae.a.func.isRequired});function ms(e,t,a){class r extends n.a.Component{constructor(e){super(e),us(this,"_itemsSource",void 0);var r=a(),n=t();this._itemsSource=n,n.setState(cs(cs({},r.getState()),{},{validate:!1})),n.getCallbackContext=()=>this.state,n.onBeforeUpdate=()=>{var e=n.getState();r.setState(e),this.setState(this.getState(cs(cs({},e),{},{isLoaded:!1})))},n.onAfterUpdate=()=>{var e=n.getState();this.setState(this.getState(cs(cs({},e),{},{isLoaded:!0})))},n.onError=e=>this.props.onError(e);var i=this.getState(cs(cs({},n.getState()),{},{isLoaded:!1})),s=n.updatePagination,o=n.toggleSorting,l=n.updateSearch,u=n.updateSelectedTags,d=n.update,m=n.handleError;this.state=cs(cs({},i),{},{toggleSorting:o,updateSearch:Object(c.debounce)(l,200),updateSelectedTags:u,updatePagination:s,update:d,handleError:m})}componentDidMount(){this.state.update()}componentWillUnmount(){this._itemsSource.onBeforeUpdate=()=>{},this._itemsSource.onAfterUpdate=()=>{},this._itemsSource.onError=()=>{}}getState(e){var t=e.isLoaded,a=e.totalCount,r=e.pageItems,n=e.params;return cs(cs({},os(e,["isLoaded","totalCount","pageItems","params"])),{},{params:cs(cs({},n),Object(c.omit)(this.props,["onError","children"])),isLoaded:t,isEmpty:!t||0===a,totalItemsCount:a||0,pageSizeOptions:H.pageSizeOptions,pageItems:r||[]})}render(){var t=this.props,a=t.children,r=(t.onError,os(t,["children","onError"]));return n.a.createElement(e,ss({},r,{controller:this.state}),a)}}return us(r,"propTypes",{onError:ae.a.func,children:ae.a.node}),us(r,"defaultProps",{onError:e=>{setTimeout(()=>{throw e})},children:null}),is()(r,e),r}function ps(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class hs{get totalPages(){return Math.ceil(this.totalCount/this.itemsPerPage)}setPage(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];Object(c.isUndefined)(e)||(e=parseInt(e,10)||1,this.page=t?e>=1&&e<=this.totalPages?e:1:e>=1?e:1)}setItemsPerPage(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];Object(c.isUndefined)(e)||(e=parseInt(e,10)||20,this.itemsPerPage=e>=1?e:1,t&&this.setPage(this.page,t))}setTotalCount(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];Object(c.isUndefined)(e)||(e=parseInt(e,10)||0,this.totalCount=e,t&&this.setPage(this.page,t))}constructor(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.page,a=e.itemsPerPage,r=e.totalCount,n=e.validate,i=void 0===n||n;ps(this,"page",1),ps(this,"itemsPerPage",20),ps(this,"totalCount",0),this.setItemsPerPage(a,i),this.setTotalCount(r,i),this.setPage(t,i)}getItemsForPage(e){var t=this.itemsPerPage*(this.page-1),a=t+this.itemsPerPage;return e.slice(t,a)}}function fs(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function bs(e,t){return e?t?"-"+e:e:null}function gs(e){var t=(e=Object(c.isString)(e)?e:"").startsWith("-");return t&&(e=e.substring(1)),{field:""!==e?e:null,reverse:t}}class ys{get compiled(){return bs(this.field,this.reverse)}set compiled(e){var t=gs(e),a=t.field,r=t.reverse;this.field=a,this.reverse=r}setField(e){this.field=Object(c.isString)(e)&&""!==e?e:null}setReverse(e){this.reverse=!!e}constructor(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.orderByField,a=e.orderByReverse,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;fs(this,"field",null),fs(this,"reverse",!1),fs(this,"sortByIteratees",null),this.setField(t),this.setReverse(a),this.sortByIteratees=r}toggleField(e){Object(c.isString)(e)&&""!==e&&(e===this.field?this.reverse=!this.reverse:(this.field=e,this.reverse=!1))}sort(e){if(this.field){var t=this.sortByIteratees&&this.sortByIteratees[this.field];return e=Object(c.sortBy)(e,t?[t]:this.field),this.reverse&&e.reverse(),e}}}a(1485);class vs{_getRequest(e,t){return this._originalGetRequest({},t)}_processResults(e,t,a){var r=e.results,n=e.count;return{results:this._originalProcessResults(r,a),count:n}}constructor(e){var t=e.getRequest,a=e.doRequest,r=e.processResults;this._originalGetRequest=Object(c.isFunction)(t)?t:c.identity,this._originalDoRequest=a,this._originalProcessResults=Object(c.isFunction)(r)?r:c.identity}fetch(e,t,a){var r=this._getRequest(t,a);return this._originalDoRequest(r,a).then(e=>this._processResults(e,t,a))}}class Os extends vs{constructor(){super(...arguments),function(e,t,a){t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a}(this,"_allItems",[])}_getRequest(e,t){var a=e.searchTerm,r=e.selectedTags;return this._originalGetRequest({q:Object(c.isString)(a)&&""!==a?a:void 0,tags:r},t)}_processResults(e,t,a){var r=t.paginator,n=t.sorter;return this._allItems=this._originalProcessResults(e,a),this._allItems=n.sort(this._allItems),{results:r.getItemsForPage(this._allItems),count:this._allItems.length,allResults:this._allItems}}fetch(e,t,a){if(Object(c.isNil)(e)||e.tags||e.sorting)return super.fetch(e,t,a);var r=t.paginator,n=t.sorter;return e.sorting&&(this._allItems=n.sort(this._allItems)),Promise.resolve({results:r.getItemsForPage(this._allItems),count:this._allItems.length,allResults:this._allItems})}}class Es extends vs{_getRequest(e,t){var a=e.paginator,r=e.sorter,n=e.searchTerm,i=e.selectedTags;return this._originalGetRequest({page:a.page,page_size:a.itemsPerPage,order:r.compiled,q:Object(c.isString)(n)&&""!==n?n:void 0,tags:i},t)}}function js(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},i=Object.keys(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function ws(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function Ss(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?ws(Object(a),!0).forEach((function(t){Ps(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):ws(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Ps(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class Cs{_beforeUpdate(){return Object(c.isFunction)(this.onBeforeUpdate)?Promise.resolve(this.onBeforeUpdate(this.getState(),this.getCallbackContext())):Promise.resolve()}_afterUpdate(){return Object(c.isFunction)(this.onAfterUpdate)?Promise.resolve(this.onAfterUpdate(this.getState(),this.getCallbackContext())):Promise.resolve()}_changed(e){var t={paginator:this._paginator,sorter:this._sorter,searchTerm:this._searchTerm,selectedTags:this._selectedTags},a={},r=Ss(Ss({},this.getCallbackContext()),{},{setCustomParams:e=>{Object(c.extend)(a,e)}});return this._beforeUpdate().then(()=>{var n=Math.random().toString(36).substr(2);return this._currentFetchToken=n,this._fetcher.fetch(e,t,r).then(e=>{var t=e.results,r=e.count,i=e.allResults;if(this._currentFetchToken===n)return this._pageItems=t,this._allItems=i||null,this._paginator.setTotalCount(r),this._params=Ss(Ss({},this._params),a),this._afterUpdate()}).catch(e=>this.handleError(e))})}constructor(e){var t=e.getRequest,a=e.doRequest,r=e.processResults,n=e.isPlainList,i=void 0!==n&&n,s=e.sortByIteratees,o=void 0===s?void 0:s,l=js(e,["getRequest","doRequest","processResults","isPlainList","sortByIteratees"]);Ps(this,"onBeforeUpdate",null),Ps(this,"onAfterUpdate",null),Ps(this,"onError",null),Ps(this,"sortByIteratees",void 0),Ps(this,"getCallbackContext",()=>null),Ps(this,"updatePagination",e=>{var t=e.page,a=e.itemsPerPage,r=this._paginator,n=r.page,i=r.itemsPerPage;this._paginator.setItemsPerPage(a),this._paginator.setPage(t),this._changed({pagination:{page:n!==this._paginator.page,itemsPerPage:i!==this._paginator.itemsPerPage}})}),Ps(this,"toggleSorting",e=>{this._sorter.toggleField(e),this._savedOrderByField=this._sorter.field,this._changed({sorting:!0})}),Ps(this,"updateSearch",e=>{this._searchTerm=e,""===e?this._sorter.setField(this._savedOrderByField):this._sorter.setField(null),this._paginator.setPage(1),this._changed({search:!0,pagination:{page:!0}})}),Ps(this,"updateSelectedTags",e=>{this._selectedTags=e,this._paginator.setPage(1),this._changed({tags:!0,pagination:{page:!0}})}),Ps(this,"update",()=>this._changed()),Ps(this,"handleError",e=>{Object(c.isFunction)(this.onError)&&this.onError(e)}),Object(c.isFunction)(t)||(t=c.identity),this._fetcher=i?new Os({getRequest:t,doRequest:a,processResults:r}):new Es({getRequest:t,doRequest:a,processResults:r}),this.sortByIteratees=o,this.setState(l),this._pageItems=[],this._params={}}getState(){return{page:this._paginator.page,itemsPerPage:this._paginator.itemsPerPage,orderByField:this._sorter.field,orderByReverse:this._sorter.reverse,searchTerm:this._searchTerm,selectedTags:this._selectedTags,totalCount:this._paginator.totalCount,pageItems:this._pageItems,allItems:this._allItems,params:this._params}}setState(e){this._paginator=new hs(e),this._sorter=new ys(e,this.sortByIteratees),this._searchTerm=e.searchTerm||"",this._selectedTags=e.selectedTags||[],this._savedOrderByField=this._sorter.field}}class Ns extends Cs{constructor(e){var t=e.getResource,a=e.getItemProcessor,r=js(e,["getResource","getItemProcessor"]);a=Object(c.isFunction)(a)?a:()=>null,super(Ss(Ss({},r),{},{doRequest:(e,a)=>t(a)(e),processResults:(e,t)=>{var r=a(t);return r=Object(c.isFunction)(r)?r:c.identity,Object(c.map)(e,e=>r(e,t))}}))}}function ks(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function xs(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class As{constructor(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._state=function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?ks(Object(a),!0).forEach((function(t){xs(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):ks(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({},e)}getState(){return Object(c.defaults)(this._state,{page:1,itemsPerPage:H.pageSize,orderByField:"created_at",orderByReverse:!1,searchTerm:"",tags:[]})}setState(){}}class _s extends As{getState(){var e=super.getState(),t=q.search,a=t.q||"",r=""!==a?"":bs(e.orderByField,e.orderByReverse),n=gs(t.order||r),i=n.field,s=n.reverse;return{page:parseInt(t.page,10)||e.page,itemsPerPage:parseInt(t.page_size,10)||e.itemsPerPage,orderByField:i,orderByReverse:s,searchTerm:a}}setState(e){var t=e.page,a=e.itemsPerPage,r=e.orderByField,n=e.orderByReverse,i=e.searchTerm;q.setSearch({page:t,page_size:a,order:bs(r,n),q:""!==i?i:null},!0)}}function qs(){return(qs=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Ts(e){return n.a.createElement("div",{className:"text-center"},n.a.createElement(Ne,qs({icon:"fa-spinner fa-2x fa-pulse",message:"Loading..."},e)))}function Is(){return(Is=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Ds(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class Rs extends n.a.Component{constructor(){var e;super(...arguments),e=this,Ds(this,"listColumns",[{title:"ID",field:"id",width:"1%",align:"right",sorter:!0},gi.custom.sortable((e,t)=>n.a.createElement(n.a.Fragment,null,n.a.createElement(O,{className:"table-main-title",href:"queries/"+t.id},t.name),n.a.createElement(Xi,{className:"d-block",tags:t.tags,isDraft:t.is_draft,isArchived:t.is_archived})),{title:"Name",field:"name",width:null}),gi.avatar({field:"user",className:"p-l-0 p-r-0"},e=>"Created by ".concat(e)),gi.dateTime.sortable({title:"Created At",field:"created_at"}),gi.duration.sortable({title:"Runtime",field:"runtime"}),gi.dateTime.sortable({title:"Last Executed At",field:"retrieved_at",orderByField:"executed_at"}),gi.custom.sortable((e,t)=>n.a.createElement(rs,{schedule:t.schedule,isNew:t.isNew()}),{title:"Update Schedule",field:"schedule"})]),Ds(this,"state",{autoUpdate:!0}),Ds(this,"_updateTimer",null),Ds(this,"autoUpdateSwitchId",Object(c.uniqueId)("auto-update-switch")),Ds(this,"update",(function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];!t&&e.state.autoUpdate&&e.props.controller.update(),e._updateTimer=setTimeout(e.update,6e4)}))}componentDidMount(){mt("view","page","admin/queries/outdated"),this.update(!0)}componentWillUnmount(){clearTimeout(this._updateTimer)}render(){var e=this.props.controller;return n.a.createElement(Nn,{activeTab:e.params.currentPage},n.a.createElement("div",{className:"m-15"},n.a.createElement("div",null,n.a.createElement("label",{htmlFor:this.autoUpdateSwitchId,className:"m-0"},"Auto update"),n.a.createElement(Mi.a,{id:this.autoUpdateSwitchId,className:"m-l-10",checked:this.state.autoUpdate,onChange:e=>this.setState({autoUpdate:e})})),e.params.lastUpdatedAt&&n.a.createElement("div",{className:"m-t-5"},"Last updated: ",n.a.createElement($n,{date:1e3*e.params.lastUpdatedAt}))),!e.isLoaded&&n.a.createElement(Ts,null),e.isLoaded&&e.isEmpty&&n.a.createElement("div",{className:"text-center p-15"},"There are no outdated queries."),e.isLoaded&&!e.isEmpty&&n.a.createElement("div",{className:"bg-white tiled table-responsive"},n.a.createElement(yi,{items:e.pageItems,columns:this.listColumns,orderByField:e.orderByField,orderByReverse:e.orderByReverse,toggleSorting:e.toggleSorting}),n.a.createElement(Ui,{showPageSizeSelect:!0,totalCount:e.totalItemsCount,pageSize:e.itemsPerPage,onPageSizeChange:t=>e.updatePagination({itemsPerPage:t}),page:e.page,onChange:t=>e.updatePagination({page:t})})))}}Ds(Rs,"propTypes",{controller:ds.isRequired});var Ms=ms(Rs,()=>new Cs({doRequest:(e,t)=>Q.get("/api/admin/queries/outdated").then(e=>{var a=e.queries,r=e.updated_at;return t.setCustomParams({lastUpdatedAt:parseFloat(r)}),a}),processResults:e=>Object(c.map)(e,e=>new Xt(e)),isPlainList:!0}),()=>new As({orderByField:"created_at",orderByReverse:!0}));pn.register("Admin.OutdatedQueries",zr({path:"/admin/queries/outdated",title:"Outdated Queries",render:e=>n.a.createElement(Ms,Is({},e,{currentPage:"outdated_queries"}))}));var zs=a(50),Fs=a.n(zs);function Us(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);r=!0);}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Vs(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Vs(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Vs(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function Ls(e){var t=e.info;return t=Object(c.toPairs)(t),n.a.createElement(Wr.a,{title:"General",size:"small"},0===t.length&&n.a.createElement("div",{className:"text-muted text-center"},"No data"),t.length>0&&n.a.createElement(Fs.a,{size:"small",itemLayout:"vertical",dataSource:t,renderItem:e=>{var t=Us(e,2),a=t[0],r=t[1];return n.a.createElement(Fs.a.Item,{extra:n.a.createElement("span",{className:"badge"},r)},oi(a))}}))}function Bs(e){var t=e.info;return n.a.createElement(Wr.a,{title:"Redash Database",size:"small"},0===t.length&&n.a.createElement("div",{className:"text-muted text-center"},"No data"),t.length>0&&n.a.createElement(Fs.a,{size:"small",itemLayout:"vertical",dataSource:t,renderItem:e=>{var t=Us(e,2),a=t[0],r=t[1];return n.a.createElement(Fs.a.Item,{extra:n.a.createElement("span",{className:"badge"},ui(r))},a)}}))}function Qs(e){var t=e.info;return t=Object(c.toPairs)(t),n.a.createElement(Wr.a,{title:"Queues",size:"small"},0===t.length&&n.a.createElement("div",{className:"text-muted text-center"},"No data"),t.length>0&&n.a.createElement(Fs.a,{size:"small",itemLayout:"vertical",dataSource:t,renderItem:e=>{var t=Us(e,2),a=t[0],r=t[1];return n.a.createElement(Fs.a.Item,{extra:n.a.createElement("span",{className:"badge"},r.size)},a)}}))}function Ws(e){var t=e.info,a=t?[n.a.createElement(Fs.a.Item,{extra:n.a.createElement("span",{className:"badge"},n.a.createElement($n,{date:t.lastRefreshAt,placeholder:"n/a"}))},"Last Refresh"),n.a.createElement(Fs.a.Item,{extra:n.a.createElement("span",{className:"badge"},n.a.createElement($n,{date:t.startedAt,placeholder:"n/a"}))},"Started"),n.a.createElement(Fs.a.Item,{extra:n.a.createElement("span",{className:"badge"},t.outdatedQueriesCount)},"Outdated Queries Count")]:[];return n.a.createElement(Wr.a,{title:"Manager",size:"small"},!t&&n.a.createElement("div",{className:"text-muted text-center"},"No data"),t&&n.a.createElement(Fs.a,{size:"small",itemLayout:"vertical",dataSource:a,renderItem:e=>e}))}a(1488);function Hs(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class Gs extends n.a.Component{constructor(){super(...arguments),Hs(this,"state",{queues:[],manager:null,databaseMetrics:{},status:{}}),Hs(this,"_refreshTimer",null),Hs(this,"refresh",()=>{Q.get("/status.json").then(e=>{this.setState({queues:e.manager.queues,manager:{startedAt:1e3*e.manager.started_at,lastRefreshAt:1e3*e.manager.last_refresh_at,outdatedQueriesCount:e.manager.outdated_queries_count},databaseMetrics:e.database_metrics.metrics||[],status:Object(c.omit)(e,["workers","manager","database_metrics"])})}).catch(e=>this.props.onError(e)),this._refreshTimer=setTimeout(this.refresh,6e4)})}componentDidMount(){mt("view","page","admin/status"),this.refresh()}componentWillUnmount(){clearTimeout(this._refreshTimer)}render(){return n.a.createElement(Nn,{activeTab:"system_status"},n.a.createElement("div",{className:"system-status-page"},n.a.createElement("div",{className:"system-status-page-blocks"},n.a.createElement("div",{className:"system-status-page-block"},n.a.createElement(Ls,{info:this.state.status})),n.a.createElement("div",{className:"system-status-page-block"},n.a.createElement(Ws,{info:this.state.manager})),n.a.createElement("div",{className:"system-status-page-block"},n.a.createElement(Qs,{info:this.state.queues})),n.a.createElement("div",{className:"system-status-page-block"},n.a.createElement(Bs,{info:this.state.databaseMetrics})))))}}function Ks(){return(Ks=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}Hs(Gs,"propTypes",{onError:ae.a.func}),Hs(Gs,"defaultProps",{onError:()=>{}}),pn.register("Admin.SystemStatus",zr({path:"/admin/status",title:"System Status",render:e=>n.a.createElement(Gs,e)}));var Ys={"greater than":">","less than":"<",equals:"="},$s=e=>Object(c.merge)({},e,{options:{op:Ys[e.options.op]||e.options.op}}),Js={query:()=>Q.get("api/alerts"),get:e=>{var t=e.id;return Q.get("api/alerts/".concat(t)).then($s)},save:e=>Q.post((e=>e.id?"api/alerts/".concat(e.id):"api/alerts")(e),(e=>{var t=Ks({},e);return void 0===t.query_id&&(t.query_id=t.query.id,t.destination_id=t.destinations,delete t.query,delete t.destinations),t})(e)),delete:e=>Q.delete("api/alerts/".concat(e.id)),mute:e=>Q.post("api/alerts/".concat(e.id,"/mute")),unmute:e=>Q.delete("api/alerts/".concat(e.id,"/mute"))};function Xs(){return(Xs=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Zs(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var eo={unknown:"label-warning",ok:"label-success",triggered:"label-danger"};class to extends n.a.Component{constructor(){super(...arguments),Zs(this,"listColumns",[gi.custom.sortable((e,t)=>n.a.createElement("span",{title:t.options.muted?"Muted":"Active"},n.a.createElement("i",{className:"fa fa-bell-".concat(t.options.muted?"slash":"o"," p-r-0"),"aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},t.options.muted?"Muted":"Active")),{title:n.a.createElement(n.a.Fragment,null,n.a.createElement("i",{className:"fa fa-bell p-r-0","aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},"Sort by notification status.")),field:"muted",width:"1%"}),gi.custom.sortable((e,t)=>n.a.createElement("div",null,n.a.createElement(O,{className:"table-main-title",href:"alerts/"+t.id},t.name)),{title:"Name",field:"name"}),gi.custom((e,t)=>t.user.name,{title:"Created By",width:"1%"}),gi.custom.sortable((e,t)=>n.a.createElement("div",null,n.a.createElement("span",{className:"label ".concat(eo[t.state])},Object(c.toUpper)(t.state))),{title:"State",field:"state",width:"1%",className:"text-nowrap"}),gi.timeAgo.sortable({title:"Last Updated At",field:"updated_at",width:"1%"}),gi.dateTime.sortable({title:"Created At",field:"created_at",width:"1%"})])}render(){var e=this.props.controller;return n.a.createElement("div",{className:"page-alerts-list"},n.a.createElement("div",{className:"container"},n.a.createElement(Cn,{title:e.params.pageTitle,actions:W.hasPermission("list_alerts")?n.a.createElement(O.Button,{block:!0,type:"primary",href:"alerts/new"},n.a.createElement("i",{className:"fa fa-plus m-r-5","aria-hidden":"true"}),"New Alert"):null}),n.a.createElement("div",null,e.isLoaded&&e.isEmpty?n.a.createElement(le,{name:"AlertsList.EmptyState"},n.a.createElement(Br,{icon:"fa fa-bell-o",illustration:"alert",description:"Get notified on certain events",helpMessage:n.a.createElement(Vr,{helpTriggerType:"ALERTS"}),showAlertStep:!0})):n.a.createElement("div",{className:"table-responsive bg-white tiled"},n.a.createElement(yi,{loading:!e.isLoaded,items:e.pageItems,columns:this.listColumns,orderByField:e.orderByField,orderByReverse:e.orderByReverse,toggleSorting:e.toggleSorting}),n.a.createElement(Ui,{showPageSizeSelect:!0,totalCount:e.totalItemsCount,pageSize:e.itemsPerPage,onPageSizeChange:t=>e.updatePagination({itemsPerPage:t}),page:e.page,onChange:t=>e.updatePagination({page:t})})))))}}Zs(to,"propTypes",{controller:ds.isRequired});var ao=ms(to,()=>new Ns({isPlainList:!0,getRequest:()=>({}),getResource:()=>Js.query.bind(Js)}),()=>new As({orderByField:"created_at",orderByReverse:!0,itemsPerPage:20}));pn.register("Alerts.List",zr({path:"/alerts",title:"Alerts",render:e=>n.a.createElement(ao,Xs({},e,{currentPage:"alerts"}))}));var ro=a(113),no=a.n(ro);function io(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);r=!0);}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return so(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return so(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function so(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function oo(e){var t=e.doDelete,a=e.canEdit,i=e.mute,s=e.unmute,o=e.muted,l=io(Object(r.useState)(!1),2),c=l[0],u=l[1],d=Object(r.useCallback)(e=>{u(!0),e().finally(()=>{u(!1)})},[]),m=Object(r.useCallback)(()=>{z.a.confirm({title:"Delete Alert",content:"Are you sure you want to delete this alert?",okText:"Delete",okType:"danger",onOk:()=>{u(!0),t().catch(()=>{u(!1)})},maskClosable:!0,autoFocusButton:null})},[t]);return n.a.createElement(Nr.a,{className:me()("m-l-5",{disabled:!a}),trigger:[a?"click":void 0],placement:"bottomRight",overlay:n.a.createElement(ue.a,null,n.a.createElement(ue.a.Item,null,o?n.a.createElement(fe,{onClick:()=>d(s)},"Unmute Notifications"):n.a.createElement(fe,{onClick:()=>d(i)},"Mute Notifications")),n.a.createElement(ue.a.Item,null,n.a.createElement(fe,{onClick:m},"Delete")))},n.a.createElement(f.a,{"aria-label":"More actions"},c?n.a.createElement(fn.a,null):n.a.createElement(no.a,{rotate:90,"aria-hidden":"true"})))}oo.propTypes={doDelete:ae.a.func.isRequired,canEdit:ae.a.bool.isRequired,mute:ae.a.func.isRequired,unmute:ae.a.func.isRequired,muted:ae.a.bool},oo.defaultProps={muted:!1};var lo=a(23),co=a.n(lo);a(1489);function uo(e){var t=e.alert,a=e.editMode,r=e.name,i=e.onChange,s=e.children,o=Cl(t);return n.a.createElement("div",{className:"alert-header"},n.a.createElement("div",{className:"alert-title"},n.a.createElement("h3",null,a&&t.query?n.a.createElement(Fe.a,{className:"f-inherit",placeholder:o,value:r,"aria-label":"Alert title",onChange:e=>i(e.target.value)}):r||o)),n.a.createElement("div",{className:"alert-actions"},s))}uo.propTypes={alert:Wn.isRequired,name:ae.a.string,children:ae.a.node,onChange:ae.a.func,editMode:ae.a.bool},uo.defaultProps={name:null,children:null,onChange:null,editMode:!1};var mo=a(192),po=a.n(mo),ho=a(117),fo=a.n(ho),bo=(a(1490),{">":">",">=":"â‰¥","<":"<","<=":"â‰¤","==":"=","!=":"â‰ "}),go=["==","!="];function yo(e){var t=e.children,a=e.minWidth;return n.a.createElement("div",{className:"criteria-disabled-input",style:{minWidth:a}},t)}function vo(e){var t=e.columnNames,a=e.resultValues,r=e.alertOptions,i=e.onChange,s=e.editMode,o=Object(c.isEmpty)(a)?null:Object(c.head)(a)[r.column],l=Object(c.includes)(go,r.op)?null:isNaN(r.value)?"Value column type doesn't match threshold type.":isNaN(o)?"Value column isn't supported by condition type.":null,u=n.a.createElement("small",{className:"alert-criteria-hint"},"Top row value is ",n.a.createElement("code",{className:"p-0"},Object(c.toString)(o)||"unknown"));return n.a.createElement("div",{"data-test":"Criteria"},n.a.createElement("div",{className:"input-title"},n.a.createElement("span",{className:"input-label"},"Value column"),s?n.a.createElement(Li.a,{value:r.column,onChange:e=>i({column:e}),dropdownMatchSelectWidth:!1,style:{minWidth:100}},t.map(e=>n.a.createElement(Li.a.Option,{key:e},e))):n.a.createElement(yo,{minWidth:70},r.column)),n.a.createElement("div",{className:"input-title"},n.a.createElement("span",{className:"input-label"},"Condition"),s?n.a.createElement(Li.a,{value:r.op,onChange:e=>i({op:e}),optionLabelProp:"label",dropdownMatchSelectWidth:!1,style:{width:55}},n.a.createElement(Li.a.Option,{value:">",label:bo[">"]},bo[">"]," greater than"),n.a.createElement(Li.a.Option,{value:">=",label:bo[">="]},bo[">="]," greater than or equals"),n.a.createElement(Li.a.Option,{disabled:!0,key:"dv1"},n.a.createElement(fo.a,{className:"select-option-divider m-t-10 m-b-5"})),n.a.createElement(Li.a.Option,{value:"<",label:bo["<"]},bo["<"]," less than"),n.a.createElement(Li.a.Option,{value:"<=",label:bo["<="]},bo["<="]," less than or equals"),n.a.createElement(Li.a.Option,{disabled:!0,key:"dv2"},n.a.createElement(fo.a,{className:"select-option-divider m-t-10 m-b-5"})),n.a.createElement(Li.a.Option,{value:"==",label:bo["=="]},bo["=="]," equals"),n.a.createElement(Li.a.Option,{value:"!=",label:bo["!="]},bo["!="]," not equal to")):n.a.createElement(yo,{minWidth:50},bo[r.op])),n.a.createElement("div",{className:"input-title"},n.a.createElement("label",{className:"input-label",htmlFor:"threshold-criterion"},"Threshold"),s?n.a.createElement(Fe.a,{id:"threshold-criterion",style:{width:90},value:r.value,onChange:e=>i({value:e.target.value})}):n.a.createElement(yo,{minWidth:50},r.value)),n.a.createElement("div",{className:"ant-form-item-explain"},u,n.a.createElement("br",null),l&&n.a.createElement("small",null,n.a.createElement(po.a,{className:"warning-icon-danger"})," ",l)))}yo.propTypes={children:ae.a.node.isRequired,minWidth:ae.a.number.isRequired},vo.propTypes={columnNames:ae.a.arrayOf(ae.a.string).isRequired,resultValues:ae.a.arrayOf(ae.a.object).isRequired,alertOptions:Qn.isRequired,onChange:ae.a.func,editMode:ae.a.bool},vo.defaultProps={onChange:()=>{},editMode:!1};var Oo=a(115),Eo=a.n(Oo);a(1493);function jo(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},i=Object.keys(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function wo(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);r=!0);}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return So(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return So(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function So(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}var Po=[["Second",1],["Minute",60],["Hour",3600],["Day",86400],["Week",604800]];function Co(e){var t=e.value,a=e.onChange,i=e.editMode,s=wo(Object(r.useState)(),2),o=s[0],l=s[1],u=wo(Object(r.useState)(),2),d=u[0],m=u[1];if(Object(r.useEffect)(()=>{for(var e=Po.length-1;e>=0;e-=1){var a=wo(Po[e],2)[1];if(t%a==0){l(e),m(t/a);break}}},[t]),!Object(c.isNumber)(d)||!Object(c.isNumber)(o))return null;var p=1!==d?"s":"";if(i)return n.a.createElement(n.a.Fragment,null,n.a.createElement(Eo.a,{value:d,onChange:e=>{m(e),a(e*Po[o][1])},min:1,precision:0}),n.a.createElement(Li.a,{value:o,onChange:e=>{l(e),a(d*Po[e][1])}},Po.map((e,t)=>{var a=wo(e,1)[0];return n.a.createElement(Li.a.Option,{value:t,key:a},a,p)})));var h=wo(Po[o],1)[0];return d+" "+Object(c.toLower)(h)+p}function No(e){var t=e.value,a=e.onChange,i=wo(Object(r.useState)(t<2?t:2),2),s=i[0],o=i[1];return n.a.createElement("div",{className:"alert-rearm"},n.a.createElement(Li.a,{optionLabelProp:"label",defaultValue:s||0,dropdownMatchSelectWidth:!1,onChange:e=>{o(e),a(e<2?e:3600)}},n.a.createElement(Li.a.Option,{value:0,label:"Just once"},"Just once ",n.a.createElement("em",null,"until back to normal")),n.a.createElement(Li.a.Option,{value:1,label:"Each time alert is evaluated"},"Each time alert is evaluated ",n.a.createElement("em",null,"until back to normal")),n.a.createElement(Li.a.Option,{value:2,label:"At most every"},"At most every ... ",n.a.createElement("em",null,"when alert is evaluated"))),2===s&&t&&n.a.createElement(Co,{value:t,onChange:a,editMode:!0}))}function ko(e){var t=e.value,a="";switch(t){case 0:a="just once, until back to normal";break;case 1:a="each time alert is evaluated, until back to normal";break;default:a=n.a.createElement(n.a.Fragment,null,"at most every ",n.a.createElement(Co,{value:t,editMode:!1}),", when alert is evaluated")}return n.a.createElement("span",null,"Notifications are sent ",a,".")}function xo(e){var t=e.editMode,a=jo(e,["editMode"]);return t?n.a.createElement(No,a):n.a.createElement(ko,a)}Co.propTypes={onChange:ae.a.func,value:ae.a.number.isRequired,editMode:ae.a.bool.isRequired},Co.defaultProps={onChange:()=>{}},No.propTypes={onChange:ae.a.func.isRequired,value:ae.a.number.isRequired},ko.propTypes={value:ae.a.number.isRequired},xo.propTypes={onChange:ae.a.func,value:ae.a.number.isRequired,editMode:ae.a.bool},xo.defaultProps={onChange:null,editMode:!1};var Ao=a(1882);function _o(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);r=!0);}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return qo(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return qo(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function qo(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function To(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=t.initialResults,n=void 0===a?null:a,i=t.debounceTimeout,s=void 0===i?200:i,o=Object(r.useState)(n),l=_o(o,2),c=l[0],u=l[1],d=Object(r.useState)(!1),m=_o(d,2),p=m[0],h=m[1],f=Object(r.useRef)(null),b=Object(r.useRef)(!1),g=Object(Ao.a)(t=>{h(!0),f.current=t,e(t).catch(()=>n).then(e=>{t!==f.current||b.current||(u(e),h(!1))})},s),y=_o(g,1),v=y[0];return Object(r.useEffect)(()=>()=>{b.current=!0},[]),[v,c,p]}function Io(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);r=!0);}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Do(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Do(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Do(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}var Ro=Li.a.Option;function Mo(e){return null===e?Promise.resolve(null):e?Xt.query({q:e}).then(e=>e.results):Xt.recent().then(e=>e.filter(e=>!e.is_draft))}function zo(e){var t=Io(Object(r.useState)(""),2),a=t[0],i=t[1],s=Io(Object(r.useState)(),2),o=s[0],l=s[1],u=Io(To(Mo,{initialResults:[]}),3),d=u[0],m=u[1],p=u[2],h="Search a query by name",f=n.a.createElement("i",{className:"fa fa-times hide-in-percy",role:"button",tabIndex:0,"aria-label":"Clear",onClick:()=>g(null)}),b=n.a.createElement("span",{role:"status","aria-live":"polite","aria-relevant":"additions removals"},n.a.createElement("i",{className:me()("fa fa-spinner fa-pulse hide-in-percy",{hidden:!p}),"aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},"Searching..."));function g(t){var a=null;t&&((a=Object(c.find)(m,{id:t}))||en.error("Something went wrong...","Couldn't select query")),i(a?null:""),l(a),e.onChange(a)}if(Object(r.useEffect)(()=>{d(a)},[d,a]),Object(r.useEffect)(()=>{e.selectedQuery&&l(e.selectedQuery)},[e.selectedQuery]),e.disabled)return n.a.createElement(Fe.a,{value:o&&o.name,"aria-label":"Tied query",placeholder:h,disabled:!0});if("select"===e.type){var y=o?f:null,v=o?o.name:a;return n.a.createElement(Li.a,{showSearch:!0,dropdownMatchSelectWidth:!1,placeholder:h,value:v||void 0,onSearch:i,onChange:g,suffixIcon:p?b:y,notFoundContent:null,filterOption:!1,defaultActiveFirstOption:!1,className:e.className,"data-test":"QuerySelector"},m&&m.map(e=>{var t=e.is_draft;return n.a.createElement(Ro,{value:e.id,key:e.id,disabled:t,className:"query-selector-result","data-test":"QueryId".concat(e.id)},e.name," ",n.a.createElement(Xi,{isDraft:e.is_draft,tags:e.tags,className:me()("inline-tags-control",{disabled:t})}))}))}return n.a.createElement("span",{"data-test":"QuerySelector"},o?n.a.createElement(Fe.a,{value:o.name,"aria-label":"Tied query",suffix:f,readOnly:!0}):n.a.createElement(Fe.a,{placeholder:h,value:a,"aria-label":"Tied query",onChange:e=>i(e.target.value),suffix:b}),n.a.createElement("div",{className:"scrollbox",style:{maxHeight:"50vh",marginTop:15}},m&&(m.length?n.a.createElement("ul",{className:"list-group"},m.map(e=>n.a.createElement(fe,{className:me()("query-selector-result","list-group-item",{inactive:e.is_draft}),key:e.id,role:"listitem",onClick:()=>g(e.id),"data-test":"QueryId".concat(e.id)},e.name," ",n.a.createElement(Xi,{isDraft:e.is_draft,tags:e.tags,className:"inline-tags-control"})))):n.a.createElement("div",{className:"text-muted"},"No results matching search term."))))}zo.propTypes={onChange:ae.a.func.isRequired,selectedQuery:ae.a.object,type:ae.a.oneOf(["select","default"]),className:ae.a.string,disabled:ae.a.bool},zo.defaultProps={selectedQuery:null,type:"default",className:null,disabled:!1};var Fo=a(692),Uo=a.n(Fo);a(1494);function Vo(e){var t=e.query,a=e.queryResult,r=e.onChange,i=e.editMode,s=t&&t.schedule?n.a.createElement("small",null,"Scheduled to refresh"," ",n.a.createElement("i",{className:"alert-query-schedule"},n.a.createElement(rs,{schedule:t.schedule,isNew:!1}))):n.a.createElement("small",null,n.a.createElement(po.a,{className:"warning-icon-danger"})," This query has no ",n.a.createElement("i",null,"refresh schedule"),"."," ",n.a.createElement(Oe,{title:"A query schedule is not necessary but is highly recommended for alerts. An Alert without a query schedule will only send notifications if a user in your organization manually executes this query."},n.a.createElement("a",{role:"presentation"},"Why it's recommended ",n.a.createElement(Uo.a,null))));return n.a.createElement(n.a.Fragment,null,i?n.a.createElement(zo,{onChange:r,selectedQuery:t,className:"alert-query-selector",type:"select"}):n.a.createElement(Oe,{title:"Open query in a new tab."},n.a.createElement(O,{href:"queries/".concat(t.id),target:"_blank",rel:"noopener noreferrer",className:"alert-query-link"},t.name," ",n.a.createElement("i",{className:"fa fa-external-link","aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},"(opens in a new tab)"))),n.a.createElement("div",{className:"ant-form-item-explain"},t&&s),t&&!a&&n.a.createElement("div",{className:"m-t-30"},n.a.createElement(fn.a,{className:"m-r-5"})," Loading query data"))}Vo.propTypes={query:Bn,queryResult:ae.a.object,onChange:ae.a.func,editMode:ae.a.bool},Vo.defaultProps={query:null,queryResult:null,onChange:()=>{},editMode:!1};a(1497);function Lo(){return(Lo=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Bo(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);r=!0);}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Qo(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Qo(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Qo(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function Wo(e){var t=e.items,a=e.renderItem,i=e.onItemClick,s=Object(r.useCallback)(e=>{var t=a(e),r=t.content,s=t.className,o=t.isDisabled;return n.a.createElement(Fs.a.Item,{className:me()("select-items-list","w-100","p-l-10","p-r-10",{disabled:o},s),onClick:o?null:()=>i(e)},r)},[a,i]);return n.a.createElement(Fs.a,{size:"small",dataSource:t,renderItem:s})}function Ho(e){var t=e.dialog,a=e.dialogTitle,i=e.inputPlaceholder,s=e.itemKey,o=e.renderItem,l=e.renderStagedItem,u=e.searchItems,d=e.selectedItemsTitle,m=e.width,p=e.showCount,h=e.extraFooterContent,b=Bo(Object(r.useState)([]),2),g=b[0],y=b[1],v=Bo(To(u,{initialResults:[]}),3),O=v[0],E=v[1],j=v[2],w=E.length>0;Object(r.useEffect)(()=>{O()},[O]);var S=Object(r.useCallback)(e=>{var t=s(e);return!!Object(c.find)(g,e=>s(e)===t)},[g,s]),P=Object(r.useCallback)(e=>{if(S(e)){var t=s(e);y(Object(c.filter)(g,e=>s(e)!==t))}else y([...g,e])},[g,s,S]),C=Object(r.useCallback)(()=>{t.close(g).catch(e=>{e&&en.error("Failed to save some of selected items.")})},[t,g]);return n.a.createElement(z.a,Lo({},t.props,{className:"select-items-dialog",width:m,title:a,footer:n.a.createElement("div",{className:"d-flex align-items-center"},n.a.createElement("span",{className:"flex-fill m-r-5",style:{textAlign:"left",color:"rgba(0, 0, 0, 0.5)"}},h),n.a.createElement(f.a,Lo({},t.props.cancelButtonProps,{onClick:t.dismiss}),"Cancel"),n.a.createElement(f.a,Lo({},t.props.okButtonProps,{onClick:C,disabled:0===g.length||t.props.okButtonProps.disabled,type:"primary"}),"Save",p&&!Object(c.isEmpty)(g)?" (".concat(Object(c.size)(g),")"):null))}),n.a.createElement("div",{className:"d-flex align-items-center m-b-10"},n.a.createElement("div",{className:"flex-fill"},n.a.createElement(Fe.a.Search,{onChange:e=>O(e.target.value),placeholder:i,"aria-label":i,autoFocus:!0})),l&&n.a.createElement("div",{className:"w-50 m-l-20"},n.a.createElement("h5",{className:"m-0"},d))),n.a.createElement("div",{className:"d-flex align-items-stretch",style:{minHeight:"30vh",maxHeight:"50vh"}},n.a.createElement("div",{className:"flex-fill scrollbox"},j&&n.a.createElement(Ts,{className:""}),!j&&!w&&n.a.createElement(Ne,{icon:"fa-search",message:"No items match your search.",className:""}),!j&&w&&n.a.createElement(Wo,{items:E,renderItem:e=>o(e,{isSelected:S(e)}),onItemClick:P})),l&&n.a.createElement("div",{className:"w-50 m-l-20 scrollbox"},g.length>0&&n.a.createElement(Wo,{items:g,renderItem:e=>l(e,{isSelected:!0}),onItemClick:P}))))}Wo.propTypes={items:ae.a.array,renderItem:ae.a.func,onItemClick:ae.a.func},Wo.defaultProps={items:[],renderItem:()=>{},onItemClick:()=>{}},Ho.propTypes={dialog:Qe.isRequired,dialogTitle:ae.a.string,inputPlaceholder:ae.a.string,selectedItemsTitle:ae.a.string,searchItems:ae.a.func.isRequired,itemKey:ae.a.func,renderItem:ae.a.func,renderStagedItem:ae.a.func,width:ae.a.oneOfType([ae.a.string,ae.a.number]),extraFooterContent:ae.a.node,showCount:ae.a.bool},Ho.defaultProps={dialogTitle:"Add Items",inputPlaceholder:"Search...",selectedItemsTitle:"Selected items",itemKey:e=>e.id,renderItem:()=>"",renderStagedItem:null,width:"80%",extraFooterContent:null,showCount:!1};var Go=We(Ho),Ko="static/images/destinations",Yo={query:()=>Q.get("api/destinations"),get:e=>{var t=e.id;return Q.get("api/destinations/".concat(t))},types:()=>Q.get("api/destinations/types"),create:e=>Q.post("api/destinations",e),save:e=>Q.post("api/destinations/".concat(e.id),e),delete:e=>{var t=e.id;return Q.delete("api/destinations/".concat(t))}},$o={query:e=>{var t=e.alertId;return Q.get("api/alerts/".concat(t,"/subscriptions"))},create:e=>Q.post("api/alerts/".concat(e.alert_id,"/subscriptions"),e),delete:e=>Q.delete("api/alerts/".concat(e.alert_id,"/subscriptions/").concat(e.id))};function Jo(e){var t=e.isSelected,a=e.isStaged,r=e.alreadyInGroup,i=e.deselectedIcon;return a?n.a.createElement(n.a.Fragment,null,n.a.createElement("i",{className:"fa fa-remove","aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},"Remove")):r?n.a.createElement(Oe,{title:"Already selected"},n.a.createElement("span",{tabIndex:0},n.a.createElement("i",{className:"fa fa-check","aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},"Already selected"))):t?n.a.createElement(n.a.Fragment,null,n.a.createElement("i",{className:"fa fa-check","aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},"Selected")):n.a.createElement(n.a.Fragment,null,n.a.createElement("i",{className:"fa ".concat(i),"aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},"Select"))}function Xo(e){var t=e.featureName,a=e.className,r=e.mode,i=e.adminOnly,s=Pe("sr-mail-description");if(!H.mailSettingsMissing)return null;if(i&&!W.isAdmin)return null;var o=n.a.createElement("span",{id:s},"Your mail server isn't configured correctly, and is needed for ",t," to work."," ",n.a.createElement(Me,{type:"MAIL_CONFIG",className:"f-inherit"}));return"icon"===r?n.a.createElement(Oe,{title:o,placement:"topRight",arrowPointAtCenter:!0},n.a.createElement("span",{className:a,"aria-label":"Mail alert","aria-describedby":s,tabIndex:0},n.a.createElement("i",{className:"fa fa-exclamation-triangle","aria-hidden":"true"}))):n.a.createElement(p.a,{message:o,type:"error",className:a})}Jo.propTypes={isSelected:ae.a.bool,isStaged:ae.a.bool,alreadyInGroup:ae.a.bool,deselectedIcon:ae.a.string},Jo.defaultProps={isSelected:!1,isStaged:!1,alreadyInGroup:!1,deselectedIcon:"fa-angle-double-right"},Xo.propTypes={featureName:ae.a.string.isRequired,className:ae.a.string,mode:ae.a.oneOf(["alert","icon"]),adminOnly:ae.a.bool},Xo.defaultProps={className:null,mode:"alert",adminOnly:!1};a(1498);function Zo(){return(Zo=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function el(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);r=!0);}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return tl(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return tl(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function tl(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function al(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function rl(e){return e.destination||(e.destination={id:-1,name:e.user.email,icon:"DEPRECATED",type:"email"}),e}function nl(e){var t=e.destination,a=t.name,r=t.type,i=e.user,s=e.unsubscribe,o=W.isAdmin||W.id===i.id;return n.a.createElement("li",{className:"destination-wrapper"},n.a.createElement("img",{src:"".concat(Ko,"/").concat(r,".png"),className:"destination-icon",alt:a}),n.a.createElement("span",{className:"flex-fill"},a),"email"===r&&n.a.createElement(Xo,{className:"destination-warning",featureName:"alert emails",mode:"icon"}),o&&n.a.createElement(Oe,{title:"Remove",mouseEnterDelay:.5},n.a.createElement(fe,{className:"remove-button",onClick:s},n.a.createElement(Se.a,null))))}nl.propTypes={destination:Ln.isRequired,user:Vn.isRequired,unsubscribe:ae.a.func.isRequired};class il extends n.a.Component{constructor(){super(...arguments),al(this,"state",{dests:[],subs:null}),al(this,"showAddAlertSubDialog",()=>{var e=this.state,t=e.dests,a=e.subs;Go.showModal({width:570,showCount:!0,extraFooterContent:n.a.createElement(n.a.Fragment,null,n.a.createElement("i",{className:"fa fa-info-circle","aria-hidden":"true"})," Create new destinations in"," ",n.a.createElement(Oe,{title:"Opens page in a new tab."},n.a.createElement(O,{href:"destinations/new",target:"_blank"},"Alert Destinations"))),dialogTitle:"Add Existing Alert Destinations",inputPlaceholder:"Search destinations...",searchItems:e=>(e=Object(c.toLower)(e),Promise.resolve(t.filter(t=>Object(c.includes)(Object(c.toLower)(t.name),e)))),renderItem:(e,t)=>{var r=t.isSelected,i=!!Object(c.find)(a,t=>t.destination.id===e.id);return{content:n.a.createElement("div",{className:"destination-wrapper"},n.a.createElement("img",{src:"".concat(Ko,"/").concat(e.type,".png"),className:"destination-icon",alt:e.name}),n.a.createElement("span",{className:"flex-fill"},e.name),n.a.createElement(Jo,{isSelected:r,alreadyInGroup:i,deselectedIcon:"fa-plus"})),isDisabled:i,className:r||i?"selected":""}}}).onClose(e=>{var t=Object(c.map)(e,e=>this.subscribe(e));return Promise.all(t).then(()=>{en.success("Subscribed.")}).catch(()=>(en.error("Failed saving subscription."),Promise.reject(null)))})}),al(this,"onUserEmailToggle",e=>{e?this.unsubscribe(e):this.subscribe()}),al(this,"subscribe",e=>{var t={alert_id:this.props.alertId};return e&&(t.destination_id=e.id),$o.create(t).then(e=>{var t=this.state.subs;this.setState({subs:[...t,rl(e)]})})}),al(this,"unsubscribe",e=>{$o.delete(e).then(()=>{var t=this.state.subs;this.setState({subs:Object(c.without)(t,e)})}).catch(()=>{en.error("Failed unsubscribing.")})})}componentDidMount(){var e=this.props.alertId;Promise.all([Yo.query(),$o.query({alertId:e})]).then(e=>{var t=el(e,2),a=t[0],r=t[1];r=r.map(rl),this.setState({dests:a,subs:r})})}render(){if(!this.props.alertId)return null;var e=this.state.subs,t=Object(c.find)(e,{destination:{id:-1},user:{id:W.id}}),a=Object(c.without)(e,t),r=H.mailSettingsMissing;return n.a.createElement("div",{className:"alert-destinations","data-test":"AlertDestinations"},n.a.createElement(Oe,{title:'Click to add an existing "Alert Destination"',mouseEnterDelay:.5},n.a.createElement(f.a,{"data-test":"ShowAddAlertSubDialog",type:"primary",size:"small",className:"add-button",onClick:this.showAddAlertSubDialog},n.a.createElement("i",{className:"fa fa-plus f-12 m-r-5","aria-hidden":"true"})," Add")),n.a.createElement("ul",null,n.a.createElement("li",{className:"destination-wrapper"},n.a.createElement("i",{className:"destination-icon fa fa-envelope","aria-hidden":"true"}),n.a.createElement("span",{className:"flex-fill"},W.email),n.a.createElement(Xo,{className:"destination-warning",featureName:"alert emails",mode:"icon"}),!r&&n.a.createElement(Mi.a,{size:"small",className:"toggle-button",checked:!!t,loading:!e,onChange:()=>this.onUserEmailToggle(t),"data-test":"UserEmailToggle"})),a.map(e=>n.a.createElement(nl,Zo({key:e.id,unsubscribe:()=>this.unsubscribe(e)},e)))))}}function sl(){return(sl=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function ol(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},i=Object.keys(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function ll(e){var t=e.children,a=e.label,r=e.className,i=ol(e,["children","label","className"]),s={span:16};return a||(s.offset=4),r=me()("alert-form-item",r),n.a.createElement(co.a.Item,sl({labelCol:{span:4},wrapperCol:s,label:a,className:r},i),t)}function cl(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function ul(e){var t=e.state,a=e.lastTriggered;return n.a.createElement("div",{className:"alert-state"},n.a.createElement("span",{className:"alert-state-indicator label ".concat(eo[t])},"Status: ",t),"unknown"===t&&n.a.createElement("div",{className:"ant-form-item-explain"},"Alert condition has not been evaluated."),a&&n.a.createElement("div",{className:"ant-form-item-explain"},"Last triggered"," ",n.a.createElement("span",{className:"alert-last-triggered"},n.a.createElement($n,{date:a}))))}al(il,"propTypes",{alertId:ae.a.any.isRequired}),ll.propTypes={children:ae.a.node,label:ae.a.string,className:ae.a.string},ll.defaultProps={children:null,label:null,className:null},ul.propTypes={state:ae.a.string.isRequired,lastTriggered:ae.a.string},ul.defaultProps={lastTriggered:null};class dl extends n.a.Component{constructor(){super(...arguments),cl(this,"state",{unmuting:!1}),cl(this,"unmute",()=>{this.setState({unmuting:!0}),this.props.unmute().finally(()=>{this.setState({unmuting:!1})})})}render(){var e=this.props,t=e.alert,a=e.queryResult,r=e.canEdit,i=e.onEdit,s=e.menuButton,o=t.query,l=t.name,c=t.options,u=t.rearm;return n.a.createElement(n.a.Fragment,null,n.a.createElement(uo,{name:l,alert:t},n.a.createElement(le,{name:"AlertView.HeaderExtra",alert:t}),n.a.createElement(Oe,{title:r?"":"You do not have sufficient permissions to edit this alert"},n.a.createElement(f.a,{type:"default",onClick:r?i:null,className:me()({disabled:!r})},n.a.createElement("i",{className:"fa fa-edit m-r-5","aria-hidden":"true"}),"Edit"),s)),n.a.createElement("div",{className:"bg-white tiled p-20"},n.a.createElement(Pn.Row,{type:"flex",gutter:16},n.a.createElement(Pn.Col,{xs:24,md:16,className:"d-flex"},n.a.createElement(co.a,{className:"flex-fill"},n.a.createElement(ll,null,n.a.createElement(ul,{state:t.state,lastTriggered:t.last_triggered_at})),n.a.createElement(ll,{label:"Query"},n.a.createElement(Vo,{query:o,queryResult:a})),a&&c&&n.a.createElement(n.a.Fragment,null,n.a.createElement(ll,{label:"Trigger when",className:"alert-criteria"},n.a.createElement(vo,{columnNames:a.getColumnNames(),resultValues:a.getData(),alertOptions:c})),n.a.createElement(ll,{label:"Notifications",className:"form-item-line-height-normal"},n.a.createElement(xo,{value:u||0}),n.a.createElement("br",null),"Set to ",c.custom_subject||c.custom_body?"custom":"default"," notification template.")))),n.a.createElement(Pn.Col,{xs:24,md:8},c.muted&&n.a.createElement(p.a,{className:"m-b-20",message:n.a.createElement(n.a.Fragment,null,n.a.createElement("i",{className:"fa fa-bell-slash-o","aria-hidden":"true"})," Notifications are muted"),description:n.a.createElement(n.a.Fragment,null,"Notifications for this alert will not be sent.",n.a.createElement("br",null),r&&n.a.createElement(n.a.Fragment,null,"To restore notifications click",n.a.createElement(f.a,{size:"small",type:"primary",onClick:this.unmute,loading:this.state.unmuting,className:"m-t-5 m-l-5"},"Unmute"))),type:"warning"}),n.a.createElement("h4",null,"Destinations"," ",n.a.createElement(Oe,{title:"Open Alert Destinations page in a new tab."},n.a.createElement(O,{href:"destinations",target:"_blank"},n.a.createElement("i",{className:"fa fa-external-link f-13","aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},"(opens in a new tab)")))),n.a.createElement(il,{alertId:t.id})))))}}dl.propTypes={alert:Wn.isRequired,queryResult:ae.a.object,canEdit:ae.a.bool.isRequired,onEdit:ae.a.func.isRequired,menuButton:ae.a.node.isRequired,unmute:ae.a.func},dl.defaultProps={queryResult:null,unmute:null};a(1513);function ml(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);r=!0);}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return pl(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return pl(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function pl(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function hl(e){var t=e.alert,a=e.query,i=e.columnNames,s=e.resultValues,o=e.subject,l=e.setSubject,u=e.body,d=e.setBody,m=!(!o&&!u),p=ml(Object(r.useState)(m?1:0),2),h=p[0],f=p[1],b=ml(Object(r.useState)(!1),2),g=b[0],y=b[1],v=function(e,t,a,r){var n=Object(c.isEmpty)(r)?null:Object(c.head)(r)[e.options.column];return{ALERT_STATUS:"TRIGGERED",ALERT_CONDITION:e.options.op,ALERT_THRESHOLD:e.options.value,ALERT_NAME:e.name,ALERT_URL:"".concat(window.location.origin,"/alerts/").concat(e.id),QUERY_NAME:t.name,QUERY_URL:"".concat(window.location.origin,"/queries/").concat(t.id),QUERY_RESULT_VALUE:Object(c.isNull)(n)||Object(c.isUndefined)(n)?"UNKNOWN":n,QUERY_RESULT_ROWS:r,QUERY_RESULT_COLS:a}}(t,a,i,s),O=e=>kt.a.render(e||"",v);return n.a.createElement("div",{className:"alert-template"},n.a.createElement(Li.a,{value:h,onChange:e=>{e||!m?(f(e),y(!1)):z.a.confirm({title:"Are you sure?",content:"Switching to default template will discard your custom template.",onOk:()=>{l(null),d(null),f(e),y(!1)},maskClosable:!0,autoFocusButton:null})},optionLabelProp:"label",dropdownMatchSelectWidth:!1,style:{width:"fit-content"}},n.a.createElement(Li.a.Option,{value:0,label:"Use default template"},"Default template"),n.a.createElement(Li.a.Option,{value:1,label:"Use custom template"},"Custom template")),!!h&&n.a.createElement("div",{className:"alert-custom-template","data-test":"AlertCustomTemplate"},n.a.createElement("div",{className:"d-flex align-items-center"},n.a.createElement("h5",{className:"flex-fill"},"Subject / Body"),"Preview"," ",n.a.createElement(Mi.a,{size:"small",className:"alert-template-preview",value:g,onChange:y})),n.a.createElement(Fe.a,{value:g?O(o):o,"aria-label":"Subject",onChange:e=>l(e.target.value),disabled:g,"data-test":"CustomSubject"}),n.a.createElement(Fe.a.TextArea,{value:g?O(u):u,"aria-label":"Body",autoSize:{minRows:9},onChange:e=>d(e.target.value),disabled:g,"data-test":"CustomBody"}),n.a.createElement(Me,{type:"ALERT_NOTIF_TEMPLATE_GUIDE",className:"f-13"},n.a.createElement("i",{className:"fa fa-question-circle","aria-hidden":"true"})," Formatting guide"," ",n.a.createElement("span",{className:"sr-only"},"(help)"))))}hl.propTypes={alert:Wn.isRequired,query:Bn.isRequired,columnNames:ae.a.arrayOf(ae.a.string).isRequired,resultValues:ae.a.arrayOf(ae.a.any).isRequired,subject:ae.a.string,setSubject:ae.a.func.isRequired,body:ae.a.string,setBody:ae.a.func.isRequired},hl.defaultProps={subject:"",body:""};var fl=hl;function bl(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class gl extends n.a.Component{constructor(){super(...arguments),bl(this,"_isMounted",!1),bl(this,"state",{saving:!1}),bl(this,"save",()=>{this.setState({saving:!0}),this.props.save().catch(()=>{this._isMounted&&this.setState({saving:!1})})}),bl(this,"cancel",()=>{this.props.cancel()})}componentDidMount(){this._isMounted=!0}componentWillUnmount(){this._isMounted=!1}render(){var e=this.props,t=e.alert,a=e.queryResult,r=e.pendingRearm,i=e.onNotificationTemplateChange,s=e.menuButton,o=this.props,l=o.onQuerySelected,c=o.onNameChange,u=o.onRearmChange,d=o.onCriteriaChange,m=t.query,p=t.name,h=t.options,b=this.state.saving;return n.a.createElement(n.a.Fragment,null,n.a.createElement(uo,{name:p,alert:t,onChange:c,editMode:!0},n.a.createElement(le,{name:"AlertEdit.HeaderExtra",alert:t}),n.a.createElement(f.a,{className:"m-r-5",onClick:()=>this.cancel()},n.a.createElement("i",{className:"fa fa-times m-r-5","aria-hidden":"true"}),"Cancel"),n.a.createElement(f.a,{type:"primary",onClick:()=>this.save()},b?n.a.createElement("span",{role:"status","aria-live":"polite","aria-relevant":"additions removals"},n.a.createElement("i",{className:"fa fa-spinner fa-pulse m-r-5","aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},"Saving...")):n.a.createElement(n.a.Fragment,null,n.a.createElement("i",{className:"fa fa-check m-r-5","aria-hidden":"true"})),"Save Changes"),s),n.a.createElement("div",{className:"bg-white tiled p-20"},n.a.createElement("div",{className:"d-flex"},n.a.createElement(co.a,{className:"flex-fill"},n.a.createElement(ll,{label:"Query"},n.a.createElement(Vo,{query:m,queryResult:a,onChange:l,editMode:!0})),a&&h&&n.a.createElement(n.a.Fragment,null,n.a.createElement(ll,{label:"Trigger when",className:"alert-criteria"},n.a.createElement(vo,{columnNames:a.getColumnNames(),resultValues:a.getData(),alertOptions:h,onChange:d,editMode:!0})),n.a.createElement(ll,{label:"When triggered, send notification"},n.a.createElement(xo,{value:r||0,onChange:u,editMode:!0})),n.a.createElement(ll,{label:"Template"},n.a.createElement(fl,{alert:t,query:m,columnNames:a.getColumnNames(),resultValues:a.getData(),subject:h.custom_subject,setSubject:e=>i({custom_subject:e}),body:h.custom_body,setBody:e=>i({custom_body:e})})))),n.a.createElement("div",null,n.a.createElement(Me,{className:"f-13",type:"ALERT_SETUP"},"Setup Instructions ",n.a.createElement("i",{className:"fa fa-question-circle","aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},"(help)"))))))}}function yl(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}gl.propTypes={alert:Wn.isRequired,queryResult:ae.a.object,pendingRearm:ae.a.number,menuButton:ae.a.node.isRequired,save:ae.a.func.isRequired,cancel:ae.a.func.isRequired,onQuerySelected:ae.a.func.isRequired,onNameChange:ae.a.func.isRequired,onCriteriaChange:ae.a.func.isRequired,onRearmChange:ae.a.func.isRequired,onNotificationTemplateChange:ae.a.func.isRequired},gl.defaultProps={queryResult:null,pendingRearm:null};class vl extends n.a.Component{constructor(){super(...arguments),yl(this,"state",{saving:!1}),yl(this,"save",()=>{this.setState({saving:!0}),this.props.save().catch(()=>{this.setState({saving:!1})})})}render(){var e=this.props,t=e.alert,a=e.queryResult,r=e.pendingRearm,i=e.onNotificationTemplateChange,s=this.props,o=s.onQuerySelected,l=s.onNameChange,c=s.onRearmChange,u=s.onCriteriaChange,d=t.query,m=t.name,p=t.options,h=this.state.saving;return n.a.createElement(n.a.Fragment,null,n.a.createElement(uo,{alert:t,name:m,onChange:l,editMode:!0}),n.a.createElement("div",{className:"bg-white tiled p-20"},n.a.createElement("div",{className:"d-flex"},n.a.createElement(co.a,{className:"flex-fill"},n.a.createElement("div",{className:"m-b-30"},"Start by selecting the query that you would like to monitor using the search bar.",n.a.createElement("br",null),"Keep in mind that Alerts do not work with queries that use parameters."),n.a.createElement(ll,{label:"Query"},n.a.createElement(Vo,{query:d,queryResult:a,onChange:o,editMode:!0})),a&&p&&n.a.createElement(n.a.Fragment,null,n.a.createElement(ll,{label:"Trigger when",className:"alert-criteria"},n.a.createElement(vo,{columnNames:a.getColumnNames(),resultValues:a.getData(),alertOptions:p,onChange:u,editMode:!0})),n.a.createElement(ll,{label:"When triggered, send notification"},n.a.createElement(xo,{value:r||0,onChange:c,editMode:!0})),n.a.createElement(ll,{label:"Template"},n.a.createElement(fl,{alert:t,query:d,columnNames:a.getColumnNames(),resultValues:a.getData(),subject:p.custom_subject,setSubject:e=>i({custom_subject:e}),body:p.custom_body,setBody:e=>i({custom_body:e})}))),n.a.createElement(ll,null,n.a.createElement(f.a,{type:"primary",onClick:this.save,disabled:!d,className:"btn-create-alert"},h&&n.a.createElement("span",{role:"status","aria-live":"polite","aria-relevant":"additions removals"},n.a.createElement("i",{className:"fa fa-spinner fa-pulse m-r-5","aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},"Saving...")),"Create Alert"))),n.a.createElement(Me,{className:"f-13",type:"ALERT_SETUP"},"Setup Instructions ",n.a.createElement("i",{className:"fa fa-question-circle","aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},"(help)")))))}}function Ol(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function El(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Ol(Object(a),!0).forEach((function(t){wl(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Ol(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function jl(){return(jl=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function wl(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}vl.propTypes={alert:Wn.isRequired,queryResult:ae.a.object,pendingRearm:ae.a.number,onQuerySelected:ae.a.func.isRequired,save:ae.a.func.isRequired,onNameChange:ae.a.func.isRequired,onRearmChange:ae.a.func.isRequired,onCriteriaChange:ae.a.func.isRequired,onNotificationTemplateChange:ae.a.func.isRequired},vl.defaultProps={queryResult:null,pendingRearm:null};var Sl={NEW:0,VIEW:1,EDIT:2},Pl=Object(c.template)("<%= query.name %>: <%= options.column %> <%= options.op %> <%= options.value %>");function Cl(e){return e.query?Pl(e):"New Alert"}class Nl extends n.a.Component{constructor(){super(...arguments),wl(this,"_isMounted",!1),wl(this,"state",{alert:null,queryResult:null,pendingRearm:null,canEdit:!1,mode:null}),wl(this,"save",()=>{var e=this.state,t=e.alert,a=e.pendingRearm;return t.name=Object(c.trim)(t.name)||Cl(t),t.rearm=a||null,Js.save(t).then(e=>{en.success("Saved."),ct("alerts/".concat(e.id),!0),this.setState({alert:e,mode:Sl.VIEW})}).catch(()=>{en.error("Failed saving alert.")})}),wl(this,"onQuerySelected",e=>{this.setState(t=>({alert:jl(t.alert,{query:e}),queryResult:null})),e&&new Xt(e).getQueryResultPromise().then(e=>{if(this._isMounted){this.setState({queryResult:e});var t=this.state.alert.options.column,a=e.getColumnNames();t&&Object(c.includes)(a,t)||(t=Object(c.head)(e.getColumnNames())),this.setAlertOptions({column:t})}})}),wl(this,"onNameChange",e=>{var t=this.state.alert;this.setState({alert:jl(t,{name:e})})}),wl(this,"onRearmChange",e=>{this.setState({pendingRearm:e})}),wl(this,"setAlertOptions",e=>{var t=this.state.alert,a=El(El({},t.options),e);this.setState({alert:jl(t,{options:a})})}),wl(this,"delete",()=>{var e=this.state.alert;return Js.delete(e).then(()=>{en.success("Alert deleted successfully."),ct("alerts")}).catch(()=>{en.error("Failed deleting alert.")})}),wl(this,"mute",()=>{var e=this.state.alert;return Js.mute(e).then(()=>{this.setAlertOptions({muted:!0}),en.warn("Notifications have been muted.")}).catch(()=>{en.error("Failed muting notifications.")})}),wl(this,"unmute",()=>{var e=this.state.alert;return Js.unmute(e).then(()=>{this.setAlertOptions({muted:!1}),en.success("Notifications have been restored.")}).catch(()=>{en.error("Failed restoring notifications.")})}),wl(this,"edit",()=>{var e=this.state.alert.id;ct("alerts/".concat(e,"/edit"),!0),this.setState({mode:Sl.EDIT})}),wl(this,"cancel",()=>{var e=this.state.alert.id;ct("alerts/".concat(e),!0),this.setState({mode:Sl.VIEW})})}componentDidMount(){this._isMounted=!0;var e=this.props.mode;if(this.setState({mode:e}),e===Sl.NEW)this.setState({alert:{options:{op:">",value:1,muted:!1}},pendingRearm:0,canEdit:!0});else{var t=this.props.alertId;Js.get({id:t}).then(e=>{if(this._isMounted){var t=W.canEdit(e);t||(this.setState({mode:Sl.VIEW}),en.warn("You cannot edit this alert","You do not have sufficient permissions to edit this alert, and have been redirected to the view-only page.",{duration:0})),this.setState({alert:e,canEdit:t,pendingRearm:e.rearm}),this.onQuerySelected(e.query)}}).catch(e=>{this._isMounted&&this.props.onError(e)})}}componentWillUnmount(){this._isMounted=!1}render(){var e=this.state.alert;if(!e)return n.a.createElement(Ts,{className:"m-t-30"});var t=!!e.options.muted,a=this.state,r=a.queryResult,i=a.mode,s=a.canEdit,o=a.pendingRearm,l=n.a.createElement(oo,{doDelete:this.delete,muted:t,mute:this.mute,unmute:this.unmute,canEdit:s}),c={alert:e,queryResult:r,pendingRearm:o,save:this.save,menuButton:l,onQuerySelected:this.onQuerySelected,onRearmChange:this.onRearmChange,onNameChange:this.onNameChange,onCriteriaChange:this.setAlertOptions,onNotificationTemplateChange:this.setAlertOptions};return n.a.createElement("div",{className:"alert-page"},n.a.createElement("div",{className:"container"},i===Sl.NEW&&n.a.createElement(vl,c),i===Sl.VIEW&&n.a.createElement(dl,jl({canEdit:s,onEdit:this.edit,muted:t,unmute:this.unmute},c)),i===Sl.EDIT&&n.a.createElement(gl,jl({cancel:this.cancel},c))))}}function kl(e){return e.tags||[]}function xl(e){return Q.get(e).then(kl)}wl(Nl,"propTypes",{mode:ae.a.oneOf(Object(c.values)(Sl)),alertId:ae.a.string,onError:ae.a.func}),wl(Nl,"defaultProps",{mode:null,alertId:null,onError:()=>{}}),pn.register("Alerts.New",zr({path:"/alerts/new",title:"New Alert",render:e=>n.a.createElement(Nl,jl({},e,{mode:Sl.NEW}))})),pn.register("Alerts.View",zr({path:"/alerts/:alertId",title:"Alert",render:e=>n.a.createElement(Nl,jl({},e,{mode:Sl.VIEW}))})),pn.register("Alerts.Edit",zr({path:"/alerts/:alertId/edit",title:"Alert",render:e=>n.a.createElement(Nl,jl({},e,{mode:Sl.EDIT}))}));a(1514);function Al(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);r=!0);}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return _l(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return _l(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _l(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}var ql=function(e){var t=e.tagsUrl,a=e.showUnselectAll,i=void 0!==a&&a,s=e.onUpdate,o=Al(Object(r.useState)([]),2),l=o[0],u=o[1],d=Al(Object(r.useState)([]),2),m=d[0],p=d[1];Object(r.useEffect)(()=>{var e=!1;return xl(t).then(t=>{e||u(t)}),()=>{e=!0}},[t]);var h=Object(r.useCallback)((e,t)=>{var a;a=e.shiftKey?Object(c.includes)(m,t)?Object(c.difference)(m,[t]):[...m,t]:Object(c.includes)(m,t)&&1===m.length?[]:[t],p(a),s&&s([...a])},[m,s]),f=Object(r.useCallback)(()=>{p([]),s&&s([])},[s]);return 0===l.length?null:n.a.createElement("div",{className:"tags-list"},n.a.createElement("div",{className:"tags-list-title"},n.a.createElement("span",{className:"tags-list-label"},"Tags"),i&&m.length>0&&n.a.createElement(fe,{type:"link",onClick:f},n.a.createElement(Se.a,null),"clear selection")),n.a.createElement("div",{className:"tiled"},n.a.createElement(ue.a,{className:"invert-stripe-position",mode:"inline",selectedKeys:m},Object(c.map)(l,e=>n.a.createElement(ue.a.Item,{key:e.name,className:"m-0"},n.a.createElement(fe,{className:"d-flex align-items-center justify-content-between",onClick:t=>h(t,e.name)},n.a.createElement("span",{className:"max-character col-xs-11"},e.name),n.a.createElement(xn.a,{count:e.count})))))))};function Tl(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);r=!0);}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Il(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Il(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Il(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function Dl(e){var t=e.placeholder,a=e.value,i=e.showIcon,s=e.onChange,o=e.label,l=Tl(Object(r.useState)(a),2),c=l[0],u=l[1];Object(r.useEffect)(()=>{u(a)},[a]);var d=Object(r.useCallback)(e=>{var t=e.target.value;u(t),s(t)},[s]),m=i?Fe.a.Search:Fe.a;return n.a.createElement("div",{className:"m-b-10"},n.a.createElement(m,{className:"form-control",placeholder:t,value:c,"aria-label":o,onChange:d}))}function Rl(e){var t=e.items,a=e.selected;return 0===(t=Object(c.filter)(t,e=>!Object(c.isFunction)(e.isAvailable)||e.isAvailable())).length?null:n.a.createElement("div",{className:"m-b-10 tags-list tiled"},n.a.createElement(ue.a,{className:"invert-stripe-position",mode:"inline",selectable:!1,selectedKeys:[a]},Object(c.map)(t,e=>n.a.createElement(ue.a.Item,{key:e.key,className:"m-0"},n.a.createElement(O,{href:e.href},Object(c.isString)(e.icon)&&""!==e.icon&&n.a.createElement("span",{className:"btn-favorite m-r-5"},n.a.createElement("i",{className:e.icon,"aria-hidden":"true"})),Object(c.isFunction)(e.icon)&&(e.icon(e)||null),e.title)))))}function Ml(e){var t=e.icon;return n.a.createElement("span",{className:"btn-favorite m-r-5"},n.a.createElement("i",{className:t,"aria-hidden":"true"}))}function zl(e){var t=e.user;return Object(c.isString)(t.profile_image_url)&&""!==t.profile_image_url?n.a.createElement("img",{src:t.profile_image_url,className:"profile__image--sidebar m-r-5",width:"13",alt:t.name}):null}function Fl(e){var t=e.url,a=e.onChange,r=e.showUnselectAll;return""===t?null:n.a.createElement("div",{className:"m-b-10"},n.a.createElement(ql,{tagsUrl:t,onUpdate:a,showUnselectAll:r}))}Dl.propTypes={value:ae.a.string.isRequired,placeholder:ae.a.string,showIcon:ae.a.bool,onChange:ae.a.func.isRequired,label:ae.a.string},Dl.defaultProps={placeholder:"Search...",showIcon:!1,label:"Search"},Rl.propTypes={items:ae.a.arrayOf(ae.a.shape({key:ae.a.string.isRequired,href:ae.a.string.isRequired,title:ae.a.string.isRequired,icon:ae.a.func,isAvailable:ae.a.func})),selected:ae.a.string},Rl.defaultProps={items:[],selected:null},Ml.propTypes={icon:ae.a.string.isRequired},zl.propTypes={user:ae.a.shape({profile_image_url:ae.a.string,name:ae.a.string}).isRequired},Fl.propTypes={url:ae.a.string.isRequired,onChange:ae.a.func.isRequired,showUnselectAll:ae.a.bool,unselectAllButtonTitle:ae.a.string};var Ul=a(44),Vl=a.n(Ul);function Ll(){return(Ll=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Bl(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);r=!0);}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Ql(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Ql(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ql(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function Wl(e,t,a){var i=Bl(Object(r.useState)({isAvailable:!1}),2),s=i[0],o=i[1],l=Bl(Object(r.useState)([]),2),u=l[0],d=l[1];Object(r.useEffect)(()=>{d([])},[e.pageItems,s.isAvailable]);var m=Object(r.useMemo)(()=>{var t=e.pageItems;return 0!==t.length&&0!==u.length&&Object(c.intersection)(u,t).length===t.length},[u,e.pageItems]),p=Object(r.useCallback)(()=>{d(m?[]:e.pageItems)},[m,e.pageItems]),h=Object(r.useCallback)(e=>{Object(c.includes)(u,e)?d(Object(c.filter)(u,t=>t!==e)):d([...u,e])},[u]),f=Object(r.useMemo)(()=>gi.custom((e,t)=>n.a.createElement(Vl.a,{checked:Object(c.includes)(u,t),onChange:()=>h(t)}),{title:()=>n.a.createElement(Vl.a,{checked:m,onChange:p}),field:"id",width:"1%"}),[u,m,p,h]),b=Object(r.useCallback)((function(e){return a?n.a.createElement(a,Ll({onStateChange:o},e)):null}),[a]);return Object(r.useMemo)(()=>({areExtraActionsAvailable:s.isAvailable,listColumns:s.isAvailable?[f,...t]:t,Component:b,selectedItems:u,setSelectedItems:d}),[s,t,f,u,b])}a(1515);function Hl(){return(Hl=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Gl(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},i=Object.keys(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var Kl={className:ae.a.string,children:ae.a.node},Yl={className:null,children:null};function $l(e){var t=e.className,a=e.children,r=Gl(e,["className","children"]);return n.a.createElement("div",Hl({className:me()("layout-sidebar",t)},r),n.a.createElement("div",null,a))}function Jl(e){var t=e.className,a=e.children,r=Gl(e,["className","children"]);return n.a.createElement("div",Hl({className:me()("layout-content",t)},r),n.a.createElement("div",null,a))}function Xl(e){var t=e.children,a=e.className,r=void 0===a?void 0:a,i=Gl(e,["children","className"]);return n.a.createElement("div",Hl({className:me()("layout-with-sidebar",r)},i),t)}function Zl(e){var t=e.objectType,a=e.tags;return n.a.createElement(Ne,{icon:"fa-tags"},"No ",t," found tagged withÂ ",n.a.createElement($i,{className:"inline-tags-control",tags:Array.from(a),tagSeparator:"+"}),".")}function ec(e){var t=e.page,a=e.searchTerm,n=e.selectedTags;if(""!==a)return r.createElement(Ne,{message:"Sorry, we couldn't find anything.",icon:"fa-search"});if(n.length>0)return r.createElement(Zl,{objectType:"dashboards",tags:n});switch(t){case"favorites":return r.createElement(Ne,{message:"Mark dashboards as Favorite to list them here.",icon:"fa-star"});case"my":var i=W.hasPermission("create_dashboard")?r.createElement("span",null,r.createElement(f.a,{type:"primary",size:"small",onClick:()=>Ja.showModal()},"Create your first dashboard!")," ",r.createElement(Me,{className:"f-14",type:"DASHBOARDS",showTooltip:!1},"Need help?")):r.createElement("span",null,"Sorry, we couldn't find anything.");return r.createElement(Ne,{icon:"fa-search"},i);default:return r.createElement(le,{name:"DashboardList.EmptyState"},r.createElement(Br,{icon:"zmdi zmdi-view-quilt",description:"See the big picture",illustration:"dashboard",helpMessage:r.createElement(Vr,{helpTriggerType:"DASHBOARDS"}),showDashboardStep:!0}))}}$l.propTypes=Kl,$l.defaultProps=Yl,Jl.propTypes=Kl,Jl.defaultProps=Yl,Xl.propTypes=Kl,Xl.defaultProps=Yl,Xl.Sidebar=$l,Xl.Content=Jl,Zl.propTypes={objectType:ae.a.string.isRequired,tags:ae.a.oneOfType([ae.a.array,ae.a.objectOf(Set)]).isRequired},ec.propTypes={page:te.string.isRequired,searchTerm:te.string.isRequired,selectedTags:te.array.isRequired};a(1516);function tc(){return(tc=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}var ac=[{key:"all",href:"dashboards",title:"All Dashboards",icon:()=>n.a.createElement(Ml,{icon:"zmdi zmdi-view-quilt"})},{key:"my",href:"dashboards/my",title:"My Dashboards",icon:()=>n.a.createElement(zl,{user:W})},{key:"favorites",href:"dashboards/favorites",title:"Favorites",icon:()=>n.a.createElement(Ml,{icon:"fa fa-star"})}],rc=[gi.favorites({className:"p-r-0"}),gi.custom.sortable((e,t)=>n.a.createElement(n.a.Fragment,null,n.a.createElement(O,{className:"table-main-title",href:t.url,"data-test":"DashboardId".concat(t.id)},t.name),n.a.createElement(Zi,{className:"d-block",tags:t.tags,isDraft:t.is_draft,isArchived:t.is_archived})),{title:"Name",field:"name",width:null}),gi.custom((e,t)=>t.user.name,{title:"Created By",width:"1%"}),gi.dateTime.sortable({title:"Created At",field:"created_at",width:"1%"})];function nc(e){return n.a.createElement(le,tc({name:"DashboardList.Actions"},e))}function ic(e){var t=e.controller,a=Wl(t,rc,nc),r=a.areExtraActionsAvailable,i=a.listColumns,s=a.Component,o=a.selectedItems;return n.a.createElement("div",{className:"page-dashboard-list"},n.a.createElement("div",{className:"container"},n.a.createElement(Cn,{title:t.params.pageTitle,actions:W.hasPermission("create_dashboard")?n.a.createElement(f.a,{block:!0,type:"primary",onClick:()=>Ja.showModal()},n.a.createElement("i",{className:"fa fa-plus m-r-5","aria-hidden":"true"}),"New Dashboard"):null}),n.a.createElement(Xl,null,n.a.createElement(Xl.Sidebar,{className:"m-b-0"},n.a.createElement(Dl,{placeholder:"Search Dashboards...",label:"Search dashboards",value:t.searchTerm,onChange:t.updateSearch}),n.a.createElement(Rl,{items:ac,selected:t.params.currentPage}),n.a.createElement(Fl,{url:"api/dashboards/tags",onChange:t.updateSelectedTags,showUnselectAll:!0})),n.a.createElement(Xl.Content,null,n.a.createElement("div",{"data-test":"DashboardLayoutContent"},t.isLoaded&&t.isEmpty?n.a.createElement(ec,{page:t.params.currentPage,searchTerm:t.searchTerm,selectedTags:t.selectedTags}):n.a.createElement(n.a.Fragment,null,n.a.createElement("div",{className:me()({"m-b-10":r})},n.a.createElement(s,{selectedItems:o})),n.a.createElement("div",{className:"bg-white tiled table-responsive"},n.a.createElement(yi,{items:t.pageItems,loading:!t.isLoaded,columns:i,orderByField:t.orderByField,orderByReverse:t.orderByReverse,toggleSorting:t.toggleSorting}),n.a.createElement(Ui,{showPageSizeSelect:!0,totalCount:t.totalItemsCount,pageSize:t.itemsPerPage,onPageSizeChange:e=>t.updatePagination({itemsPerPage:e}),page:t.page,onChange:e=>t.updatePagination({page:e})}))))))))}ic.propTypes={controller:ds.isRequired};var sc=ms(ic,()=>new Ns({getResource(e){var t=e.params.currentPage;return{all:La.query.bind(La),my:La.myDashboards.bind(La),favorites:La.favorites.bind(La)}[t]},getItemProcessor:()=>e=>new La(e)}),()=>new _s({orderByField:"created_at",orderByReverse:!0}));pn.register("Dashboards.List",zr({path:"/dashboards",title:"Dashboards",render:e=>n.a.createElement(sc,tc({},e,{currentPage:"all"}))})),pn.register("Dashboards.Favorites",zr({path:"/dashboards/favorites",title:"Favorite Dashboards",render:e=>n.a.createElement(sc,tc({},e,{currentPage:"favorites"}))})),pn.register("Dashboards.My",zr({path:"/dashboards/my",title:"My Dashboards",render:e=>n.a.createElement(sc,tc({},e,{currentPage:"my"}))}));var oc=a(420),lc=a(133),cc=a(132),uc=a.n(cc),dc=a(190),mc=a(421),pc=a.n(mc),hc=(a(1528),/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"Cmd":"Ctrl"),fc=/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"Option":"Alt";var bc={};function gc(e,t){e.preventDefault(),e.retunValue=!1,Object(c.each)(bc[t],e=>e())}var yc={modKey:hc,altKey:fc,bind:e=>{Object(c.each)(e,(e,t)=>{var a=t.toLowerCase().split(",").map(c.trim);Object(c.each)(a,t=>{bc[t]=[...Object(c.without)(bc[t],e),e],pc.a.bindGlobal(t,gc)})})},unbind:e=>{Object(c.each)(e,(e,t)=>{var a=t.toLowerCase().split(",").map(c.trim);Object(c.each)(a,t=>{bc[t]=Object(c.without)(bc[t],e),0===bc[t].length&&(bc[t]=void 0,pc.a.unbind(t))})})}};function vc(e){var t=e.paramCount,a=e.onClick,r=t?n.a.createElement("i",{className:"fa fa-check","aria-hidden":"true"}):n.a.createElement("span",{role:"status","aria-live":"polite","aria-relevant":"additions removals"},n.a.createElement("i",{className:"fa fa-spinner fa-pulse","aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},"Loading..."));return n.a.createElement("div",{className:"parameter-apply-button","data-show":!!t,"data-test":"ParameterApplyButton"},n.a.createElement(xn.a,{count:t},n.a.createElement(Oe,{title:t?"".concat(yc.modKey," + Enter"):null},n.a.createElement("span",null,n.a.createElement(f.a,{onClick:a},r," Apply Changes")))))}vc.propTypes={onClick:ae.a.func.isRequired,paramCount:ae.a.number.isRequired};var Oc=vc,Ec=document.createElement("canvas");function jc(){return(jc=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function wc(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},i=Object.keys(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}Ec.style.display="none",document.body.appendChild(Ec);var Sc=function(e){var t=e.options,a=wc(e,["options"]),i=Object(r.useMemo)(()=>{if(t&&t.length>400){var e=Object(c.maxBy)(t,"label.length");if(e){var a=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document.body,a=Ec.getContext("2d");if(a){var r=window.getComputedStyle(t);a.font="".concat(r.fontSize," ").concat(r.fontFamily);var n=a.measureText(e),i=n.width;return"actualBoundingBoxLeft"in n&&(i=Math.abs(n.actualBoundingBoxLeft)+Math.abs(n.actualBoundingBoxRight)),i}return null}(e.label);if(a)return a+40}return!0}return!1},[t]);return n.a.createElement(Li.a,jc({dropdownMatchSelectWidth:i,options:t,optionFilterProp:"label"},a))},Pc=a(104),Cc=a.n(Pc);function Nc(){return(Nc=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function kc(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},i=Object.keys(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var xc=n.a.forwardRef((e,t)=>{var a=e.defaultValue,r=e.value,i=e.onSelect,s=e.className,o=kc(e,["defaultValue","value","onSelect","className"]),l=H.dateFormat||"YYYY-MM-DD",c={};return a&&a.isValid()&&(c.defaultValue=a),(null===r||r&&r.isValid())&&(c.value=r),n.a.createElement(Cc.a,Nc({ref:t,className:s},c,{format:l,placeholder:"Select Date",onChange:i},o))});xc.propTypes={defaultValue:Gn,value:Gn,onSelect:ae.a.func,className:ae.a.string},xc.defaultProps={defaultValue:null,value:void 0,onSelect:()=>{},className:""};var Ac=xc;function _c(){return(_c=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function qc(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},i=Object.keys(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var Tc=n.a.forwardRef((e,t)=>{var a=e.defaultValue,r=e.value,i=e.withSeconds,s=e.onSelect,o=e.className,l=qc(e,["defaultValue","value","withSeconds","onSelect","className"]),c=(H.dateFormat||"YYYY-MM-DD")+(i?" HH:mm:ss":" HH:mm"),u={};return a&&a.isValid()&&(u.defaultValue=a),(null===r||r&&r.isValid())&&(u.value=r),n.a.createElement(Cc.a,_c({ref:t,className:o,showTime:!0},u,{format:c,placeholder:"Select Date and Time",onChange:s},l))});Tc.propTypes={defaultValue:Gn,value:Gn,withSeconds:ae.a.bool,onSelect:ae.a.func,className:ae.a.string},Tc.defaultProps={defaultValue:null,value:void 0,withSeconds:!1,onSelect:()=>{},className:""};var Ic=Tc,Dc=a(693),Rc=a.n(Dc),Mc=a(694),zc=a.n(Mc),Fc=a(695),Uc=a.n(Fc),Vc=(a(1543),Gr.a.Text);function Lc(e){var t=e.options,a=e.selectedDynamicValue,i=e.onSelect,s=e.enabled,o=e.staticValueLabel,l=n.a.createElement(ue.a,{className:"dynamic-menu",onClick:e=>{var a=e.key;return i(Object(c.get)(t,a,"static"))},selectedKeys:["".concat(Object(c.findIndex)(t,{value:a}))],"data-test":"DynamicButtonMenu"},t.map((e,t)=>n.a.createElement(ue.a.Item,{key:t},e.name," ",e.label&&n.a.createElement("em",null,Object(c.isFunction)(e.label)?e.label():e.label))),s&&n.a.createElement(ue.a.Divider,null),s&&n.a.createElement(ue.a.Item,null,n.a.createElement(Rc.a,null),n.a.createElement(Vc,{type:"secondary"},o))),u=Object(r.useRef)(null);return n.a.createElement("div",{ref:u},n.a.createElement("div",{role:"presentation",onClick:e=>e.stopPropagation()},n.a.createElement(Nr.a.Button,{overlay:l,className:"dynamic-button",placement:"bottomRight",trigger:["click"],icon:s?n.a.createElement(zc.a,{className:"dynamic-icon"}):n.a.createElement(Uc.a,{className:"dynamic-icon"}),getPopupContainer:()=>u.current,"data-test":"DynamicButton"})))}Lc.propTypes={options:ae.a.arrayOf(ae.a.object),selectedDynamicValue:ae.a.oneOfType([oa,ga]),onSelect:ae.a.func,enabled:ae.a.bool,staticValueLabel:ae.a.string},Lc.defaultProps={options:[],selectedDynamicValue:null,onSelect:()=>{},enabled:!1,staticValueLabel:"Back to Static Value"};var Bc=Lc;a(632);function Qc(){return(Qc=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Wc(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class Hc extends n.a.Component{constructor(e){super(e),Wc(this,"onDynamicValueSelect",e=>{var t=this.props,a=t.onSelect,r=t.parameter;if("static"===e){var n=r.getExecutionValue();a(n?l()(n):null)}else a(e.value);this.dateComponentRef.current.focus()}),this.dateComponentRef=n.a.createRef()}render(){var e=this.props,t=e.type,a=e.value,r=e.className,i=e.dateOptions,s=e.dynamicButtonOptions,o=e.onSelect,u=ca(a),d=Object(c.includes)(t,"datetime"),m={},p=Ac;if(d&&(p=Ic,Object(c.includes)(t,"with-seconds")&&(m.withSeconds=!0)),(l.a.isMoment(a)||null===a)&&(m.value=a),u){var h=a;m.placeholder=h&&h.name,m.value=null}return n.a.createElement("div",{className:me()("date-parameter",r)},n.a.createElement(p,Qc({},i,{ref:this.dateComponentRef,className:me()("redash-datepicker",t,{"dynamic-value":u}),onSelect:o,suffixIcon:null},m)),n.a.createElement(Bc,{options:s.options,staticValueLabel:s.staticValueLabel,selectedDynamicValue:u?a:null,enabled:u,onSelect:this.onDynamicValueSelect}))}}Wc(Hc,"propTypes",{type:ae.a.string,className:ae.a.string,value:ae.a.any,parameter:ae.a.any,onSelect:ae.a.func,dynamicButtonOptions:ae.a.shape({staticValueLabel:ae.a.string,options:ae.a.arrayOf(ae.a.shape({name:ae.a.string,value:ae.a.object,label:ae.a.oneOfType([ae.a.string,ae.a.func])}))}),dateOptions:ae.a.any}),Wc(Hc,"defaultProps",{type:"",className:"",value:null,parameter:null,dynamicButtonOptions:{options:[]},onSelect:()=>{}});var Gc=Hc;function Kc(){return(Kc=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}var Yc=[{name:"Today/Now",value:ua("d_now"),label:()=>ua("d_now").value().format("MMM D")},{name:"Yesterday",value:ua("d_yesterday"),label:()=>ua("d_yesterday").value().format("MMM D")}];function $c(e){return n.a.createElement(Gc,Kc({dynamicButtonOptions:{options:Yc}},e,{dateOptions:{"aria-label":"Parameter date value"}}))}$c.propTypes={type:ae.a.string,className:ae.a.string,value:ae.a.any,parameter:ae.a.any,onSelect:ae.a.func},$c.defaultProps={type:"",className:"",value:null,parameter:null,onSelect:()=>{}};var Jc=$c;function Xc(){return(Xc=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Zc(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},i=Object.keys(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var eu=Cc.a.RangePicker,tu=n.a.forwardRef((e,t)=>{var a=e.defaultValue,r=e.value,i=e.onSelect,s=e.className,o=Zc(e,["defaultValue","value","onSelect","className"]),l=H.dateFormat||"YYYY-MM-DD",u={};return Object(c.isArray)(a)&&a[0].isValid()&&a[1].isValid()&&(u.defaultValue=a),(null===r||Object(c.isArray)(r)&&r[0].isValid()&&r[1].isValid())&&(u.value=r),n.a.createElement(eu,Xc({ref:t,className:s},u,{format:l,onChange:i},o))});tu.propTypes={defaultValue:ae.a.arrayOf(Gn),value:ae.a.arrayOf(Gn),onSelect:ae.a.func,className:ae.a.string},tu.defaultProps={defaultValue:null,value:void 0,onSelect:()=>{},className:""};var au=tu;function ru(){return(ru=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function nu(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},i=Object.keys(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var iu=Cc.a.RangePicker,su=n.a.forwardRef((e,t)=>{var a=e.defaultValue,r=e.value,i=e.withSeconds,s=e.onSelect,o=e.className,l=nu(e,["defaultValue","value","withSeconds","onSelect","className"]),u=(H.dateFormat||"YYYY-MM-DD")+(i?" HH:mm:ss":" HH:mm"),d={};return Object(c.isArray)(a)&&a[0].isValid()&&a[1].isValid()&&(d.defaultValue=a),(null===r||Object(c.isArray)(r)&&r[0].isValid()&&r[1].isValid())&&(d.value=r),n.a.createElement(iu,ru({ref:t,className:o,showTime:!0},d,{format:u,onChange:s},l))});su.propTypes={defaultValue:ae.a.arrayOf(Gn),value:ae.a.arrayOf(Gn),withSeconds:ae.a.bool,onSelect:ae.a.func,className:ae.a.string},su.defaultProps={defaultValue:null,value:void 0,withSeconds:!1,onSelect:()=>{},className:""};var ou=su;function lu(){return(lu=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function cu(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},i=Object.keys(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function uu(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class du extends n.a.Component{constructor(e){super(e),uu(this,"onDynamicValueSelect",e=>{var t=this.props,a=t.onSelect,r=t.parameter;if("static"===e){var n=r.getExecutionValue();Object(c.isObject)(n)&&n.start&&n.end?a([l()(n.start),l()(n.end)]):a(null)}else a(e.value);this.dateRangeComponentRef.current.focus()}),this.dateRangeComponentRef=n.a.createRef()}render(){var e=this.props,t=e.type,a=e.value,r=e.onSelect,i=e.className,s=e.dynamicButtonOptions,o=e.dateRangeOptions,u=(e.parameter,cu(e,["type","value","onSelect","className","dynamicButtonOptions","dateRangeOptions","parameter"])),d=Object(c.includes)(t,"datetime-range"),m=va(a),p={},h=au;return d&&(h=ou,Object(c.includes)(t,"with-seconds")&&(p.withSeconds=!0)),(function(e){return Object(c.isArray)(e)&&2===e.length&&l.a.isMoment(e[0])&&l.a.isMoment(e[1])}(a)||null===a)&&(p.value=a),m&&(p.placeholder=[a&&a.name],p.value=null),n.a.createElement("div",lu({},u,{className:me()("date-range-parameter",i)}),n.a.createElement(h,lu({},o,{ref:this.dateRangeComponentRef,className:me()("redash-datepicker date-range-input",t,{"dynamic-value":m}),onSelect:r,suffixIcon:null},p)),n.a.createElement(Bc,{options:s.options,staticValueLabel:s.staticValueLabel,selectedDynamicValue:m?a:null,enabled:m,onSelect:this.onDynamicValueSelect}))}}uu(du,"propTypes",{type:ae.a.oneOf(["date-range","datetime-range","datetime-range-with-seconds"]).isRequired,className:ae.a.string,value:ae.a.any,parameter:ae.a.any,onSelect:ae.a.func,dynamicButtonOptions:ae.a.shape({staticValueLabel:ae.a.string,options:ae.a.arrayOf(ae.a.shape({name:ae.a.string,value:ae.a.object,label:ae.a.oneOfType([ae.a.string,ae.a.func])}))}),dateRangeOptions:ae.a.any}),uu(du,"defaultProps",{type:"date-range",className:"",value:null,parameter:null,dynamicButtonOptions:{options:[]},onSelect:()=>{}});var mu=du;function pu(){return(pu=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}var hu=[{name:"This week",value:Oa("d_this_week"),label:()=>Oa("d_this_week").value()[0].format("MMM D")+" - "+Oa("d_this_week").value()[1].format("MMM D")},{name:"This month",value:Oa("d_this_month"),label:()=>Oa("d_this_month").value()[0].format("MMMM")},{name:"This year",value:Oa("d_this_year"),label:()=>Oa("d_this_year").value()[0].format("YYYY")},{name:"Last week",value:Oa("d_last_week"),label:()=>Oa("d_last_week").value()[0].format("MMM D")+" - "+Oa("d_last_week").value()[1].format("MMM D")},{name:"Last month",value:Oa("d_last_month"),label:()=>Oa("d_last_month").value()[0].format("MMMM")},{name:"Last year",value:Oa("d_last_year"),label:()=>Oa("d_last_year").value()[0].format("YYYY")},{name:"Last 7 days",value:Oa("d_last_7_days"),label:()=>Oa("d_last_7_days").value()[0].format("MMM D")+" - Today"},{name:"Last 14 days",value:Oa("d_last_14_days"),label:()=>Oa("d_last_14_days").value()[0].format("MMM D")+" - Today"},{name:"Last 30 days",value:Oa("d_last_30_days"),label:()=>Oa("d_last_30_days").value()[0].format("MMM D")+" - Today"},{name:"Last 60 days",value:Oa("d_last_60_days"),label:()=>Oa("d_last_60_days").value()[0].format("MMM D")+" - Today"},{name:"Last 90 days",value:Oa("d_last_90_days"),label:()=>Oa("d_last_90_days").value()[0].format("MMM D")+" - Today"},{name:"Last 12 months",value:Oa("d_last_12_months"),label:null}],fu=[{name:"Today",value:Oa("d_today"),label:()=>Oa("d_today").value()[0].format("MMM D")},{name:"Yesterday",value:Oa("d_yesterday"),label:()=>Oa("d_yesterday").value()[0].format("MMM D")},...hu];function bu(e){var t=Object(c.includes)(e.type,"datetime-range")?fu:hu;return n.a.createElement(mu,pu({},e,{dynamicButtonOptions:{options:t}}))}bu.propTypes={type:ae.a.string,className:ae.a.string,value:ae.a.any,parameter:ae.a.any,onSelect:ae.a.func},bu.defaultProps={type:"",className:"",value:null,parameter:null,onSelect:()=>{}};var gu=bu;a(1550);function yu(){return(yu=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function vu(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},i=Object.keys(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function Ou(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class Eu extends n.a.Component{constructor(e){super(e),this.state={options:[],value:null,loading:!1}}componentDidMount(){this._loadOptions(this.props.queryId)}componentDidUpdate(e){this.props.queryId!==e.queryId&&this._loadOptions(this.props.queryId),this.props.value!==e.value&&this.setValue(this.props.value)}setValue(e){var t=this.state.options;if("multiple"===this.props.mode){e=Object(c.isArray)(e)?e:[e];var a=Object(c.map)(t,e=>e.value),r=Object(c.intersection)(e,a);return this.setState({value:r}),r}return e=void 0!==Object(c.find)(t,e=>e.value===this.props.value)?e:Object(c.get)(Object(c.first)(t),"value"),this.setState({value:e}),e}_loadOptions(e){var t,a=this;return regeneratorRuntime.async((function(r){for(;;)switch(r.prev=r.next){case 0:if(!e||e===a.state.queryId){r.next=6;break}return a.setState({loading:!0}),r.next=4,regeneratorRuntime.awrap(a.props.parameter.loadDropdownValues());case 4:t=r.sent,a.props.queryId===e&&a.setState({options:t,loading:!1},()=>{var e=a.setValue(a.props.value);Object(c.isEqual)(e,a.props.value)||a.props.onSelect(e)});case 6:case"end":return r.stop()}}),null,null,null,Promise)}render(){var e=this.props,t=e.className,a=e.mode,r=e.onSelect,i=(e.queryId,e.value,vu(e,["className","mode","onSelect","queryId","value"])),s=this.state,o=s.loading,l=s.options;return n.a.createElement("span",null,n.a.createElement(Sc,yu({className:t,disabled:o,loading:o,mode:a,value:this.state.value,onChange:r,options:Object(c.map)(l,e=>{var t=e.value,a=e.name;return{label:String(a),value:t}}),showSearch:!0,showArrow:!0,notFoundContent:Object(c.isEmpty)(l)?"No options available":null},i)))}}Ou(Eu,"propTypes",{parameter:ae.a.any,value:ae.a.any,mode:ae.a.oneOf(["default","multiple"]),queryId:ae.a.number,onSelect:ae.a.func,className:ae.a.string}),Ou(Eu,"defaultProps",{value:null,mode:"default",parameter:null,queryId:null,onSelect:()=>{},className:""});a(1551);function ju(){return(ju=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function wu(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var Su={maxTagCount:3,maxTagTextLength:10,maxTagPlaceholder:e=>"+".concat(e.length," more")};class Pu extends n.a.Component{constructor(e){super(e),wu(this,"componentDidUpdate",e=>{var t=this.props,a=t.value,r=t.parameter;e.value===a&&e.parameter===r||this.setState({value:r.hasPendingValue?r.pendingValue:a,isDirty:r.hasPendingValue})}),wu(this,"onSelect",e=>{var t=!Object(c.isEqual)(e,this.props.value);this.setState({value:e,isDirty:t}),this.props.onSelect(e,t)}),this.state={value:e.parameter.hasPendingValue?e.parameter.pendingValue:e.value,isDirty:e.parameter.hasPendingValue}}renderDateParameter(){var e=this.props,t=e.type,a=e.parameter,r=this.state.value;return n.a.createElement(Jc,{type:t,className:this.props.className,value:r,parameter:a,onSelect:this.onSelect})}renderDateRangeParameter(){var e=this.props,t=e.type,a=e.parameter,r=this.state.value;return n.a.createElement(gu,{type:t,className:this.props.className,value:r,parameter:a,onSelect:this.onSelect})}renderEnumInput(){var e,t=this.props,a=t.enumOptions,r=t.parameter,i=this.state.value,s=a.split("\n").filter(e=>""!==e);return n.a.createElement(Sc,ju({className:this.props.className,mode:r.multiValuesOptions?"multiple":"default",value:(e=i,r.multiValuesOptions&&null===e?[]:e),onChange:this.onSelect,options:Object(c.map)(s,e=>({label:String(e),value:e})),showSearch:!0,showArrow:!0,notFoundContent:Object(c.isEmpty)(s)?"No options available":null},Su))}renderQueryBasedInput(){var e=this.props,t=e.queryId,a=e.parameter,r=this.state.value;return n.a.createElement(Eu,ju({className:this.props.className,mode:a.multiValuesOptions?"multiple":"default",parameter:a,value:r,queryId:t,onSelect:this.onSelect,style:{minWidth:60}},Su))}renderNumberInput(){var e=this.props.className,t=this.state.value,a=e=>isNaN(e)?void 0:e;return n.a.createElement(Eo.a,{className:e,value:a(t),"aria-label":"Parameter number value",onChange:e=>this.onSelect(a(e))})}renderTextInput(){var e=this.props.className,t=this.state.value;return n.a.createElement(Fe.a,{className:e,value:t,"aria-label":"Parameter text value","data-test":"TextParamInput",onChange:e=>this.onSelect(e.target.value)})}renderInput(){switch(this.props.type){case"datetime-with-seconds":case"datetime-local":case"date":return this.renderDateParameter();case"datetime-range-with-seconds":case"datetime-range":case"date-range":return this.renderDateRangeParameter();case"enum":return this.renderEnumInput();case"query":return this.renderQueryBasedInput();case"number":return this.renderNumberInput();default:return this.renderTextInput()}}render(){var e=this.state.isDirty;return n.a.createElement("div",{className:"parameter-input","data-dirty":e||null,"data-test":"ParameterValueInput"},this.renderInput())}}wu(Pu,"propTypes",{type:ae.a.string,value:ae.a.any,enumOptions:ae.a.string,queryId:ae.a.number,parameter:ae.a.any,onSelect:ae.a.func,className:ae.a.string}),wu(Pu,"defaultProps",{type:"text",value:null,enumOptions:"",queryId:null,parameter:null,onSelect:()=>{},className:""});var Cu=Pu;function Nu(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function ku(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Nu(Object(a),!0).forEach((function(t){xu(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Nu(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function xu(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function Au(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);r=!0);}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return _u(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return _u(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _u(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function qu(){return(qu=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}var Tu=Li.a.Option,Iu={labelCol:{span:6},wrapperCol:{span:16}};function Du(e){return Object(c.capitalize)(Object(c.words)(e).join(" "))}function Ru(e){var t=e.name,a=e.type,r=e.onChange,i=e.existingNames,s=e.setValidation,o="",l="";return t?Object(c.includes)(i,t)?(o="Parameter with this name already exists",s(!1),l="error"):(function(e){return/-range/.test(e)}(a)&&(o=n.a.createElement(n.a.Fragment,null,"Appears in query as"," ",n.a.createElement("code",{style:{display:"inline-block",color:"inherit"}},"{{".concat(t,".start}} {{").concat(t,".end}}")))),s(!0)):(o="Choose a keyword for this parameter",s(!1)),n.a.createElement(co.a.Item,qu({required:!0,label:"Keyword",help:o,validateStatus:l},Iu),n.a.createElement(Fe.a,{onChange:e=>r(e.target.value),autoFocus:!0}))}function Mu(e){var t=Au(Object(r.useState)(Object(c.clone)(e.parameter)),2),a=t[0],i=t[1],s=Au(Object(r.useState)(!0),2),o=s[0],l=s[1],u=Au(Object(r.useState)(),2),d=u[0],m=u[1],p=!e.parameter.name;Object(r.useEffect)(()=>{var t=e.parameter.queryId;t&&Xt.get({id:t}).then(m)},[e.parameter.queryId]);var h,b,g,y=Pe("paramForm");return n.a.createElement(z.a,qu({},e.dialog.props,{title:p?"Add Parameter":a.name,width:600,footer:[n.a.createElement(f.a,{key:"cancel",onClick:e.dialog.dismiss},"Cancel"),n.a.createElement(f.a,{key:"submit",htmlType:"submit",disabled:!!(!o||""===a.title||"query"===a.type&&!a.queryId),type:"primary",form:y,"data-test":"SaveParameterSettings"},p?"Add Parameter":"OK")]}),n.a.createElement(co.a,{layout:"horizontal",onFinish:function(){a.title||(a.title=Du(a.name),i(a)),e.dialog.close(a)},id:y},p&&n.a.createElement(Ru,{name:a.name,onChange:e=>i(ku(ku({},a),{},{name:e})),setValidation:l,existingNames:e.existingParams,type:a.type}),n.a.createElement(co.a.Item,qu({required:!0,label:"Title"},Iu),n.a.createElement(Fe.a,{value:Object(c.isNull)(a.title)?Du(a.name):a.title,onChange:e=>i(ku(ku({},a),{},{title:e.target.value})),"data-test":"ParameterTitleInput"})),n.a.createElement(co.a.Item,qu({label:"Type"},Iu),n.a.createElement(Li.a,{value:a.type,onChange:e=>i(ku(ku({},a),{},{type:e})),"data-test":"ParameterTypeSelect"},n.a.createElement(Tu,{value:"text","data-test":"TextParameterTypeOption"},"Text"),n.a.createElement(Tu,{value:"number","data-test":"NumberParameterTypeOption"},"Number"),n.a.createElement(Tu,{value:"enum"},"Dropdown List"),n.a.createElement(Tu,{value:"query"},"Query Based Dropdown List"),n.a.createElement(Tu,{disabled:!0,key:"dv1"},n.a.createElement(fo.a,{className:"select-option-divider"})),n.a.createElement(Tu,{value:"date","data-test":"DateParameterTypeOption"},"Date"),n.a.createElement(Tu,{value:"datetime-local","data-test":"DateTimeParameterTypeOption"},"Date and Time"),n.a.createElement(Tu,{value:"datetime-with-seconds"},"Date and Time (with seconds)"),n.a.createElement(Tu,{disabled:!0,key:"dv2"},n.a.createElement(fo.a,{className:"select-option-divider"})),n.a.createElement(Tu,{value:"date-range","data-test":"DateRangeParameterTypeOption"},"Date Range"),n.a.createElement(Tu,{value:"datetime-range"},"Date and Time Range"),n.a.createElement(Tu,{value:"datetime-range-with-seconds"},"Date and Time Range (with seconds)"))),"enum"===a.type&&n.a.createElement(co.a.Item,qu({label:"Values",help:"Dropdown list values (newline delimited)"},Iu),n.a.createElement(Fe.a.TextArea,{rows:3,value:a.enumOptions,onChange:e=>i(ku(ku({},a),{},{enumOptions:e.target.value}))})),"query"===a.type&&n.a.createElement(co.a.Item,qu({label:"Query",help:"Select query to load dropdown values from"},Iu),n.a.createElement(zo,{selectedQuery:d,onChange:e=>i(ku(ku({},a),{},{queryId:e&&e.id})),type:"select"})),("enum"===a.type||"query"===a.type)&&n.a.createElement(co.a.Item,qu({className:"m-b-0",label:" ",colon:!1},Iu),n.a.createElement(Vl.a,{defaultChecked:!!a.multiValuesOptions,onChange:e=>i(ku(ku({},a),{},{multiValuesOptions:e.target.checked?{prefix:"",suffix:"",separator:","}:null})),"data-test":"AllowMultipleValuesCheckbox"},"Allow multiple values")),("enum"===a.type||"query"===a.type)&&a.multiValuesOptions&&n.a.createElement(co.a.Item,qu({label:"Quotation",help:n.a.createElement(n.a.Fragment,null,"Placed in query as: ",n.a.createElement("code",null,(h=a.multiValuesOptions,b=h.prefix,g=h.suffix,["value1","value2","value3"].map(e=>"".concat(b).concat(e).concat(g)).join(","))))},Iu),n.a.createElement(Li.a,{value:a.multiValuesOptions.prefix,onChange:e=>i(ku(ku({},a),{},{multiValuesOptions:ku(ku({},a.multiValuesOptions),{},{prefix:e,suffix:e})})),"data-test":"QuotationSelect"},n.a.createElement(Tu,{value:""},"None (default)"),n.a.createElement(Tu,{value:"'"},"Single Quotation Mark"),n.a.createElement(Tu,{value:'"',"data-test":"DoubleQuotationMarkOption"},"Double Quotation Mark")))))}Ru.propTypes={name:ae.a.string.isRequired,onChange:ae.a.func.isRequired,existingNames:ae.a.arrayOf(ae.a.string).isRequired,setValidation:ae.a.func.isRequired,type:ae.a.string.isRequired},Mu.propTypes={parameter:ae.a.object.isRequired,dialog:Qe.isRequired,existingParams:ae.a.arrayOf(ae.a.string)},Mu.defaultProps={existingParams:[]};var zu=We(Mu);a(1552);function Fu(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function Uu(e){var t=Object(c.extend)({},q.search);e.forEach(e=>{Object(c.extend)(t,e.toUrlParams())}),q.setSearch(t,!0)}class Vu extends n.a.Component{constructor(e){super(e),Fu(this,"componentDidUpdate",e=>{var t=this.props,a=t.parameters,r=t.disableUrlUpdate,n=e.parameters!==a,i=e.disableUrlUpdate!==r;n&&this.setState({parameters:a}),!n&&!i||r||Uu(a)}),Fu(this,"handleKeyDown",e=>{13===e.keyCode&&(e.ctrlKey||e.metaKey||e.altKey)&&(e.stopPropagation(),this.applyChanges())}),Fu(this,"setPendingValue",(e,t,a)=>{var r=this.props.onPendingValuesChange;this.setState(n=>{var i=n.parameters;return a?e.setPendingValue(t):e.clearPendingValue(),r(),{parameters:i}})}),Fu(this,"moveParameter",e=>{var t=e.oldIndex,a=e.newIndex,r=this.props.onParametersEdit;t!==a&&this.setState(e=>{var n=e.parameters;return n.splice(a,0,n.splice(t,1)[0]),r(n),{parameters:n}})}),Fu(this,"applyChanges",()=>{var e=this.props,t=e.onValuesChange,a=e.disableUrlUpdate;this.setState(e=>{var r=e.parameters,n=r.filter(e=>e.hasPendingValue);return Object(c.forEach)(r,e=>e.applyPendingValue()),a||Uu(r),t(n),{parameters:r}})}),Fu(this,"showParameterSettings",(e,t)=>{var a=this.props.onParametersEdit;zu.showModal({parameter:e}).onClose(r=>{this.setState(n=>{var i=n.parameters,s=Object(c.extend)(e,r);return i[t]=Pa(s,s.parentQueryId),a(i),{parameters:i}})})});var t=e.parameters;this.state={parameters:t},e.disableUrlUpdate||Uu(t)}renderParameter(e,t){var a=this.props.editable;return n.a.createElement("div",{key:e.name,className:"di-block","data-test":"ParameterName-".concat(e.name)},n.a.createElement("div",{className:"parameter-heading"},n.a.createElement("label",null,e.title||oi(e.name)),a&&n.a.createElement(fe,{className:"btn btn-default btn-xs m-l-5","aria-label":"Edit",onClick:()=>this.showParameterSettings(e,t),"data-test":"ParameterSettings-".concat(e.name),type:"button"},n.a.createElement("i",{className:"fa fa-cog","aria-hidden":"true"}))),n.a.createElement(Cu,{type:e.type,value:e.normalizedValue,parameter:e,enumOptions:e.enumOptions,queryId:e.queryId,onSelect:(t,a)=>this.setPendingValue(e,t,a)}))}render(){var e=this.state.parameters,t=this.props,a=t.sortable,r=t.appendSortableToParent,i=Object(c.size)(Object(c.filter)(e,"hasPendingValue"));return n.a.createElement(dc.SortableContainer,{disabled:!a,axis:"xy",useDragHandle:!0,lockToContainerEdges:!0,helperClass:"parameter-dragged",helperContainer:e=>r?e:document.body,updateBeforeSortStart:this.onBeforeSortStart,onSortEnd:this.moveParameter,containerProps:{className:"parameter-container",onKeyDown:i?this.handleKeyDown:null}},e.map((e,t)=>n.a.createElement(dc.SortableElement,{key:e.name,index:t},n.a.createElement("div",{className:"parameter-block","data-editable":a||null,"data-test":"ParameterBlock-".concat(e.name)},a&&n.a.createElement(dc.DragHandle,{"data-test":"DragHandle-".concat(e.name)}),this.renderParameter(e,t)))),n.a.createElement(Oc,{onClick:this.applyChanges,paramCount:i}))}}function Lu(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);r=!0);}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Bu(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Bu(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Bu(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function Qu(e){var t=e.from,a=Object(r.useMemo)(()=>l()(t).valueOf(),[t]),i=Lu(Object(r.useState)(null),2),s=i[0],o=i[1];return Object(r.useEffect)(()=>{function e(){var e=l.a.now()-a,t=e>36e5?"HH:mm:ss":"mm:ss";o(l.a.utc(e).format(t))}e();var t=setInterval(e,1e3);return()=>clearInterval(t)},[a]),n.a.createElement("span",{className:"rd-timer"},s)}Fu(Vu,"propTypes",{parameters:ae.a.arrayOf(ae.a.instanceOf(wt)),editable:ae.a.bool,sortable:ae.a.bool,disableUrlUpdate:ae.a.bool,onValuesChange:ae.a.func,onPendingValuesChange:ae.a.func,onParametersEdit:ae.a.func,appendSortableToParent:ae.a.bool}),Fu(Vu,"defaultProps",{parameters:[],editable:!1,sortable:!1,disableUrlUpdate:!1,onValuesChange:()=>{},onPendingValuesChange:()=>{},onParametersEdit:()=>{},appendSortableToParent:!0}),Qu.propTypes={from:ae.a.oneOfType([ae.a.string,ae.a.number,ae.a.instanceOf(Date),Gn])},Qu.defaultProps={from:null};a(1553);function Wu(e){var t=e.visualization,a=d.registeredVisualizations[t.type];return n.a.createElement("span",{className:"visualization-name"},a&&t.name!==a.name?t.name:null)}Wu.propTypes={visualization:d.VisualizationType.isRequired};var Hu=Wu;a(1554);function Gu(){return(Gu=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Ku(e){var t=e.query,a=e.visualization,r=e.readOnly;return n.a.createElement(e=>{return r?n.a.createElement("span",e):n.a.createElement(O,Gu({href:(i=null,a&&(i="TABLE"===a.type?"table":a.id),t.getUrl(!1,i))},e));var i},{className:"query-link"},n.a.createElement(Hu,{visualization:a})," ",n.a.createElement("span",null,t.name))}Ku.propTypes={query:ae.a.object.isRequired,visualization:d.VisualizationType,readOnly:ae.a.bool},Ku.defaultProps={visualization:null,readOnly:!1};var Yu=Ku;function $u(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function Ju(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?$u(Object(a),!0).forEach((function(t){Xu(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):$u(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Xu(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var Zu="###Redash::Filters::SelectAll###",ed=ae.a.shape({name:ae.a.string.isRequired,friendlyName:ae.a.string.isRequired,multiple:ae.a.bool,current:ae.a.oneOfType([ae.a.any,ae.a.arrayOf(ae.a.any)]),values:ae.a.arrayOf(ae.a.any).isRequired}),td=ae.a.arrayOf(ed);function ad(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(!Object(c.isArray)(e))return[];var a=e;return Object(c.isArray)(t)&&t.length>0&&(a=a.filter(e=>Object(c.every)(t,t=>{var a=e[t.name],r=Object(c.isArray)(t.current)?t.current:[t.current];return Object(c.some)(r,e=>l.a.isMoment(a)?a.isSame(e):e===a||String(a)===e)}))),a}function rd(e){var t=e.filters,a=e.onChange;return 0===t.length?null:(a=function(e,t){return(a,r)=>{if(Object(c.isArray)(r))r=Object(c.map)(r,e=>a.values[Object(c.toNumber)(e.key)]||e.key);else{var n=a.values[Object(c.toNumber)(r.key)];r=void 0!==n?n:r.key}a.multiple&&Object(c.includes)(r,Zu)&&(r=[...a.values]),a.multiple&&Object(c.includes)(r,"###Redash::Filters::Clear###")&&(r=[]),e=Object(c.map)(e,e=>e.name===a.name?Ju(Ju({},a),{},{current:r}):e),t(e)}}(t,a),n.a.createElement("div",{className:"filters-wrapper","data-test":"Filters"},n.a.createElement("div",{className:"container bg-white"},n.a.createElement("div",{className:"row"},Object(c.map)(t,e=>{var t=Object(c.map)(e.values,(t,a)=>n.a.createElement(Li.a.Option,{key:a},di(t,Object(c.get)(e,"column.type"))));return n.a.createElement("div",{key:e.name,className:"col-sm-6 p-l-0 filter-container","data-test":"FilterName-".concat(e.name)},n.a.createElement("label",null,e.friendlyName),0===t.length&&n.a.createElement(Li.a,{className:"w-100",disabled:!0,value:"No values"}),t.length>0&&n.a.createElement(Li.a,{labelInValue:!0,className:"w-100",mode:e.multiple?"multiple":"default",value:Object(c.isArray)(e.current)?Object(c.map)(e.current,t=>({key:"".concat(Object(c.indexOf)(e.values,t)),label:di(t)})):{key:"".concat(Object(c.indexOf)(e.values,e.current)),label:di(e.current)},allowClear:e.multiple,optionFilterProp:"children",showSearch:!0,maxTagCount:3,maxTagTextLength:10,maxTagPlaceholder:e=>"+".concat(e.length," more"),onChange:t=>a(e,t)},!e.multiple&&t,e.multiple&&[n.a.createElement(Li.a.Option,{key:"###Redash::Filters::Clear###","data-test":"ClearOption"},n.a.createElement("i",{className:"fa fa-square-o m-r-5","aria-hidden":"true"}),"Clear"),n.a.createElement(Li.a.Option,{key:Zu,"data-test":"SelectAllOption"},n.a.createElement("i",{className:"fa fa-check-square-o m-r-5","aria-hidden":"true"}),"Select All"),n.a.createElement(Li.a.OptGroup,{key:"Values",title:"Values"},t)]))})))))}rd.propTypes={filters:td.isRequired,onChange:ae.a.func},rd.defaultProps={onChange:()=>{}};var nd=rd;function id(e){var t=Object(c.invoke)(e,"getStatus");return Object(r.useMemo)(()=>function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return{status:t||Object(c.invoke)(e,"getStatus")||null,columns:Object(c.invoke)(e,"getColumns")||[],rows:Object(c.invoke)(e,"getData")||[],filters:Object(c.invoke)(e,"getFilters")||[],updatedAt:Object(c.invoke)(e,"getUpdatedAt")||null,retrievedAt:Object(c.get)(e,"query_result.retrieved_at",null),truncated:Object(c.invoke)(e,"getTruncated")||null,log:Object(c.invoke)(e,"getLog")||[],error:Object(c.invoke)(e,"getError")||null,runtime:Object(c.invoke)(e,"getRuntime")||null,metadata:Object(c.get)(e,"query_result.data.metadata",{})}}(e,t),[e,t])}function sd(e){var t=Object(r.useRef)();return t.current=Object(c.isFunction)(e)?e:c.noop,Object(r.useCallback)((function(){return t.current(...arguments)}),[])}var od=a(696),ld=a.n(od),cd=a(697),ud=a.n(cd),dd=a(698),md=a.n(dd);function pd(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function hd(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function fd(e){return function(t){return Object(d.updateVisualizationsSettings)(function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?pd(Object(a),!0).forEach((function(t){hd(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):pd(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({HelpTriggerComponent:Me,LinkComponent:O,choroplethAvailableMaps:{countries:{name:"Countries",url:ld.a,fieldNames:{name:"Short name",name_long:"Full name",abbrev:"Abbreviated name",iso_a2:"ISO code (2 letters)",iso_a3:"ISO code (3 letters)",iso_n3:"ISO code (3 digits)"}},usa:{name:"USA",url:ud.a,fieldNames:{name:"Name",ns_code:"National Standard ANSI Code (8-character)",geoid:"Geographic ID",usps_abbrev:"USPS Abbreviation",fips_code:"FIPS Code (2-character)"}},subdiv_japan:{name:"Japan/Prefectures",url:md.a,fieldNames:{name:"Name",name_alt:"Name (alternative)",name_local:"Name (local)",iso_3166_2:"ISO-3166-2",postal:"Postal Code",type:"Type",type_en:"Type (EN)",region:"Region",region_code:"Region Code"}}}},Object(c.pick)(H,["dateFormat","dateTimeFormat","integerFormat","floatFormat","booleanValues","tableCellMaxJSONSize","allowCustomJSVisualizations","hidePlotlyModeBar"]))),n.a.createElement(e,t)}}var bd=fd(d.Renderer),gd=fd(d.Editor);function yd(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);r=!0);}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return vd(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return vd(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function vd(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function Od(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function Ed(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Od(Object(a),!0).forEach((function(t){jd(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Od(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function jd(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function wd(e,t){return 0===e.length||0===t.length?e:Object(c.map)(e,e=>{var a=Object(c.find)(t,t=>t.name===e.name);return a?Ed(Ed({},e),{},{current:a.current}):e})}function Sd(e){var t=id(e.queryResult),a=yd(Object(r.useState)(()=>wd(t.filters,e.filters)),2),i=a[0],s=a[1],o=Object(r.useRef)();o.current=i;var l=sd(t=>{var a,r;r=i,(a=t).length===r.length&&(a=Object(c.fromPairs)(Object(c.map)(a,e=>[e.name,e])),r=Object(c.fromPairs)(Object(c.map)(r,e=>[e.name,e])),Object(c.isEqual)(a,r))||(s(t),e.onFiltersChange(t))});Object(r.useEffect)(()=>{l(wd(t.filters,e.filters))},[t.filters,e.filters,l]),Object(r.useEffect)(()=>{l(wd(o.current,e.filters))},[e.filters,l]);var u=Object(r.useMemo)(()=>({columns:t.columns,rows:ad(t.rows,i)}),[t,i]),d=e.showFilters,m=e.visualization,p=Ed({},m.options);return"TABLE"===m.type&&(p.paginationSize="widget"===e.context?"small":"default"),n.a.createElement(bd,{key:"visualization".concat(m.id),type:m.type,options:p,data:u,visualizationName:m.name,addonBefore:d&&n.a.createElement(nd,{filters:i,onChange:l})})}function Pd(){return(Pd=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Cd(e){var t=e.dialog,a=e.widget,r=e.filters;return n.a.createElement(z.a,Pd({},t.props,{title:n.a.createElement(n.a.Fragment,null,n.a.createElement(Hu,{visualization:a.visualization})," ",n.a.createElement("span",null,a.getQuery().name)),width:"95%",footer:n.a.createElement(f.a,{onClick:t.dismiss},"Close")}),n.a.createElement(Sd,{visualization:a.visualization,queryResult:a.getQueryResult(),filters:r,context:"widget"}))}Sd.propTypes={visualization:d.VisualizationType.isRequired,queryResult:ae.a.object.isRequired,showFilters:ae.a.bool,filters:td,onFiltersChange:ae.a.func,context:ae.a.oneOf(["query","widget"]).isRequired},Sd.defaultProps={showFilters:!0,filters:[],onFiltersChange:()=>{}},Cd.propTypes={dialog:Qe.isRequired,widget:ae.a.object.isRequired,filters:td},Cd.defaultProps={filters:[]};var Nd=We(Cd),kd=a(183),xd=a.n(kd),Ad=a(160),_d=a.n(Ad),qd=a(54),Td=a.n(qd),Id=a(413),Dd=a.n(Id),Rd=a(296),Md=a.n(Rd),zd=a(159),Fd=a.n(zd);a(1555);function Ud(){return(Ud=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Vd(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);r=!0);}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Ld(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Ld(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ld(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function Bd(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var Qd="dashboard-add-new",Wd="dashboard-map-to-existing",Hd="widget-level",Gd="static-value";function Kd(e){return Object(c.fromPairs)(Object(c.map)(e,e=>{var t=Object(c.extend)({},e);switch(e.type){case Qd:case Wd:t.type=Ta.DashboardLevel,t.value=null;break;case Gd:t.type=Ta.StaticValue,t.param=Ca(e.param),t.param.setValue(t.value),t.value=t.param.value;break;case Hd:t.type=Ta.WidgetLevel,t.value=null}return delete t.param,[t.name,t]}))}function Yd(e,t){var a=[];return Object(c.each)(e,e=>{e.type===Ta.DashboardLevel&&Object(c.each)(t,t=>{var r=t.options.parameterMappings;Object(c.each)(r,r=>{r.type===Ta.DashboardLevel&&r.mapTo===e.mapTo&&r.title!==e.title&&(r.title=e.title,a.push(t))})})}),a}class $d extends n.a.Component{constructor(){super(...arguments),Bd(this,"formItemProps",{labelCol:{span:5},wrapperCol:{span:16},className:"form-item"}),Bd(this,"updateSourceType",e=>{var t=this.props.mapping.mapTo,a=this.props.existingParamNames;e!==Wd||Object(c.includes)(a,t)||(t=a[0]),this.updateParamMapping({type:e,mapTo:t})}),Bd(this,"updateParamMapping",e=>{var t=this.props,a=t.onChange,r=t.mapping,n=Object(c.extend)({},r,e);n.value!==r.value&&(n.param=Ca(n.param),n.param.setValue(n.value)),Object(c.has)(e,"type")&&(e.type===Gd?n.value=n.param.value:n.value=null),a(n)})}renderMappingTypeSelector(){var e=Object(c.isEmpty)(this.props.existingParamNames);return n.a.createElement(Td.a.Group,{value:this.props.mapping.type,onChange:e=>this.updateSourceType(e.target.value)},n.a.createElement(Td.a,{className:"radio",value:Qd,"data-test":"NewDashboardParameterOption"},"New dashboard parameter"),n.a.createElement(Td.a,{className:"radio",value:Wd,disabled:e},"Existing dashboard parameter"," ",e?n.a.createElement(Oe,{title:"There are no dashboard parameters corresponding to this data type"},n.a.createElement(Dd.a,null)):null),n.a.createElement(Td.a,{className:"radio",value:Hd,"data-test":"WidgetParameterOption"},"Widget parameter"),n.a.createElement(Td.a,{className:"radio",value:Gd,"data-test":"StaticValueOption"},"Static value"))}renderDashboardAddNew(){var e=this.props.mapping.mapTo;return n.a.createElement(Fe.a,{value:e,"aria-label":"Parameter name (key)",onChange:e=>this.updateParamMapping({mapTo:e.target.value})})}renderDashboardMapToExisting(){var e=this.props,t=e.mapping,a=e.existingParamNames,r=Object(c.map)(a,e=>({label:e,value:e}));return n.a.createElement(Li.a,{value:t.mapTo,onChange:e=>this.updateParamMapping({mapTo:e}),options:r})}renderStaticValue(){var e=this.props.mapping;return n.a.createElement(Cu,{type:e.param.type,value:e.param.normalizedValue,enumOptions:e.param.enumOptions,queryId:e.param.queryId,parameter:e.param,onSelect:e=>this.updateParamMapping({value:e})})}renderInputBlock(){switch(this.props.mapping.type){case Qd:return["Key","Enter a new parameter keyword",this.renderDashboardAddNew()];case Wd:return["Key","Select from a list of existing parameters",this.renderDashboardMapToExisting()];case Gd:return["Value",null,this.renderStaticValue()];default:return[]}}render(){var e=this.props.inputError,t=Vd(this.renderInputBlock(),3),a=t[0],r=t[1],i=t[2];return n.a.createElement(co.a,{layout:"horizontal"},n.a.createElement(co.a.Item,Ud({label:"Source"},this.formItemProps),this.renderMappingTypeSelector()),n.a.createElement(co.a.Item,Ud({style:{height:60,visibility:i?"visible":"hidden"},label:a},this.formItemProps,{validateStatus:e?"error":"",help:e||r}),i))}}Bd($d,"propTypes",{mapping:ae.a.object,existingParamNames:ae.a.arrayOf(ae.a.string),onChange:ae.a.func,inputError:ae.a.string}),Bd($d,"defaultProps",{mapping:{},existingParamNames:[],onChange:()=>{},inputError:null});class Jd extends n.a.Component{constructor(e){super(e),Bd(this,"onVisibleChange",e=>{e?this.show():this.hide()}),Bd(this,"onChange",e=>{var t=null;e.type===Qd&&(Object(c.isEmpty)(e.mapTo)?t="Keyword must have a value":Object(c.includes)(this.props.existingParamNames,e.mapTo)&&(t="A parameter with this name already exists")),this.setState({mapping:e,inputError:t})}),Bd(this,"save",()=>{this.props.onChange(this.props.mapping,this.state.mapping),this.hide()}),Bd(this,"show",()=>{this.setState({visible:!0,mapping:Object(c.clone)(this.props.mapping)})}),Bd(this,"hide",()=>{this.setState({visible:!1})}),this.state={visible:!1,mapping:Object(c.clone)(this.props.mapping),inputError:null}}renderContent(){var e=this.state,t=e.mapping,a=e.inputError;return n.a.createElement("div",{className:"parameter-mapping-editor","data-test":"EditParamMappingPopover"},n.a.createElement("header",null,"Edit Source and Value ",n.a.createElement(Me,{type:"VALUE_SOURCE_OPTIONS"})),n.a.createElement($d,{mapping:t,existingParamNames:this.props.existingParamNames,onChange:this.onChange,inputError:a}),n.a.createElement("footer",null,n.a.createElement(f.a,{onClick:this.hide},"Cancel"),n.a.createElement(f.a,{onClick:this.save,disabled:!!a,type:"primary"},"OK")))}render(){var e=this.state,t=e.visible,a=e.mapping;return n.a.createElement(xd.a,{placement:"left",trigger:"click",content:this.renderContent(),visible:t,onVisibleChange:this.onVisibleChange},n.a.createElement(f.a,{size:"small",type:"dashed","data-test":"EditParamMappingButton-".concat(a.param.name)},n.a.createElement(Md.a,null)))}}Bd(Jd,"propTypes",{mapping:ae.a.object.isRequired,existingParamNames:ae.a.arrayOf(ae.a.string).isRequired,onChange:ae.a.func.isRequired});class Xd extends n.a.Component{constructor(){super(...arguments),Bd(this,"state",{showPopup:!1,title:""}),Bd(this,"onPopupVisibleChange",e=>{this.setState({showPopup:e,title:e?this.getMappingTitle():""})}),Bd(this,"onEditingTitleChange",e=>{this.setState({title:e.target.value})}),Bd(this,"save",()=>{var e=Object(c.extend)({},this.props.mapping,{title:this.state.title});this.props.onChange(e),this.hide()}),Bd(this,"hide",()=>{this.setState({showPopup:!1})})}getMappingTitle(){var e=this.props.mapping;if(Object(c.isString)(e.title)&&""!==e.title)return e.title;if(e.type===Wd){var t=Object(c.find)(this.props.existingParams,{name:e.mapTo});t&&(e=t)}return e.title||e.param.title}renderPopover(){var e=this.props.mapping.param.title;return n.a.createElement("div",{className:"parameter-mapping-title-editor"},n.a.createElement(Fe.a,{size:"small",value:this.state.title,placeholder:e,"aria-label":"Edit parameter title",onChange:this.onEditingTitleChange,onPressEnter:this.save,maxLength:100,autoFocus:!0}),n.a.createElement(f.a,{size:"small",type:"dashed",onClick:this.hide},n.a.createElement(Se.a,null)),n.a.createElement(f.a,{size:"small",type:"dashed",onClick:this.save},n.a.createElement(Fd.a,null)))}renderEditButton(){return this.props.mapping.type===Gd?n.a.createElement(Oe,{placement:"right",title:"Titles for static values don't appear in widgets"},n.a.createElement("span",{tabIndex:0},n.a.createElement("i",{className:"fa fa-eye-slash","aria-hidden":"true"}))):n.a.createElement(xd.a,{placement:"right",trigger:"click",content:this.renderPopover(),visible:this.state.showPopup,onVisibleChange:this.onPopupVisibleChange},n.a.createElement(f.a,{size:"small",type:"dashed"},n.a.createElement(Md.a,null)))}render(){var e=this.props.mapping.type===Gd;return n.a.createElement("div",{className:me()("parameter-mapping-title",{disabled:e})},n.a.createElement("span",{className:"text"},this.getMappingTitle()),this.renderEditButton())}}Bd(Xd,"propTypes",{existingParams:ae.a.arrayOf(ae.a.object),mapping:ae.a.object.isRequired,onChange:ae.a.func.isRequired}),Bd(Xd,"defaultProps",{existingParams:[]});class Zd extends n.a.Component{static getStringValue(e){return e?e instanceof Object&&"start"in e&&"end"in e?"".concat(e.start," ~ ").concat(e.end):"object"==typeof e?Object(c.map)(e,e=>this.getStringValue(e)).join(", "):e.toString():""}static getDefaultValue(e,t){var a=e.type,r=e.mapTo,n=e.name,i=e.param;if(a===Wd&&r!==n){var s=Object(c.find)(t,{name:r});s&&(i=s)}else a===Gd&&(i=Ca(i).setValue(e.value));var o=wt.getExecutionValue(i);return i.hasDynamicValue&&(o=i.normalizedValue.name),this.getStringValue(o)}static getSourceTypeLabel(e){var t=e.type,a=e.mapTo;switch(t){case Qd:case Wd:return n.a.createElement(r.Fragment,null,"Dashboard ",n.a.createElement(_d.a,{className:"tag"},a));case Hd:return"Widget parameter";case Gd:return"Static value";default:return""}}updateParamMapping(e,t){var a=[...this.props.mappings],r=Object(c.findIndex)(a,e);r>=0?a[r]=t:a.push(t),this.props.onChange(a)}render(){var e=this.props.existingParams,t=this.props.mappings.map(e=>({mapping:e}));return n.a.createElement("div",{className:"parameters-mapping-list"},n.a.createElement(Tn.a,{dataSource:t,size:"middle",pagination:!1,rowKey:(e,t)=>"row".concat(t)},n.a.createElement(Tn.a.Column,{title:"Title",dataIndex:"mapping",key:"title",render:t=>n.a.createElement(Xd,{existingParams:e,mapping:t,onChange:e=>this.updateParamMapping(t,e)})}),n.a.createElement(Tn.a.Column,{title:"Keyword",dataIndex:"mapping",key:"keyword",className:"keyword",render:e=>n.a.createElement("code",null,"{{ ".concat(e.name," }}"))}),n.a.createElement(Tn.a.Column,{title:"Default Value",dataIndex:"mapping",key:"value",render:e=>this.constructor.getDefaultValue(e,this.props.existingParams)}),n.a.createElement(Tn.a.Column,{title:"Value Source",dataIndex:"mapping",key:"source",render:t=>{var a=e.filter(e=>e.type===t.param.type).map(e=>e.name);return n.a.createElement(r.Fragment,null,this.constructor.getSourceTypeLabel(t)," ",n.a.createElement(Jd,{mapping:t,existingParamNames:a,onChange:(e,t)=>this.updateParamMapping(e,t)}))}})))}}function em(){return(em=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function tm(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function am(e,t){return Object(c.map)(Object(c.sortBy)(e,e=>e.name),e=>{var a;switch(e.type){case Gd:return[e.name,e.value];case Hd:return[e.name,e.param.value];case Qd:case Wd:return a=Object(c.find)(t,t=>t.name===e.mapTo),[e.name,a?a.value:null]}})}Bd(Zd,"propTypes",{mappings:ae.a.arrayOf(ae.a.object),existingParams:ae.a.arrayOf(ae.a.object),onChange:ae.a.func}),Bd(Zd,"defaultProps",{mappings:[],existingParams:[],onChange:()=>{}});class rm extends n.a.Component{constructor(e){super(e),tm(this,"originalParamValuesSnapshot",null);var t=function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return Object(c.map)(e,e=>{var r=Object(c.extend)({},e),n=Object(c.includes)(a,e.mapTo);switch(r.param=Object(c.find)(t,t=>t.name===e.name),e.type){case Ta.DashboardLevel:r.type=n?Wd:Qd,r.value=null;break;case Ta.StaticValue:r.type=Gd,r.param=Ca(r.param),r.param.setValue(r.value);break;case Ta.WidgetLevel:r.type=Hd,r.value=null}return r})}(e.widget.options.parameterMappings,e.widget.query.getParametersDefs(),Object(c.map)(this.props.dashboard.getParametersDefs(),e=>e.name));this.originalParamValuesSnapshot=am(t,this.props.dashboard.getParametersDefs()),this.state={saveInProgress:!1,parameterMappings:t}}saveWidget(){var e=this.props.widget;this.setState({saveInProgress:!0});var t=Kd(this.state.parameterMappings);e.options.parameterMappings=t;var a=!Object(c.isMatch)(this.originalParamValuesSnapshot,am(this.state.parameterMappings,this.props.dashboard.getParametersDefs())),r=[e,...Yd(e.options.parameterMappings,this.props.dashboard.widgets)];Promise.all(Object(c.map)(r,e=>e.save())).then(()=>{this.props.dialog.close(a)}).catch(()=>{en.error("Widget cannot be updated")}).finally(()=>{this.setState({saveInProgress:!1})})}updateParamMappings(e){this.setState({parameterMappings:e})}render(){var e=this.props.dialog;return n.a.createElement(z.a,em({},e.props,{title:"Parameters",onOk:()=>this.saveWidget(),okButtonProps:{loading:this.state.saveInProgress},width:700}),this.state.parameterMappings.length>0&&n.a.createElement(Zd,{mappings:this.state.parameterMappings,existingParams:this.props.dashboard.getParametersDefs(),onChange:e=>this.updateParamMappings(e)}))}}tm(rm,"propTypes",{dashboard:ae.a.object.isRequired,widget:ae.a.object.isRequired,dialog:Qe.isRequired});var nm=We(rm);a(1556);function im(){return(im=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function sm(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function om(e){var t=e.extraOptions,a=e.showDeleteOption,r=e.onDelete,i=n.a.createElement(ue.a,{"data-test":"WidgetDropdownButtonMenu"},t,a&&t&&n.a.createElement(ue.a.Divider,null),a&&n.a.createElement(ue.a.Item,{onClick:r},"Remove from Dashboard"));return n.a.createElement("div",{className:"widget-menu-regular"},n.a.createElement(Nr.a,{overlay:i,placement:"bottomRight",trigger:["click"]},n.a.createElement(fe,{className:"action p-l-15 p-r-15","data-test":"WidgetDropdownButton","aria-label":"More options"},n.a.createElement("i",{className:"zmdi zmdi-more-vert","aria-hidden":"true"}))))}function lm(e){var t=e.onClick;return n.a.createElement("div",{className:"widget-menu-remove"},n.a.createElement(fe,{className:"action",title:"Remove From Dashboard",onClick:t,"data-test":"WidgetDeleteButton","aria-label":"Close"},n.a.createElement("i",{className:"zmdi zmdi-close","aria-hidden":"true"})))}om.propTypes={extraOptions:ae.a.node,showDeleteOption:ae.a.bool,onDelete:ae.a.func},om.defaultProps={extraOptions:null,showDeleteOption:!1,onDelete:()=>{}},lm.propTypes={onClick:ae.a.func},lm.defaultProps={onClick:()=>{}};class cm extends n.a.Component{constructor(){super(...arguments),sm(this,"deleteWidget",()=>{var e=this.props,t=e.widget,a=e.onDelete;z.a.confirm({title:"Delete Widget",content:"Are you sure you want to remove this widget from the dashboard?",okText:"Delete",okType:"danger",onOk:()=>t.delete().then(a),maskClosable:!0,autoFocusButton:null})})}componentDidMount(){mt("view","widget",this.props.widget.id)}render(){var e=this.props,t=e.className,a=e.children,r=e.header,i=e.footer,s=e.canEdit,o=e.isPublic,l=e.menuOptions,u=e.tileProps,d=!o&&(s||!Object(c.isEmpty)(l));return n.a.createElement("div",{className:"widget-wrapper"},n.a.createElement("div",im({className:me()("tile body-container",t)},u),n.a.createElement("div",{className:"widget-actions"},d&&n.a.createElement(om,{extraOptions:l,showDeleteOption:s,onDelete:this.deleteWidget}),s&&n.a.createElement(lm,{onClick:this.deleteWidget})),n.a.createElement("div",{className:"body-row widget-header"},r),a,i&&n.a.createElement("div",{className:"body-row tile__bottom-control"},i)))}}sm(cm,"propTypes",{widget:ae.a.object.isRequired,className:ae.a.string,children:ae.a.node,header:ae.a.node,footer:ae.a.node,canEdit:ae.a.bool,isPublic:ae.a.bool,refreshStartedAt:Gn,menuOptions:ae.a.node,tileProps:ae.a.object,onDelete:ae.a.func}),sm(cm,"defaultProps",{className:"",children:null,header:null,footer:null,canEdit:!1,isPublic:!1,refreshStartedAt:null,menuOptions:null,tileProps:{},onDelete:()=>{}});var um=cm;function dm(){return(dm=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function mm(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function pm(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);r=!0);}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return hm(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return hm(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function hm(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function fm(e){var t=e.widget,a=e.canEditDashboard,r=e.onParametersEdit,i=W.hasPermission("view_query"),s=a&&!Object(c.isEmpty)(Object(c.invoke)(t,"query.getParametersDefs")),o=t.getQueryResult(),l=!o||!o.isEmpty||o.isEmpty(),u=e=>o.getLink(t.getQuery().id,e),d=e=>o.getName(t.getQuery().name,e);return Object(c.compact)([n.a.createElement(ue.a.Item,{key:"download_csv",disabled:l},l?"Download as CSV File":n.a.createElement(O,{href:u("csv"),download:d("csv"),target:"_self"},"Download as CSV File")),n.a.createElement(ue.a.Item,{key:"download_tsv",disabled:l},l?"Download as TSV File":n.a.createElement(O,{href:u("tsv"),download:d("tsv"),target:"_self"},"Download as TSV File")),n.a.createElement(ue.a.Item,{key:"download_excel",disabled:l},l?"Download as Excel File":n.a.createElement(O,{href:u("xlsx"),download:d("xlsx"),target:"_self"},"Download as Excel File")),(i||s)&&n.a.createElement(ue.a.Divider,{key:"divider"}),i&&n.a.createElement(ue.a.Item,{key:"view_query"},n.a.createElement(O,{href:t.getQuery().getUrl(!0,t.visualization.id)},"View Query")),s&&n.a.createElement(ue.a.Item,{key:"edit_parameters",onClick:r},"Edit Parameters")])}function bm(e){var t=e.refreshStartedAt;return n.a.createElement("div",{className:"refresh-indicator"},n.a.createElement("div",{className:"refresh-icon"},n.a.createElement("i",{className:"zmdi zmdi-refresh zmdi-hc-spin","aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},"Refreshing...")),n.a.createElement(Qu,{from:t}))}function gm(e){var t=e.widget,a=e.refreshStartedAt,r=e.parameters,i=e.isEditing,s=e.onParametersUpdate,o=e.onParametersEdit,l=W.hasPermission("view_query");return n.a.createElement(n.a.Fragment,null,n.a.createElement(bm,{refreshStartedAt:a}),n.a.createElement("div",{className:"t-header widget clearfix"},n.a.createElement("div",{className:"th-title"},n.a.createElement("p",null,n.a.createElement(Yu,{query:t.getQuery(),visualization:t.visualization,readOnly:!l})),!Object(c.isEmpty)(t.getQuery().description)&&n.a.createElement(uc.a,{className:"text-muted markdown query--description"},lc.markdown.toHTML(t.getQuery().description||"")))),!Object(c.isEmpty)(r)&&n.a.createElement("div",{className:"m-b-10"},n.a.createElement(Vu,{parameters:r,sortable:i,appendSortableToParent:!1,onValuesChange:s,onParametersEdit:o})))}function ym(e){var t=e.widget,a=e.isPublic,i=e.onRefresh,s=e.onExpand,o=t.getQueryResult(),l=Object(c.invoke)(o,"getUpdatedAt"),u=pm(Object(r.useState)(),2),d=u[0],m=u[1],p=e=>{d||(m(e),i().finally(()=>m(null)))};return o?n.a.createElement(n.a.Fragment,null,n.a.createElement("span",null,!a&&!!o&&n.a.createElement(fe,{className:"refresh-button hidden-print btn btn-sm btn-default btn-transparent",onClick:()=>p(1),"data-test":"RefreshButton"},n.a.createElement("i",{className:me()("zmdi zmdi-refresh",{"zmdi-hc-spin":1===d}),"aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},1===d?"Refreshing, please wait. ":"Press to refresh. ")," ",n.a.createElement($n,{date:l})),n.a.createElement("span",{className:"visible-print"},n.a.createElement("i",{className:"zmdi zmdi-time-restore","aria-hidden":"true"})," ",ti(l)),a&&n.a.createElement("span",{className:"small hidden-print"},n.a.createElement("i",{className:"zmdi zmdi-time-restore","aria-hidden":"true"})," ",n.a.createElement($n,{date:l}))),n.a.createElement("span",null,!a&&n.a.createElement(fe,{className:"btn btn-sm btn-default hidden-print btn-transparent btn__refresh",onClick:()=>p(2)},n.a.createElement("i",{className:me()("zmdi zmdi-refresh",{"zmdi-hc-spin":2===d}),"aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},2===d?"Refreshing, please wait.":"Press to refresh.")),n.a.createElement(fe,{className:"btn btn-sm btn-default hidden-print btn-transparent btn__refresh",onClick:s},n.a.createElement("i",{className:"zmdi zmdi-fullscreen","aria-hidden":"true"})))):null}bm.propTypes={refreshStartedAt:Gn},bm.defaultProps={refreshStartedAt:null},gm.propTypes={widget:ae.a.object.isRequired,refreshStartedAt:Gn,parameters:ae.a.arrayOf(ae.a.object),isEditing:ae.a.bool,onParametersUpdate:ae.a.func,onParametersEdit:ae.a.func},gm.defaultProps={refreshStartedAt:null,onParametersUpdate:()=>{},onParametersEdit:()=>{},isEditing:!1,parameters:[]},ym.propTypes={widget:ae.a.object.isRequired,isPublic:ae.a.bool,onRefresh:ae.a.func.isRequired,onExpand:ae.a.func.isRequired},ym.defaultProps={isPublic:!1};class vm extends n.a.Component{constructor(e){super(e),mm(this,"onLocalFiltersChange",e=>{this.setState({localFilters:e})}),mm(this,"expandWidget",()=>{Nd.showModal({widget:this.props.widget,filters:this.state.localFilters})}),mm(this,"editParameterMappings",()=>{var e=this.props,t=e.widget,a=e.dashboard,r=e.onRefresh,n=e.onParameterMappingsChange;nm.showModal({dashboard:a,widget:t}).onClose(e=>{e&&r(),n(),this.setState({localParameters:t.getLocalParameters()})})}),this.state={localParameters:e.widget.getLocalParameters(),localFilters:e.filters}}componentDidMount(){var e=this.props,t=e.widget,a=e.onLoad;mt("view","query",t.visualization.query.id,{dashboard:!0}),mt("view","visualization",t.visualization.id,{dashboard:!0}),a()}renderVisualization(){var e=this.props,t=e.widget,a=e.filters,r=t.getQueryResult();switch(r&&r.getStatus()){case"failed":return n.a.createElement("div",{className:"body-row-auto scrollbox"},r.getError()&&n.a.createElement("div",{className:"alert alert-danger m-5"},"Error running query: ",n.a.createElement("strong",null,r.getError())));case"done":return n.a.createElement("div",{className:"body-row-auto scrollbox"},n.a.createElement(Sd,{visualization:t.visualization,queryResult:r,filters:a,onFiltersChange:this.onLocalFiltersChange,context:"widget"}));default:return n.a.createElement("div",{className:"body-row-auto spinner-container",role:"status","aria-live":"polite","aria-relevant":"additions removals"},n.a.createElement("div",{className:"spinner"},n.a.createElement("i",{className:"zmdi zmdi-refresh zmdi-hc-spin zmdi-hc-5x","aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},"Loading...")))}}render(){var e=this.props,t=e.widget,a=e.isLoading,r=e.isPublic,i=e.canEdit,s=e.isEditing,o=e.onRefresh,l=this.state.localParameters,u=t.getQueryResult(),d=a&&!(!u||!u.getStatus());return n.a.createElement(um,dm({},this.props,{className:"widget-visualization",menuOptions:fm({widget:t,canEditDashboard:i,onParametersEdit:this.editParameterMappings}),header:n.a.createElement(gm,{widget:t,refreshStartedAt:d?t.refreshStartedAt:null,parameters:l,isEditing:s,onParametersUpdate:o,onParametersEdit:e=>{var a=Object(c.map)(e,"name");t.options.paramOrder=a,t.save("options",{paramOrder:a})}}),footer:n.a.createElement(ym,{widget:t,isPublic:r,onRefresh:o,onExpand:this.expandWidget}),tileProps:{"data-refreshing":d}}),this.renderVisualization())}}mm(vm,"propTypes",{widget:ae.a.object.isRequired,dashboard:ae.a.object.isRequired,filters:td,isPublic:ae.a.bool,isLoading:ae.a.bool,canEdit:ae.a.bool,isEditing:ae.a.bool,onLoad:ae.a.func,onRefresh:ae.a.func,onDelete:ae.a.func,onParameterMappingsChange:ae.a.func}),mm(vm,"defaultProps",{filters:[],isPublic:!1,isLoading:!1,canEdit:!1,isEditing:!1,onLoad:()=>{},onRefresh:()=>{},onDelete:()=>{},onParameterMappingsChange:()=>{}});var Om=vm;a(1557);function Em(){return(Em=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function jm(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);r=!0);}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return wm(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return wm(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function wm(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function Sm(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},i=Object.keys(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function Pm(e){var t=e.dialog,a=e.isNew,i=Sm(e,["dialog","isNew"]),s=jm(Object(r.useState)(Object(c.toString)(i.text)),2),o=s[0],l=s[1],u=jm(Object(r.useState)(null),2),d=u[0],m=u[1];Object(r.useEffect)(()=>{l(i.text),m(lc.markdown.toHTML(i.text))},[i.text]);var p=jm(Object(Ao.a)(()=>{m(lc.markdown.toHTML(o))},200),1)[0],h=Object(r.useCallback)(e=>{l(e.target.value),p()},[p]),f=Object(r.useCallback)(()=>{t.close(o).catch(()=>{en.error(a?"Widget could not be added":"Widget could not be saved")})},[t,a,o]),b=Object(r.useCallback)(()=>{var e=i.text;o!==e?z.a.confirm({title:"Quit editing?",content:"Changes you made so far will not be saved. Are you sure?",okText:"Yes, quit",okType:"danger",onOk:()=>t.dismiss(),maskClosable:!0,autoFocusButton:null,style:{top:170}}):t.dismiss()},[t,o,i.text]);return n.a.createElement(z.a,Em({},t.props,{title:a?"Add Textbox":"Edit Textbox",onOk:f,onCancel:b,okText:a?"Add to Dashboard":"Save",width:500,wrapProps:{"data-test":"TextboxDialog"}}),n.a.createElement("div",{className:"textbox-dialog"},n.a.createElement(Fe.a.TextArea,{className:"resize-vertical",rows:"5",value:o,"aria-label":"Textbox widget content",onChange:h,autoFocus:!0,placeholder:"This is where you write some text"}),n.a.createElement("small",null,"Supports basic"," ",n.a.createElement(O,{target:"_blank",rel:"noopener noreferrer",href:"https://www.markdownguide.org/cheat-sheet/#basic-syntax"},n.a.createElement(Oe,{title:"Markdown guide opens in new window"},"Markdown")),"."),o&&n.a.createElement(n.a.Fragment,null,n.a.createElement(fo.a,{dashed:!0}),n.a.createElement("strong",{className:"preview-title"},"Preview:"),n.a.createElement(uc.a,{className:"preview markdown"},d))))}Pm.propTypes={dialog:Qe.isRequired,isNew:ae.a.bool,text:ae.a.string},Pm.defaultProps={isNew:!1,text:""};var Cm=We(Pm);function Nm(){return(Nm=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function km(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);r=!0);}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return xm(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return xm(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function xm(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function Am(e){var t=e.widget,a=e.canEdit,i=km(Object(r.useState)(t.text),2),s=i[0],o=i[1],l=[n.a.createElement(ue.a.Item,{key:"edit",onClick:()=>{Cm.showModal({text:t.text}).onClose(e=>(t.text=e,o(e),t.save()))}},"Edit")];return t.width?n.a.createElement(um,Nm({},e,{menuOptions:a?l:null,className:"widget-text"}),n.a.createElement(uc.a,{className:"body-row-auto scrollbox t-body p-15 markdown"},lc.markdown.toHTML(s||""))):null}Am.propTypes={widget:ae.a.object.isRequired,canEdit:ae.a.bool},Am.defaultProps={canEdit:!1};var _m=Am;function qm(){return(qm=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}var Tm=function(e){return n.a.createElement(um,qm({},e,{className:"d-flex justify-content-center align-items-center widget-restricted"}),n.a.createElement("div",{className:"t-body scrollbox"},n.a.createElement("div",{className:"text-center"},n.a.createElement("h1",null,n.a.createElement("span",{className:"zmdi zmdi-lock"})),n.a.createElement("p",{className:"text-muted"},"This widget requires access to a data source you don't have access to."))))};function Im(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);r=!0);}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Dm(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Dm(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Dm(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function Rm(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var Mm=[".widget-header",".visualization-renderer",".scrollbox .alert",".spinner-container",".tile__bottom-control"].join(",");class zm{constructor(e){Rm(this,"widgets",{}),Rm(this,"interval",null),Rm(this,"onHeightChange",null),Rm(this,"add",e=>{this.isEmpty()&&this.start();var t='[data-widgetid="{0}"]'.replace("{0}",e);this.widgets[e]=[function(){var e=document.querySelector(t);if(e){var a=e.querySelectorAll(Mm);return Object(c.reduce)(a,(e,t)=>e+(t?t.getBoundingClientRect().height:0),0)}}]}),Rm(this,"remove",e=>{this.exists(e)&&(this.widgets[e.toString()]=!1,this.isEmpty()&&this.stop())}),Rm(this,"exists",e=>!!this.widgets[e.toString()]),Rm(this,"isEmpty",()=>!Object(c.some)(this.widgets)),Rm(this,"checkHeightChanges",()=>{Object.keys(this.widgets).filter(this.exists).forEach(e=>{var t=Im(this.widgets[e],2),a=t[0],r=t[1],n=a();n&&n!==r&&(this.widgets[e][1]=n,this.onHeightChange(e,n))})}),Rm(this,"start",()=>{this.stop(),this.interval=setInterval(this.checkHeightChanges,200)}),Rm(this,"stop",()=>{clearInterval(this.interval)}),Rm(this,"resume",()=>{this.isEmpty()||this.start()}),Rm(this,"destroy",()=>{this.stop(),this.widgets=null}),this.onHeightChange=e}update(e){var t=e.filter(e=>e.options.position.autoHeight).map(e=>e.id.toString());t.filter(e=>!Object(c.includes)(Object.keys(this.widgets),e)).forEach(this.add),Object.keys(this.widgets).filter(e=>!Object(c.includes)(t,e)).forEach(this.remove)}}a(1558),a(1559);function Fm(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var Um=Object(oc.WidthProvider)(oc.Responsive),Vm=ae.a.shape({id:ae.a.number.isRequired,options:ae.a.shape({position:ae.a.shape({col:ae.a.number.isRequired,row:ae.a.number.isRequired,sizeY:ae.a.number.isRequired,minSizeY:ae.a.number.isRequired,maxSizeY:ae.a.number.isRequired,sizeX:ae.a.number.isRequired,minSizeX:ae.a.number.isRequired,maxSizeX:ae.a.number.isRequired}).isRequired}).isRequired}),Lm="single-column",Bm="multi-column",Qm=n.a.memo((function(e){var t=e.widget,a=e.dashboard,r=e.onLoadWidget,i=e.onRefreshWidget,s=e.onRemoveWidget,o=e.onParameterMappingsChange,l=e.isEditing,c=e.canEdit,u=e.isPublic,d=e.isLoading,m=e.filters,p=t.type,h=()=>s(t.id);return p===ka?n.a.createElement(Om,{widget:t,dashboard:a,filters:m,isEditing:l,canEdit:c,isPublic:u,isLoading:d,onLoad:()=>r(t),onRefresh:()=>i(t),onDelete:h,onParameterMappingsChange:o}):p===Na?n.a.createElement(_m,{widget:t,canEdit:c,isPublic:u,onDelete:h}):n.a.createElement(Tm,{widget:t})}),(e,t)=>e.widget===t.widget&&e.canEdit===t.canEdit&&e.isPublic===t.isPublic&&e.isLoading===t.isLoading&&e.filters===t.filters&&e.isEditing===t.isEditing);class Wm extends n.a.Component{static normalizeFrom(e){var t=e.id,a=e.options.position;return{i:t.toString(),x:a.col,y:a.row,w:a.sizeX,h:a.sizeY,minW:a.minSizeX,maxW:a.maxSizeX,minH:a.minSizeY,maxH:a.maxSizeY}}constructor(e){super(e),Fm(this,"mode",null),Fm(this,"autoHeightCtrl",null),Fm(this,"onLayoutChange",(e,t)=>{if(t[Bm]&&this.setState({layouts:t}),this.mode=document.body.offsetWidth<=bt?Lm:Bm,this.mode!==Lm){var a=Object(c.chain)(t[Bm]).keyBy("i").mapValues(this.normalizeTo).value();this.props.onLayoutChange(a)}}),Fm(this,"onBreakpointChange",e=>{this.mode=e,this.props.onBreakpointChange(e===Lm)}),Fm(this,"onWidgetHeightUpdated",(e,t)=>{this.setState(a=>{var r=a.layouts,n=Object(c.cloneDeep)(r[Bm]),i=Object(c.find)(n,{i:e.toString()});return i&&(i.h=Math.ceil((t+ft)/ht)),{layouts:{[Bm]:n}}})}),Fm(this,"onWidgetResize",(e,t,a)=>{t.h!==a.h&&this.autoHeightCtrl.remove(Number(a.i)),this.autoHeightCtrl.resume()}),Fm(this,"normalizeTo",e=>({col:e.x,row:e.y,sizeX:e.w,sizeY:e.h,autoHeight:this.autoHeightCtrl.exists(e.i)})),this.state={layouts:{},disableAnimations:!0},this.autoHeightCtrl=new zm(this.onWidgetHeightUpdated),this.autoHeightCtrl.update(this.props.widgets)}componentDidMount(){this.onBreakpointChange(document.body.offsetWidth<=bt?Lm:Bm),setTimeout(()=>{this.setState({disableAnimations:!1})},50)}componentDidUpdate(){this.autoHeightCtrl.update(this.props.widgets)}componentWillUnmount(){this.autoHeightCtrl.destroy()}render(){var e=this.props,t=e.onLoadWidget,a=e.onRefreshWidget,r=e.onRemoveWidget,i=e.onParameterMappingsChange,s=e.filters,o=e.dashboard,l=e.isPublic,c=e.isEditing,u=e.widgets,d=me()("dashboard-wrapper",c?"editing-mode":"preview-mode");return n.a.createElement("div",{className:d},n.a.createElement(Um,{draggableCancel:"input,.sortable-container",className:me()("layout",{"disable-animations":this.state.disableAnimations}),cols:{[Bm]:pt,[Lm]:1},rowHeight:ht-ft,margin:[ft,ft],isDraggable:c,isResizable:c,onResizeStart:this.autoHeightCtrl.stop,onResizeStop:this.onWidgetResize,layouts:this.state.layouts,onLayoutChange:this.onLayoutChange,onBreakpointChange:this.onBreakpointChange,breakpoints:{[Bm]:bt,[Lm]:0}},u.map(e=>n.a.createElement("div",{key:e.id,"data-grid":Wm.normalizeFrom(e),"data-widgetid":e.id,"data-test":"WidgetId".concat(e.id),className:me()("dashboard-widget-wrapper",{"widget-auto-height-enabled":this.autoHeightCtrl.exists(e.id)})},n.a.createElement(Qm,{dashboard:o,widget:e,filters:s,isPublic:l,isLoading:e.loading,isEditing:c,canEdit:o.canEdit(),onLoadWidget:t,onRefreshWidget:a,onRemoveWidget:r,onParameterMappingsChange:i})))))}}Fm(Wm,"propTypes",{isEditing:ae.a.bool.isRequired,isPublic:ae.a.bool,dashboard:ae.a.object.isRequired,widgets:ae.a.arrayOf(Vm).isRequired,filters:td,onBreakpointChange:ae.a.func,onLoadWidget:ae.a.func,onRefreshWidget:ae.a.func,onRemoveWidget:ae.a.func,onLayoutChange:ae.a.func,onParameterMappingsChange:ae.a.func}),Fm(Wm,"defaultProps",{isPublic:!1,filters:[],onLoadWidget:()=>{},onRefreshWidget:()=>{},onRemoveWidget:()=>{},onLayoutChange:()=>{},onBreakpointChange:()=>{},onParameterMappingsChange:()=>{}});var Hm=Wm,Gm=new Map;function Km(){Gm.size>0&&(Gm.forEach((e,t)=>{var a=t.getBoundingClientRect(),r=Math.round(10*a.width),n=Math.round(10*a.height);e.width===r&&e.height===n||(e.width=r,e.height=n,e.callback(t))}),setTimeout(Km,100))}function Ym(e,t){if(e&&!Gm.has(e)){var a=0===Gm.size;return Gm.set(e,{callback:t}),a&&Km(),()=>Gm.delete(e)}return()=>{}}function $m(){return($m=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Jm(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function Xm(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Jm(Object(a),!0).forEach((function(t){Zm(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Jm(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Zm(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function ep(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);r=!0);}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return tp(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return tp(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function tp(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function ap(e){var t=e.query,a=e.visualization,i=e.onChange,s=Object(r.useMemo)(()=>t?Object(c.groupBy)(t.visualizations,"type"):{},[t]),o=Pe("visualization-select"),l=Object(r.useCallback)(e=>{var a=t?Object(c.find)(t.visualizations,{id:e}):null;i(a||null)},[t,i]);return t?n.a.createElement("div",null,n.a.createElement("div",{className:"form-group"},n.a.createElement("label",{htmlFor:o},"Choose Visualization"),n.a.createElement(Li.a,{id:o,className:"w-100",value:a?a.id:void 0,onChange:l},Object(c.map)(s,(e,t)=>n.a.createElement(Li.a.OptGroup,{key:t,label:t},Object(c.map)(e,e=>n.a.createElement(Li.a.Option,{key:"".concat(e.id),value:e.id},e.name))))))):null}function rp(e){var t=e.dialog,a=e.dashboard,i=ep(Object(r.useState)(null),2),s=i[0],o=i[1],l=ep(Object(r.useState)(null),2),u=l[0],d=l[1],m=ep(Object(r.useState)([]),2),p=m[0],h=m[1],f=Object(r.useCallback)(e=>{o(null),d(null),h([]),e&&Xt.get({id:e}).then(e=>{if(e){var t=Object(c.map)(a.getParametersDefs(),e=>e.name);o(e),h(Object(c.map)(e.getParametersDefs(),e=>({name:e.name,type:Object(c.includes)(t,e.name)?Wd:Qd,mapTo:e.name,value:e.normalizedValue,title:"",param:e}))),e.visualizations.length>0&&d(Object(c.first)(e.visualizations))}})},[a]),b=Object(r.useCallback)(()=>{t.close({visualization:u,parameterMappings:p}).catch(()=>{en.error("Widget could not be added")})},[t,u,p]),g=a.getParametersDefs(),y=Pe("parameter-mappings");return n.a.createElement(z.a,$m({},t.props,{title:"Add Widget",onOk:b,okButtonProps:Xm(Xm({},t.props.okButtonProps),{},{disabled:!s||t.props.okButtonProps.disabled}),okText:"Add to Dashboard",width:700}),n.a.createElement("div",{"data-test":"AddWidgetDialog"},n.a.createElement(zo,{onChange:e=>f(e?e.id:null)}),s&&n.a.createElement(ap,{query:s,visualization:u,onChange:d}),p.length>0&&[n.a.createElement("label",{key:"parameters-title",htmlFor:y},"Parameters"),n.a.createElement(Zd,{key:"parameters-list",id:y,mappings:p,existingParams:g,onChange:h})]))}ap.propTypes={query:ae.a.object,visualization:ae.a.object,onChange:ae.a.func},ap.defaultProps={query:null,visualization:null,onChange:()=>{}},rp.propTypes={dialog:Qe.isRequired,dashboard:ae.a.object.isRequired};var np=We(rp);function ip(){return(ip=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function sp(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},i=Object.keys(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function op(e){var t=e.imageUrl,a=e.roundedImage,r=e.title,i=e.body,s=e.children,o=e.className,l=sp(e,["imageUrl","roundedImage","title","body","children","className"]);return n.a.createElement("div",ip({},l,{className:o+" w-100 d-flex align-items-center"}),n.a.createElement("img",{src:t,width:"32",height:"32",className:me()({"profile__image--settings":a},"m-r-5"),alt:"Logo/Avatar"}),n.a.createElement("div",{className:"flex-fill"},n.a.createElement("div",null,r),i&&n.a.createElement("div",{className:"text-muted"},i)),s)}function lp(e){var t=e.user,a=e.withLink,r=e.children,i=sp(e,["user","withLink","children"]),s=a?n.a.createElement(O,{href:"users/"+t.id},t.name):t.name;return n.a.createElement(op,ip({},i,{imageUrl:t.profile_image_url,title:s,body:t.email}),r)}function cp(e){var t=e.dataSource,a=e.withLink,r=e.children,i=sp(e,["dataSource","withLink","children"]),s="static/images/db-logos/".concat(t.type,".png"),o=a?n.a.createElement(O,{href:"data_sources/"+t.id},t.name):t.name;return n.a.createElement(op,ip({},i,{imageUrl:s,title:o}),r)}op.propTypes={imageUrl:ae.a.string.isRequired,title:ae.a.node.isRequired,body:ae.a.node,roundedImage:ae.a.bool,className:ae.a.string,children:ae.a.node},op.defaultProps={body:null,roundedImage:!0,className:"",children:null},lp.propTypes={user:ae.a.shape({profile_image_url:ae.a.string.isRequired,name:ae.a.string.isRequired,email:ae.a.string.isRequired}).isRequired,withLink:ae.a.bool,children:ae.a.node},lp.defaultProps={withLink:!1,children:null},cp.propTypes={dataSource:ae.a.shape({name:ae.a.string.isRequired,type:ae.a.string.isRequired}).isRequired,withLink:ae.a.bool,children:ae.a.node},cp.defaultProps={withLink:!1,children:null};var up=a(237),dp=a.n(up);dp.a.setConfig({ADD_ATTR:["target"]}),dp.a.addHook("afterSanitizeAttributes",(function(e){var t=e.getAttribute("target");Object(c.isString)(t)&&"_blank"===t.toLowerCase()?e.setAttribute("rel","noopener noreferrer"):e.removeAttribute("target")}));var mp=dp.a.sanitize;function pp(e){return Object(c.find)([Object(c.get)(e,"response.data.message"),Object(c.get)(e,"response.statusText"),"Unknown error"],c.isString)}function hp(e){return"api/users/".concat(e.id,"/disable")}var fp={query:e=>Q.get("api/users",{params:e}),get:e=>{var t=e.id;return Q.get("api/users/".concat(t))},create:e=>Q.post("api/users",e),save:e=>Q.post("api/users/".concat(e.id),e),enableUser:function(e){var t=mp(e.name);return Q.delete(hp(e)).then(a=>(en.success("User ".concat(t," is now enabled.")),e.is_disabled=!1,e.profile_image_url=a.profile_image_url,a)).catch(e=>{en.error("Cannot enable user",pp(e))})},disableUser:function(e){var t=mp(e.name);return Q.post(hp(e)).then(a=>(en.warning("User ".concat(t," is now disabled.")),e.is_disabled=!0,e.profile_image_url=a.profile_image_url,a)).catch(e=>{en.error("Cannot disable user",pp(e))})},deleteUser:function(e){var t=mp(e.name);return Q.delete("api/users/".concat(e.id)).then(e=>(en.warning("User ".concat(t," has been deleted.")),e)).catch(e=>{en.error("Cannot delete user",pp(e))})},convertUserInfo:function(e){return{id:e.id,name:e.name,email:e.email,profileImageUrl:e.profile_image_url,apiKey:e.api_key,groupIds:e.groups,isDisabled:e.is_disabled,isInvitationPending:e.is_invitation_pending}},regenerateApiKey:function(e){return Q.post("api/users/".concat(e.id,"/regenerate_api_key")).then(e=>(en.success("The API Key has been updated."),e.api_key)).catch(e=>{en.error("Failed regenerating API Key",pp(e))})},sendPasswordReset:function(e){return Q.post("api/users/".concat(e.id,"/reset_password")).then(e=>{if(H.mailSettingsMissing)return en.warning("The mail server is not configured."),e.reset_link;en.success("Password reset email sent.")}).catch(e=>{en.error("Failed to send password reset email",pp(e))})},resendInvitation:function(e){return Q.post("api/users/".concat(e.id,"/invite")).then(e=>{if(H.mailSettingsMissing)return en.warning("The mail server is not configured."),e.invite_link;en.success("Invitation sent.")}).catch(e=>{en.error("Failed to resend invitation",pp(e))})}};a(1560);function bp(){return(bp=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function gp(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);r=!0);}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return yp(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return yp(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function yp(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}var vp=Li.a.Option;function Op(e){var t=e.context;return n.a.createElement(n.a.Fragment,null,"Manage Permissions",n.a.createElement("div",{className:"modal-header-desc"},"Editing this ".concat(t," is enabled for the users in this list and for admins. "),n.a.createElement(Me,{type:"MANAGE_PERMISSIONS"})))}function Ep(e){var t=e.onSelect,a=e.shouldShowUser,i=gp(Object(r.useState)(!0),2),s=i[0],o=i[1],l=gp(Object(r.useState)([]),2),u=l[0],d=l[1],m=gp(Object(r.useState)(""),2),p=m[0],h=m[1],f=Object(r.useCallback)(Object(c.debounce)(e=>(e=>fp.query({q:e}).then(e=>e.results).catch(()=>[]))(e).then(d).finally(()=>o(!1)),200),[]);return Object(r.useEffect)(()=>{o(!0),f(p)},[f,p]),n.a.createElement(Li.a,{className:"w-100 m-b-10",placeholder:"Add users...",showSearch:!0,onSearch:h,suffixIcon:s?n.a.createElement("span",{role:"status","aria-live":"polite","aria-relevant":"additions removals"},n.a.createElement("i",{className:"fa fa-spinner fa-pulse","aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},"Loading...")):n.a.createElement("i",{className:"fa fa-search","aria-hidden":"true"}),filterOption:!1,notFoundContent:null,value:void 0,getPopupContainer:e=>e.parentNode,onSelect:t},u.filter(a).map(e=>n.a.createElement(vp,{key:e.id,value:e.id},n.a.createElement(lp,{user:e}))))}function jp(e){var t,a=e.dialog,i=e.author,s=e.context,o=e.aclUrl,l=gp(Object(r.useState)(!0),2),u=l[0],d=l[1],m=gp(Object(r.useState)([]),2),p=m[0],h=m[1],b=(t=o,{loadGrantees:Object(r.useCallback)(()=>Q.get(t).then(e=>{var t=[];return Object(c.each)(e,(e,a)=>{e.forEach(e=>{e.accessType=oi(a),t.push(e)})}),t}),[t]),addPermission:Object(r.useCallback)((function(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"modify";return Q.post(t,{access_type:a,user_id:e}).catch(()=>en.error("Could not grant permission to the user"))}),[t]),removePermission:Object(r.useCallback)((function(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"modify";return Q.delete(t,{data:{access_type:a,user_id:e}}).catch(()=>en.error("Could not remove permission from the user"))}),[t])}),g=b.loadGrantees,y=b.addPermission,v=b.removePermission,O=Object(r.useCallback)(()=>{d(!0),g().then(h).catch(()=>en.error("Failed to load grantees list")).finally(()=>d(!1))},[g]),E=Object(r.useCallback)(e=>e.id===i.id||!!Object(c.get)(Object(c.find)(p,{id:e.id}),"accessType"),[i.id,p]);return Object(r.useEffect)(()=>{O()},[o,O]),n.a.createElement(z.a,bp({},a.props,{className:"permissions-editor-dialog",title:n.a.createElement(Op,{context:s}),footer:n.a.createElement(f.a,{onClick:a.dismiss},"Close")}),n.a.createElement(Ep,{onSelect:e=>y(e).then(O),shouldShowUser:e=>!E(e)}),n.a.createElement("div",{className:"d-flex align-items-center m-t-5"},n.a.createElement("h5",{className:"flex-fill"},"Users with permissions"),u&&n.a.createElement("span",{role:"status","aria-live":"polite","aria-relevant":"additions removals"},n.a.createElement("i",{className:"fa fa-spinner fa-pulse","aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},"Loading..."))),n.a.createElement("div",{className:"scrollbox p-5",style:{maxHeight:"40vh"}},n.a.createElement(Fs.a,{size:"small",dataSource:[i,...p],renderItem:e=>n.a.createElement(Fs.a.Item,null,n.a.createElement(lp,{key:e.id,user:e},e.id===i.id?n.a.createElement(_d.a,{className:"m-0"},"Author"):n.a.createElement(Oe,{title:"Remove user permissions"},n.a.createElement(fe,{"aria-label":"Remove permissions",onClick:()=>v(e.id).then(O)},n.a.createElement("i",{className:"fa fa-remove clickable","aria-hidden":"true"})))))})))}Op.propTypes={context:ae.a.oneOf(["query","dashboard"])},Op.defaultProps={context:"query"},Ep.propTypes={onSelect:ae.a.func,shouldShowUser:ae.a.func},Ep.defaultProps={onSelect:()=>{},shouldShowUser:()=>!0},jp.propTypes={dialog:Qe.isRequired,author:ae.a.object.isRequired,context:ae.a.oneOf(["query","dashboard"]),aclUrl:ae.a.string.isRequired},jp.defaultProps={context:"query"};var wp=We(jp),Sp=a(233),Pp=a.n(Sp);function Cp(){return(Cp=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}class Np extends n.a.Component{constructor(e){super(e),function(e,t,a){t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a}(this,"copy",()=>{this.ref.current.select();try{if(!document.execCommand("copy"))throw new Error;this.setState({copied:"Copied!"})}catch(e){this.setState({copied:"Copy failed"})}this.resetCopyState=setTimeout(()=>this.setState({copied:null}),2e3)}),this.state={copied:null},this.ref=n.a.createRef(),this.copyFeatureSupported=document.queryCommandSupported("copy"),this.resetCopyState=null}componentWillUnmount(){this.resetCopyState&&clearTimeout(this.resetCopyState)}render(){var e=n.a.createElement(Oe,{title:this.state.copied||"Copy"},n.a.createElement(fe,{onClick:this.copy},n.a.createElement(Pp.a,null)));return n.a.createElement(Fe.a,Cp({},this.props,{ref:this.ref,addonAfter:this.copyFeatureSupported&&e}))}}function kp(){return(kp=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function xp(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class Ap extends n.a.Component{constructor(e){super(e),xp(this,"formItemProps",{labelCol:{span:8},wrapperCol:{span:16},style:{marginBottom:7}}),xp(this,"enableAccess",()=>{var e=this.props.dashboard;this.setState({saving:!0}),Q.post(this.apiUrl).then(t=>{e.publicAccessEnabled=!0,e.public_url=t.public_url}).catch(()=>{en.error("Failed to turn on sharing for this dashboard")}).finally(()=>{this.setState({saving:!1})})}),xp(this,"disableAccess",()=>{var e=this.props.dashboard;this.setState({saving:!0}),Q.delete(this.apiUrl).then(()=>{e.publicAccessEnabled=!1,delete e.public_url}).catch(()=>{en.error("Failed to turn off sharing for this dashboard")}).finally(()=>{this.setState({saving:!1})})}),xp(this,"onChange",e=>{e?this.enableAccess():this.disableAccess()});var t=this.props.dashboard;this.state={saving:!1},this.apiUrl=Object(c.replace)("api/dashboards/{id}/share","{id}",t.id),this.enabled=this.props.hasOnlySafeQueries||t.publicAccessEnabled}static get headerContent(){return n.a.createElement(n.a.Fragment,null,"Share Dashboard",n.a.createElement("div",{className:"modal-header-desc"},"Allow public access to this dashboard with a secret address. ",n.a.createElement(Me,{type:"SHARE_DASHBOARD"})))}render(){var e=this.props,t=e.dialog,a=e.dashboard;return n.a.createElement(z.a,kp({},t.props,{title:this.constructor.headerContent,footer:null}),n.a.createElement(co.a,{layout:"horizontal"},!this.props.hasOnlySafeQueries&&n.a.createElement(co.a.Item,null,n.a.createElement(p.a,{message:"For your security, sharing is currently not supported for dashboards containing queries with text parameters. Consider changing the text parameters in your query to a different type.",type:"error"})),n.a.createElement(co.a.Item,kp({label:"Allow public access"},this.formItemProps),n.a.createElement(Mi.a,{checked:a.publicAccessEnabled,onChange:this.onChange,loading:this.state.saving,disabled:!this.enabled,"data-test":"PublicAccessEnabled"})),a.public_url&&n.a.createElement(co.a.Item,kp({label:"Secret address"},this.formItemProps),n.a.createElement(Np,{value:a.public_url,"data-test":"SecretAddress"}))))}}xp(Ap,"propTypes",{dashboard:ae.a.object.isRequired,hasOnlySafeQueries:ae.a.bool.isRequired,dialog:Qe.isRequired});var _p=We(Ap);function qp(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);r=!0);}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Tp(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Tp(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Tp(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function Ip(){var e=qp(Object(r.useState)(Object(c.has)(q.search,"fullscreen")),2),t=e[0],a=e[1];Object(r.useEffect)(()=>{document.body.classList.toggle("headless",t),q.setSearch({fullscreen:!!t||null},!0)},[t]);return[t,()=>a(!t)]}function Dp(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);r=!0);}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Rp(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Rp(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Rp(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function Mp(e){var t=Z.getDashboardRefreshIntervals();return Object(c.max)([30,Object(c.min)(t),e])}function zp(e){var t=Dp(Object(r.useState)(function(){var e=parseFloat(q.search.refresh);return Object(c.isNaN)(e)?null:Mp(e)}()),2),a=t[0],n=t[1],i=sd(e);return Object(r.useEffect)(()=>{if(q.setSearch({refresh:a||null},!0),a){var e=setInterval(i,1e3*a);return()=>clearInterval(e)}},[a,i]),Object(r.useMemo)(()=>[a,e=>n(Mp(e)),()=>n(null)],[a])}function Fp(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);r=!0);}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Up(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Up(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Up(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}var Vp="saved",Lp="saving",Bp="saving_failed";function Qp(e,t){var a=Fp(Object(r.useState)(e&&Object(c.has)(q.search,"edit")),2),n=a[0],i=a[1],s=Fp(Object(r.useState)(Vp),2),o=s[0],l=s[1],u=Fp(Object(r.useState)([]),2),d=u[0],m=u[1],p=Fp(Object(r.useState)(!1),2),h=p[0],f=p[1];Object(r.useEffect)(()=>{q.setSearch({edit:!!n||null},!0)},[n]),Object(r.useEffect)(()=>{h&&o===Vp&&(f(!1),i(!1))},[h,o]);var b=Object(r.useCallback)(a=>{if(e){var r=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(c.pickBy)(t,(t,a)=>{var r=Object(c.find)(e,{id:Number(a)}).options.position;return!Object(c.isMatch)(r,t)})}(t,a);l(Lp),m(a);var n=Object(c.map)(r,(e,a)=>{var r=Object(c.find)(t,{id:Number(a)});return r?r.save("options",{position:e}):Promise.resolve()});return Promise.all(n).then(()=>l(Vp)).catch(()=>{l(Bp),en.error("Error saving changes.")})}l(Vp)},[e,t]),g=Object(r.useCallback)((function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return l(Lp),Object(c.debounce)(()=>b(...t),2e3)()}),[b]),y=Object(r.useCallback)(()=>b(d),[d,b]),v=Object(r.useCallback)(t=>{t||o===Vp?i(e&&t):f(!0)},[o,e]);return{editingLayout:e&&n,setEditingLayout:v,saveDashboardLayout:n?g:b,retrySaveDashboardLayout:y,doneBtnClickedWhileSaving:h,dashboardStatus:o}}function Wp(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function Hp(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Wp(Object(a),!0).forEach((function(t){Gp(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Wp(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Gp(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function Kp(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);r=!0);}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Yp(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Yp(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Yp(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function $p(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return Object(c.isEmpty)(t)?e:e.filter(e=>Object.values(e.getParameterMappings()).filter(e=>"dashboard-level"===e.type).some(e=>{var a=e.mapTo;return Object(c.includes)(t.map(e=>e.name),a)}))}var Jp=function(e){var t=Kp(Object(r.useState)(e),2),a=t[0],n=t[1],i=Kp(Object(r.useState)([]),2),s=i[0],o=i[1],l=Kp(Object(r.useState)(!1),2),u=l[0],d=l[1],m=Kp(Object(r.useState)(!1),2),p=m[0],h=m[1],f=Object(r.useMemo)(()=>a.getParametersDefs(),[a]),b=!a.is_archived&&Z.canEdit(a),g=Object(r.useMemo)(()=>!a.is_archived&&Object(c.has)(a,"user.id")&&(W.id===a.user.id||W.isAdmin),[a]),y=Object(r.useMemo)(()=>Object(c.every)(a.widgets,e=>!e.getQuery()||e.getQuery().is_safe),[a]),v=Object(r.useCallback)(()=>{var e="api/dashboards/".concat(a.id,"/acl");wp.showModal({aclUrl:e,context:"dashboard",author:a.user})},[a]),O=Object(r.useCallback)((function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return n(t=>Object(c.extend)({},t,e)),e=Hp(Hp({},e),{},{id:a.id}),t&&(e=Hp(Hp({},e),{},{version:a.version})),La.save(e).then(t=>{n(a=>Object(c.extend)({},a,Object(c.pick)(t,Object(c.keys)(e)))),Object(c.has)(e,"name")&&q.setPath(Ke.parse(t.url).pathname,!0)}).catch(e=>{var t=Object(c.get)(e,"response.status");403===t?en.error("Dashboard update failed","Permission Denied."):409===t&&en.error("It seems like the dashboard has been modified by another user. ","Please copy/backup your changes and reload this page.",{duration:null})})}),[a]),E=Object(r.useCallback)(()=>{mt("toggle_published","dashboard",a.id),O({is_draft:!a.is_draft},!1)},[a,O]),j=Object(r.useCallback)((function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e.getParametersDefs(),n(e=>Object(c.extend)({},e)),e.load(t).catch(e=>{if(!(e instanceof ea))return Promise.reject(e)}).finally(()=>n(e=>Object(c.extend)({},e)))}),[]),w=Object(r.useCallback)(e=>j(e,!0),[j]),S=Object(r.useCallback)(e=>{n(t=>Object(c.extend)({},t,{widgets:t.widgets.filter(t=>void 0!==t.id&&t.id!==e)}))},[]),P=Object(r.useRef)();P.current=a;var C=Object(r.useCallback)((function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],a=$p(P.current.widgets,t),r=Object(c.compact)(a.map(t=>j(t,e).catch(e=>e)));return Promise.all(r).then(()=>{var e=Object(c.compact)(Object(c.map)(P.current.widgets,e=>e.getQueryResult())),t=Fa(P.current,e,q.search);o(t)})}),[j]),N=Object(r.useCallback)(e=>{u||(d(!0),C(!0,e).finally(()=>d(!1)))},[u,C]),k=Object(r.useCallback)(()=>{mt("archive","dashboard",a.id),La.delete(a).then(e=>n(t=>Object(c.extend)({},t,Object(c.pick)(e,["is_archived"]))))},[a]),x=Object(r.useCallback)(()=>{var e=()=>n(e=>Object(c.extend)({},e));_p.showModal({dashboard:a,hasOnlySafeQueries:y}).onClose(e).onDismiss(e)},[a,y]),A=Object(r.useCallback)(()=>{Cm.showModal({isNew:!0}).onClose(e=>a.addWidget(e).then(()=>n(e=>Object(c.extend)({},e))))},[a]),_=Object(r.useCallback)(()=>{np.showModal({dashboard:a}).onClose(e=>{var t=e.visualization,r=e.parameterMappings;return a.addWidget(t,{parameterMappings:Kd(r)}).then(e=>{var t=[e,...Yd(e.options.parameterMappings,a.widgets)];return Promise.all(t.map(e=>e.save())).then(()=>n(e=>Object(c.extend)({},e)))})})},[a]),T=Kp(zp(N),3),I=T[0],D=T[1],R=T[2],M=Kp(Ip(),2),z=M[0],F=M[1],U=Qp(!p&&b,a.widgets);return Object(r.useEffect)(()=>{n(e),C()},[e]),Object(r.useEffect)(()=>{document.title=a.name},[a.name]),Object(r.useEffect)(()=>{C()},[a.dashboard_filters_enabled]),Hp(Hp({dashboard:a,globalParameters:f,refreshing:u,filters:s,setFilters:o,loadDashboard:C,refreshDashboard:N,updateDashboard:O,togglePublished:E,archiveDashboard:k,loadWidget:j,refreshWidget:w,removeWidget:S,canEditDashboard:b,isDashboardOwnerOrAdmin:g,refreshRate:I,setRefreshRate:D,disableRefreshRate:R},U),{},{gridDisabled:p,setGridDisabled:h,fullscreen:z,toggleFullscreen:F,showShareDashboardDialog:x,showAddTextboxDialog:A,showAddWidgetDialog:_,managePermissions:v})};function Xp(){return(Xp=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Zp(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class eh extends n.a.Component{constructor(e){super(e),Zp(this,"startEditing",()=>{this.props.isEditable&&this.setState({editing:!0})}),Zp(this,"stopEditing",e=>{var t=Object(c.trim)(e);this.props.ignoreBlanks&&""===t||t===this.props.value||this.props.onDone(t),this.setState({editing:!1})}),Zp(this,"handleKeyDown",e=>{13!==e.keyCode||e.shiftKey?27===e.keyCode&&this.setState({editing:!1}):(e.preventDefault(),this.stopEditing(e.target.value))}),Zp(this,"renderNormal",()=>this.props.value?n.a.createElement("span",{role:"presentation",onFocus:this.startEditing,onClick:this.startEditing,className:this.props.isEditable?"editable":""},this.props.value):n.a.createElement("a",{className:"clickable",onClick:this.startEditing},this.props.placeholder)),Zp(this,"renderEdit",()=>{var e=this.props,t=e.multiline,a=e.value,r=e.editorProps,i=t?Fe.a.TextArea:Fe.a;return n.a.createElement(i,Xp({defaultValue:a,"aria-label":"Editing",onBlur:e=>this.stopEditing(e.target.value),onKeyDown:this.handleKeyDown,autoFocus:!0},r))}),this.state={editing:e.defaultEditing}}componentDidUpdate(e,t){!this.state.editing&&t.editing&&this.props.onStopEditing()}render(){return n.a.createElement("span",{className:me()("edit-in-place",{active:this.state.editing},this.props.className)},this.state.editing?this.renderEdit():this.renderNormal())}}Zp(eh,"propTypes",{ignoreBlanks:ae.a.bool,isEditable:ae.a.bool,placeholder:ae.a.string,value:ae.a.string,onDone:ae.a.func.isRequired,onStopEditing:ae.a.func,multiline:ae.a.bool,editorProps:ae.a.object,defaultEditing:ae.a.bool}),Zp(eh,"defaultProps",{ignoreBlanks:!1,isEditable:!0,placeholder:"",value:"",onStopEditing:()=>{},multiline:!1,editorProps:{},defaultEditing:!1});a(1561);function th(){return xl("api/dashboards/tags").then(e=>Object(c.map)(e,e=>e.name))}function ah(e){return e?"primary":"default"}function rh(e){var t=e.dashboardConfiguration,a=t.dashboard,r=t.canEditDashboard,i=t.updateDashboard,s=t.editingLayout;return n.a.createElement("div",{className:"title-with-tags"},n.a.createElement("div",{className:"page-title"},n.a.createElement(Mn,{item:a}),n.a.createElement("h3",null,n.a.createElement(eh,{isEditable:s,onDone:e=>i({name:e}),value:a.name,ignoreBlanks:!0})),n.a.createElement(Oe,{title:a.user.name,placement:"bottom"},n.a.createElement("img",{src:a.user.profile_image_url,className:"profile-image",alt:a.user.name}))),n.a.createElement(Zi,{tags:a.tags,isDraft:a.is_draft,isArchived:a.is_archived,canEdit:r,getAvailableTags:th,onEdit:e=>i({tags:e})}))}function nh(e){var t=e.dashboardConfiguration,a=t.refreshRate,r=t.setRefreshRate,i=t.disableRefreshRate,s=t.refreshing,o=t.refreshDashboard,l=Z.getDashboardRefreshIntervals(),u=H.dashboardRefreshIntervals;return n.a.createElement(f.a.Group,null,n.a.createElement(Oe,{title:a?"Auto Refreshing every ".concat(si(a)):null},n.a.createElement(f.a,{type:ah(a),onClick:()=>o()},n.a.createElement("i",{className:me()("zmdi zmdi-refresh m-r-5",{"zmdi-hc-spin":s}),"aria-hidden":"true"}),a?si(a):"Refresh")),n.a.createElement(Nr.a,{trigger:["click"],placement:"bottomRight",overlay:n.a.createElement(ue.a,{onClick:e=>{var t=e.key,a=parseFloat(t);a?(r(a),o()):i()},selectedKeys:["".concat(a)]},u.map(e=>n.a.createElement(ue.a.Item,{key:"".concat(e),disabled:!Object(c.includes)(l,e)},si(e))),a&&n.a.createElement(ue.a.Item,{key:null},"Disable auto refresh"))},n.a.createElement(f.a,{className:"icon-button hidden-xs",type:ah(a)},n.a.createElement("i",{className:"fa fa-angle-down","aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},"Split button!"))))}function ih(e){var t=e.dashboardConfiguration,a=t.dashboard,r=t.setEditingLayout,i=t.togglePublished,s=t.archiveDashboard,o=t.managePermissions,l=t.gridDisabled,c=t.isDashboardOwnerOrAdmin;return n.a.createElement(Nr.a,{trigger:["click"],placement:"bottomRight",overlay:n.a.createElement(ue.a,{"data-test":"DashboardMoreButtonMenu"},n.a.createElement(ue.a.Item,{className:me()({hidden:l})},n.a.createElement(fe,{onClick:()=>r(!0)},"Edit")),H.showPermissionsControl&&c&&n.a.createElement(ue.a.Item,null,n.a.createElement(fe,{onClick:o},"Manage Permissions")),!H.disablePublish&&!a.is_draft&&n.a.createElement(ue.a.Item,null,n.a.createElement(fe,{onClick:i},"Unpublish")),n.a.createElement(ue.a.Item,null,n.a.createElement(fe,{onClick:()=>{z.a.confirm({title:"Archive Dashboard",content:'Are you sure you want to archive the "'.concat(a.name,'" dashboard?'),okText:"Archive",okType:"danger",onOk:s,maskClosable:!0,autoFocusButton:null})}},"Archive")))},n.a.createElement(f.a,{className:"icon-button m-l-5","data-test":"DashboardMoreButton","aria-label":"More actions"},n.a.createElement(no.a,{rotate:90,"aria-hidden":"true"})))}function sh(e){var t=e.dashboardConfiguration,a=e.headerExtra,r=t.dashboard,i=t.togglePublished,s=t.canEditDashboard,o=t.fullscreen,l=t.toggleFullscreen,c=t.showShareDashboardDialog,u=r.is_draft,d=!r.is_draft,m=s&&!r.is_draft,p=!H.disablePublicUrls&&(r.publicAccessEnabled||m),h=s;return n.a.createElement("div",{className:"dashboard-control"},!r.is_archived&&n.a.createElement("span",{className:"hidden-print"},u&&n.a.createElement(f.a,{className:"m-r-5 hidden-xs",onClick:i},n.a.createElement("span",{className:"fa fa-paper-plane m-r-5"})," Publish"),n.a.createElement(nh,{dashboardConfiguration:t}),d&&n.a.createElement(Oe,{className:"hidden-xs",title:"Enable/Disable Fullscreen display"},n.a.createElement(f.a,{type:ah(o),className:"icon-button m-l-5",onClick:l,"aria-label":"Toggle fullscreen display"},n.a.createElement("i",{className:"zmdi zmdi-fullscreen","aria-hidden":"true"}))),a,p&&n.a.createElement(Oe,{title:"Dashboard Sharing Options"},n.a.createElement(f.a,{className:"icon-button m-l-5",type:ah(r.publicAccessEnabled),onClick:c,"data-test":"OpenShareForm","aria-label":"Share"},n.a.createElement("i",{className:"zmdi zmdi-share","aria-hidden":"true"}))),h&&n.a.createElement(ih,{dashboardConfiguration:t})))}function oh(e){var t,a=e.dashboardConfiguration,r=e.headerExtra,i=a.setEditingLayout,s=a.doneBtnClickedWhileSaving,o=a.dashboardStatus,l=a.retrySaveDashboardLayout;return t=o===Vp?n.a.createElement("span",{className:"save-status"},"Saved"):o===Lp?n.a.createElement("span",{className:"save-status","data-saving":!0},"Saving"):n.a.createElement("span",{className:"save-status","data-error":!0},"Saving Failed"),n.a.createElement("div",{className:"dashboard-control"},t,o===Bp?n.a.createElement(f.a,{type:"primary",onClick:l},"Retry"):n.a.createElement(f.a,{loading:s,type:"primary",onClick:()=>i(!1)},!s&&n.a.createElement("i",{className:"fa fa-check m-r-5","aria-hidden":"true"})," Done Editing"),r)}function lh(e){var t=e.dashboardConfiguration,a=e.headerExtra,r=t.editingLayout?oh:sh;return n.a.createElement("div",{className:"dashboard-header"},n.a.createElement(rh,{dashboardConfiguration:t}),n.a.createElement(r,{dashboardConfiguration:t,headerExtra:a}))}rh.propTypes={dashboardConfiguration:ae.a.object.isRequired},nh.propTypes={dashboardConfiguration:ae.a.object.isRequired},ih.propTypes={dashboardConfiguration:ae.a.object.isRequired},sh.propTypes={dashboardConfiguration:ae.a.object.isRequired,headerExtra:ae.a.node},oh.propTypes={dashboardConfiguration:ae.a.object.isRequired,headerExtra:ae.a.node},lh.propTypes={dashboardConfiguration:ae.a.object.isRequired,headerExtra:ae.a.node};a(1562);function ch(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);r=!0);}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return uh(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return uh(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function uh(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function dh(){return(dh=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function mh(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},i=Object.keys(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function ph(e){var t=e.dashboardConfiguration,a=t.dashboard,r=t.updateDashboard;return n.a.createElement("div",{className:"m-b-10 p-15 bg-white tiled"},n.a.createElement(Vl.a,{checked:!!a.dashboard_filters_enabled,onChange:e=>{var t=e.target;return r({dashboard_filters_enabled:t.checked})},"data-test":"DashboardFiltersCheckbox"},"Use Dashboard Level Filters"))}function hh(e){var t=e.dashboardConfiguration,a=e.className,r=mh(e,["dashboardConfiguration","className"]),i=t.showAddTextboxDialog,s=t.showAddWidgetDialog;return n.a.createElement("div",dh({className:me()("add-widget-container",a)},r),n.a.createElement("h2",null,n.a.createElement("i",{className:"zmdi zmdi-widgets","aria-hidden":"true"}),n.a.createElement("span",{className:"hidden-xs hidden-sm"},"Widgets are individual query visualizations or text boxes you can place on your dashboard in various arrangements.")),n.a.createElement("div",null,n.a.createElement(f.a,{className:"m-r-15",onClick:i,"data-test":"AddTextboxButton"},"Add Textbox"),n.a.createElement(f.a,{type:"primary",onClick:s,"data-test":"AddWidgetButton"},"Add Widget")))}function fh(e){var t=Jp(e.dashboard),a=t.dashboard,i=t.filters,s=t.setFilters,o=t.loadDashboard,l=t.loadWidget,u=t.removeWidget,d=t.saveDashboardLayout,m=t.globalParameters,p=t.updateDashboard,h=t.refreshDashboard,f=t.refreshWidget,b=t.editingLayout,g=t.setGridDisabled,y=ch(Object(r.useState)(null),2),v=y[0],O=y[1],E=ch(Object(r.useState)({}),2),j=E[0],w=E[1];return Object(r.useEffect)(()=>{if(v)return Ym(v,()=>{if(b){var e=window.getComputedStyle(v,null),t=v.getBoundingClientRect(),a=parseFloat(e.paddingLeft)||0,r=parseFloat(e.paddingRight)||0;w({left:Math.round(t.left)+r,width:v.clientWidth-a-r})}window.dispatchEvent(new Event("resize"))})},[v,b]),n.a.createElement("div",{className:"container",ref:O,"data-test":"DashboardId".concat(a.id,"Container")},n.a.createElement(lh,{dashboardConfiguration:t,headerExtra:n.a.createElement(le,{name:"Dashboard.HeaderExtra",dashboard:a,dashboardConfiguration:t})}),!Object(c.isEmpty)(m)&&n.a.createElement("div",{className:"dashboard-parameters m-b-10 p-15 bg-white tiled","data-test":"DashboardParameters"},n.a.createElement(Vu,{parameters:m,onValuesChange:h,sortable:b,onParametersEdit:e=>{var t=Object(c.map)(e,"name");p({options:{globalParamOrder:t}})}})),!Object(c.isEmpty)(i)&&n.a.createElement("div",{className:"m-b-10 p-15 bg-white tiled","data-test":"DashboardFilters"},n.a.createElement(nd,{filters:i,onChange:s})),b&&n.a.createElement(ph,{dashboardConfiguration:t}),n.a.createElement("div",{id:"dashboard-container"},n.a.createElement(Hm,{dashboard:a,widgets:a.widgets,filters:i,isEditing:b,onLayoutChange:b?d:()=>{},onBreakpointChange:g,onLoadWidget:l,onRefreshWidget:f,onRemoveWidget:u,onParameterMappingsChange:o})),b&&n.a.createElement(hh,{dashboardConfiguration:t,style:j}))}function bh(e){var t=e.dashboardSlug,a=e.dashboardId,i=e.onError,s=ch(Object(r.useState)(null),2),o=s[0],l=s[1],c=sd(i);return Object(r.useEffect)(()=>{La.get({id:a,slug:t}).then(e=>{mt("view","dashboard",e.id),l(e),a||q.setPath(Ke.parse(e.url).pathname,!0)}).catch(c)},[a,t,c]),n.a.createElement("div",{className:"dashboard-page"},o&&n.a.createElement(fh,{dashboard:o}))}function gh(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},i=Object.keys(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function yh(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function vh(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?yh(Object(a),!0).forEach((function(t){Oh(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):yh(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Oh(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function Eh(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);r=!0);}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return jh(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return jh(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function jh(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function wh(e){var t=e.apiKey,a=e.currentRoute,i=e.renderChildren,s=Eh(Object(r.useState)(!1),2),o=s[0],l=s[1],c=Object(r.useContext)(E.ErrorBoundaryContext).handleError;return Object(r.useEffect)(()=>{var e=!1;return X.setApiKey(t),X.loadConfig().then(()=>{e||l(!0)}).catch(()=>{e||l(!1)}),()=>{e=!0}},[t]),!o||H.disablePublicUrls?null:n.a.createElement(n.a.Fragment,{key:a.key},i(vh(vh({},a.routeParams),{},{pageTitle:a.title,onError:c,apiKey:t})))}function Sh(e){var t=e.render,a=e.getApiKey;return vh(vh({},gh(e,["render","getApiKey"])),{},{render:e=>n.a.createElement(wh,{apiKey:a(e),currentRoute:e,renderChildren:t})})}ph.propTypes={dashboardConfiguration:ae.a.object.isRequired},hh.propTypes={dashboardConfiguration:ae.a.object.isRequired,className:ae.a.string},fh.propTypes={dashboard:ae.a.object.isRequired},bh.propTypes={dashboardSlug:ae.a.string,dashboardId:ae.a.string,onError:ae.a.func},bh.defaultProps={dashboardSlug:null,dashboardId:null,onError:ae.a.func},pn.register("Dashboards.LegacyViewOrEdit",zr({path:"/dashboard/:dashboardSlug",render:e=>n.a.createElement(bh,e)})),pn.register("Dashboards.ViewOrEdit",zr({path:"/dashboards/:dashboardId([^-]+)(-.*)?",render:e=>n.a.createElement(bh,e)})),wh.propTypes={apiKey:ae.a.string.isRequired,renderChildren:ae.a.func},wh.defaultProps={renderChildren:()=>null};a(1563);function Ph(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function Ch(e){var t=e.dashboard,a=Jp(t),r=a.globalParameters,i=a.filters,s=a.setFilters,o=a.refreshDashboard,l=a.loadWidget,u=a.refreshWidget;return n.a.createElement("div",{className:"container p-t-10 p-b-20"},n.a.createElement(Cn,{title:t.name}),!Object(c.isEmpty)(r)&&n.a.createElement("div",{className:"m-b-10 p-15 bg-white tiled"},n.a.createElement(Vu,{parameters:r,onValuesChange:o})),!Object(c.isEmpty)(i)&&n.a.createElement("div",{className:"m-b-10 p-15 bg-white tiled"},n.a.createElement(nd,{filters:i,onChange:s})),n.a.createElement("div",{id:"dashboard-container"},n.a.createElement(Hm,{dashboard:t,widgets:t.widgets,filters:i,isEditing:!1,isPublic:!0,onLoadWidget:l,onRefreshWidget:u})))}Ch.propTypes={dashboard:ae.a.object.isRequired};class Nh extends n.a.Component{constructor(){super(...arguments),Ph(this,"state",{loading:!0,dashboard:null})}componentDidMount(){La.getByToken({token:this.props.token}).then(e=>this.setState({dashboard:e,loading:!1})).catch(e=>this.props.onError(e))}render(){var e=this.state,t=e.loading,a=e.dashboard;return n.a.createElement("div",{className:"public-dashboard-page"},t?n.a.createElement("div",{className:"container loading-message"},n.a.createElement(Ne,{className:"",icon:"fa-spinner fa-2x fa-pulse",message:"Loading..."})):n.a.createElement(Ch,{dashboard:a}),n.a.createElement("div",{id:"footer"},n.a.createElement("div",{className:"text-center"},n.a.createElement(O,{href:"https://redash.io"},n.a.createElement("img",{alt:"Redash Logo",src:nr.a,width:"38"}))),"Powered by ",n.a.createElement(O,{href:"https://redash.io/?ref=public-dashboard"},"Redash")))}}function kh(){return(kh=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function xh(e){return n.a.createElement("div",{className:"text-center"},n.a.createElement(Ne,kh({icon:"fa-search",message:"Sorry, we couldn't find anything."},e)))}Ph(Nh,"propTypes",{token:ae.a.string.isRequired,onError:ae.a.func}),Ph(Nh,"defaultProps",{onError:()=>{}}),pn.register("Dashboards.ViewShared",Sh({path:"/public/dashboards/:token",render:e=>n.a.createElement(Nh,e),getApiKey:e=>e.routeParams.token}));a(1564);function Ah(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);r=!0);}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return _h(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return _h(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _h(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function qh(){return(qh=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Th(e){var t=e.item,a=e.keySuffix,r={key:"card".concat(a),className:"visual-card",onClick:t.onClick,children:n.a.createElement(n.a.Fragment,null,n.a.createElement("img",{alt:t.title,src:t.imgSrc}),n.a.createElement("h3",null,t.title))};return t.href?n.a.createElement(O,qh({href:t.href},r)):n.a.createElement(fe,qh({type:"link"},r))}function Ih(e){var t=e.items,a=void 0===t?[]:t,i=e.showSearch,s=void 0!==i&&i,o=Ah(Object(r.useState)(""),2),l=o[0],u=o[1],d=a.filter(e=>Object(c.isEmpty)(l)||Object(c.includes)(e.title.toLowerCase(),l.toLowerCase()));return n.a.createElement("div",{"data-test":"CardsList"},s&&n.a.createElement("div",{className:"row p-10"},n.a.createElement("div",{className:"col-md-4 col-md-offset-4"},n.a.createElement(Fe.a.Search,{placeholder:"Search...","aria-label":"Search cards",onChange:e=>u(e.target.value),autoFocus:!0}))),Object(c.isEmpty)(d)?n.a.createElement(xh,{className:""}):n.a.createElement("div",{className:"row"},n.a.createElement("div",{className:"col-lg-12 d-inline-flex flex-wrap visual-card-list"},d.map((e,t)=>n.a.createElement(Th,{key:t,item:e,keySuffix:t.toString()})))))}Ih.propTypes={items:ae.a.arrayOf(ae.a.shape({title:ae.a.string.isRequired,imgSrc:ae.a.string.isRequired,onClick:ae.a.func,href:ae.a.string})),showSearch:ae.a.bool};var Dh=a(422),Rh=a.n(Dh),Mh=a(297),zh=a.n(Mh);function Fh(){return(Fh=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Uh(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},i=Object.keys(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function Vh(e){var t=e.collapsed,a=e.children,r=e.className,i=Uh(e,["collapsed","children","className"]);return n.a.createElement(zh.a,Fh({},i,{activeKey:t?null:"content",className:me()(r,"ant-collapse-headerless")}),n.a.createElement(zh.a.Panel,{key:"content",header:""},a))}function Lh(e){var t=e.title,a=e.name;return t||oi(a)}Vh.propTypes={collapsed:ae.a.bool,children:ae.a.node,className:ae.a.string},Vh.defaultProps={collapsed:!0,children:null,className:""};var Bh=a(293),Qh=a.n(Bh);a(1570);function Wh(){return(Wh=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}var Hh=Object(r.forwardRef)((function(e,t){return n.a.createElement("div",{className:"ace-editor-input","data-test":e["data-test"]},n.a.createElement(Qh.a,Wh({ref:t,mode:"sql",theme:"textmate",height:"100px",editorProps:{$blockScrolling:1/0},showPrintMargin:!1},e)))}));function Gh(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},i=Object.keys(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function Kh(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},i=Object.keys(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var Yh=a(699),$h=a.n(Yh),Jh=a(700),Xh=a.n(Jh);function Zh(){return(Zh=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function ef(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},i=Object.keys(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function tf(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},i=Object.keys(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function af(e){e.form,e.field;var t=tf(e,["form","field"]);return n.a.createElement(Fe.a,t)}function rf(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},i=Object.keys(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function nf(){return(nf=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function sf(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},i=Object.keys(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function of(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},i=Object.keys(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function lf(){return(lf=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function cf(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function uf(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?cf(Object(a),!0).forEach((function(t){df(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):cf(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function df(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function mf(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},i=Object.keys(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var pf=ae.a.shape({name:ae.a.string.isRequired,title:ae.a.string,type:ae.a.oneOf(["ace","text","textarea","email","password","number","checkbox","file","select","content"]).isRequired,initialValue:ae.a.oneOfType([ae.a.string,ae.a.number,ae.a.bool,ae.a.arrayOf(ae.a.string),ae.a.arrayOf(ae.a.number)]),content:ae.a.node,mode:ae.a.string,required:ae.a.bool,extra:ae.a.bool,readOnly:ae.a.bool,autoFocus:ae.a.bool,minLength:ae.a.number,placeholder:ae.a.string,contentAfter:ae.a.oneOfType([ae.a.node,ae.a.func]),loading:ae.a.bool,props:ae.a.object}),hf={checkbox:function(e){e.form;var t=e.field,a=Kh(e,["form","field"]),r=Lh(t);return n.a.createElement(Vl.a,a,r)},file:function(e){var t=e.form,a=e.field,r=ef(e,["form","field"]),i=a.name,s=a.initialValue,o=t.getFieldValue,l=void 0!==o(i)&&o(i)!==s;return n.a.createElement($h.a,Zh({},r,{beforeUpload:()=>!1}),n.a.createElement(f.a,{disabled:l},n.a.createElement(Xh.a,null)," Click to upload"))},select:function(e){e.form;var t=e.field,a=sf(e,["form","field"]),r=t.readOnly;return n.a.createElement(Li.a,nf({},a,{optionFilterProp:"children",loading:t.loading||!1,mode:t.mode,getPopupContainer:e=>e.parentNode}),t.options&&t.options.map(e=>n.a.createElement(Li.a.Option,{key:"".concat(e.value),value:e.value,disabled:r},e.name||e.value)))},number:function(e){e.form,e.field;var t=rf(e,["form","field"]);return n.a.createElement(Eo.a,t)},textarea:function(e){e.form,e.field;var t=of(e,["form","field"]);return n.a.createElement(Fe.a.TextArea,t)},ace:function(e){e.form,e.field;var t=Gh(e,["form","field"]);return n.a.createElement(Hh,t)},content:function(e){return e.field.content}};function ff(e){var t=e.form,a=e.field,r=mf(e,["form","field"]),i=a.name,s=a.type,o=a.readOnly,l=a.autoFocus,u=Lh(a),d=uf(uf({},a.props),{},{className:"w-100",name:i,type:s,readOnly:o,autoFocus:l,placeholder:a.placeholder,"data-test":u},r),m=Object(c.get)(hf,s,af);return n.a.createElement(m,lf({},d,{form:t,field:a}))}function bf(e,t,a){var r=new Array(t.length);return Object.keys(e).forEach(n=>{var i=t.indexOf(n),s={name:n,title:e[n].title,type:e[n].type,placeholder:Object(c.isNil)(e[n].default)?null:e[n].default.toString(),required:e[n].required,extra:e[n].extra,initialValue:a[n]};"select"===s.type&&(s.placeholder="Select an option",s.options=e[n].options),i>-1?r[i]=s:r.push(s)}),r}function gf(e){Object(c.each)(e.properties,(t,a)=>{"password"!==a&&"passwd"!==a||(t.type="password"),a.endsWith("File")&&(t.type="file"),"boolean"===t.type&&(t.type="checkbox"),"string"===t.type&&(t.type="text"),Object(c.isEmpty)(t.enum)||(t.type="select",t.options=Object(c.map)(t.enum,e=>({value:e,name:e}))),Object(c.isEmpty)(t.extendedEnum)||(t.type="select",t.options=t.extendedEnum),t.required=Object(c.includes)(e.required,a),t.extra=Object(c.includes)(e.extra_options,a)}),e.order=e.order||[]}function yf(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=e.properties;Object.keys(a).forEach(e=>{var r=a[e];if(Object(c.isUndefined)(r.default)||"checkbox"!==r.type||(t[e]=r.default),"select"===r.type){var n=Object(c.map)(r.options,e=>e.value);t[e]=Object(c.includes)(n,r.default)?r.default:n[0]}})}ff.propTypes={field:pf.isRequired};var vf={getFields:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{options:{}},a=e.configuration_schema;gf(a);var r=Object.keys(t.options).length>0;r||yf(a,t.options);var i=!t.id,s=[{name:"name",title:"Name",type:"text",required:!0,initialValue:t.name,contentAfter:n.a.createElement("hr"),placeholder:"My ".concat(e.name),autoFocus:i},...bf(a.properties,a.order,t.options)];return s},updateTargetWithValues:function(e,t){e.name=t.name,Object.keys(t).forEach(a=>{"name"!==a&&(e.options[a]=t[a])})},getBase64:function(e){return new Promise((t,a)=>{var r=new FileReader;r.readAsDataURL(e),r.onload=()=>t(r.result.substr(r.result.indexOf(",")+1)),r.onerror=e=>a(e)})},hasFilledExtraField:function(e,t){var a=Object(c.get)(e,"configuration_schema.extra_options",[]);return Object(c.some)(a,a=>{var r=Object(c.get)(e,["configuration_schema","properties",a,"default"]),n=Object(c.get)(t,["options",a]);return!Object(c.isNil)(n)&&n!==r})}};a(1595);function Of(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);r=!0);}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Ef(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Ef(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ef(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}var jf=ae.a.shape({name:ae.a.string.isRequired,callback:ae.a.func.isRequired,type:ae.a.string,pullRight:ae.a.bool,disabledWhenDirty:ae.a.bool}),wf=ae.a.shape({validateFieldsAndScroll:ae.a.func}),Sf=e=>{var t=e.type,a=e.required,r=e.minLength;return[a&&{required:a,message:"This field is required."},r&&Object(c.includes)(["text","email","password"],t)&&{min:r,message:"This field is too short."},"email"===t&&{type:"email",message:"This field must be a valid email."}].filter(e=>e)};function Pf(e){var t=e.fields,a=e.feedbackIcons,r=e.form;return t.map(e=>{var t=e.name,i=e.type,s=e.initialValue,o=e.contentAfter,l=Lh(e),u={name:t,className:"m-b-10",hasFeedback:"checkbox"!==i&&"file"!==i&&a,label:"checkbox"===i?"":l,rules:Sf(e),valuePropName:"checkbox"===i?"checked":"value",initialValue:s};return"file"===i&&(u.valuePropName="data-value",u.getValueFromEvent=e=>{e&&e.fileList[0]&&vf.getBase64(e.file).then(e=>{r.setFieldsValue({[t]:e})})}),n.a.createElement(n.a.Fragment,{key:t},n.a.createElement(co.a.Item,u,n.a.createElement(ff,{field:e,form:r})),Object(c.isFunction)(o)?o(r.getFieldValue(t)):o)})}Pf.propTypes={fields:ae.a.arrayOf(pf),feedbackIcons:ae.a.bool,form:wf.isRequired},Pf.defaultProps={fields:[],feedbackIcons:!1};var Cf=(e,t)=>(t.inProgress?e.add(t.actionName):e.delete(t.actionName),new Set(e));function Nf(e){var t=e.actions,a=e.isFormDirty,i=Of(Object(r.useReducer)(Cf,new Set),2),s=i[0],o=i[1],l=Object(r.useCallback)(e=>{var t=e.name;Object(c.isFunction)(e.callback)&&(o({actionName:t,inProgress:!0}),e.callback(()=>{o({actionName:t,inProgress:!1})}))},[]);return t.map(e=>n.a.createElement(f.a,{key:e.name,htmlType:"button",className:me()("m-t-10",{"pull-right":e.pullRight}),type:e.type,disabled:a&&e.disableWhenDirty,loading:s.has(e.name),onClick:()=>l(e)},e.name))}function kf(e){var t=e.id,a=e.fields,i=e.actions,s=e.feedbackIcons,o=e.hideSubmitButton,l=e.defaultShowExtraFields,u=e.saveText,d=e.onSubmit,m=Of(Object(r.useState)(!1),2),p=m[0],h=m[1],b=Of(Object(r.useState)(l),2),g=b[0],y=b[1],v=Of(co.a.useForm(),1)[0],O=Object(c.filter)(a,{extra:!0}),E=Object(c.difference)(a,O),j=Object(r.useCallback)(e=>{h(!0),e=function(e,t){return Object(c.mapValues)(t,(t,a)=>{var r=(Object(c.find)(e,{name:a})||{}).initialValue;return null!=r&&""!==r||""!==t?t:null})}(a,e),d(e,e=>{var t=v.setFieldsValue,a=v.getFieldsValue;h(!1),t(a()),en.success(e)},e=>{h(!1),en.error(e)})},[v,a,d]),w=Object(r.useCallback)(e=>{var t=e.errorFields;v.scrollToField(t[0].name)},[v]);return n.a.createElement(co.a,{form:v,id:t,className:"dynamic-form",layout:"vertical",onFinish:j,onFinishFailed:w},n.a.createElement(Pf,{fields:E,feedbackIcons:s,form:v}),!Object(c.isEmpty)(O)&&n.a.createElement("div",{className:"extra-options"},n.a.createElement(f.a,{type:"dashed",block:!0,className:"extra-options-button",onClick:()=>y(e=>!e)},"Additional Settings",n.a.createElement("i",{className:me()("fa m-l-5",{"fa-caret-up":g,"fa-caret-down":!g}),"aria-hidden":"true"})),n.a.createElement(Vh,{collapsed:!g,className:"extra-options-content"},n.a.createElement(Pf,{fields:O,feedbackIcons:s,form:v}))),!o&&n.a.createElement(f.a,{className:"w-100 m-t-20",type:"primary",htmlType:"submit",disabled:p},u),n.a.createElement(Nf,{actions:i,isFormDirty:v.isFieldsTouched()}))}function xf(){return(xf=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Af(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}Nf.propTypes={actions:ae.a.arrayOf(jf),isFormDirty:ae.a.bool},Nf.defaultProps={actions:[],isFormDirty:!1},kf.propTypes={id:ae.a.string,fields:ae.a.arrayOf(pf),actions:ae.a.arrayOf(jf),feedbackIcons:ae.a.bool,hideSubmitButton:ae.a.bool,defaultShowExtraFields:ae.a.bool,saveText:ae.a.string,onSubmit:ae.a.func},kf.defaultProps={id:null,fields:[],actions:[],feedbackIcons:!1,hideSubmitButton:!1,defaultShowExtraFields:!1,saveText:"Save",onSubmit:()=>{}};var _f=Rh.a.Step,qf=Fe.a.Search,Tf=0,If=1,Df=2;class Rf extends n.a.Component{constructor(){super(...arguments),Af(this,"state",{searchText:"",selectedType:null,savingSource:!1,currentStep:Tf}),Af(this,"formId",Object(c.uniqueId)("sourceForm")),Af(this,"selectType",e=>{this.setState({selectedType:e,currentStep:If})}),Af(this,"resetType",()=>{this.state.currentStep===If&&this.setState({searchText:"",selectedType:null,currentStep:Tf})}),Af(this,"createSource",(e,t,a)=>{var r=this.state,n=r.selectedType;r.savingSource||(this.setState({savingSource:!0,currentStep:Df}),this.props.onCreate(n,e).then(e=>{t("Saved."),this.props.dialog.close({success:!0,data:e})}).catch(e=>{this.setState({savingSource:!1,currentStep:If}),a(Object(c.get)(e,"response.data.message","Failed saving."))}))})}renderTypeSelector(){var e=this.props.types,t=this.state.searchText,a=e.filter(e=>Object(c.isEmpty)(t)||Object(c.includes)(e.name.toLowerCase(),t.toLowerCase()));return n.a.createElement("div",{className:"m-t-10"},n.a.createElement(qf,{placeholder:"Search...","aria-label":"Search",onChange:e=>this.setState({searchText:e.target.value}),autoFocus:!0,"data-test":"SearchSource"}),n.a.createElement("div",{className:"scrollbox p-5 m-t-10",style:{minHeight:"30vh",maxHeight:"40vh"}},Object(c.isEmpty)(a)?n.a.createElement(xh,{className:""}):n.a.createElement(Fs.a,{size:"small",dataSource:a,renderItem:e=>this.renderItem(e)})))}renderForm(){var e=this.props,t=e.imageFolder,a=e.helpTriggerPrefix,r=this.state.selectedType,i=vf.getFields(r),s="".concat(a).concat(Object(c.toUpper)(r.type));return n.a.createElement("div",null,n.a.createElement("div",{className:"d-flex justify-content-center align-items-center"},n.a.createElement("img",{className:"p-5",src:"".concat(t,"/").concat(r.type,".png"),alt:r.name,width:"48"}),n.a.createElement("h4",{className:"m-0"},r.name)),n.a.createElement("div",{className:"text-right"},Ie[s]&&n.a.createElement(Me,{className:"f-13",type:s},"Setup Instructions ",n.a.createElement("i",{className:"fa fa-question-circle","aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},"(help)"))),n.a.createElement(kf,{id:this.formId,fields:i,onSubmit:this.createSource,feedbackIcons:!0,hideSubmitButton:!0}),"databricks"===r.type&&n.a.createElement("small",null,"By using the Databricks Data Source you agree to the Databricks JDBC/ODBC"," ",n.a.createElement(O,{href:"https://databricks.com/spark/odbc-driver-download",target:"_blank",rel:"noopener noreferrer"},"Driver Download Terms and Conditions"),"."))}renderItem(e){var t=this.props.imageFolder;return n.a.createElement(Fs.a.Item,{className:"p-l-10 p-r-10 clickable",onClick:()=>this.selectType(e)},n.a.createElement(op,{title:e.name,imageUrl:"".concat(t,"/").concat(e.type,".png"),roundedImage:!1,"data-test":"PreviewItem","data-test-type":e.type},n.a.createElement("i",{className:"fa fa-angle-double-right","aria-hidden":"true"})))}render(){var e=this.state,t=e.currentStep,a=e.savingSource,r=this.props,i=r.dialog,s=r.sourceType;return n.a.createElement(z.a,xf({},i.props,{title:"Create a New ".concat(s),footer:t===Tf?[n.a.createElement(f.a,{key:"cancel",onClick:()=>i.dismiss(),"data-test":"CreateSourceCancelButton"},"Cancel"),n.a.createElement(f.a,{key:"submit",type:"primary",disabled:!0},"Create")]:[n.a.createElement(f.a,{key:"previous",onClick:this.resetType},"Previous"),n.a.createElement(f.a,{key:"submit",htmlType:"submit",form:this.formId,type:"primary",loading:a,"data-test":"CreateSourceSaveButton"},"Create")]}),n.a.createElement("div",{"data-test":"CreateSourceDialog"},n.a.createElement(Rh.a,{className:"hidden-xs m-b-10",size:"small",current:t,progressDot:!0},t===If?n.a.createElement(_f,{title:n.a.createElement("a",null,"Type Selection"),className:"clickable",onClick:this.resetType}):n.a.createElement(_f,{title:"Type Selection"}),n.a.createElement(_f,{title:"Configuration"}),n.a.createElement(_f,{title:"Done"})),t===Tf&&this.renderTypeSelector(),t!==Tf&&this.renderForm()))}}Af(Rf,"propTypes",{dialog:Qe.isRequired,types:ae.a.arrayOf(ae.a.object),sourceType:ae.a.string.isRequired,imageFolder:ae.a.string.isRequired,helpTriggerPrefix:ae.a.string,onCreate:ae.a.func.isRequired}),Af(Rf,"defaultProps",{types:[],helpTriggerPrefix:null});var Mf=We(Rf);var zf=function(e,t,a){return ar.add(e,t),function(e){var t=ar.getActiveItem(q.path);return n.a.createElement("div",{className:"settings-screen"},n.a.createElement("div",{className:"container"},n.a.createElement(Cn,{title:"Settings"}),n.a.createElement("div",{className:"bg-white tiled"},n.a.createElement(ue.a,{selectedKeys:[t&&t.title],selectable:!1,mode:"horizontal"},ar.getAvailableItems().map(e=>n.a.createElement(ue.a.Item,{key:e.title},n.a.createElement(O,{href:e.path,"data-test":"SettingsScreenItem"},e.title)))),n.a.createElement("div",{className:"p-15"},n.a.createElement("div",null,n.a.createElement(a,e))))))}};function Ff(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function Uf(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Ff(Object(a),!0).forEach((function(t){Vf(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Ff(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Vf(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function Lf(e){return Object(c.map)(e,e=>Object(c.isObject)(e)?e:{name:e})}var Bf={query:()=>Q.get("api/data_sources"),get:e=>{var t=e.id;return Q.get("api/data_sources/".concat(t))},types:()=>Q.get("api/data_sources/types"),create:e=>Q.post("api/data_sources",e),save:e=>Q.post("api/data_sources/".concat(e.id),e),test:e=>Q.post("api/data_sources/".concat(e.id,"/test")),delete:e=>{var t=e.id;return Q.delete("api/data_sources/".concat(t))},fetchSchema:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a={};return t&&(a.refresh=!0),Q.get("api/data_sources/".concat(e.id,"/schema"),{params:a}).then(e=>Object(c.has)(e,"job")?Lt(e.job.id).catch(t=>1===t.code?[]:Promise.reject(new Error(e.job.error))):Object(c.has)(e,"schema")?e.schema:Promise.reject()).then(e=>Object(c.map)(e,e=>Uf(Uf({},e),{},{columns:Lf(e.columns)})))}};function Qf(){return(Qf=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Wf(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}oe("DataSourcesListComponent",(function(e){var t=e.dataSources,a=e.onClickCreate,r=t.map(e=>({title:e.name,imgSrc:"".concat("static/images/db-logos","/").concat(e.type,".png"),href:"data_sources/".concat(e.id)}));return Object(c.isEmpty)(t)?n.a.createElement("div",{className:"text-center"},"There are no data sources yet.",Z.isCreateDataSourceEnabled()&&n.a.createElement("div",{className:"m-t-5"},n.a.createElement(fe,{type:"link",onClick:a,"data-test":"CreateDataSourceLink"},"Click here")," ","to add one.")):n.a.createElement(Ih,{items:r})}));class Hf extends n.a.Component{constructor(){var e;super(...arguments),e=this,Wf(this,"state",{dataSourceTypes:[],dataSources:[],loading:!0}),Wf(this,"newDataSourceDialog",null),Wf(this,"createDataSource",(e,t)=>{var a={options:{},type:e.type};return vf.updateTargetWithValues(a,t),Bf.create(a).then(e=>(this.setState({loading:!0}),Bf.query().then(e=>this.setState({dataSources:e,loading:!1})),e))}),Wf(this,"showCreateSourceDialog",()=>{mt("view","page","data_sources/new"),this.newDataSourceDialog=Mf.showModal({types:Object(c.reject)(this.state.dataSourceTypes,"deprecated"),sourceType:"Data Source",imageFolder:"static/images/db-logos",helpTriggerPrefix:"DS_",onCreate:this.createDataSource}),this.newDataSourceDialog.onClose((function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.newDataSourceDialog=null,t.success&&ct("data_sources/".concat(t.data.id))})).onDismiss(()=>{this.newDataSourceDialog=null,ct("data_sources",!0)})})}componentDidMount(){Promise.all([Bf.query(),Bf.types()]).then(e=>this.setState({dataSources:e[0],dataSourceTypes:e[1],loading:!1},()=>{this.props.isNewDataSourcePage&&(Z.canCreateDataSource()?this.showCreateSourceDialog():ct("data_sources",!0))})).catch(e=>this.props.onError(e))}componentWillUnmount(){this.newDataSourceDialog&&this.newDataSourceDialog.dismiss()}render(){var e={type:"primary",onClick:Z.isCreateDataSourceEnabled()?this.showCreateSourceDialog:null,disabled:!Z.isCreateDataSourceEnabled(),"data-test":"CreateDataSourceButton"};return n.a.createElement("div",null,n.a.createElement("div",{className:"m-b-15"},n.a.createElement(f.a,e,n.a.createElement("i",{className:"fa fa-plus m-r-5","aria-hidden":"true"}),"New Data Source"),n.a.createElement(le,{name:"DataSourcesListExtra"})),this.state.loading?n.a.createElement(Ts,{className:""}):n.a.createElement(le,{name:"DataSourcesListComponent",dataSources:this.state.dataSources,onClickCreate:this.showCreateSourceDialog}))}}Wf(Hf,"propTypes",{isNewDataSourcePage:ae.a.bool,onError:ae.a.func}),Wf(Hf,"defaultProps",{isNewDataSourcePage:!1,onError:()=>{}});var Gf=zf("DataSources.List",{permission:"admin",title:"Data Sources",path:"data_sources",order:1},Hf);function Kf(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}pn.register("DataSources.List",zr({path:"/data_sources",title:"Data Sources",render:e=>n.a.createElement(Gf,e)})),pn.register("DataSources.New",zr({path:"/data_sources/new",title:"Data Sources",render:e=>n.a.createElement(Gf,Qf({},e,{isNewDataSourcePage:!0}))}));class Yf extends n.a.Component{constructor(){super(...arguments),Kf(this,"state",{dataSource:null,type:null,loading:!0}),Kf(this,"saveDataSource",(e,t,a)=>{var r=this.state.dataSource;vf.updateTargetWithValues(r,e),Bf.save(r).then(()=>t("Saved.")).catch(e=>{var t=Object(c.get)(e,"response.data.message","Failed saving.");a(t)})}),Kf(this,"deleteDataSource",e=>{var t=this.state.dataSource;z.a.confirm({title:"Delete Data Source",content:"Are you sure you want to delete this data source?",okText:"Delete",okType:"danger",onOk:()=>{Bf.delete(t).then(()=>{en.success("Data source deleted successfully."),ct("data_sources")}).catch(()=>{e()})},onCancel:e,maskClosable:!0,autoFocusButton:null})}),Kf(this,"testConnection",e=>{var t=this.state.dataSource;Bf.test({id:t.id}).then(t=>{t.ok?en.success("Success"):en.error("Connection Test Failed:",t.message,{duration:10}),e()}).catch(()=>{en.error("Connection Test Failed:","Unknown error occurred while performing connection test. Please try again later.",{duration:10}),e()})})}componentDidMount(){Bf.get({id:this.props.dataSourceId}).then(e=>{var t=e.type;this.setState({dataSource:e}),Bf.types().then(e=>this.setState({type:Object(c.find)(e,{type:t}),loading:!1}))}).catch(e=>this.props.onError(e))}renderForm(){var e=this.state,t=e.dataSource,a=e.type,r=vf.getFields(a,t),i="DS_".concat(Object(c.toUpper)(a.type)),s={fields:r,type:a,actions:[{name:"Delete",type:"danger",callback:this.deleteDataSource},{name:"Test Connection",pullRight:!0,callback:this.testConnection,disableWhenDirty:!0}],onSubmit:this.saveDataSource,feedbackIcons:!0,defaultShowExtraFields:vf.hasFilledExtraField(a,t)};return n.a.createElement("div",{className:"row","data-test":"DataSource"},n.a.createElement("div",{className:"text-right m-r-10"},Ie[i]&&n.a.createElement(Me,{className:"f-13",type:i},"Setup Instructions ",n.a.createElement("i",{className:"fa fa-question-circle","aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},"(help)"))),n.a.createElement("div",{className:"text-center m-b-10"},n.a.createElement("img",{className:"p-5",src:"".concat("static/images/db-logos","/").concat(a.type,".png"),alt:a.name,width:"64"}),n.a.createElement("h3",{className:"m-0"},a.name)),n.a.createElement("div",{className:"col-md-4 col-md-offset-4 m-b-10"},n.a.createElement(kf,s)))}render(){return this.state.loading?n.a.createElement(Ts,{className:""}):this.renderForm()}}Kf(Yf,"propTypes",{dataSourceId:ae.a.string.isRequired,onError:ae.a.func}),Kf(Yf,"defaultProps",{onError:()=>{}});var $f=zf("DataSources.Edit",null,Yf);function Jf(){return(Jf=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Xf(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}pn.register("DataSources.Edit",zr({path:"/data_sources/:dataSourceId",title:"Data Sources",render:e=>n.a.createElement($f,e)}));class Zf extends n.a.Component{constructor(){super(...arguments),Xf(this,"state",{destinationTypes:[],destinations:[],loading:!0}),Xf(this,"createDestination",(e,t)=>{var a={options:{},type:e.type};return vf.updateTargetWithValues(a,t),Yo.create(a).then(e=>(this.setState({loading:!0}),Yo.query().then(e=>this.setState({destinations:e,loading:!1})),e))}),Xf(this,"showCreateSourceDialog",()=>{Mf.showModal({types:Object(c.reject)(this.state.destinationTypes,"deprecated"),sourceType:"Alert Destination",imageFolder:Ko,onCreate:this.createDestination}).onClose((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.success&&ct("destinations/".concat(e.data.id))})).onDismiss(()=>{ct("destinations",!0)})})}componentDidMount(){Promise.all([Yo.query(),Yo.types()]).then(e=>this.setState({destinations:e[0],destinationTypes:e[1],loading:!1},()=>{this.props.isNewDestinationPage&&(Z.canCreateDestination()?this.showCreateSourceDialog():ct("destinations",!0))})).catch(e=>this.props.onError(e))}renderDestinations(){var e=this.state.destinations,t=e.map(e=>({title:e.name,imgSrc:"".concat(Ko,"/").concat(e.type,".png"),href:"destinations/".concat(e.id)}));return Object(c.isEmpty)(e)?n.a.createElement("div",{className:"text-center"},"There are no alert destinations yet.",Z.isCreateDestinationEnabled()&&n.a.createElement("div",{className:"m-t-5"},n.a.createElement(fe,{type:"link",onClick:this.showCreateSourceDialog},"Click here")," ","to add one.")):n.a.createElement(Ih,{items:t})}render(){var e={type:"primary",onClick:Z.isCreateDestinationEnabled()?this.showCreateSourceDialog:null,disabled:!Z.isCreateDestinationEnabled()};return n.a.createElement("div",null,n.a.createElement("div",{className:"m-b-15"},n.a.createElement(f.a,e,n.a.createElement("i",{className:"fa fa-plus m-r-5","aria-hidden":"true"}),"New Alert Destination")),this.state.loading?n.a.createElement(Ts,{className:""}):this.renderDestinations())}}Xf(Zf,"propTypes",{isNewDestinationPage:ae.a.bool,onError:ae.a.func}),Xf(Zf,"defaultProps",{isNewDestinationPage:!1,onError:()=>{}});var eb=zf("AlertDestinations.List",{permission:"admin",title:"Alert Destinations",path:"destinations",order:4},Zf);function tb(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}pn.register("AlertDestinations.List",zr({path:"/destinations",title:"Alert Destinations",render:e=>n.a.createElement(eb,e)})),pn.register("AlertDestinations.New",zr({path:"/destinations/new",title:"Alert Destinations",render:e=>n.a.createElement(eb,Jf({},e,{isNewDestinationPage:!0}))}));class ab extends n.a.Component{constructor(){super(...arguments),tb(this,"state",{destination:null,type:null,loading:!0}),tb(this,"saveDestination",(e,t,a)=>{var r=this.state.destination;vf.updateTargetWithValues(r,e),Yo.save(r).then(()=>t("Saved.")).catch(e=>{var t=Object(c.get)(e,"response.data.message","Failed saving.");a(t)})}),tb(this,"deleteDestination",e=>{var t=this.state.destination;z.a.confirm({title:"Delete Alert Destination",content:"Are you sure you want to delete this alert destination?",okText:"Delete",okType:"danger",onOk:()=>{Yo.delete(t).then(()=>{en.success("Alert destination deleted successfully."),ct("destinations")}).catch(()=>{e()})},onCancel:e,maskClosable:!0,autoFocusButton:null})})}componentDidMount(){Yo.get({id:this.props.destinationId}).then(e=>{var t=e.type;this.setState({destination:e}),Yo.types().then(e=>this.setState({type:Object(c.find)(e,{type:t}),loading:!1}))}).catch(e=>this.props.onError(e))}renderForm(){var e=this.state,t=e.destination,a=e.type,r={fields:vf.getFields(a,t),type:a,actions:[{name:"Delete",type:"danger",callback:this.deleteDestination}],onSubmit:this.saveDestination,defaultShowExtraFields:vf.hasFilledExtraField(a,t),feedbackIcons:!0};return n.a.createElement("div",{className:"row","data-test":"Destination"},n.a.createElement("div",{className:"text-center m-b-10"},n.a.createElement("img",{className:"p-5",src:"".concat(Ko,"/").concat(a.type,".png"),alt:a.name,width:"64"}),n.a.createElement("h3",{className:"m-0"},a.name)),n.a.createElement("div",{className:"col-md-4 col-md-offset-4 m-b-10"},n.a.createElement(kf,r)))}render(){return this.state.loading?n.a.createElement(Ts,{className:""}):this.renderForm()}}tb(ab,"propTypes",{destinationId:ae.a.string.isRequired,onError:ae.a.func}),tb(ab,"defaultProps",{onError:()=>{}});var rb=zf("AlertDestinations.Edit",null,ab);function nb(){return(nb=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function ib(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}pn.register("AlertDestinations.Edit",zr({path:"/destinations/:destinationId",title:"Alert Destinations",render:e=>n.a.createElement(rb,e)}));class sb extends n.a.Component{constructor(){super(...arguments),ib(this,"state",{name:""}),ib(this,"save",()=>{this.props.dialog.close({name:this.state.name})})}render(){var e=this.props.dialog;return n.a.createElement(z.a,nb({},e.props,{title:"Create a New Group",okText:"Create",onOk:()=>this.save()}),n.a.createElement(Fe.a,{className:"form-control",defaultValue:this.state.name,onChange:e=>this.setState({name:e.target.value}),onPressEnter:()=>this.save(),placeholder:"Group Name","aria-label":"Group name",autoFocus:!0}))}}ib(sb,"propTypes",{dialog:Qe.isRequired});var ob=We(sb),lb={query:()=>Q.get("api/groups"),get:e=>{var t=e.id;return Q.get("api/groups/".concat(t))},create:e=>Q.post("api/groups",e),save:e=>Q.post("api/groups/".concat(e.id),e),delete:e=>Q.delete("api/groups/".concat(e.id)),members:e=>{var t=e.id;return Q.get("api/groups/".concat(t,"/members"))},addMember:(e,t)=>{var a=e.id;return Q.post("api/groups/".concat(a,"/members"),t)},removeMember:e=>{var t=e.id,a=e.userId;return Q.delete("api/groups/".concat(t,"/members/").concat(a))},dataSources:e=>{var t=e.id;return Q.get("api/groups/".concat(t,"/data_sources"))},addDataSource:(e,t)=>{var a=e.id;return Q.post("api/groups/".concat(a,"/data_sources"),t)},removeDataSource:e=>{var t=e.id,a=e.dataSourceId;return Q.delete("api/groups/".concat(t,"/data_sources/").concat(a))},updateDataSource:(e,t)=>{var a=e.id,r=e.dataSourceId;return Q.post("api/groups/".concat(a,"/data_sources/").concat(r),t)}};function cb(){return(cb=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function ub(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},i=Object.keys(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function db(e){var t=e.group,a=e.title,r=e.onClick,i=e.children,s=ub(e,["group","title","onClick","children"]);if(!t)return null;var o=n.a.createElement(f.a,cb({},s,{type:"danger",onClick:e=>function(e,t,a){z.a.confirm({title:"Delete Group",content:"Are you sure you want to delete this group?",okText:"Yes",okType:"danger",cancelText:"No",onOk:()=>{lb.delete(t).then(()=>{en.success("Group deleted successfully."),a()})}})}(0,t,r)}),i);return Object(c.isString)(a)&&""!==a?n.a.createElement(Oe,{placement:"top",title:a,mouseLeaveDelay:0},o):o}function mb(){return(mb=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function pb(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}db.propTypes={group:ae.a.object,title:ae.a.string,onClick:ae.a.func,children:ae.a.node},db.defaultProps={group:null,title:null,onClick:()=>{},children:null};class hb extends n.a.Component{constructor(){super(...arguments),pb(this,"listColumns",[gi.custom((e,t)=>n.a.createElement("div",null,n.a.createElement(O,{href:"groups/"+t.id},t.name),"builtin"===t.type&&n.a.createElement("span",{className:"label label-default m-l-10"},"built-in")),{field:"name",width:null}),gi.custom((e,t)=>n.a.createElement(f.a.Group,null,n.a.createElement(O.Button,{href:"groups/".concat(t.id)},"Members"),W.isAdmin&&n.a.createElement(O.Button,{href:"groups/".concat(t.id,"/data_sources")},"Data Sources")),{width:"1%",className:"text-nowrap"}),gi.custom((e,t)=>{var a="builtin"!==t.type;return n.a.createElement(db,{className:"w-100",disabled:!a,group:t,title:a?null:"Cannot delete built-in group",onClick:()=>this.onGroupDeleted()},"Delete")},{width:"1%",className:"text-nowrap p-l-0",isAvailable:()=>W.isAdmin})]),pb(this,"createGroup",()=>{ob.showModal().onClose(e=>lb.create(e).then(e=>ct("groups/".concat(e.id))))}),pb(this,"onGroupDeleted",()=>{this.props.controller.updatePagination({page:1}),this.props.controller.update()})}render(){var e=this.props.controller;return n.a.createElement("div",{"data-test":"GroupList"},W.isAdmin&&n.a.createElement("div",{className:"m-b-15"},n.a.createElement(f.a,{type:"primary",onClick:this.createGroup},n.a.createElement("i",{className:"fa fa-plus m-r-5","aria-hidden":"true"}),"New Group")),!e.isLoaded&&n.a.createElement(Ts,{className:""}),e.isLoaded&&e.isEmpty&&n.a.createElement(xh,{className:""}),e.isLoaded&&!e.isEmpty&&n.a.createElement("div",{className:"table-responsive"},n.a.createElement(yi,{items:e.pageItems,columns:this.listColumns,showHeader:!1,context:this.actions,orderByField:e.orderByField,orderByReverse:e.orderByReverse,toggleSorting:e.toggleSorting}),n.a.createElement(Ui,{showPageSizeSelect:!0,totalCount:e.totalItemsCount,pageSize:e.itemsPerPage,onPageSizeChange:t=>e.updatePagination({itemsPerPage:t}),page:e.page,onChange:t=>e.updatePagination({page:t})})))}}pb(hb,"propTypes",{controller:ds.isRequired});var fb=zf("Groups.List",{permission:"list_users",title:"Groups",path:"groups",order:3},ms(hb,()=>new Ns({isPlainList:!0,getRequest:()=>({}),getResource:()=>lb.query.bind(lb)}),()=>new As({orderByField:"name",itemsPerPage:10})));pn.register("Groups.List",zr({path:"/groups",title:"Groups",render:e=>n.a.createElement(fb,mb({},e,{currentPage:"groups"}))}));var bb=a(230),gb=a.n(bb);function yb(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},i=Object.keys(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function vb(e){var t=e.group,a=e.onChange,r=yb(e,["group","onChange"]);if(!t)return null;var i=W.isAdmin&&"builtin"!==t.type;return n.a.createElement("h3",r,n.a.createElement(eh,{className:"edit-in-place",isEditable:i,ignoreBlanks:!0,onDone:e=>function(e,t,a){e.name=t,lb.save(e),a()}(t,e,a),value:t.name}))}function Ob(e){var t=e.controller,a=e.group,r=e.items,i=e.canAddMembers,s=e.onAddMembersClick,o=e.canAddDataSources,l=e.onAddDataSourcesClick,c=e.onGroupDeleted,u=a&&W.isAdmin&&"builtin"!==a.type;return n.a.createElement(n.a.Fragment,null,n.a.createElement(Rl,{items:r,selected:t.params.currentPage}),i&&n.a.createElement(f.a,{className:"w-100 m-t-5",type:"primary",onClick:s},n.a.createElement("i",{className:"fa fa-plus m-r-5","aria-hidden":"true"}),"Add Members"),o&&n.a.createElement(f.a,{className:"w-100 m-t-5",type:"primary",onClick:l},n.a.createElement("i",{className:"fa fa-plus m-r-5","aria-hidden":"true"}),"Add Data Sources"),u&&n.a.createElement(n.a.Fragment,null,n.a.createElement(fo.a,{dashed:!0,className:"m-t-10 m-b-10"}),n.a.createElement(db,{className:"w-100",group:a,onClick:c},"Delete Group")))}function Eb(){return(Eb=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function jb(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}vb.propTypes={group:ae.a.shape({name:ae.a.string.isRequired}),onChange:ae.a.func},vb.defaultProps={group:null,onChange:()=>{}},Ob.propTypes={controller:ds.isRequired,group:ae.a.object,items:ae.a.array.isRequired,canAddMembers:ae.a.bool,onAddMembersClick:ae.a.func,canAddDataSources:ae.a.bool,onAddDataSourcesClick:ae.a.func,onGroupDeleted:ae.a.func},Ob.defaultProps={group:null,canAddMembers:!1,onAddMembersClick:null,canAddDataSources:!1,onAddDataSourcesClick:null,onGroupDeleted:null};class wb extends n.a.Component{constructor(){super(...arguments),jb(this,"groupId",parseInt(this.props.controller.params.groupId,10)),jb(this,"group",null),jb(this,"sidebarMenu",[{key:"users",href:"groups/".concat(this.groupId),title:"Members"},{key:"datasources",href:"groups/".concat(this.groupId,"/data_sources"),title:"Data Sources",isAvailable:()=>W.isAdmin}]),jb(this,"listColumns",[gi.custom((e,t)=>n.a.createElement(cp,{dataSource:t,withLink:!0}),{title:"Name",field:"name",width:null}),gi.custom((e,t)=>{var a=n.a.createElement(ue.a,{selectedKeys:[t.view_only?"viewonly":"full"],onClick:e=>this.setDataSourcePermissions(t,e.key)},n.a.createElement(ue.a.Item,{key:"full"},"Full Access"),n.a.createElement(ue.a.Item,{key:"viewonly"},"View Only"));return n.a.createElement(Nr.a,{trigger:["click"],overlay:a},n.a.createElement(f.a,{className:"w-100","aria-label":"Permissions"},t.view_only?"View Only":"Full Access",n.a.createElement(gb.a,{"aria-hidden":"true"})))},{width:"1%",className:"p-r-0",isAvailable:()=>W.isAdmin}),gi.custom((e,t)=>n.a.createElement(f.a,{className:"w-100",type:"danger",onClick:()=>this.removeGroupDataSource(t)},"Remove"),{width:"1%",isAvailable:()=>W.isAdmin})]),jb(this,"removeGroupDataSource",e=>{lb.removeDataSource({id:this.groupId,dataSourceId:e.id}).then(()=>{this.props.controller.updatePagination({page:1}),this.props.controller.update()}).catch(()=>{en.error("Failed to remove data source from group.")})}),jb(this,"setDataSourcePermissions",(e,t)=>{var a="full"!==t;lb.updateDataSource({id:this.groupId,dataSourceId:e.id},{view_only:a}).then(()=>{e.view_only=a,this.forceUpdate()}).catch(()=>{en.error("Failed change data source permissions.")})}),jb(this,"addDataSources",()=>{var e=Bf.query(),t=Object(c.map)(this.props.controller.allItems,e=>e.id);Go.showModal({dialogTitle:"Add Data Sources",inputPlaceholder:"Search data sources...",selectedItemsTitle:"New Data Sources",searchItems:t=>(t=Object(c.toLower)(t),e.then(e=>Object(c.filter)(e,e=>Object(c.includes)(Object(c.toLower)(e.name),t)))),renderItem:(e,a)=>{var r=a.isSelected,i=Object(c.includes)(t,e.id);return{content:n.a.createElement(cp,{dataSource:e},n.a.createElement(Jo,{isSelected:r,alreadyInGroup:i})),isDisabled:i,className:r||i?"selected":""}},renderStagedItem:(e,t)=>{var a=t.isSelected;return{content:n.a.createElement(cp,{dataSource:e},n.a.createElement(Jo,{isSelected:a,isStaged:!0}))}}}).onClose(e=>{var t=Object(c.map)(e,e=>lb.addDataSource({id:this.groupId},{data_source_id:e.id}));return Promise.all(t).then(()=>this.props.controller.update())})})}componentDidMount(){lb.get({id:this.groupId}).then(e=>{this.group=e,this.forceUpdate()}).catch(e=>{this.props.controller.handleError(e)})}render(){var e=this.props.controller;return n.a.createElement("div",{"data-test":"Group"},n.a.createElement(vb,{className:"d-block m-t-0 m-b-15",group:this.group,onChange:()=>this.forceUpdate()}),n.a.createElement(Xl,null,n.a.createElement(Xl.Sidebar,null,n.a.createElement(Ob,{controller:e,group:this.group,items:this.sidebarMenu,canAddDataSources:W.isAdmin,onAddDataSourcesClick:this.addDataSources,onGroupDeleted:()=>ct("groups")})),n.a.createElement(Xl.Content,null,!e.isLoaded&&n.a.createElement(Ts,{className:""}),e.isLoaded&&e.isEmpty&&n.a.createElement("div",{className:"text-center"},n.a.createElement("p",null,"There are no data sources in this group yet."),W.isAdmin&&n.a.createElement(f.a,{type:"primary",onClick:this.addDataSources},n.a.createElement("i",{className:"fa fa-plus m-r-5","aria-hidden":"true"}),"Add Data Sources")),e.isLoaded&&!e.isEmpty&&n.a.createElement("div",{className:"table-responsive"},n.a.createElement(yi,{items:e.pageItems,columns:this.listColumns,showHeader:!1,context:this.actions,orderByField:e.orderByField,orderByReverse:e.orderByReverse,toggleSorting:e.toggleSorting}),n.a.createElement(Ui,{showPageSizeSelect:!0,totalCount:e.totalItemsCount,pageSize:e.itemsPerPage,onPageSizeChange:t=>e.updatePagination({itemsPerPage:t}),page:e.page,onChange:t=>e.updatePagination({page:t})})))))}}jb(wb,"propTypes",{controller:ds.isRequired});var Sb=zf("Groups.DataSources",null,ms(wb,()=>new Ns({isPlainList:!0,getRequest:(e,t)=>({id:t.params.groupId}),getResource:()=>lb.dataSources.bind(lb)}),()=>new As({orderByField:"name"})));function Pb(){return(Pb=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Cb(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}pn.register("Groups.DataSources",zr({path:"/groups/:groupId/data_sources",title:"Group Data Sources",render:e=>n.a.createElement(Sb,Eb({},e,{currentPage:"datasources"}))}));class Nb extends n.a.Component{constructor(){super(...arguments),Cb(this,"groupId",parseInt(this.props.controller.params.groupId,10)),Cb(this,"group",null),Cb(this,"sidebarMenu",[{key:"users",href:"groups/".concat(this.groupId),title:"Members"},{key:"datasources",href:"groups/".concat(this.groupId,"/data_sources"),title:"Data Sources",isAvailable:()=>W.isAdmin}]),Cb(this,"listColumns",[gi.custom((e,t)=>n.a.createElement(lp,{user:t,withLink:!0}),{title:"Name",field:"name",width:null}),gi.custom((e,t)=>this.group?"builtin"===this.group.type&&W.id===t.id?null:n.a.createElement(f.a,{className:"w-100",type:"danger",onClick:e=>this.removeGroupMember(e,t)},"Remove"):null,{width:"1%",isAvailable:()=>W.isAdmin})]),Cb(this,"removeGroupMember",(e,t)=>lb.removeMember({id:this.groupId,userId:t.id}).then(()=>{this.props.controller.updatePagination({page:1}),this.props.controller.update()}).catch(()=>{en.error("Failed to remove member from group.")})),Cb(this,"addMembers",()=>{var e=Object(c.map)(this.props.controller.allItems,e=>e.id);Go.showModal({dialogTitle:"Add Members",inputPlaceholder:"Search users...",selectedItemsTitle:"New Members",searchItems:e=>fp.query({q:e}).then(e=>e.results),renderItem:(t,a)=>{var r=a.isSelected,i=Object(c.includes)(e,t.id);return{content:n.a.createElement(lp,{user:t},n.a.createElement(Jo,{isSelected:r,alreadyInGroup:i})),isDisabled:i,className:r||i?"selected":""}},renderStagedItem:(e,t)=>{var a=t.isSelected;return{content:n.a.createElement(lp,{user:e},n.a.createElement(Jo,{isSelected:a,isStaged:!0}))}}}).onClose(e=>{var t=Object(c.map)(e,e=>lb.addMember({id:this.groupId},{user_id:e.id}));return Promise.all(t).then(()=>this.props.controller.update())})})}componentDidMount(){lb.get({id:this.groupId}).then(e=>{this.group=e,this.forceUpdate()}).catch(e=>{this.props.controller.handleError(e)})}render(){var e=this.props.controller;return n.a.createElement("div",{"data-test":"Group"},n.a.createElement(vb,{className:"d-block m-t-0 m-b-15",group:this.group,onChange:()=>this.forceUpdate()}),n.a.createElement(Xl,null,n.a.createElement(Xl.Sidebar,null,n.a.createElement(Ob,{controller:e,group:this.group,items:this.sidebarMenu,canAddMembers:W.isAdmin,onAddMembersClick:this.addMembers,onGroupDeleted:()=>ct("groups")})),n.a.createElement(Xl.Content,null,!e.isLoaded&&n.a.createElement(Ts,{className:""}),e.isLoaded&&e.isEmpty&&n.a.createElement("div",{className:"text-center"},n.a.createElement("p",null,"There are no members in this group yet."),W.isAdmin&&n.a.createElement(f.a,{type:"primary",onClick:this.addMembers},n.a.createElement("i",{className:"fa fa-plus m-r-5","aria-hidden":"true"}),"Add Members")),e.isLoaded&&!e.isEmpty&&n.a.createElement("div",{className:"table-responsive"},n.a.createElement(yi,{items:e.pageItems,columns:this.listColumns,showHeader:!1,context:this.actions,orderByField:e.orderByField,orderByReverse:e.orderByReverse,toggleSorting:e.toggleSorting}),n.a.createElement(Ui,{showPageSizeSelect:!0,totalCount:e.totalItemsCount,pageSize:e.itemsPerPage,onPageSizeChange:t=>e.updatePagination({itemsPerPage:t}),page:e.page,onChange:t=>e.updatePagination({page:t})})))))}}Cb(Nb,"propTypes",{controller:ds.isRequired});var kb=zf("Groups.Members",null,ms(Nb,()=>new Ns({isPlainList:!0,getRequest:(e,t)=>({id:t.params.groupId}),getResource:()=>lb.members.bind(lb)}),()=>new As({orderByField:"name"})));function xb(e){var t=e.page,a=e.searchTerm,r=e.selectedTags;if(""!==a)return n.a.createElement(Ne,{message:"Sorry, we couldn't find anything.",icon:"fa-search"});if(r.length>0)return n.a.createElement(Zl,{objectType:"queries",tags:r});switch(t){case"favorites":return n.a.createElement(Ne,{message:"Mark queries as Favorite to list them here.",icon:"fa-star"});case"archive":return n.a.createElement(Ne,{message:"Archived queries will be listed here.",icon:"fa-archive"});case"my":var i=W.hasPermission("create_query")?n.a.createElement("span",null,n.a.createElement(O.Button,{href:"queries/new",type:"primary",size:"small"},"Create your first query!")," ",n.a.createElement(Me,{className:"f-13",type:"QUERIES",showTooltip:!1},"Need help?")):n.a.createElement("span",null,"Sorry, we couldn't find anything.");return n.a.createElement(Ne,{icon:"fa-search"},i);default:return n.a.createElement(le,{name:"QueriesList.EmptyState"},n.a.createElement(Br,{icon:"fa fa-code",illustration:"query",description:"Getting the data from your datasources.",helpMessage:n.a.createElement(Vr,{helpTriggerType:"QUERIES"})}))}}pn.register("Groups.Members",zr({path:"/groups/:groupId",title:"Group Members",render:e=>n.a.createElement(kb,Pb({},e,{currentPage:"users"}))})),xb.propTypes={page:ae.a.string.isRequired,searchTerm:ae.a.string.isRequired,selectedTags:ae.a.array.isRequired};a(1596);function Ab(){return(Ab=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}var _b=[{key:"all",href:"queries",title:"All Queries",icon:()=>n.a.createElement(Ml,{icon:"fa fa-code"})},{key:"my",href:"queries/my",title:"My Queries",icon:()=>n.a.createElement(zl,{user:W})},{key:"favorites",href:"queries/favorites",title:"Favorites",icon:()=>n.a.createElement(Ml,{icon:"fa fa-star"})},{key:"archive",href:"queries/archive",title:"Archived",icon:()=>n.a.createElement(Ml,{icon:"fa fa-archive"})}],qb=[gi.favorites({className:"p-r-0"}),gi.custom.sortable((e,t)=>n.a.createElement(n.a.Fragment,null,n.a.createElement(O,{className:"table-main-title",href:"queries/"+t.id},t.name),n.a.createElement(Xi,{className:"d-block",tags:t.tags,isDraft:t.is_draft,isArchived:t.is_archived})),{title:"Name",field:"name",width:null}),gi.custom((e,t)=>t.user.name,{title:"Created By",width:"1%"}),gi.dateTime.sortable({title:"Created At",field:"created_at",width:"1%"}),gi.dateTime.sortable({title:"Last Executed At",field:"retrieved_at",orderByField:"executed_at",width:"1%"}),gi.custom.sortable((e,t)=>n.a.createElement(rs,{schedule:t.schedule,isNew:t.isNew()}),{title:"Refresh Schedule",field:"schedule",width:"1%"})];function Tb(e){return n.a.createElement(le,Ab({name:"QueriesList.Actions"},e))}function Ib(e){var t=e.controller,a=Object(r.useRef)();a.current=t,Object(r.useEffect)(()=>{var e=q.listen((e,t)=>{var r=q.search.q||"";"PUSH"===t&&r!==a.current.searchTerm&&a.current.updateSearch(r)});return()=>{e()}},[]);var i=Wl(t,qb,Tb),s=i.areExtraActionsAvailable,o=i.listColumns,l=i.Component,c=i.selectedItems;return n.a.createElement("div",{className:"page-queries-list"},n.a.createElement("div",{className:"container"},n.a.createElement(Cn,{title:t.params.pageTitle,actions:W.hasPermission("create_query")?n.a.createElement(O.Button,{block:!0,type:"primary",href:"queries/new"},n.a.createElement("i",{className:"fa fa-plus m-r-5","aria-hidden":"true"}),"New Query"):null}),n.a.createElement(Xl,null,n.a.createElement(Xl.Sidebar,{className:"m-b-0"},n.a.createElement(Dl,{placeholder:"Search Queries...",label:"Search queries",value:t.searchTerm,onChange:t.updateSearch}),n.a.createElement(Rl,{items:_b,selected:t.params.currentPage}),n.a.createElement(Fl,{url:"api/queries/tags",onChange:t.updateSelectedTags,showUnselectAll:!0})),n.a.createElement(Xl.Content,null,t.isLoaded&&t.isEmpty?n.a.createElement(xb,{page:t.params.currentPage,searchTerm:t.searchTerm,selectedTags:t.selectedTags}):n.a.createElement(n.a.Fragment,null,n.a.createElement("div",{className:me()({"m-b-10":s})},n.a.createElement(l,{selectedItems:c})),n.a.createElement("div",{className:"bg-white tiled table-responsive"},n.a.createElement(yi,{items:t.pageItems,loading:!t.isLoaded,columns:o,orderByField:t.orderByField,orderByReverse:t.orderByReverse,toggleSorting:t.toggleSorting}),n.a.createElement(Ui,{showPageSizeSelect:!0,totalCount:t.totalItemsCount,pageSize:t.itemsPerPage,onPageSizeChange:e=>t.updatePagination({itemsPerPage:e}),page:t.page,onChange:e=>t.updatePagination({page:e})})))))))}Ib.propTypes={controller:ds.isRequired};var Db=ms(Ib,()=>new Ns({getResource(e){var t=e.params.currentPage;return{all:Xt.query.bind(Xt),my:Xt.myQueries.bind(Xt),favorites:Xt.favorites.bind(Xt),archive:Xt.archive.bind(Xt)}[t]},getItemProcessor:()=>e=>new Xt(e)}),()=>new _s({orderByField:"created_at",orderByReverse:!0}));pn.register("Queries.List",zr({path:"/queries",title:"Queries",render:e=>n.a.createElement(Db,Ab({},e,{currentPage:"all"}))})),pn.register("Queries.Favorites",zr({path:"/queries/favorites",title:"Favorite Queries",render:e=>n.a.createElement(Db,Ab({},e,{currentPage:"favorites"}))})),pn.register("Queries.Archived",zr({path:"/queries/archive",title:"Archived Queries",render:e=>n.a.createElement(Db,Ab({},e,{currentPage:"archive"}))})),pn.register("Queries.My",zr({path:"/queries/my",title:"My Queries",render:e=>n.a.createElement(Db,Ab({},e,{currentPage:"my"}))}));var Rb=a(134),Mb=a.n(Rb),zb=a(423),Fb=a.n(zb),Ub=a(415);a(1601);function Vb(){return(Vb=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Lb(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function Bb(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Lb(Object(a),!0).forEach((function(t){Qb(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Lb(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Qb(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function Wb(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);r=!0);}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Hb(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Hb(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Hb(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function Gb(e){var t=e.toggleShortcut,a=e.direction,i=e.sizeAttribute,s=e.children,o=Wb(Object(r.useState)(0),2),l=o[0],c=o[1],u=Object(r.useRef)(),d=Object(r.useRef)(!1),m=Object(r.useRef)(!1),p="horizontal"===a?"width":"height";i=i||p;var h=Object(r.useCallback)(()=>u.current?Math.floor(u.current.getBoundingClientRect()[p]):0,[p]),f=Object(r.useRef)(null),b=Object(r.useCallback)(()=>{if(u.current){var e,t=Fb.a.select(u.current);null===f.current?(e="0px",f.current="".concat(h(),"px")):(e=f.current,f.current=null),t.style(i,f.current||"0px").transition().duration(200).ease("swing").style(i,e),c(parseInt(e)||0)}},[h,i]),g=Object(r.useMemo)(()=>n.a.createElement("span",{className:"react-resizable-handle react-resizable-handle-".concat(a),role:"separator",onClick:()=>{!d.current&&m.current||b(),d.current=!1,m.current=!1}}),[a,b]);Object(r.useEffect)(()=>{if(t){var e={[t]:b};return yc.bind(e),()=>{yc.unbind(e)}}},[t,b]);var y=Object(r.useMemo)(()=>({onResizeStart:()=>{c(h())},onResize:(e,t)=>{Fb.a.select(u.current).style(i,"".concat(t.size[p],"px")),c(t.size[p]),m.current=!0},onResizeStop:()=>{m.current&&(f.current=null)}}),[p,h,i]),v=Object(r.useMemo)(()=>({onMouseDown:e=>{"touchstart"===e.type&&(d.current=!0),c(h())}}),[h]);return s?(s=n.a.createElement(s.type,Bb(Bb({},s.props),{},{ref:u})),n.a.createElement(Ub.Resizable,Vb({className:"resizable-component",axis:"horizontal"===a?"x":"y",resizeHandles:["horizontal"===a?"e":"s"],handle:g,width:"horizontal"===a?l:0,height:"vertical"===a?l:0,minConstraints:[0,0]},y,{draggableOpts:v}),s)):null}Gb.propTypes={direction:ae.a.oneOf(["horizontal","vertical"]),sizeAttribute:ae.a.string,toggleShortcut:ae.a.string,children:ae.a.element},Gb.defaultProps={direction:"horizontal",sizeAttribute:null,toggleShortcut:null,children:null};var Kb=a(701),Yb=a.n(Kb),$b={sql:e=>Yb.a.format(Object(c.trim)(e)),json:e=>JSON.stringify(JSON.parse(e),null,4)};function Jb(e){return e in $b}function Xb(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return t=t||{view_only:!0},Object(r.useMemo)(()=>({isNew:Object(c.isNil)(e.id),isDraft:e.is_draft,isArchived:e.is_archived,canCreate:W.hasPermission("create_query"),canView:W.hasPermission("view_query"),canEdit:W.hasPermission("edit_query")&&Z.canEdit(e),canViewSource:W.hasPermission("view_source"),canExecute:!Object(c.isEmpty)(e.query)&&Z.canRun(e)&&(e.is_safe||W.hasPermission("execute_query")&&!t.view_only),canFork:W.hasPermission("edit_query")&&!t.view_only,canSchedule:W.hasPermission("schedule_query")}),[e,t.view_only])}function Zb(e,t){var a=sd(t);return Object(r.useCallback)(()=>{new Promise((e,t)=>{z.a.confirm({title:"Archive Query",content:n.a.createElement(n.a.Fragment,null,n.a.createElement("div",{className:"m-b-5"},"Are you sure you want to archive this query?"),n.a.createElement("div",null,"All alerts and dashboard widgets created with its visualizations will be deleted.")),okText:"Archive",okType:"danger",onOk:()=>{e()},onCancel:()=>{t()},maskClosable:!0,autoFocusButton:null})}).then(()=>function(e){return Xt.delete({id:e.id}).then(()=>Object(c.extend)(e.clone(),{is_archived:!0,schedule:null})).catch(e=>(en.error("Query could not be archived."),Promise.reject(e)))}(e)).then(a)},[e,a])}function eg(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function tg(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?eg(Object(a),!0).forEach((function(t){ag(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):eg(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function ag(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class rg extends(function(e){function t(){var t=Reflect.construct(e,Array.from(arguments));return Object.setPrototypeOf(t,Object.getPrototypeOf(this)),t}return t.prototype=Object.create(e.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e,t}(Error)){constructor(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;super(e),this.detailedMessage=t}}class ng extends rg{constructor(){super("Changes not saved",n.a.createElement(n.a.Fragment,null,n.a.createElement("div",{className:"m-b-5"},"It seems like the query has been modified by another user."),n.a.createElement("div",null,"Please copy/backup your changes and reload this page.")))}}function ig(){return new Promise((e,t)=>{z.a.confirm({title:"Overwrite Query",content:n.a.createElement(n.a.Fragment,null,n.a.createElement("div",{className:"m-b-5"},"It seems like the query has been modified by another user."),n.a.createElement("div",null,"Are you sure you want to overwrite the query with your version?")),okText:"Overwrite",okType:"danger",onOk:()=>{e()},onCancel:()=>{t()},maskClosable:!0,autoFocusButton:null})})}function sg(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=t.canOverwrite,r=void 0!==a&&a;return Object(c.isObject)(e.options)&&e.options.parameters&&(e.options=tg(tg({},e.options),{},{parameters:Object(c.map)(e.options.parameters,e=>e.toSaveableObject())})),Xt.save(e).catch(t=>409===Object(c.get)(t,"response.status")?r?ig().then(()=>Xt.save(Object(c.omit)(e,["version"]))).catch(()=>Promise.reject(new ng)):Promise.reject(new ng):Promise.reject(new rg("Query could not be saved")))}function og(e,t){var a=sd(t);return Object(r.useCallback)((function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=r.successMessage,i=void 0===n?"Query saved":n;if(Object(c.isObject)(t)){if(e.isNew())return void a(Object(c.extend)(e.clone(),t));t=tg(tg({},t),{},{id:e.id,version:e.version})}else t=Object(c.pick)(e,["id","version","schedule","query","description","name","data_source_id","options","latest_query_data_id","is_draft","tags"]);return sg(t,{canOverwrite:Z.canEdit(e)}).then(r=>{Object(c.isNil)(i)||en.success(i),a(Object(c.extend)(e.clone(),r.id!==e.id?r:Object(c.pick)(r,Object(c.uniq)(["id","version",...Object(c.keys)(t)]))))}).catch(e=>{var t={};e instanceof ng&&(t.duration=null),en.error(e.message,e.detailedMessage,t)})}),[e,a])}var lg=a(424),cg=a.n(lg);function ug(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);r=!0);}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return dg(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return dg(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function dg(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function mg(e){var t=ug(Object(r.useState)(!1),2),a=t[0],n=t[1],i=Object(r.useCallback)(()=>{var t="duplicatedQueryTab/".concat(Math.random().toString()),a=window.open("",t);n(!0),Xt.fork({id:e.id}).then(e=>{a.location=function(e){var t=C.a.parse(window.location.search);e=cg.a.parse(e);var a=C.a.parse(e.search);return cg.a.format(Object(c.extend)(Object(c.pick)(e,["protocol","auth","host","pathname","hash"]),{search:C.a.stringify(Object(c.extend)(t,a))}))}(e.getUrl(!0))}).finally(()=>{n(!1)})},[e.id]);return[a,a?c.noop:i]}a(1660);function pg(){return(pg=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function hg(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},i=Object.keys(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function fg(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class bg extends n.a.Component{constructor(e){super(e),fg(this,"state",{copied:null}),fg(this,"copy",()=>{window.getSelection().selectAllChildren(this.ref.current);try{if(!document.execCommand("copy"))throw new Error;this.setState({copied:"Copied!"})}catch(e){this.setState({copied:"Copy failed"})}window.getSelection().removeAllRanges(),this.resetCopyState=setTimeout(()=>this.setState({copied:null}),2e3)}),this.ref=n.a.createRef(),this.copyFeatureEnabled=e.copyable&&document.queryCommandSupported("copy"),this.resetCopyState=null}componentWillUnmount(){this.resetCopyState&&clearTimeout(this.resetCopyState)}render(){var e=this.props,t=(e.copyable,e.children),a=hg(e,["copyable","children"]),r=n.a.createElement(Oe,{title:this.state.copied||"Copy"},n.a.createElement(f.a,{icon:n.a.createElement(Pp.a,null),type:"dashed",size:"small",onClick:this.copy}));return n.a.createElement("div",{className:"code-block"},n.a.createElement("code",pg({},a,{ref:this.ref}),t),this.copyFeatureEnabled&&r)}}fg(bg,"propTypes",{copyable:ae.a.bool,children:ae.a.node}),fg(bg,"defaultProps",{copyable:!1,children:null});a(1661);function gg(){return(gg=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function yg(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);r=!0);}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return vg(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return vg(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function vg(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function Og(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},i=Object.keys(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function Eg(e){var t=e.dialog,a=Og(e,["dialog"]),i=yg(Object(r.useState)(a.query),2),s=i[0],o=i[1],l=yg(Object(r.useState)(!1),2),u=l[0],d=l[1],m=Object(r.useCallback)(()=>{d(!0),Q.post("api/queries/".concat(s.id,"/regenerate_api_key")).then(e=>{d(!1),o(Object(c.extend)(s.clone(),{api_key:e.api_key}))}).catch(()=>{d(!1),en.error("Failed to update API key")})},[s]),p=Object(r.useMemo)(()=>({csvUrl:"".concat(H.basePath,"api/queries/").concat(s.id,"/results.csv?api_key=").concat(s.api_key),jsonUrl:"".concat(H.basePath,"api/queries/").concat(s.id,"/results.json?api_key=").concat(s.api_key)}),[s.id,s.api_key]),h=p.csvUrl,b=p.jsonUrl,g=Pe("csv-results-label"),y=Pe("json-results-label");return n.a.createElement(z.a,gg({},t.props,{width:600,footer:n.a.createElement(f.a,{onClick:()=>t.close(s)},"Close")}),n.a.createElement("div",{className:"query-api-key-dialog-wrapper"},n.a.createElement("h5",null,"API Key"),n.a.createElement("div",{className:"m-b-20"},n.a.createElement(Fe.a.Group,{compact:!0},n.a.createElement(Fe.a,{readOnly:!0,value:s.api_key,"aria-label":"Query API Key"}),Z.canEdit(s)&&n.a.createElement(f.a,{disabled:u,loading:u,onClick:m},"Regenerate"))),n.a.createElement("h5",null,"Example API Calls:"),n.a.createElement("div",{className:"m-b-10"},n.a.createElement("span",{id:g},"Results in CSV format:"),n.a.createElement(bg,{"aria-labelledby":g,copyable:!0},h)),n.a.createElement("div",null,n.a.createElement("span",{id:y},"Results in JSON format:"),n.a.createElement(bg,{"aria-labelledby":y,copyable:!0},b))))}Eg.propTypes={dialog:Qe.isRequired,query:ae.a.shape({id:ae.a.number.isRequired,api_key:ae.a.string,can_edit:ae.a.bool}).isRequired};var jg=We(Eg);a(1662);function wg(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);r=!0);}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Sg(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Sg(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Sg(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function Pg(){return xl("api/queries/tags").then(e=>Object(c.map)(e,e=>e.name))}function Cg(e){var t=e.query,a=e.dataSource,i=e.sourceMode,s=e.selectedVisualization,o=e.headerExtra,l=e.tagsExtra,u=e.onChange,d=Mb()({minWidth:768}),m=Xb(t,a),p=function(e,t){var a=og(e,t);return Object(r.useCallback)(t=>{mt("edit_name","query",e.id);var r={name:t},n={};e.is_draft&&H.autoPublishNamedQueries&&"New Query"!==t&&(r.is_draft=!1,n.successMessage="Query saved and published"),a(r,n)},[e.id,e.is_draft,a])}(t,u),h=function(e,t){var a=og(e,t);return Object(r.useCallback)(t=>{mt("edit_tags","query",e.id),a({tags:t})},[e.id,a])}(t,u),b=Zb(t,u),g=function(e,t){var a=og(e,t);return Object(r.useCallback)(()=>{mt("toggle_published","query",e.id),a({is_draft:!1})},[e.id,a])}(t,u),y=function(e,t){var a=og(e,t);return Object(r.useCallback)(()=>{mt("toggle_published","query",e.id),a({is_draft:!0})},[e.id,a])}(t,u),v=wg(mg(t),2),E=v[0],j=v[1],w=function(e,t){var a=sd(t);return Object(r.useCallback)(()=>{jg.showModal({query:e}).onClose(a)},[e,a])}(t,u),S=function(e){return Object(r.useCallback)(()=>{wp.showModal({aclUrl:"api/queries/".concat(e.id,"/acl"),context:"query",author:e.user})},[e.id,e.user])}(t),P=Object(r.useMemo)(()=>{return e=[{fork:{isEnabled:!m.isNew&&m.canFork&&!E,title:n.a.createElement(n.a.Fragment,null,"Fork ",n.a.createElement("i",{className:"fa fa-external-link m-l-5","aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},"(opens in a new tab)")),onClick:j}},{archive:{isAvailable:!m.isNew&&m.canEdit&&!m.isArchived,title:"Archive",onClick:b},managePermissions:{isAvailable:!m.isNew&&m.canEdit&&!m.isArchived&&H.showPermissionsControl,title:"Manage Permissions",onClick:S},publish:{isAvailable:!d&&m.isDraft&&!m.isArchived&&!m.isNew&&m.canEdit,title:"Publish",onClick:g},unpublish:{isAvailable:!H.disablePublish&&!m.isNew&&m.canEdit&&!m.isDraft,title:"Unpublish",onClick:y}},{showAPIKey:{isAvailable:!H.disablePublicUrls&&!m.isNew,title:"Show API Key",onClick:w}}],t={},a=Object(c.map)(e,e=>Object(c.filter)(Object(c.map)(e,(e,a)=>(e=Object(c.extend)({isAvailable:!0,isEnabled:!0,onClick:()=>{}},e)).isAvailable?(t[a]=e.onClick,n.a.createElement(ue.a.Item,{key:a,disabled:!e.isEnabled},e.title)):null))),n.a.createElement(ue.a,{onClick:e=>{var a=e.key;return t[a]()}},Object(c.reduce)(Object(c.filter)(a,e=>e.length>0),(e,t,a)=>{var r=e.length>0?n.a.createElement(ue.a.Divider,{key:"divider".concat(a)}):null;return[...e,r,...t]},[]));var e,t,a},[m.isNew,m.canFork,m.canEdit,m.isArchived,m.isDraft,E,j,b,S,d,g,y,w]);return n.a.createElement("div",{className:"query-page-header"},n.a.createElement("div",{className:"title-with-tags"},n.a.createElement("div",{className:"page-title"},n.a.createElement("div",{className:"d-flex align-items-center"},!m.isNew&&n.a.createElement(Mn,{item:t}),n.a.createElement("h3",null,n.a.createElement(eh,{isEditable:m.canEdit,onDone:p,ignoreBlanks:!0,value:t.name})))),n.a.createElement("div",{className:"query-tags"},n.a.createElement(Xi,{tags:t.tags,isDraft:m.isDraft,isArchived:m.isArchived,canEdit:m.canEdit,getAvailableTags:Pg,onEdit:h,tagsExtra:l}))),n.a.createElement("div",{className:"header-actions"},o,d&&m.isDraft&&!m.isArchived&&!m.isNew&&m.canEdit&&n.a.createElement(f.a,{className:"m-r-5",onClick:g},n.a.createElement("i",{className:"fa fa-paper-plane m-r-5","aria-hidden":"true"})," Publish"),!m.isNew&&m.canViewSource&&n.a.createElement("span",null,!i&&n.a.createElement(O.Button,{className:"m-r-5",href:t.getUrl(!0,s)},n.a.createElement("i",{className:"fa fa-pencil-square-o","aria-hidden":"true"}),n.a.createElement("span",{className:"m-l-5"},"Edit Source")),i&&n.a.createElement(O.Button,{className:"m-r-5",href:t.getUrl(!1,s),"data-test":"QueryPageShowResultOnly"},n.a.createElement("i",{className:"fa fa-table","aria-hidden":"true"}),n.a.createElement("span",{className:"m-l-5"},"Show Results Only"))),!m.isNew&&n.a.createElement(Nr.a,{overlay:P,trigger:["click"]},n.a.createElement(f.a,{"data-test":"QueryPageHeaderMoreButton","aria-label":"More actions"},n.a.createElement(no.a,{rotate:90,"aria-hidden":"true"})))))}Cg.propTypes={query:ae.a.shape({id:ae.a.oneOfType([ae.a.number,ae.a.string]),name:ae.a.string,tags:ae.a.arrayOf(ae.a.string)}).isRequired,dataSource:ae.a.object,sourceMode:ae.a.bool,selectedVisualization:ae.a.number,headerExtra:ae.a.node,tagsExtra:ae.a.node,onChange:ae.a.func},Cg.defaultProps={dataSource:null,sourceMode:!1,selectedVisualization:null,headerExtra:null,tagsExtra:null,onChange:()=>{}};a(1663);function Ng(e){var t=e.query,a=e.dataSource,r=e.layout,i=e.onEditSchedule;return n.a.createElement("div",{className:"query-metadata query-metadata-".concat(r)},n.a.createElement("div",{className:"query-metadata-item"},n.a.createElement("img",{className:"profile__image_thumb",src:t.user.profile_image_url,alt:"Avatar"}),n.a.createElement("div",{className:"query-metadata-property"},n.a.createElement("strong",{className:me()("query-metadata-label",{"text-muted":t.user.is_disabled})},t.user.name),n.a.createElement("span",{className:"query-metadata-value"},"created"," ",n.a.createElement("strong",null,n.a.createElement($n,{date:t.created_at}))))),n.a.createElement("div",{className:"query-metadata-item"},n.a.createElement("img",{className:"profile__image_thumb",src:t.last_modified_by.profile_image_url,alt:"Avatar"}),n.a.createElement("div",{className:"query-metadata-property"},n.a.createElement("strong",{className:me()("query-metadata-label",{"text-muted":t.last_modified_by.is_disabled})},t.last_modified_by.name),n.a.createElement("span",{className:"query-metadata-value"},"updated"," ",n.a.createElement("strong",null,n.a.createElement($n,{date:t.updated_at}))))),n.a.createElement("div",{className:"query-metadata-space"}),Object(c.has)(a,"name")&&Object(c.has)(a,"type")&&n.a.createElement("div",{className:"query-metadata-item"},"Data Source:",n.a.createElement("img",{src:"".concat("static/images/db-logos","/").concat(a.type,".png"),width:"20",alt:a.type}),n.a.createElement("div",{className:"query-metadata-property"},n.a.createElement("div",{className:"query-metadata-label"},a.name))),n.a.createElement("div",{className:"query-metadata-item"},n.a.createElement("div",{className:"query-metadata-property"},n.a.createElement("span",{className:"query-metadata-label"},n.a.createElement("span",{className:"zmdi zmdi-refresh m-r-5"}),"Refresh Schedule"),n.a.createElement("span",{className:"query-metadata-value"},n.a.createElement(rs,{isLink:Object(c.isFunction)(i),isNew:t.isNew(),schedule:t.schedule,onClick:i})))))}Ng.propTypes={layout:ae.a.oneOf(["table","horizontal"]),query:ae.a.shape({created_at:ae.a.oneOfType([ae.a.string,Gn]).isRequired,updated_at:ae.a.oneOfType([ae.a.string,Gn]).isRequired,user:ae.a.shape({name:ae.a.string.isRequired,profile_image_url:ae.a.string.isRequired,is_disabled:ae.a.bool}).isRequired,last_modified_by:ae.a.shape({name:ae.a.string.isRequired,profile_image_url:ae.a.string.isRequired,is_disabled:ae.a.bool}).isRequired,schedule:ae.a.object}).isRequired,dataSource:ae.a.shape({type:ae.a.string,name:ae.a.string}),onEditSchedule:ae.a.func},Ng.defaultProps={layout:"table",dataSource:null,onEditSchedule:null};a(1664);function kg(){return(kg=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function xg(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);r=!0);}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Ag(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Ag(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ag(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function _g(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},i=Object.keys(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var qg=Sn.a.TabPane;function Tg(e){var t=e.title,a=e.message,r=e.refreshButton;return n.a.createElement("div",{className:"query-results-empty-state"},n.a.createElement("div",{className:"empty-state-content"},n.a.createElement("div",null,n.a.createElement("img",{src:"static/images/illustrations/no-query-results.svg",alt:"No Query Results Illustration"})),n.a.createElement("h3",null,t),n.a.createElement("div",{className:"m-b-20"},a),r))}function Ig(e){var t=e.visualizationName,a=e.canDelete,i=e.onDelete,s=_g(e,["visualizationName","canDelete","onDelete"]),o=Object(r.useCallback)(e=>{e.stopPropagation(),z.a.confirm({title:"Delete Visualization",content:"Are you sure you want to delete this visualization?",okText:"Delete",okType:"danger",onOk:i,maskClosable:!0,autoFocusButton:null})},[i]);return n.a.createElement("span",s,t,a&&n.a.createElement(fe,{className:"delete-visualization-button",onClick:o,"aria-label":"Close",title:"Close"},n.a.createElement("i",{className:"zmdi zmdi-close","aria-hidden":"true"})))}Tg.propTypes={title:ae.a.string.isRequired,message:ae.a.string.isRequired,refreshButton:ae.a.node},Tg.defaultProps={refreshButton:null},Ig.propTypes={visualizationName:ae.a.string.isRequired,canDelete:ae.a.bool,onDelete:ae.a.func},Ig.defaultProps={canDelete:!1,onDelete:()=>{}};var Dg=[{type:"TABLE",name:"Table",id:null,options:{}}];function Rg(e){var t=e.queryResult,a=e.selectedTab,i=e.showNewVisualizationButton,s=e.canDeleteVisualizations,o=e.onChangeTab,l=e.onAddVisualization,u=e.onDeleteVisualization,d=e.refreshButton,m=e.canRefresh,p=_g(e,["queryResult","selectedTab","showNewVisualizationButton","canDeleteVisualizations","onChangeTab","onAddVisualization","onDeleteVisualization","refreshButton","canRefresh"]),h=Object(r.useMemo)(()=>p.visualizations.length>0?p.visualizations:Dg,[p.visualizations]),b={};Object(c.find)(h,{id:a})&&(b.activeKey="".concat(a)),i&&(b.tabBarExtraContent=n.a.createElement(f.a,{className:"add-visualization-button","data-test":"NewVisualization",type:"link",onClick:()=>l()},n.a.createElement("i",{className:"fa fa-plus","aria-hidden":"true"}),n.a.createElement("span",{className:"m-l-5 hidden-xs"},"Add Visualization")));var g=Object(r.useMemo)(()=>Object(c.orderBy)(h,["id"]),[h]),y=Object(r.useCallback)(e=>e===g[0].id,[g]),v=Mb()({maxWidth:768}),O=xg(Object(r.useState)([]),2),E=O[0],j=O[1];return n.a.createElement(Sn.a,kg({},b,{type:"card",className:me()("query-visualization-tabs card-style"),"data-test":"QueryPageVisualizationTabs",animated:!1,tabBarGutter:0,onChange:e=>o(+e),destroyInactiveTabPane:!0}),g.map(e=>n.a.createElement(qg,{key:"".concat(e.id),tab:n.a.createElement(Ig,{"data-test":"QueryPageVisualizationTab".concat(e.id),canDelete:!v&&s&&!y(e.id),visualizationName:e.name,onDelete:()=>u(e.id)})},t?n.a.createElement(Sd,{visualization:e,queryResult:t,context:"query",filters:E,onFiltersChange:j}):n.a.createElement(Tg,{title:"Query has no result",message:m?"Execute/Refresh the query to show results.":"You do not have a permission to execute/refresh this query.",refreshButton:d}))))}function Mg(e){var t=e.status,a=e.updatedAt,r=e.error,i=e.isCancelling,s=e.onCancel,o="failed"===t?"error":"info",l="failed"!==t&&a,u=Object(c.includes)(["waiting","processing"],t),d=i?n.a.createElement(n.a.Fragment,null,"Cancellingâ€¦"):null;switch(t){case"waiting":i||(d=n.a.createElement(n.a.Fragment,null,"Query in queueâ€¦"));break;case"processing":i||(d=n.a.createElement(n.a.Fragment,null,"Executing queryâ€¦"));break;case"loading-result":d=n.a.createElement(n.a.Fragment,null,"Loading resultsâ€¦");break;case"failed":d=n.a.createElement(n.a.Fragment,null,"Error running query: ",n.a.createElement("strong",null,r))}return n.a.createElement(p.a,{"data-test":"QueryExecutionStatus",type:o,message:n.a.createElement("div",{className:"d-flex align-items-center"},n.a.createElement("div",{className:"flex-fill p-t-5 p-b-5"},d," ",l&&n.a.createElement(Qu,{from:a})),n.a.createElement("div",null,u&&n.a.createElement(f.a,{className:"m-l-10",type:"primary",size:"small",disabled:i,onClick:s},"Cancel")))})}Rg.propTypes={queryResult:ae.a.object,visualizations:ae.a.arrayOf(ae.a.object),selectedTab:ae.a.number,showNewVisualizationButton:ae.a.bool,canDeleteVisualizations:ae.a.bool,onChangeTab:ae.a.func,onAddVisualization:ae.a.func,onDeleteVisualization:ae.a.func,refreshButton:ae.a.node,canRefresh:ae.a.bool},Rg.defaultProps={queryResult:null,visualizations:[],selectedTab:null,showNewVisualizationButton:!1,canDeleteVisualizations:!1,onChangeTab:()=>{},onAddVisualization:()=>{},onDeleteVisualization:()=>{},refreshButton:null,canRefresh:!0},Mg.propTypes={status:ae.a.string,updatedAt:ae.a.any,error:ae.a.string,isCancelling:ae.a.bool,onCancel:ae.a.func},Mg.defaultProps={status:"waiting",updatedAt:null,error:null,isCancelling:!0,onCancel:()=>{}};a(1665);function zg(e){var t=e.query,a=e.dataSourcesAvailable,r=Xb(t),i=null;return r.isNew&&!r.canCreate?i=n.a.createElement(n.a.Fragment,null,n.a.createElement(Gr.a.Title,{level:4},"You don't have permission to create new queries on any of the data sources available to you."),n.a.createElement("p",null,n.a.createElement(Gr.a.Text,{type:"secondary"},"You can either ",n.a.createElement(O,{href:"queries"},"browse existing queries"),", or ask for additional permissions from your Redash admin."))):a||(i=W.isAdmin?n.a.createElement(n.a.Fragment,null,n.a.createElement(Gr.a.Title,{level:4},"Looks like no data sources were created yet or none of them available to the group(s) you're member of."),n.a.createElement("p",null,n.a.createElement(Gr.a.Text,{type:"secondary"},"Please create one first, and then start querying.")),n.a.createElement("div",{className:"query-source-alerts-actions"},n.a.createElement(O.Button,{type:"primary",href:"data_sources/new"},"Create Data Source"),n.a.createElement(O.Button,{type:"default",href:"groups"},"Manage Group Permissions"))):n.a.createElement(n.a.Fragment,null,n.a.createElement(Gr.a.Title,{level:4},"Looks like no data sources were created yet or none of them available to the group(s) you're member of."),n.a.createElement("p",null,n.a.createElement(Gr.a.Text,{type:"secondary"},"Please ask your Redash admin to create one first.")))),i?n.a.createElement("div",{className:"query-source-alerts"},n.a.createElement(Wr.a,null,n.a.createElement(le,{name:"QuerySource.Alerts",query:t,dataSourcesAvailable:a},n.a.createElement("div",{className:"query-source-alerts-icon"},n.a.createElement(po.a,null)),i))):null}function Fg(){return(Fg=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Ug(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);r=!0);}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Vg(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Vg(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Vg(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function Lg(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},i=Object.keys(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function Bg(e){function t(t){var a=t.queryId,i=t.onError,s=Lg(t,["queryId","onError"]),o=Ug(Object(r.useState)(null),2),l=o[0],c=o[1],u=sd(i);return Object(r.useEffect)(()=>{var e=!1;return(a?Xt.get({id:a}):Promise.resolve(Xt.newQuery())).then(t=>{e||c(t)}).catch(u),()=>{e=!0}},[a,u]),l?n.a.createElement(e,Fg({query:l,onError:i},s)):n.a.createElement(Ts,{className:"flex-fill"})}return t.propTypes={queryId:ae.a.oneOfType([ae.a.number,ae.a.string])},t.defaultProps={queryId:null},t}zg.propTypes={query:ae.a.object.isRequired,dataSourcesAvailable:ae.a.bool},zg.defaultProps={dataSourcesAvailable:!1};var Qg=a(705),Wg=a.n(Qg);a(1666);function Hg(){return(Hg=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Gg(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);r=!0);}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Kg(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Kg(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Kg(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function Yg(e){var t=e.dialog,a=e.visualization,i=Gg(Object(r.useState)(""),2),s=i[0],o=i[1],l=Gg(To(e=>Object(c.isString)(e)&&""!==e?La.query({q:e}).then(e=>e.results).catch(()=>[]):Promise.resolve([]),{initialResults:[]}),3),u=l[0],d=l[1],m=l[2],p=Gg(Object(r.useState)(null),2),h=p[0],f=p[1],b=Gg(Object(r.useState)(!1),2),g=b[0],y=b[1];Object(r.useEffect)(()=>{u(s)},[u,s]);var v=h?[h]:d;return n.a.createElement(z.a,Hg({},t.props,{title:"Add to Dashboard",okButtonProps:{disabled:!h||g,loading:g},cancelButtonProps:{disabled:g},onOk:function(){La.get(h).then(e=>(e.addWidget(a),e)).then(e=>{t.close();var a="notification-".concat(Math.random().toString(36).substr(2,10));en.success("Widget added to dashboard",n.a.createElement(n.a.Fragment,null,n.a.createElement(O,{href:"".concat(e.url),onClick:()=>en.close(a)},e.name),n.a.createElement(Xi,{isDraft:e.is_draft,tags:e.tags})),{key:a})}).catch(()=>{en.error("Widget not added.")}).finally(()=>{y(!1)})}}),n.a.createElement("label",{htmlFor:"add-to-dashboard-dialog-dashboard"},"Choose the dashboard to add this query to:"),!h&&n.a.createElement(Fe.a,{id:"add-to-dashboard-dialog-dashboard",className:"w-100",autoComplete:"off",autoFocus:!0,placeholder:"Search a dashboard by name",value:s,onChange:e=>o(e.target.value),suffix:n.a.createElement(fe,{className:""===s?"hidden":null,onClick:()=>o("")},n.a.createElement(Se.a,null))}),(v.length>0||m)&&n.a.createElement(Fs.a,{className:h?"add-to-dashboard-dialog-selection":"add-to-dashboard-dialog-search-results",bordered:!0,itemLayout:"horizontal",loading:m,dataSource:v,renderItem:e=>n.a.createElement(Fs.a.Item,{key:"dashboard-".concat(e.id),actions:h?[n.a.createElement(fe,{onClick:()=>f(null)},n.a.createElement(Se.a,null))]:[],onClick:h?null:()=>f(e)},n.a.createElement("div",{className:"add-to-dashboard-dialog-item-content"},e.name,n.a.createElement(Xi,{isDraft:e.is_draft,tags:e.tags})))}))}Yg.propTypes={dialog:Qe.isRequired,visualization:ae.a.object.isRequired};var $g=We(Yg);a(1667);function Jg(){return(Jg=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Xg(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class Zg extends n.a.Component{constructor(e){super(e),Xg(this,"state",{enableChangeIframeSize:!1,iframeWidth:720,iframeHeight:391}),Xg(this,"urlEmbedLabelId",Object(c.uniqueId)("url-embed-label")),Xg(this,"iframeEmbedLabelId",Object(c.uniqueId)("iframe-embed-label"));var t=e.query,a=e.visualization;this.embedUrl="".concat(H.basePath,"embed/query/").concat(t.id,"/visualization/").concat(a.id,"?api_key=").concat(t.api_key,"&").concat(t.getParameters().toUrlParams()),window.snapshotUrlBuilder&&(this.snapshotUrl=window.snapshotUrlBuilder(t,a))}render(){var e=this.props,t=e.query,a=e.dialog,r=this.state,i=r.enableChangeIframeSize,s=r.iframeWidth,o=r.iframeHeight;return n.a.createElement(z.a,Jg({},a.props,{className:"embed-query-dialog",title:"Embed Query",footer:n.a.createElement(f.a,{onClick:a.dismiss},"Close")}),t.is_safe?n.a.createElement(n.a.Fragment,null,n.a.createElement("h5",{id:this.urlEmbedLabelId,className:"m-t-0"},"Public URL"),n.a.createElement("div",{className:"m-b-30"},n.a.createElement(bg,{"aria-labelledby":this.urlEmbedLabelId,"data-test":"EmbedIframe",copyable:!0},this.embedUrl)),n.a.createElement("h5",{id:this.iframeEmbedLabelId,className:"m-t-0"},"IFrame Embed"),n.a.createElement("div",null,n.a.createElement(bg,{"aria-labelledby":this.iframeEmbedLabelId,copyable:!0},'<iframe src="'.concat(this.embedUrl,'" width="').concat(s,'" height="').concat(o,'"></iframe>')),n.a.createElement(co.a,{className:"m-t-10",layout:"inline"},n.a.createElement(co.a.Item,null,n.a.createElement(Vl.a,{checked:i,onChange:e=>this.setState({enableChangeIframeSize:e.target.checked})})),n.a.createElement(co.a.Item,{label:"Width"},n.a.createElement(Eo.a,{className:"size-input",value:s,onChange:e=>this.setState({iframeWidth:e}),size:"small",disabled:!i})),n.a.createElement(co.a.Item,{label:"Height"},n.a.createElement(Eo.a,{className:"size-input",value:o,onChange:e=>this.setState({iframeHeight:e}),size:"small",disabled:!i})))),this.snapshotUrl&&n.a.createElement(n.a.Fragment,null,n.a.createElement("h5",null,"Image Embed"),n.a.createElement(bg,{copyable:!0},this.snapshotUrl))):n.a.createElement(p.a,{message:"Currently it is not possible to embed queries that contain text parameters.",type:"error","data-test":"EmbedErrorAlert"}))}}Xg(Zg,"propTypes",{dialog:Qe.isRequired,query:ae.a.object.isRequired,visualization:ae.a.object.isRequired});var ey=We(Zg);var ty=a(702),ay=a.n(ty),ry=a(703),ny=a.n(ry),iy=a(195),sy=a.n(iy),oy=a(298),ly=a.n(oy);function cy(e){var t="",a=e.query,r=e.queryResult,i=e.fileType,s=r.getId&&r.getId(),o=r.getData&&r.getData();return s&&o&&a.name&&(t=a.id?"api/queries/".concat(a.id,"/results/").concat(s,".").concat(i).concat(e.embed?"?api_key=".concat(e.apiKey):""):"api/query_results/".concat(s,".").concat(i)),n.a.createElement(O,{target:"_blank",rel:"noopener noreferrer",disabled:e.disabled,href:t,download:!0},e.children)}function uy(e){var t=n.a.createElement(ue.a,null,!e.query.isNew()&&(!e.query.is_draft||!e.query.is_archived)&&n.a.createElement(ue.a.Item,null,n.a.createElement(fe,{onClick:()=>e.openAddToDashboardForm(e.selectedTab)},n.a.createElement(ay.a,null)," Add to Dashboard")),!H.disablePublicUrls&&!e.query.isNew()&&n.a.createElement(ue.a.Item,null,n.a.createElement(fe,{onClick:()=>e.showEmbedDialog(e.query,e.selectedTab),"data-test":"ShowEmbedDialogButton"},n.a.createElement(ny.a,null)," Embed Elsewhere")),n.a.createElement(ue.a.Item,null,n.a.createElement(cy,{fileType:"csv",disabled:e.queryExecuting||!e.queryResult.getData||!e.queryResult.getData(),query:e.query,queryResult:e.queryResult,embed:e.embed,apiKey:e.apiKey},n.a.createElement(sy.a,null)," Download as CSV File")),n.a.createElement(ue.a.Item,null,n.a.createElement(cy,{fileType:"tsv",disabled:e.queryExecuting||!e.queryResult.getData||!e.queryResult.getData(),query:e.query,queryResult:e.queryResult,embed:e.embed,apiKey:e.apiKey},n.a.createElement(sy.a,null)," Download as TSV File")),n.a.createElement(ue.a.Item,null,n.a.createElement(cy,{fileType:"xlsx",disabled:e.queryExecuting||!e.queryResult.getData||!e.queryResult.getData(),query:e.query,queryResult:e.queryResult,embed:e.embed,apiKey:e.apiKey},n.a.createElement(ly.a,null)," Download as Excel File")));return n.a.createElement(Nr.a,{trigger:["click"],overlay:t,overlayClassName:"query-control-dropdown-overlay"},n.a.createElement(f.a,{"data-test":"QueryControlDropdownButton"},n.a.createElement(no.a,{rotate:90})))}cy.propTypes={query:ae.a.object.isRequired,queryResult:ae.a.object,fileType:ae.a.string,disabled:ae.a.bool.isRequired,embed:ae.a.bool,apiKey:ae.a.string,children:ae.a.oneOfType([ae.a.arrayOf(ae.a.node),ae.a.node]).isRequired},cy.defaultProps={queryResult:{},fileType:"csv",embed:!1,apiKey:""},uy.propTypes={query:ae.a.object.isRequired,queryResult:ae.a.object,queryExecuting:ae.a.bool.isRequired,showEmbedDialog:ae.a.func.isRequired,embed:ae.a.bool,apiKey:ae.a.string,selectedTab:ae.a.oneOfType([ae.a.string,ae.a.number]),openAddToDashboardForm:ae.a.func.isRequired},uy.defaultProps={queryResult:{},embed:!1,apiKey:"",selectedTab:""};var dy=a(704),my=a.n(dy);function py(e){return n.a.createElement(f.a,{"data-test":"EditVisualization",className:"edit-visualization",onClick:()=>e.openVisualizationEditor(e.selectedTab)},n.a.createElement(my.a,null),n.a.createElement("span",{className:"hidden-xs hidden-s hidden-m"},"Edit Visualization"))}py.propTypes={openVisualizationEditor:ae.a.func.isRequired,selectedTab:ae.a.oneOfType([ae.a.string,ae.a.number])},py.defaultProps={selectedTab:""};a(1678);function hy(e){var t=e.query,a=e.queryResult,i=e.isQueryExecuting,s=e.selectedVisualization,o=e.showEditVisualizationButton,l=e.onEditVisualization,u=e.extraActions,d=id(a),m=function(e){return Object(r.useCallback)(t=>{var a=Object(c.find)(e.visualizations,{id:t});$g.showModal({visualization:a})},[e.visualizations])}(t),p=function(e){return Object(r.useCallback)((t,a)=>{var r=Object(c.find)(e.visualizations,{id:a});ey.showModal({query:e,visualization:r})},[e])}(t);return n.a.createElement("div",{className:"query-execution-metadata"},n.a.createElement("span",{className:"m-r-5"},n.a.createElement(uy,{query:t,queryResult:a,queryExecuting:i,showEmbedDialog:p,embed:!1,apiKey:t.api_key,selectedTab:s,openAddToDashboardForm:m})),u,o&&n.a.createElement(py,{openVisualizationEditor:l,selectedTab:s}),n.a.createElement("span",{className:"m-l-5 m-r-10"},n.a.createElement("span",null,!0===d.truncated&&n.a.createElement("span",{className:"m-r-5"},n.a.createElement(Oe,{title:"Result truncated to "+d.rows.length+" rows. Databricks may truncate query results that are unstably large."},n.a.createElement(Wg.a,{twoToneColor:"#FF9800"}))),n.a.createElement("strong",null,d.rows.length)," ",ii("row",d.rows.length)),n.a.createElement("span",{className:"m-l-5"},!i&&n.a.createElement(n.a.Fragment,null,n.a.createElement("strong",null,si(d.runtime)),n.a.createElement("span",{className:"hidden-xs"}," runtime")),i&&n.a.createElement("span",null,"Runningâ€¦")),d.metadata.data_scanned&&n.a.createElement("span",{className:"m-l-5"},"Data Scanned",n.a.createElement("strong",null,ui(d.metadata.data_scanned)))),n.a.createElement("div",null,n.a.createElement("span",{className:"m-r-10"},n.a.createElement("span",{className:"hidden-xs"},"Refreshed "),n.a.createElement("strong",null,n.a.createElement($n,{date:d.retrievedAt,placeholder:"-"})))))}hy.propTypes={query:ae.a.object.isRequired,queryResult:ae.a.object.isRequired,isQueryExecuting:ae.a.bool,selectedVisualization:ae.a.number,showEditVisualizationButton:ae.a.bool,onEditVisualization:ae.a.func,extraActions:ae.a.node},hy.defaultProps={isQueryExecuting:!1,selectedVisualization:null,showEditVisualizationButton:!1,onEditVisualization:()=>{},extraActions:null};var fy=a(706),by=a.n(fy),gy=a(707),yy=a.n(gy);function vy(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);r=!0);}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Oy(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Oy(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Oy(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function Ey(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;return e?Bf.fetchSchema(e,t).catch(()=>(en.error("Schema refresh failed.","Please try again later."),Promise.resolve([]))):Promise.resolve([])}function jy(){return(jy=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function wy(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function Sy(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?wy(Object(a),!0).forEach((function(t){Py(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):wy(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Py(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function Cy(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);r=!0);}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Ny(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Ny(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ny(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function ky(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},i=Object.keys(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var xy=ae.a.shape({name:ae.a.string.isRequired,type:ae.a.string}),Ay=ae.a.shape({name:ae.a.string.isRequired,size:ae.a.number,loading:ae.a.bool,columns:ae.a.arrayOf(xy).isRequired});function _y(e){var t=e.item,a=e.expanded,i=e.onToggle,s=e.onSelect,o=ky(e,["item","expanded","onToggle","onSelect"]),l=Object(r.useCallback)((function(e){e.preventDefault(),e.stopPropagation();for(var t=arguments.length,a=new Array(t>1?t-1:0),r=1;r<t;r++)a[r-1]=arguments[r];s(...a)}),[s]);if(!t)return null;var u=t.displayName||t.name;return n.a.createElement("div",o,n.a.createElement("div",{className:"schema-list-item"},n.a.createElement(fe,{className:"table-name",onClick:i},n.a.createElement("i",{className:"fa fa-table m-r-5","aria-hidden":"true"}),n.a.createElement("strong",null,n.a.createElement("span",{title:t.name},u),!Object(c.isNil)(t.size)&&n.a.createElement("span",null," (",t.size,")"))),n.a.createElement(Oe,{title:"Insert table name into query text",mouseEnterDelay:0,mouseLeaveDelay:0,placement:"topRight",arrowPointAtCenter:!0},n.a.createElement(fe,{className:"copy-to-editor",onClick:e=>l(e,t.name)},n.a.createElement("i",{className:"fa fa-angle-double-right","aria-hidden":"true"})))),a&&n.a.createElement("div",{className:"table-open"},t.loading?n.a.createElement("div",{className:"table-open"},"Loading..."):Object(c.map)(t.columns,e=>{var t=Object(c.get)(e,"name"),a=Object(c.get)(e,"type");return n.a.createElement(Oe,{title:"Insert column name into query text",mouseEnterDelay:0,mouseLeaveDelay:0,placement:"rightTop"},n.a.createElement(fe,{key:t,className:"table-open-item",onClick:e=>l(e,t)},n.a.createElement("div",null,t," ",a&&n.a.createElement("span",{className:"column-type"},a)),n.a.createElement("div",{className:"copy-to-editor"},n.a.createElement("i",{className:"fa fa-angle-double-right","aria-hidden":"true"}))))})))}function qy(){return n.a.createElement("div",{className:"schema-loading-state"},n.a.createElement(Ts,{className:""}))}function Ty(e){var t=e.loading,a=e.schema,i=e.expandedFlags,s=e.onTableExpand,o=e.onItemSelect,l=Cy(Object(r.useState)(null),2),c=l[0],u=l[1];return Object(r.useEffect)(()=>{c&&c.recomputeRowHeights()},[c,a,i]),n.a.createElement("div",{className:"schema-browser"},t&&n.a.createElement(qy,null),!t&&n.a.createElement(by.a,null,e=>{var t=e.width,r=e.height;return n.a.createElement(yy.a,{ref:u,width:t,height:r,rowCount:a.length,rowHeight:e=>{var t=e.index,r=a[t],n=r.loading?1:r.columns.length;return 22+18*(i[r.name]?n:0)},rowRenderer:e=>{var t=e.key,r=e.index,l=e.style,c=a[r];return n.a.createElement(_y,{key:t,style:l,item:c,expanded:i[c.name],onToggle:()=>s(c.name),onSelect:o})}})}))}function Iy(e,t){var a=Object(c.filter)(t.toLowerCase().split(/\s+/),e=>e.length>0);if(0===a.length)return e;if(1===a.length){var r=a[0],n=a[0];return Object(c.filter)(e,e=>Object(c.includes)(e.name.toLowerCase(),r)||Object(c.some)(e.columns,e=>Object(c.includes)(Object(c.get)(e,"name").toLowerCase(),n)))}var i=a[0],s=a[1];return Object(c.filter)(Object(c.map)(e,e=>{if(Object(c.includes)(e.name.toLowerCase(),i))return(e=Sy(Sy({},e),{},{columns:Object(c.filter)(e.columns,e=>Object(c.includes)(Object(c.get)(e,"name").toLowerCase(),s))})).columns.length>0?e:null}))}function Dy(e){var t=e.dataSource,a=e.onSchemaUpdate,i=e.onItemSelect,s=(e.options,e.onOptionsUpdate,ky(e,["dataSource","onSchemaUpdate","onItemSelect","options","onOptionsUpdate"])),o=Cy(function(e){var t=vy(Object(r.useState)([]),2),a=t[0],n=t[1],i=vy(Object(r.useState)(!0),2),s=i[0],o=i[1],l=Object(r.useRef)(null),c=Object(r.useCallback)((function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;o(!0);var a=Math.random().toString(36).substr(2);l.current=a,Ey(e,t).then(e=>{l.current===a&&n(e)}).finally(()=>{l.current===a&&o(!1)})}),[e]);return Object(r.useEffect)(()=>{c()},[c]),Object(r.useEffect)(()=>()=>{l.current=null},[]),Object(r.useMemo)(()=>[a,s,c],[a,s,c])}(t),3),l=o[0],c=o[1],u=o[2],d=Cy(Object(r.useState)(""),2),m=d[0],p=d[1],h=Object(r.useMemo)(()=>Iy(l,m),[l,m]),b=Cy(Object(Ao.a)(p,500),1)[0],g=Cy(Object(r.useState)({}),2),y=g[0],v=g[1],O=sd(a);if(Object(r.useEffect)(()=>{v({}),O(l)},[l,O]),0===l.length&&!c)return null;return n.a.createElement("div",jy({className:"schema-container"},s),n.a.createElement("div",{className:"schema-control"},n.a.createElement(Fe.a,{className:"m-r-5",placeholder:"Search schema...","aria-label":"Search schema",disabled:0===l.length,onChange:e=>b(e.target.value)}),n.a.createElement(Oe,{title:"Refresh Schema"},n.a.createElement(f.a,{onClick:()=>u(!0)},n.a.createElement("i",{className:me()("zmdi zmdi-refresh",{"zmdi-hc-spin":c}),"aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},c?"Loading, please wait.":"Press to refresh.")))),n.a.createElement(Ty,{loading:c&&0===l.length,schema:h,expandedFlags:y,onTableExpand:function(e){v(Sy(Sy({},y),{},{[e]:!y[e]}))},onItemSelect:i}))}_y.propTypes={item:Ay,expanded:ae.a.bool,onToggle:ae.a.func,onSelect:ae.a.func},_y.defaultProps={item:null,expanded:!1,onToggle:()=>{},onSelect:()=>{}},Dy.propTypes={dataSource:ae.a.object,onSchemaUpdate:ae.a.func,onItemSelect:ae.a.func},Dy.defaultProps={dataSource:null,onSchemaUpdate:()=>{},onItemSelect:()=>{}};var Ry=a(161),My=a.n(Ry),zy=(a(1752),a(1753),a(1754),a(1755),a(1756),a(1757),a(1758),My.a.acequire("ace/ext/language_tools")),Fy=My.a.acequire("ace/snippets");function Uy(e){My.a.define("ace/snippets/".concat(e),["require","exports","module"],(t,a)=>{a.snippetText="",a.scope=e})}function Vy(e){var t=[],a={},r={};return e.forEach(e=>{t.push({name:e.name,value:e.name,score:100,meta:"Table"}),r[e.name]=function(e){var t=[];return e.columns.forEach(a=>{var r=Object(c.get)(a,"name");t.push({name:"".concat(e.name,".").concat(r),value:"".concat(e.name,".").concat(r),score:100,meta:Object(c.capitalize)(Object(c.get)(a,"type","Column"))})}),t}(e),e.columns.forEach(e=>{var t=Object(c.get)(e,"name",e);a[t]=Object(c.capitalize)(Object(c.get)(e,"type","Column"))})}),{table:t,column:Object(c.map)(a,(e,t)=>({name:t,value:t,score:50,meta:e})),tableColumn:r}}Uy("python"),Uy("sql"),Uy("json"),Uy("yaml");var Ly={};function By(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;Ly[e]=Object(c.isNil)(t)?null:Vy(t)}zy.setCompleters([zy.snippetCompleter,zy.keyWordCompleter,zy.textCompleter,{identifierRegexps:[/[a-zA-Z_0-9.\-\u00A2-\uFFFF]/],getCompletions:(e,t,a,r,n)=>{var i=Ly[e.id]||{table:[],column:[],tableColumn:[]},s=i.table,o=i.column,l=i.tableColumn;if(0!==r.length&&0!==s.length)if("."!==r[r.length-1])n(null,s.concat(o));else{var c=r.substring(0,r.length-1);n(null,s.concat(l[c]))}else n(null,[])}}]);class Qy{constructor(e){Object(c.extend)(this,e)}getSnippet(){var e=this.trigger;return""!==this.description&&(e="".concat(this.trigger,": ").concat(this.description)),{name:e,content:this.snippet,tabTrigger:this.trigger}}}var Wy=e=>new Qy(e),Hy={get:e=>Q.get("api/query_snippets/".concat(e.id)).then(Wy),query:()=>Q.get("api/query_snippets").then(e=>Object(c.map)(e,Wy)),create:e=>Q.post("api/query_snippets",e).then(Wy),save:e=>Q.post("api/query_snippets/".concat(e.id),e).then(Wy),delete:e=>Q.delete("api/query_snippets/".concat(e.id))};a(1759);function Gy(e){var t=e.available,a=e.enabled,i=e.onToggle,s="Live Autocomplete Enabled",o="icon-flash";a||(s="Live Autocomplete Disabled",o="icon-flash-off"),t||(s="Live Autocomplete Not Available (Use Ctrl+Space to Trigger)",o="icon-flash-off");var l=Object(r.useCallback)(()=>{mt("toggle_autocomplete","screen","query_editor",{state:!a}),i(!a)},[a,i]);return n.a.createElement(Oe,{placement:"top",title:s},n.a.createElement(f.a,{className:"query-editor-controls-button m-r-5",disabled:!t,onClick:l,"aria-label":a?"Disable live autocomplete":"Enable live autocomplete"},n.a.createElement("i",{className:"icon "+o,"aria-hidden":"true"})))}Gy.propTypes={available:ae.a.bool.isRequired,enabled:ae.a.bool.isRequired,onToggle:ae.a.func.isRequired};a(1760);function Ky(e){var t=e.available,a=e.checked,i=e.onChange,s=Object(r.useCallback)(()=>{mt("checkbox_auto_limit","screen","query_editor",{state:!a}),i(!a)},[a,i]),o=null;return o=t?"Auto limit results to first 1000 rows.":"Auto limiting is not available for this Data Source type.",n.a.createElement(Oe,{placement:"top",title:o},n.a.createElement(Vl.a,{className:"query-editor-controls-checkbox",disabled:!t,onClick:s,checked:t&&a},"LIMIT 1000"))}function Yy(){return(Yy=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function $y(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},i=Object.keys(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function Jy(e){var t=e.title,a=e.shortcut,r=$y(e,["title","shortcut"]);return a=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/0,a={mod:Object(c.upperFirst)(hc),alt:Object(c.upperFirst)(fc)};return e=Object(c.toLower)(Object(c.toString)(e)),e=Object(c.filter)(Object(c.map)(e.split(","),c.trim),e=>""!==e).slice(0,t),""!==(e=Object(c.map)(e,e=>(e=Object(c.filter)(Object(c.map)(e.split("+")),e=>""!==e),Object(c.map)(e,e=>a[e]||Object(c.upperFirst)(e)).join(" + "))).join(", "))?e:null}(a,1),t=t&&a?n.a.createElement(n.a.Fragment,null,t," (",n.a.createElement("i",null,a),")"):t||a,n.a.createElement(Oe,Yy({placement:"top",title:t},r))}function Xy(e){var t=e.addParameterButtonProps,a=e.formatButtonProps,i=e.saveButtonProps,s=e.executeButtonProps,o=e.autocompleteToggleProps,l=e.autoLimitCheckboxProps,u=e.dataSourceSelectorProps;return Object(r.useEffect)(()=>{var e=Object(c.filter)([t,a,i,s],e=>e.shortcut&&Object(c.isFunction)(e.onClick));if(e.length>0){var r=Object(c.fromPairs)(Object(c.map)(e,e=>[e.shortcut,e.disabled?c.noop:e.onClick]));return yc.bind(r),()=>{yc.unbind(r)}}},[t,a,i,s]),n.a.createElement("div",{className:"query-editor-controls"},!1!==t&&n.a.createElement(Jy,{title:t.title,shortcut:t.shortcut},n.a.createElement(f.a,{className:"query-editor-controls-button m-r-5",disabled:t.disabled,onClick:t.onClick},"{{","Â ","}}")),!1!==a&&n.a.createElement(Jy,{title:a.title,shortcut:a.shortcut},n.a.createElement(f.a,{className:"query-editor-controls-button m-r-5",disabled:a.disabled,onClick:a.onClick},n.a.createElement("span",{className:"zmdi zmdi-format-indent-increase"}),a.text)),!1!==o&&n.a.createElement(Gy,{available:o.available,enabled:o.enabled,onToggle:o.onToggle}),!1!==l&&n.a.createElement(Ky,l),!1===u&&n.a.createElement("span",{className:"query-editor-controls-spacer"}),!1!==u&&n.a.createElement(Li.a,{className:"w-100 flex-fill datasource-small",disabled:u.disabled,value:u.value,onChange:u.onChange},Object(c.map)(u.options,e=>n.a.createElement(Li.a.Option,{key:"option-".concat(e.value),value:e.value},e.label))),!1!==i&&n.a.createElement(Jy,{title:i.title,shortcut:i.shortcut},n.a.createElement(f.a,{className:"query-editor-controls-button m-l-5",disabled:i.disabled,loading:i.loading,onClick:i.onClick,"data-test":"SaveButton"},!i.loading&&n.a.createElement("span",{className:"fa fa-floppy-o"}),i.text)),!1!==s&&n.a.createElement(Jy,{title:s.title,shortcut:s.shortcut},n.a.createElement(f.a,{className:"query-editor-controls-button m-l-5",type:"primary",disabled:s.disabled,onClick:s.onClick,"data-test":"ExecuteButton"},n.a.createElement("span",{className:"zmdi zmdi-play"}),s.text)))}Ky.propTypes={available:ae.a.bool,checked:ae.a.bool.isRequired,onChange:ae.a.func.isRequired},Jy.propTypes={title:ae.a.node,shortcut:ae.a.string},Jy.defaultProps={title:null,shortcut:null};var Zy=ae.a.oneOfType([ae.a.bool,ae.a.shape({title:ae.a.node,disabled:ae.a.bool,loading:ae.a.bool,onClick:ae.a.func,text:ae.a.node,shortcut:ae.a.string})]);Xy.propTypes={addParameterButtonProps:Zy,formatButtonProps:Zy,saveButtonProps:Zy,executeButtonProps:Zy,autocompleteToggleProps:ae.a.oneOfType([ae.a.bool,ae.a.shape({available:ae.a.bool,enabled:ae.a.bool,onToggle:ae.a.func})]),autoLimitCheckboxProps:ae.a.oneOfType([ae.a.bool,ae.a.shape(Ky.propTypes)]),dataSourceSelectorProps:ae.a.oneOfType([ae.a.bool,ae.a.shape({disabled:ae.a.bool,value:ae.a.oneOfType([ae.a.string,ae.a.number]),options:ae.a.arrayOf(ae.a.shape({value:ae.a.oneOfType([ae.a.string,ae.a.number]),label:ae.a.node})),onChange:ae.a.func})])},Xy.defaultProps={addParameterButtonProps:!1,formatButtonProps:!1,saveButtonProps:!1,executeButtonProps:!1,autocompleteToggleProps:!1,autoLimitCheckboxProps:!1,dataSourceSelectorProps:!1};a(1761);function ev(){return(ev=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function tv(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);r=!0);}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return av(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return av(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function av(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function rv(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},i=Object.keys(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var nv={$blockScrolling:1/0},iv=n.a.forwardRef((function(e,t){var a=e.className,i=e.syntax,s=e.value,o=e.autocompleteEnabled,l=e.schema,c=e.onChange,u=e.onSelectionChange,d=rv(e,["className","syntax","value","autocompleteEnabled","schema","onChange","onSelectionChange"]),m=tv(Object(r.useState)(null),2),p=m[0],h=m[1],f=tv(Object(r.useState)(null),2),b=f[0],g=f[1],y=tv(Object(r.useState)(s),2),v=y[0],O=y[1];Object(r.useEffect)(()=>{O(s)},[s]);var E=Object(r.useCallback)(e=>{O(e),c(e)},[c]),j=Object(r.useMemo)(()=>({behavioursEnabled:!0,enableSnippets:!0,enableBasicAutocompletion:!0,enableLiveAutocompletion:o,autoScrollEditorIntoView:!0}),[o]);Object(r.useEffect)(()=>{if(b){var e=b.editor.id;return By(e,l),()=>{By(e,null)}}},[l,b]),Object(r.useEffect)(()=>{function e(){b&&b.editor.resize()}if(p)return e(),Ym(p,e)},[p,b]);var w=Object(r.useCallback)(e=>{var t=b.editor.session.doc.getTextRange(e.getRange()),a=t.length>1?t:null;u(a)},[b,u]),S=Object(r.useCallback)(e=>{e.commands.bindKey({win:"Ctrl+L",mac:"Cmd+L"},null),e.commands.bindKey({win:"Ctrl+Shift+F",mac:"Cmd+Shift+F"},null),e.commands.bindKey({win:"Ctrl+P",mac:null},null),e.commands.bindKey({win:null,mac:"Ctrl+P"},"golineup"),e.commands.bindKey({win:"Esc",mac:"Esc"},()=>{e.blur()});var t=null;e.on("focus",()=>{t=function(e){var t=e.text,a=e.expiry,r=void 0===a?1e3:a,n=e.container,i=void 0===n?document.body:n,s=e.politeness,o=void 0===s?"polite":s,l=document.createElement("div"),c="speak-".concat(Date.now());l.id=c,l.className="sr-only",l.textContent=t,l.setAttribute("role","alert"),l.setAttribute("aria-live",o),i.appendChild(l);var u=null,d=!1,m=()=>{if(!d){d=!0;try{i.removeChild(l)}catch(e){console.error(e)}u&&window.clearTimeout(u)}};return u=window.setTimeout(m,r),m}({text:"You've entered the SQL editor. To exit press the ESC key.",politeness:"assertive"})}),e.on("blur",()=>{t&&t()}),e.commands.on("afterExec",t=>{"insertstring"===t.command.name&&"."===t.args&&e.completer&&e.completer.showPopup(e)}),Hy.query().then(e=>{var t=Fy.snippetManager,a={snippetText:""};a.snippets=t.parseSnippetFile(a.snippetText),e.forEach(e=>{a.snippets.push(e.getSnippet())}),t.register(a.snippets||[],a.scope)}),e.focus()},[]);return Object(r.useImperativeHandle)(t,()=>({paste:e=>{if(b){var t=b.editor;t.session.doc.replace(t.selection.getRange(),e);var a=t.selection.getRange();c(t.session.getValue()),t.selection.setRange(a)}},focus:()=>{b&&b.editor.focus()}}),[b,c]),n.a.createElement("div",ev({className:me()("query-editor-container",a)},d,{ref:h}),n.a.createElement(Qh.a,{ref:g,theme:"textmate",mode:i||"sql",value:v,editorProps:nv,width:"100%",height:"100%",setOptions:j,showPrintMargin:!1,wrapEnabled:!1,onLoad:S,onChange:E,onSelectionChange:w}))}));iv.propTypes={className:ae.a.string,syntax:ae.a.string,value:ae.a.string,autocompleteEnabled:ae.a.bool,schema:ae.a.arrayOf(Ay),onChange:ae.a.func,onSelectionChange:ae.a.func},iv.defaultProps={className:null,syntax:null,value:null,autocompleteEnabled:!0,schema:[],onChange:()=>{},onSelectionChange:()=>{}},iv.Controls=Xy;var sv=iv,ov=a(708),lv=a.n(ov);function cv(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function uv(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?cv(Object(a),!0).forEach((function(t){dv(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):cv(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function dv(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function mv(e){return Object(c.has)(e,"job.id")?Lt(e.job.id,1e3):e}function pv(e){return Object(c.has)(e,"error")?Promise.reject(new Error(e.error.message)):e}var hv=uv(uv({},Bf),{},{getDatabases:function(e){var t=e.id,a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r={};return a&&(r.refresh=!0),Q.get("api/databricks/databases/".concat(t),{params:r}).then(mv).then(pv)},getDatabaseTables:function(e,t){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r={};return a&&(r.refresh=!0),Q.get("api/databricks/databases/".concat(e.id,"/").concat(t,"/tables"),{params:r}).then(mv).then(pv)},getTableColumns:(e,t,a)=>Q.get("api/databricks/databases/".concat(e.id,"/").concat(t,"/columns/").concat(a)).then(mv).then(pv)});function fv(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);r=!0);}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return bv(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return bv(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function bv(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function gv(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function yv(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?gv(Object(a),!0).forEach((function(t){vv(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):gv(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function vv(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function Ov(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e?hv.getDatabases(e,t).catch(()=>(en.error("Failed to load Database list.","Please try again later."),Promise.reject())):Promise.resolve([])}function Ev(e,t){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return e&&t?hv.getDatabaseTables(e,t,a).catch(()=>(en.error("Failed to load tables for ".concat(t,"."),"Please try again later."),Promise.reject())):Promise.resolve([])}function jv(e,t){return t?Object(c.map)(e,e=>{var a=t+".",r=e.name;return Object(c.startsWith)(e.name,a)&&(r=e.name.slice(a.length)),yv(yv({},e),{},{displayName:r})}):e}a(1762);function wv(){return(wv=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Sv(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function Pv(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Sv(Object(a),!0).forEach((function(t){Cv(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Sv(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Cv(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function Nv(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);r=!0);}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return kv(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return kv(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function kv(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function xv(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},i=Object.keys(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function Av(e){var t=e.dataSource,a=e.options,i=e.onOptionsUpdate,s=e.onSchemaUpdate,o=e.onItemSelect,l=xv(e,["dataSource","options","onOptionsUpdate","onSchemaUpdate","onItemSelect"]),u=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=Object(r.useState)([]),i=fv(n,2),s=i[0],o=i[1],l=Object(r.useState)(!0),u=fv(l,2),d=u[0],m=u[1],p=Object(r.useState)(),h=fv(p,2),f=h[0],b=h[1],g=Object(r.useState)({}),y=fv(g,2),v=y[0],O=y[1],E=Object(r.useState)(!1),j=fv(E,2),w=j[0],S=j[1],P=Object(r.useState)(!1),C=fv(P,2),N=C[0],k=C[1],x=Object(r.useCallback)(e=>O(t=>yv(yv({},t),{},{[f]:e})),[f]),A=Object(r.useRef)();A.current=f;var _=Object(r.useCallback)(t=>{hv.getTableColumns(e,f,t.substring(f.length+1)).then(e=>{A.current===f&&O(a=>{var r=Object(c.get)(a,f,[]),n=Object(c.map)(r,a=>a.name===t?yv(yv({},a),{},{columns:e,loading:!1}):a);return yv(yv({},a),{},{[f]:n})})})},[e,f]),q=Object(r.useMemo)(()=>jv(Object(c.get)(v,f,[]),f),[v,f]),T=Object(r.useCallback)(()=>{if(!N){k(!0);var t=Ov(e,!0).then(o),a=Ev(e,f,!0).then(e=>{var t=e.schema;return x(t)});Promise.all([a.catch(()=>{}),t.catch(()=>{})]).then(()=>k(!1))}},[e,f,x,N]),I=Object(r.useRef)();I.current=v,Object(r.useEffect)(()=>{var t=!1;return f&&!Object(c.has)(I.current,f)&&(S(!0),Ev(e,f).catch(()=>Promise.resolve({schema:[],has_columns:!0})).then(a=>{var r=a.schema,n=a.has_columns;t||(n||Object(c.isEmpty)(r)||(r=Object(c.map)(r,e=>yv(yv({},e),{},{loading:!0})),Ev(e,f,!0).then(e=>{var a=e.schema;t||x(a)})),x(r))}).finally(()=>{t||S(!1)})),()=>{t=!0}},[e,f,x]);var D=Object(r.useRef)();D.current=Object(c.get)(t,"selectedDatabase",null),Object(r.useEffect)(()=>{var t=!1;return m(!0),b(void 0),O({}),Ov(e).catch(()=>Promise.resolve([])).then(a=>{if(!t){o(a);var r=D.current||localStorage.getItem("lastSelectedDatabricksDatabase_".concat(e.id));r||(r=Object(c.includes)(a,"default")?"default":Object(c.first)(a)||null),b(r)}}).finally(()=>{t||m(!1)}),()=>{t=!0}},[e]);var R=Object(r.useCallback)(r=>{if(r)try{localStorage.setItem("lastSelectedDatabricksDatabase_".concat(e.id),r)}catch(e){}b(r),Object(c.isFunction)(a)&&r!==D.current&&a(yv(yv({},t),{},{selectedDatabase:r}))},[e.id,t,a]);return{databases:s,loadingDatabases:d,schema:q,loadingSchema:w,currentDatabaseName:f,setCurrentDatabase:R,loadTableColumns:_,refreshAll:T,refreshing:N}}(t,a,i),d=u.databases,m=u.loadingDatabases,p=u.schema,h=u.loadingSchema,b=u.loadTableColumns,g=u.currentDatabaseName,y=u.setCurrentDatabase,v=u.refreshAll,O=u.refreshing,E=Nv(Object(r.useState)(""),2),j=E[0],w=E[1],S=Nv(Object(r.useState)(""),2),P=S[0],C=S[1],N=Object(r.useMemo)(()=>Iy(p,j),[p,j]),k=Nv(Object(r.useState)(!1),2),x=k[0],A=k[1],_=Nv(Object(r.useState)({}),2),q=_[0],T=_[1],I=Nv(Object(Ao.a)(w,500),1)[0],D=Nv(Object(Ao.a)(C,500),2),R=D[0],M=D[1],z=Object(r.useCallback)(e=>{y(e),M(),C("")},[M,y]),F=Object(r.useMemo)(()=>Object(c.filter)(d,e=>Object(c.includes)(e.toLowerCase(),P.toLowerCase())),[d,P]),U=sd(s);return Object(r.useEffect)(()=>{U(p)},[p,U]),Object(r.useEffect)(()=>{T({})},[g]),n.a.createElement("div",wv({className:"databricks-schema-browser schema-container"},l),n.a.createElement("div",{className:"schema-control"},n.a.createElement(Fe.a,{className:x?"database-select-open":"",placeholder:"Filter tables & columns...","aria-label":"Search schema",disabled:m||h,onChange:e=>I(e.target.value),addonBefore:n.a.createElement(Li.a,{dropdownClassName:"databricks-schema-browser-db-dropdown",loading:m,disabled:m,onChange:z,value:g,showSearch:!0,onSearch:R,onDropdownVisibleChange:A,placeholder:n.a.createElement(n.a.Fragment,null,n.a.createElement("i",{className:"fa fa-database m-r-5","aria-hidden":"true"})," Database")},F.map(e=>n.a.createElement(Li.a.Option,{key:e},n.a.createElement("i",{className:"fa fa-database m-r-5","aria-hidden":"true"}),e)))})),n.a.createElement("div",{className:"schema-list-wrapper"},n.a.createElement(Ty,{loading:m||h,schema:N,expandedFlags:q,onTableExpand:function(e){var t=Object(c.find)(p,{name:e});!q[e]&&Object(c.get)(t,"loading",!1)&&b(e),T(Pv(Pv({},q),{},{[e]:!q[e]}))},onItemSelect:o}),!(h||m)&&n.a.createElement("div",{className:"load-button"},n.a.createElement(Oe,{title:O?null:"Refresh Databases and Current Schema"},n.a.createElement(f.a,{type:"link",onClick:v,disabled:O},n.a.createElement(lv.a,{spin:O}))))))}function _v(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function qv(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?_v(Object(a),!0).forEach((function(t){Tv(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):_v(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Tv(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}Av.propTypes={dataSource:ae.a.object,options:ae.a.object,onOptionsUpdate:ae.a.func,onSchemaUpdate:ae.a.func,onItemSelect:ae.a.func},Av.defaultProps={dataSource:null,options:null,onOptionsUpdate:()=>{},onSchemaUpdate:()=>{},onItemSelect:()=>{}};var Iv=new Map,Dv="SchemaBrowser",Rv="QueryEditor";function Mv(e,t,a){Object(c.isNil)(a)&&(a=[null]),Object(c.isArray)(a)||(a=[a]),Object(c.each)(a,a=>{Iv.set(a,qv(qv({},Iv.get(a)),{},{[e]:t}))})}function zv(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);r=!0);}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Fv(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Fv(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Fv(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function Uv(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);r=!0);}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Vv(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Vv(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Vv(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function Lv(e){var t=Object(r.useMemo)(()=>Object(c.first)(Object(c.orderBy)(e,["id"]))||{},[e]),a=Uv(Object(r.useState)(+q.hash||t.id),2),n=a[0],i=a[1];return Object(r.useEffect)(()=>{var e=n!==t.id?"".concat(n):null;return q.hash!==e&&q.setHash(e),q.listen(()=>{q.hash!==e&&i(+q.hash||t.id)})},[t.id,n]),Object(r.useEffect)(()=>{Object(c.find)(e,{id:n})||i(t.id)},[t.id,n,e]),Object(r.useMemo)(()=>[n,i],[n])}function Bv(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);r=!0);}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Qv(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Qv(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Qv(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function Wv(e){var t=Object(r.useMemo)(()=>function(e){return Object(c.reduce)(e,(e,t)=>e+t.columns.length,0)}(e)<=5e3,[e]),a=Bv(Object(r.useState)(Ht.get("liveAutocomplete",!0)),2),n=a[0],i=a[1],s=Object(r.useCallback)(e=>{i(e),Ht.set("liveAutocomplete",e)},[]);return Object(r.useMemo)(()=>[t,n,s],[t,n,s])}function Hv(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function Gv(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Hv(Object(a),!0).forEach((function(t){Kv(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Hv(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Kv(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function Yv(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);r=!0);}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return $v(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return $v(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function $v(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function Jv(e,t,a){var n=function(e){return Object(c.get)(e,"supports_auto_limit",!1)}(e),i=Yv(Object(r.useState)(t.options.apply_auto_limit),2),s=i[0],o=i[1];return t.options.apply_auto_limit=s,[n,s,Object(r.useCallback)(e=>{o(e),Ht.set("applyAutoLimit",e),a(Object(c.extend)(t.clone(),{options:Gv(Gv({},t.options),{},{apply_auto_limit:e})}))},[t,a])]}Mv(Dv,Dy),Mv(Rv,sv),Mv(Dv,Av,["databricks","databricks_internal"]);var Xv=S()("redash:notifications"),Zv=window.Notification||null;Zv||Xv("HTML5 notifications are not supported.");var eO=Object(c.find)(["hidden","webkitHidden","mozHidden","msHidden"],e=>e in document);var tO={getPermissions:function(){Zv&&"default"===Zv.permission&&Zv.requestPermission()},showNotification:function(e,t){Zv&&document[eO]&&"granted"===Zv.permission&&(new Zv(e,{tag:e+t,body:t,icon:nr.a}).onclick=function(){window.focus(),this.close(),mt("click","notification")})}};function aO(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);r=!0);}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return rO(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return rO(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function rO(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function nO(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function iO(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?nO(Object(a),!0).forEach((function(t){sO(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):nO(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function sO(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var oO=(e,t)=>iO(iO({},e),t);function lO(e){var t=aO(Object(r.useReducer)(oO,{queryResult:null,isExecuting:!1,loadedInitialResults:!1,executionStatus:null,isCancelling:!1,cancelCallback:null,error:null}),2),a=t[0],n=t[1],i=Object(r.useRef)(null);Object(r.useEffect)(()=>()=>{i.current=null},[]);var s=sd((function(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,s=arguments.length>1?arguments[1]:void 0;t=s?s():e.getQueryResult(r),mt("execute","query",e.id),tO.getPermissions(),i.current=t,n({updatedAt:t.getUpdatedAt(),executionStatus:t.getStatus(),isExecuting:!0,cancelCallback:()=>{mt("cancel_execute","query",e.id),n({isCancelling:!0}),t.cancelExecution()}});var o=e=>{i.current===t&&n({updatedAt:t.getUpdatedAt(),executionStatus:e})};t.toPromise(o).then(r=>{i.current===t&&(r&&r.query_result.query===e.query&&(e.latest_query_data_id=r.getId(),e.queryResult=r),a.loadedInitialResults&&tO.showNotification("Redash","".concat(e.name," updated.")),n({queryResult:r,loadedInitialResults:!0,error:null,isExecuting:!1,isCancelling:!1,executionStatus:null}))}).catch(r=>{i.current===t&&(a.loadedInitialResults&&tO.showNotification("Redash","".concat(e.name," failed to run: ").concat(r.getError())),n({queryResult:r,loadedInitialResults:!0,error:r.getError(),isExecuting:!1,isCancelling:!1,executionStatus:Mt}))})})),o=Object(r.useRef)(e);return o.current=e,Object(r.useEffect)(()=>{var e;o.current.hasResult()||o.current.paramsRequired()?s(void 0!==(e=q.search.maxAge)?e:-1):n({loadedInitialResults:!0})},[s]),iO(iO({},a),{executeQuery:s})}function cO(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);r=!0);}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return uO(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return uO(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function uO(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function dO(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);r=!0);}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return mO(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return mO(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function mO(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function pO(e){var t=Object(r.useMemo)(()=>e.getParametersDefs(),[e]),a=dO(Object(r.useState)(e.getParameters().hasPendingValues()),2),n=a[0],i=a[1],s=Object(r.useCallback)(t=>{t=Object(c.isUndefined)(t)?e.getParameters().hasPendingValues():t,i(t)},[e]);return Object(r.useEffect)(()=>{var t=e.getParameters().hasPendingValues();t!==n&&i(t)},[e,t,n]),Object(r.useMemo)(()=>[t,n,s],[t,n,s])}var hO=a(709),fO=a.n(hO);function bO(){return(bO=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function gO(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function yO(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);r=!0);}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return vO(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return vO(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function vO(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}var OO=l.a.weekdaysShort(),EO=l.a.weekdays(),jO=Li.a.Option,wO=Li.a.OptGroup;function SO(e){var t=yO(Object(r.useState)(e.defaultValue),2),a=t[0],i=t[1],s=a&&!a.isUTC();return n.a.createElement(n.a.Fragment,null,n.a.createElement(fO.a,{allowClear:!1,value:a,format:"HH:mm",minuteStep:5,onChange:function(t){i(t),e.onChange(t)}}),s&&n.a.createElement("span",{className:"utc","data-testid":"utc"},"(",l.a.utc(a).format("HH:mm")," UTC)"))}SO.propTypes={defaultValue:Gn,onChange:ae.a.func.isRequired},SO.defaultProps={defaultValue:null};class PO extends n.a.Component{constructor(){super(...arguments),gO(this,"state",this.getState()),gO(this,"setTime",e=>{this.newSchedule={time:l()(e).utc().format("HH:mm")}}),gO(this,"setInterval",e=>{var t=this.state.newSchedule,a=ni(e).interval;a===Zn.NEVER&&(t.until=null),-1!==[Zn.NEVER,Zn.MINUTES,Zn.HOURS].indexOf(a)&&(t.time=null),a!==Zn.WEEKS&&(t.day_of_week=null),a!==Zn.DAYS&&a!==Zn.WEEKS||this.state.minute&&this.state.hour||(t.time=l()().hour("00").minute("15").utc().format("HH:mm")),a!==Zn.WEEKS||this.state.dayOfWeek||(t.day_of_week=EO[0]),t.interval=e;var r=yO(t.time?ri(t.time).split(":"):[null,null],2),n=r[0],i=r[1];this.setState({interval:a,seconds:e,hour:n,minute:i,dayOfWeek:t.day_of_week?OO[EO.indexOf(t.day_of_week)]:null}),this.newSchedule=t}),gO(this,"setScheduleUntil",(e,t)=>{this.newSchedule={until:t}}),gO(this,"setWeekday",e=>{var t=e.target.value;this.setState({dayOfWeek:t}),this.newSchedule={day_of_week:t?EO[OO.indexOf(t)]:null}}),gO(this,"setUntilToggle",e=>{var t=e.target.value?l()().format("YYYY-MM-DD"):null;this.setScheduleUntil(null,t)})}getState(){var e=Object(c.clone)(this.props.schedule||PO.defaultProps.schedule),t=e.time,a=e.interval,r=e.day_of_week,n=ni(a).interval,i=yO(t?ri(t).split(":"):[null,null],2);return{hour:i[0],minute:i[1],seconds:a,interval:n,dayOfWeek:r?OO[EO.indexOf(r)]:null,newSchedule:e}}get intervals(){var e={[Zn.NEVER]:[]};return this.props.refreshOptions.forEach(t=>{var a=ni(t),r=a.count,n=a.interval;n in e||(e[n]=[]),e[n].push([r,t])}),Object.defineProperty(this,"intervals",{value:e}),e}set newSchedule(e){this.setState(t=>({newSchedule:bO(t.newSchedule,e)}))}save(){var e=this.state.newSchedule;(()=>{var t=Object(c.omitBy)(e,c.isNil),a=Object(c.omitBy)(this.props.schedule,c.isNil);return!Object(c.isEqual)(t,a)})()&&(e.interval?this.props.dialog.close(Object(c.clone)(e)):this.props.dialog.close(null)),this.props.dialog.dismiss()}render(){var e=this.props.dialog,t=this.state,a=t.interval,r=t.minute,i=t.hour,s=t.seconds,o=t.newSchedule.until;return n.a.createElement(z.a,bO({},e.props,{title:"Refresh Schedule",className:"schedule",onOk:()=>this.save()}),n.a.createElement("div",{className:"schedule-component"},n.a.createElement("h5",null,"Refresh every"),n.a.createElement("div",{"data-testid":"interval"},n.a.createElement(Li.a,{className:"input",value:s,onChange:this.setInterval,dropdownMatchSelectWidth:!1},n.a.createElement(jO,{value:null,key:"never"},"Never"),Object.keys(this.intervals).filter(e=>!Object(c.isEmpty)(this.intervals[e])).map(e=>n.a.createElement(wO,{label:Object(c.capitalize)(ii(e)),key:e},this.intervals[e].map(t=>{var a=yO(t,2),r=a[0],i=a[1];return n.a.createElement(jO,{value:i,key:"".concat(e,"-").concat(r)},si(i))})))))),-1!==[Zn.DAYS,Zn.WEEKS].indexOf(a)?n.a.createElement("div",{className:"schedule-component"},n.a.createElement("h5",null,"On time"),n.a.createElement("div",{"data-testid":"time"},n.a.createElement(SO,{defaultValue:i?l()().hour(i).minute(r):null,onChange:this.setTime}))):null,Zn.WEEKS===a?n.a.createElement("div",{className:"schedule-component"},n.a.createElement("h5",null,"On day"),n.a.createElement("div",{"data-testid":"weekday"},n.a.createElement(Td.a.Group,{size:"medium",defaultValue:this.state.dayOfWeek,onChange:this.setWeekday},OO.map(e=>n.a.createElement(Td.a.Button,{value:e,key:e,className:"input"},e[0]))))):null,a!==Zn.NEVER?n.a.createElement("div",{className:"schedule-component"},n.a.createElement("h5",null,"Ends"),n.a.createElement("div",{className:"ends","data-testid":"ends"},n.a.createElement(Td.a.Group,{size:"medium",value:!!o,onChange:this.setUntilToggle},n.a.createElement(Td.a,{value:!1},"Never"),n.a.createElement(Td.a,{value:!0},"On")),o?n.a.createElement(Cc.a,{size:"small",className:"datepicker",value:l()(o),allowClear:!1,format:"YYYY-MM-DD",onChange:this.setScheduleUntil}):null)):null)}}gO(PO,"propTypes",{schedule:Fn,refreshOptions:ae.a.arrayOf(ae.a.number).isRequired,dialog:Qe.isRequired}),gO(PO,"defaultProps",{schedule:Un});var CO=We(PO);function NO(e,t){var a=Xb(e),n=og(e,t);return Object(r.useCallback)(()=>{if(a.canEdit&&a.canSchedule){var t=H.queryRefreshIntervals,r=Z.getQueryRefreshIntervals(),i=Object(c.isArray)(r)?Object(c.intersection)(t,r):t;CO.showModal({schedule:e.schedule,refreshOptions:i}).onClose(t=>{mt("edit_schedule","query",e.id),n({schedule:t})})}},[e.id,e.schedule,a.canEdit,a.canSchedule,n])}var kO={save:e=>Q.post((e=>e.id?"api/visualizations/".concat(e.id):"api/visualizations")(e),e),delete:e=>Q.delete("api/visualizations/".concat(e.id))};a(1765);function xO(){return(xO=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function AO(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);r=!0);}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return _O(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return _O(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _O(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function qO(e){var t=e.dialog,a=e.visualization,i=e.query,s=e.queryResult,o=Object(r.useRef)(),l=!a,u=id(s),m=AO(Object(r.useState)(u.filters),2),p=m[0],h=m[1],f=Object(r.useMemo)(()=>({columns:u.columns,rows:ad(u.rows,p)}),[u,p]),b=Object(r.useMemo)(()=>{var e=a?d.registeredVisualizations[a.type]:Object(d.getDefaultVisualization)(),t=e.getOptions(l?{}:a.options,u);return{type:e.type,name:l?e.name:a.name,options:t,originalOptions:t}},[u,l,a]),g=AO(Object(r.useState)(b.type),2),y=g[0],v=g[1],O=AO(Object(r.useState)(b.name),2),E=O[0],j=O[1],w=AO(Object(r.useState)(!1),2),S=w[0],P=w[1],C=AO(Object(r.useState)(b.options),2),N=C[0],k=C[1],x=AO(Object(r.useState)(!1),2),A=x[0],_=x[1];function q(e){var t=d.registeredVisualizations[y];k(t.getOptions(e,u))}Object(r.useEffect)(()=>{o.current&&o.current.reset()},[u,N]);var T=l?Object(c.filter)(Object(c.sortBy)(d.registeredVisualizations,["name"]),e=>!e.isDeprecated):Object(c.pick)(d.registeredVisualizations,[y]),I=Pe("visualization-type"),D=Pe("visualization-name");return n.a.createElement(z.a,xO({},t.props,{wrapClassName:"ant-modal-fullscreen",title:"Visualization Editor",okText:"Save",okButtonProps:{loading:A,disabled:A},onOk:function(){_(!0);var e=N;"TABLE"===y&&(e=Object(c.omit)(e,["paginationSize"])),function(e){return e.id?mt("update","visualization",e.id,{type:e.type}):mt("create","visualization",null,{type:e.type}),kO.save(e).then(e=>(en.success("Visualization saved"),e)).catch(e=>(en.error("Visualization could not be saved"),Promise.reject(e)))}(Object(c.extend)(Object(d.newVisualization)(y),a,{name:E,options:e,query_id:i.id})).then(e=>{!function(e,t){var a=Object(c.findIndex)(e.visualizations,e=>e.id===t.id);a>-1?e.visualizations[a]=t:e.visualizations.push(t),e.visualizations=[...e.visualizations]}(i,e),t.close(e)})},onCancel:function(){var e,a=!Object(c.isEqual)(N,b.originalOptions);(e=S||a,new Promise((t,a)=>{e?z.a.confirm({title:"Visualization Editor",content:"Are you sure you want to close the editor without saving?",okText:"Yes",cancelText:"No",onOk:()=>t(),onCancel:()=>a()}):t()})).then(t.dismiss)},wrapProps:{"data-test":"EditVisualizationDialog"}}),n.a.createElement("div",{className:"edit-visualization-dialog"},n.a.createElement("div",{className:"visualization-settings"},n.a.createElement("div",{className:"m-b-15"},n.a.createElement("label",{htmlFor:I},"Visualization Type"),n.a.createElement(Li.a,{"data-test":"VisualizationType",id:I,className:"w-100",disabled:!l,value:y,onChange:function(e){v(e);var t=d.registeredVisualizations[e];S||j(t.name),k(t.getOptions(l?{}:a.options,u))}},Object(c.map)(T,e=>n.a.createElement(Li.a.Option,{key:e.type,"data-test":"VisualizationType."+e.type},e.name)))),n.a.createElement("div",{className:"m-b-15"},n.a.createElement("label",{htmlFor:D},"Visualization Name"),n.a.createElement(Fe.a,{"data-test":"VisualizationName",id:D,className:"w-100",value:E,onChange:e=>{return t=e.target.value,j(t),void P(t!==E);var t}})),n.a.createElement("div",{"data-test":"VisualizationEditor"},n.a.createElement(gd,{type:y,data:u,options:N,visualizationName:E,onOptionsChange:q}))),n.a.createElement("div",{className:"visualization-preview"},n.a.createElement("label",{htmlFor:"visualization-preview",className:"invisible hidden-xs"},"Preview"),n.a.createElement(nd,{filters:p,onChange:h}),n.a.createElement("div",{className:"scrollbox","data-test":"VisualizationPreview"},n.a.createElement(bd,{type:y,data:f,options:N,visualizationName:E,onOptionsChange:q})))))}qO.propTypes={dialog:Qe.isRequired,query:ae.a.object.isRequired,visualization:d.VisualizationType,queryResult:ae.a.object.isRequired},qO.defaultProps={visualization:null};var TO=We(qO);function IO(e,t,a){var n=sd(a);return Object(r.useCallback)((function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=Object(c.find)(e.visualizations,{id:a})||null;TO.showModal({query:e,visualization:r,queryResult:t}).onClose(t=>{var a=Object(c.filter)(e.visualizations,e=>e.id!==t.id);n(Object(c.extend)(e.clone(),{visualizations:[...a,t]}),t)})}),[e,t,n])}function DO(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);r=!0);}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return RO(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return RO(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function RO(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function MO(e,t){var a=sd(t);return Object(r.useCallback)(t=>kO.delete({id:t}).then(()=>{var r=Object(c.filter)(e.visualizations,e=>e.id!==t);a(Object(c.extend)(e.clone(),{visualizations:r}))}).catch(()=>{en.error("Error deleting visualization.","Maybe it's used in a dashboard?")}),[e,a])}function zO(e,t){var a=og(e,t);return Object(r.useCallback)(t=>{mt("edit_description","query",e.id),a({description:t})},[e.id,a])}function FO(e){return n.a.createElement("img",{src:"static/images/db-logos/".concat(e.type,".png"),width:"20",alt:e.alt})}function UO(e){var t=e.dataSource,a=e.children;return n.a.createElement(n.a.Fragment,null,n.a.createElement(FO,{type:t.type,"aria-label":t.name,title:t.name}),a||n.a.createElement("span",null,t.name))}function VO(e){return n.a.createElement(Li.a,{className:"w-100","data-test":"SelectDataSource",placeholder:"Choose data source...",value:e.value,disabled:e.disabled,loading:e.loading,optionFilterProp:"data-name",showSearch:!0,onChange:e.onChange},Object(c.map)(e.dataSources,e=>n.a.createElement(Li.a.Option,{key:"ds-".concat(e.id),value:e.id,"data-name":e.name,"data-test":"SelectDataSource".concat(e.id)},n.a.createElement(le,{name:"QuerySourceDropdownItem",dataSource:e}))))}FO.propTypes={type:ae.a.string,alt:ae.a.string},UO.propTypes={dataSource:ae.a.shape({name:ae.a.string,id:ae.a.oneOfType([ae.a.string,ae.a.number]),type:ae.a.string}).isRequired,children:ae.a.element},oe("QuerySourceDropdownItem",UO),VO.propTypes={dataSources:ae.a.any,value:ae.a.oneOfType([ae.a.string,ae.a.number]),disabled:ae.a.bool,loading:ae.a.bool,onChange:ae.a.func},oe("QuerySourceDropdown",VO);a(1766);function LO(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function BO(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?LO(Object(a),!0).forEach((function(t){QO(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):LO(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function QO(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function WO(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);r=!0);}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return HO(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return HO(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function HO(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function GO(e){var t,a=function(e){var t=zv(Object(r.useState)(e),2),a=t[0],n=t[1],i=zv(Object(r.useState)(e.query),2),s=i[0],o=i[1],l=zv(Object(r.useState)(a.options.apply_auto_limit),2),u=l[0],d=l[1],m=og(a,e=>{e.id!==a.id&&ct(e.getUrl(!0),!0),n(e),o(e.query),d(e.options.apply_auto_limit)});return Object(r.useMemo)(()=>({query:a,setQuery:n,isDirty:a.query!==s||!Object(c.isEmpty)(a.query)&&a.options.apply_auto_limit!==u,saveQuery:()=>m()}),[a,s,m,u])}(e.query),i=a.query,s=a.setQuery,o=a.isDirty,l=a.saveQuery,u=function(e){var t=cO(Object(r.useState)([]),2),a=t[0],n=t[1],i=cO(Object(r.useState)(!1),2),s=i[0],o=i[1],l=Object(r.useMemo)(()=>Object(c.filter)(a,t=>!t.view_only||t.id===e.data_source_id),[a,e.data_source_id]),u=Object(r.useMemo)(()=>Object(c.find)(l,t=>Object(c.toString)(t.id)===Object(c.toString)(e.data_source_id))||null,[e.data_source_id,l]);return Object(r.useEffect)(()=>{var e=!1;return Bf.query().then(t=>{e||(o(!0),n(t))}),()=>{e=!0}},[]),Object(r.useMemo)(()=>({dataSourcesLoaded:s,dataSources:l,dataSource:u}),[s,l,u])}(i),d=u.dataSourcesLoaded,m=u.dataSources,p=u.dataSource,h=WO(Object(r.useState)([]),2),b=h[0],g=h[1],y=Xb(i,p),v=WO(pO(i),3),O=v[0],E=v[1],j=v[2],w=WO(Lv(i.visualizations),2),S=w[0],P=w[1],C=(t=p&&p.type,qv(qv({},Iv.get(null)),Iv.get(t))),N=C.QueryEditor,k=C.SchemaBrowser,x=!Mb()({minWidth:768});!function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=Object(r.useRef)();t.current=e,Object(r.useEffect)(()=>{var e="".concat("You will lose your changes if you leave","\n\nAre you sure you want to leave this page?"),a=window.onbeforeunload;window.onbeforeunload=function(){return t.current?"You will lose your changes if you leave":void 0};var r=q.confirmChange((a,r)=>{if(t.current&&a.path!==r.path)return e});return()=>{window.onbeforeunload=a,r()}},[])}(o);var A=lO(i),_=A.queryResult,T=A.isExecuting,I=A.executionStatus,D=A.executeQuery,R=A.error,M=A.cancelCallback,z=A.isCancelling,F=A.updatedAt,U=A.loadedInitialResults,V=id(_),L=Object(r.useRef)(null),B=WO(Wv(b),3),Q=B[0],W=B[1],H=B[2],G=WO(Jv(p,i,s),3),K=G[0],Y=G[1],$=G[2],J=WO(Object(Ao.a)(e=>{s(Object(c.extend)(i.clone(),{query:e}))},100),1)[0];Object(r.useEffect)(()=>{mt("view_source","query",i.id)},[i.id]),Object(r.useEffect)(()=>{document.title=i.name},[i.name]);var X=og(i,s),Z=zO(i,s),ee=p?p.syntax||"sql":null,te=Jb(ee),ae=Object(r.useCallback)(e=>{if(e)try{localStorage.setItem("lastSelectedDataSourceId",e)}catch(e){}if(i.data_source_id!==e){mt("update_data_source","query",i.id,{dataSourceId:e});var t={data_source_id:e,latest_query_data_id:null,latest_query_data:null};s(Object(c.extend)(i.clone(),t)),X(t,{successMessage:null})}},[i,s,X]);Object(r.useEffect)(()=>{if(d&&y.isNew){var e=m.length>0?m[0].id:null;ae((t=[i.data_source_id,localStorage.getItem("lastSelectedDataSourceId"),e],a=m,a=Object(c.map)(a,e=>e.id),Object(c.find)(t,e=>Object(c.includes)(a,e))||null))}var t,a},[i.data_source_id,y.isNew,d,m,ae]);var re=NO(i,s),ne=function(e,t){var a=sd(t);return Object(r.useCallback)(()=>{zu.showModal({parameter:{title:null,name:"",type:"text",value:null},existingParams:Object(c.map)(e.getParameters().get(),e=>e.name)}).onClose(t=>{var r=e.clone();t=r.getParameters().add(t),a(r,t)})},[e,a])}(i,(e,t)=>{L.current&&(L.current.paste(t.toQueryTextFragment()),L.current.focus()),s(e)}),ie=Object(r.useCallback)(e=>{L.current&&L.current.paste(e)},[]),se=WO(Object(r.useState)(null),2),oe=se[0],ce=se[1],ue=Object(r.useCallback)((function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];y.canExecute&&(e||!E&&!T)&&(o||!Object(c.isEmpty)(oe)?D(null,()=>i.getQueryResultByText(0,oe)):D())}),[i,y.canExecute,E,T,o,oe,D]),de=WO(Object(r.useState)(!1),2),pe=de[0],he=de[1],fe=Object(r.useCallback)(()=>{pe||(he(!0),l().finally(()=>he(!1)))},[pe,l]),be=function(e,t,a,n){var i=Xb(e),s=IO(e,t,n),o=DO(Object(r.useState)(!1),2),l=o[0],c=o[1];return Object(r.useEffect)(()=>{!i.isNew&&l&&(c(!1),s())},[i.isNew,l,s]),Object(r.useCallback)(()=>{i.isNew?(c(!0),a()):s()},[i.isNew,a,s])}(i,_,fe,(e,t)=>{s(e),P(t.id)}),ge=IO(i,_,e=>s(e)),ye=MO(i,s);return n.a.createElement("div",{className:me()("query-page-wrapper",{"query-fixed-layout":!x})},n.a.createElement(zg,{query:i,dataSourcesAvailable:!d||m.length>0}),n.a.createElement("div",{className:"container w-100 p-b-10"},n.a.createElement(Cg,{query:i,dataSource:p,sourceMode:!0,selectedVisualization:S,headerExtra:n.a.createElement(le,{name:"QuerySource.HeaderExtra",query:i}),onChange:s})),n.a.createElement("main",{className:"query-fullscreen"},n.a.createElement(Gb,{direction:"horizontal",sizeAttribute:"flex-basis",toggleShortcut:"Alt+Shift+D, Alt+D"},n.a.createElement("nav",null,d&&n.a.createElement("div",{className:"editor__left__data-source"},n.a.createElement(le,{name:"QuerySourceDropdown",dataSources:m,value:p?p.id:void 0,disabled:!y.canEdit||!d||0===m.length,loading:!d,onChange:ae})),n.a.createElement("div",{className:"editor__left__schema"},n.a.createElement(k,{dataSource:p,options:i.options.schemaOptions,onOptionsUpdate:e=>s(Object(c.extend)(i.clone(),{options:BO(BO({},i.options),{},{schemaOptions:e})})),onSchemaUpdate:g,onItemSelect:ie})),!i.isNew()&&n.a.createElement("div",{className:"query-page-query-description"},n.a.createElement(eh,{isEditable:y.canEdit,markdown:!0,ignoreBlanks:!1,placeholder:"Add description",value:i.description,onDone:Z,multiline:!0})),!i.isNew()&&n.a.createElement(Ng,{layout:"table",query:i,onEditSchedule:re}))),n.a.createElement("div",{className:"content"},n.a.createElement("div",{className:"flex-fill p-relative"},n.a.createElement("div",{className:"p-absolute d-flex flex-column p-l-15 p-r-15",style:{left:0,top:0,right:0,bottom:0,overflow:"auto"}},n.a.createElement(Gb,{direction:"vertical",sizeAttribute:"flex-basis"},n.a.createElement("div",{className:"row editor"},n.a.createElement("section",{className:"query-editor-wrapper","data-test":"QueryEditor"},n.a.createElement(N,{ref:L,"data-executing":T?"true":null,syntax:p?p.syntax:null,value:i.query,schema:b,autocompleteEnabled:Q&&W,onChange:J,onSelectionChange:ce}),n.a.createElement(N.Controls,{addParameterButtonProps:{title:"Add New Parameter",shortcut:"mod+p",onClick:ne},formatButtonProps:{title:te?"Format Query":"Query formatting is not supported for your Data Source syntax",disabled:!p||!te,shortcut:te?"mod+shift+f":null,onClick:()=>{try{var e=(t=i.query,Jb(a=ee)?(0,$b[a])(t):t);s(Object(c.extend)(i.clone(),{query:e}))}catch(e){en.error(String(e))}var t,a}},saveButtonProps:y.canEdit&&{text:n.a.createElement(n.a.Fragment,null,n.a.createElement("span",{className:"hidden-xs"},"Save"),o&&!pe?"*":null),shortcut:"mod+s",onClick:fe,loading:pe},executeButtonProps:{disabled:!y.canExecute||T||E,shortcut:"mod+enter, alt+enter, ctrl+enter, shift+enter",onClick:ue,text:n.a.createElement("span",{className:"hidden-xs"},null===oe?"Execute":"Execute Selected")},autocompleteToggleProps:{available:Q,enabled:W,onToggle:H},autoLimitCheckboxProps:{available:K,checked:Y,onChange:$},dataSourceSelectorProps:!!p&&{disabled:!y.canEdit,value:p.id,onChange:ae,options:Object(c.map)(m,e=>({value:e.id,label:e.name}))}})))),!y.isNew&&n.a.createElement(Ng,{layout:"horizontal",query:i,onEditSchedule:re}),n.a.createElement("section",{className:"query-results-wrapper"},i.hasParameters()&&n.a.createElement("div",{className:"query-parameters-wrapper"},n.a.createElement(Vu,{editable:y.canEdit,sortable:y.canEdit,disableUrlUpdate:y.isNew,parameters:O,onPendingValuesChange:()=>j(),onValuesChange:()=>{j(!1),ue(!0)},onParametersEdit:()=>{o||l()}})),(R||T)&&n.a.createElement("div",{className:"query-alerts"},n.a.createElement(Mg,{status:I,updatedAt:F,error:R,isCancelling:z,onCancel:M})),n.a.createElement(n.a.Fragment,null,V.log.length>0&&n.a.createElement("div",{className:"query-results-log"},n.a.createElement("p",null,"Log Information:"),Object(c.map)(V.log,(e,t)=>n.a.createElement("p",{key:"log-line-".concat(t),className:"query-log-line"},e))),U&&!(y.isNew&&!_)&&n.a.createElement(Rg,{queryResult:_,visualizations:i.visualizations,showNewVisualizationButton:y.canEdit&&V.status===Rt,canDeleteVisualizations:y.canEdit,selectedTab:S,onChangeTab:P,onAddVisualization:be,onDeleteVisualization:ye,refreshButton:n.a.createElement(f.a,{type:"primary",disabled:!y.canExecute||E,loading:T,onClick:ue},!T&&n.a.createElement("i",{className:"zmdi zmdi-refresh m-r-5","aria-hidden":"true"}),"Refresh Now")}))))),_&&!_.getError()&&n.a.createElement("div",{className:"bottom-controller-container"},n.a.createElement(hy,{query:i,queryResult:_,selectedVisualization:S,isQueryExecuting:T,showEditVisualizationButton:!y.isNew&&y.canEdit,onEditVisualization:ge})))))}GO.propTypes={query:ae.a.object.isRequired};var KO=Bg(GO);pn.register("Queries.New",zr({path:"/queries/new",render:e=>n.a.createElement(KO,e),bodyClass:"fixed-layout"})),pn.register("Queries.Edit",zr({path:"/queries/:queryId/source",render:e=>n.a.createElement(KO,e),bodyClass:"fixed-layout"}));var YO=a(711),$O=a.n(YO),JO=a(710),XO=a.n(JO);function ZO(){return(ZO=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function eE(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);r=!0);}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return tE(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return tE(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function tE(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function aE(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},i=Object.keys(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function rE(e){var t=e.title,a=e.shortcut,i=e.disabled,s=e.children,o=e.onClick,l=aE(e,["title","shortcut","disabled","children","onClick"]),c=eE(Object(r.useState)(!1),2),u=c[0],d=c[1],m=Object(r.useMemo)(()=>({onMouseEnter:()=>d(!0),onMouseLeave:()=>d(!1)}),[]);return Object(r.useEffect)(()=>{i&&d(!1)},[i]),Object(r.useEffect)(()=>{if(a){var e={[a]:o};return yc.bind(e),()=>{yc.unbind(e)}}},[a,o]),n.a.createElement(Jy,{title:t,shortcut:a,visible:u},n.a.createElement("span",m,n.a.createElement(f.a,ZO({"data-test":"ExecuteButton",disabled:i,onClick:o,style:i?{pointerEvents:"none"}:{}},l),s)))}rE.propTypes={className:ae.a.string,shortcut:ae.a.string,disabled:ae.a.bool,children:ae.a.node,onClick:ae.a.func},rE.defaultProps={className:null,shortcut:null,disabled:!1,children:null,onClick:()=>{}};a(1767);function nE(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);r=!0);}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return iE(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return iE(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function iE(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function sE(e){var t=nE(Object(r.useState)(e.query),2),a=t[0],i=t[1],s=nE(Object(r.useState)(),2),o=s[0],l=s[1],c=Xb(a,o),u=nE(pO(a),3),d=u[0],m=u[1],p=u[2],h=nE(Lv(a.visualizations),2),b=h[0],g=h[1],y=Mb()({minWidth:768}),v=Mb()({minHeight:500})&&y,O=nE(Ip(),2),E=O[0],j=O[1],w=nE(Object(r.useState)(!1),2),S=w[0],P=w[1],C=lO(a),N=C.queryResult,k=C.loadedInitialResults,x=C.isExecuting,A=C.executionStatus,_=C.executeQuery,q=C.error,T=C.cancelCallback,I=C.isCancelling,D=C.updatedAt,R=id(N),M=zO(a,i),z=NO(a,i),F=IO(a,N,(e,t)=>{i(e),g(t.id)}),U=IO(a,N,e=>i(e)),V=MO(a,i),L=Object(r.useCallback)((function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];c.canExecute&&(e||!m&&!x)&&_()}),[m,_,x,c.canExecute]);return Object(r.useEffect)(()=>{document.title=a.name},[a.name]),Object(r.useEffect)(()=>{Bf.get({id:a.data_source_id}).then(l)},[a.data_source_id]),n.a.createElement("div",{className:me()("query-page-wrapper",{"query-view-fullscreen":E,"query-fixed-layout":v})},n.a.createElement("div",{className:"container w-100"},n.a.createElement(Cg,{query:a,dataSource:o,onChange:i,selectedVisualization:b,headerExtra:n.a.createElement(le,{name:"QueryView.HeaderExtra",query:a},Z.canRun(a)&&n.a.createElement(rE,{className:"m-r-5",type:"primary",shortcut:"mod+enter, alt+enter, ctrl+enter",disabled:!c.canExecute||x||m,onClick:L},"Refresh")),tagsExtra:!a.description&&c.canEdit&&!S&&!E&&n.a.createElement(fe,{className:"label label-tag hidden-xs",role:"none",onClick:()=>P(!0)},n.a.createElement("i",{className:"zmdi zmdi-plus m-r-5","aria-hidden":"true"}),"Add description")}),(a.description||S)&&n.a.createElement("div",{className:me()("m-t-5",{hidden:E})},n.a.createElement(eh,{className:"w-100",value:a.description,isEditable:c.canEdit,onDone:M,onStopEditing:()=>P(!1),placeholder:"Add description",ignoreBlanks:!1,editorProps:{autoSize:{minRows:2,maxRows:4}},defaultEditing:S,multiline:!0}))),n.a.createElement("div",{className:"query-view-content"},a.hasParameters()&&n.a.createElement("div",{className:me()("bg-white tiled p-15 m-t-15 m-l-15 m-r-15",{hidden:E})},n.a.createElement(Vu,{parameters:d,onValuesChange:()=>{p(!1),L(!0)},onPendingValuesChange:()=>p()})),n.a.createElement("div",{className:"query-results m-t-15"},k&&n.a.createElement(Rg,{queryResult:N,visualizations:a.visualizations,showNewVisualizationButton:c.canEdit&&R.status===Rt,canDeleteVisualizations:c.canEdit,selectedTab:b,onChangeTab:g,onAddVisualization:F,onDeleteVisualization:V,refreshButton:Z.canRun(a)&&n.a.createElement(f.a,{type:"primary",disabled:!c.canExecute||m,loading:x,onClick:L},!x&&n.a.createElement("i",{className:"zmdi zmdi-refresh m-r-5","aria-hidden":"true"}),"Refresh Now"),canRefresh:Z.canRun(a)}),n.a.createElement("div",{className:"query-results-footer"},N&&!N.getError()&&n.a.createElement(hy,{query:a,queryResult:N,selectedVisualization:b,isQueryExecuting:x,showEditVisualizationButton:c.canEdit,onEditVisualization:U,extraActions:n.a.createElement(rE,{className:"icon-button m-r-5 hidden-xs",title:"Toggle Fullscreen",type:"default",shortcut:"alt+f",onClick:j},E?n.a.createElement(XO.a,null):n.a.createElement($O.a,null))}),(q||x)&&n.a.createElement("div",{className:"query-execution-status"},n.a.createElement(Mg,{status:A,error:q,isCancelling:I,onCancel:T,updatedAt:D})))),n.a.createElement("div",{className:me()("p-t-15 p-r-15 p-l-15",{hidden:E})},n.a.createElement(Ng,{layout:"horizontal",query:a,dataSource:o,onEditSchedule:z}))))}sE.propTypes={query:ae.a.object.isRequired};var oE=Bg(sE);function lE(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);r=!0);}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return cE(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return cE(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function cE(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function uE(e){var t=e.queryName,a=e.queryDescription,r=e.visualization;return n.a.createElement("div",{className:"embed-heading p-b-10 p-r-15 p-l-15"},n.a.createElement("h3",null,n.a.createElement("img",{src:nr.a,alt:"Redash Logo",style:{height:"24px",verticalAlign:"text-bottom"}}),n.a.createElement(Hu,{visualization:r})," ",t,a&&n.a.createElement("small",null,n.a.createElement(uc.a,{className:"markdown text-muted"},lc.markdown.toHTML(a||"")))))}function dE(e){var t=e.query,a=e.queryResults,r=e.updatedAt,i=e.refreshStartedAt,s=e.queryUrl,o=e.hideTimestamp,l=e.apiKey,c=n.a.createElement(ue.a,null,n.a.createElement(ue.a.Item,null,n.a.createElement(cy,{fileType:"csv",query:t,queryResult:a,apiKey:l,disabled:!a||!a.getData||!a.getData(),embed:!0},n.a.createElement(sy.a,null)," Download as CSV File")),n.a.createElement(ue.a.Item,null,n.a.createElement(cy,{fileType:"tsv",query:t,queryResult:a,apiKey:l,disabled:!a||!a.getData||!a.getData(),embed:!0},n.a.createElement(sy.a,null)," Download as TSV File")),n.a.createElement(ue.a.Item,null,n.a.createElement(cy,{fileType:"xlsx",query:t,queryResult:a,apiKey:l,disabled:!a||!a.getData||!a.getData(),embed:!0},n.a.createElement(ly.a,null)," Download as Excel File")));return n.a.createElement("div",{className:"tile__bottom-control"},!o&&n.a.createElement("span",null,n.a.createElement("span",{className:"small hidden-print"},n.a.createElement("i",{className:"zmdi zmdi-time-restore","aria-hidden":"true"})," ",i?n.a.createElement(Qu,{from:i}):n.a.createElement($n,{date:r})),n.a.createElement("span",{className:"small visible-print"},n.a.createElement("i",{className:"zmdi zmdi-time-restore","aria-hidden":"true"})," ",ti(r))),s&&n.a.createElement("span",{className:"hidden-print"},n.a.createElement(Oe,{title:"Open in Redash"},n.a.createElement(O.Button,{className:"icon-button",href:s,target:"_blank"},n.a.createElement("i",{className:"fa fa-external-link","aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},"Open in Redash"))),!t.hasParameters()&&n.a.createElement(Nr.a,{overlay:c,disabled:!a,trigger:["click"],placement:"topLeft"},n.a.createElement(f.a,{loading:!a&&!!i,className:"m-l-5"},"Download Dataset",n.a.createElement("i",{className:"fa fa-caret-up m-l-5","aria-hidden":"true"})))))}function mE(e){var t=e.queryId,a=e.visualizationId,i=e.apiKey,s=e.onError,o=lE(Object(r.useState)(null),2),u=o[0],d=o[1],m=lE(Object(r.useState)(null),2),p=m[0],h=m[1],f=lE(Object(r.useState)(null),2),b=f[0],g=f[1],y=lE(Object(r.useState)(null),2),v=y[0],O=y[1],E=sd(s);Object(r.useEffect)(()=>{var e=!1;return Xt.get({id:t}).then(t=>{e||d(t)}).catch(E),()=>{e=!0}},[t,E]);var j=Object(r.useCallback)(()=>{u&&(h(null),g(l()()),u.getQueryResultPromise().then(e=>{O(e)}).catch(e=>{h(e.getError())}).finally(()=>g(null)))},[u]);if(Object(r.useEffect)(()=>{document.querySelector("body").classList.add("headless"),j()},[j]),!u)return null;var w=Object(c.has)(q.search,"hide_header"),S=Object(c.has)(q.search,"hide_parameters"),P=Object(c.has)(q.search,"hide_link"),C=Object(c.has)(q.search,"hide_timestamp"),N=Object(c.has)(q.search,"showDescription");a=parseInt(a,10);var k=Object(c.find)(u.visualizations,e=>e.id===a);return k?n.a.createElement("div",{className:"tile m-t-10 m-l-10 m-r-10 p-t-10 embed__vis","data-test":"VisualizationEmbed"},!w&&n.a.createElement(uE,{queryName:u.name,queryDescription:N?u.description:null,visualization:k}),n.a.createElement("div",{className:"col-md-12 query__vis"},!S&&u.hasParameters()&&n.a.createElement("div",{className:"p-t-15 p-b-10"},n.a.createElement(Vu,{parameters:u.getParametersDefs(),onValuesChange:j})),p&&n.a.createElement("div",{className:"alert alert-danger","data-test":"ErrorMessage"},"Error: ".concat(p)),!p&&v&&n.a.createElement(Sd,{visualization:k,queryResult:v,context:"widget"}),!v&&b&&n.a.createElement("div",{className:"d-flex justify-content-center"},n.a.createElement("div",{className:"spinner"},n.a.createElement("i",{className:"zmdi zmdi-refresh zmdi-hc-spin zmdi-hc-5x","aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},"Refreshing...")))),n.a.createElement(dE,{query:u,queryResults:v,updatedAt:v?v.getUpdatedAt():void 0,refreshStartedAt:b,queryUrl:P?null:u.getUrl(),hideTimestamp:C,apiKey:i})):(setTimeout(()=>{s(new Error("Visualization does not exist"))},10),null)}function pE(){return(pE=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function hE(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function fE(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?hE(Object(a),!0).forEach((function(t){bE(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):hE(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function bE(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function gE(e){var t=e.querySnippet,a=e.dialog,i=e.readOnly,s=Object(r.useCallback)((e,r,n)=>{var i=Object(c.get)(t,"id");Object(c.isNil)(e.description)&&(e.description=""),a.close(i?fE({id:i},e):e).then(()=>r("Saved.")).catch(()=>n("Failed saving snippet."))},[a,t]),o=!!Object(c.get)(t,"id"),l=[{name:"trigger",title:"Trigger",type:"text",required:!0,autoFocus:!o},{name:"description",title:"Description",type:"text"},{name:"snippet",title:"Snippet",type:"ace",required:!0}].map(e=>fE(fE({},e),{},{readOnly:i,initialValue:Object(c.get)(t,e.name,"")})),u=Pe("querySnippetForm");return n.a.createElement(z.a,pE({},a.props,{title:o?t.trigger:"Create Query Snippet",footer:[n.a.createElement(f.a,pE({key:"cancel"},a.props.cancelButtonProps,{onClick:a.dismiss}),i?"Close":"Cancel"),!i&&n.a.createElement(f.a,pE({key:"submit"},a.props.okButtonProps,{disabled:i||a.props.okButtonProps.disabled,htmlType:"submit",type:"primary",form:u,"data-test":"SaveQuerySnippetButton"}),o?"Save":"Create")],wrapProps:{"data-test":"QuerySnippetDialog"}}),n.a.createElement(kf,{id:u,fields:l,onSubmit:s,hideSubmitButton:!0,feedbackIcons:!0}))}pn.register("Queries.View",zr({path:"/queries/:queryId",render:e=>n.a.createElement(oE,e)})),uE.propTypes={queryName:ae.a.string.isRequired,queryDescription:ae.a.string,visualization:d.VisualizationType.isRequired},uE.defaultProps={queryDescription:""},dE.propTypes={query:ae.a.object.isRequired,queryResults:ae.a.object,updatedAt:ae.a.string,refreshStartedAt:Gn,queryUrl:ae.a.string,hideTimestamp:ae.a.bool,apiKey:ae.a.string},dE.defaultProps={queryResults:null,updatedAt:null,refreshStartedAt:null,queryUrl:null,hideTimestamp:!1,apiKey:null},mE.propTypes={queryId:ae.a.string.isRequired,visualizationId:ae.a.string,apiKey:ae.a.string.isRequired,onError:ae.a.func},mE.defaultProps={onError:()=>{}},pn.register("Visualizations.ViewShared",Sh({path:"/embed/query/:queryId/visualization/:visualizationId",render:e=>n.a.createElement(mE,e),getApiKey:()=>q.search.api_key})),gE.propTypes={dialog:Qe.isRequired,querySnippet:ae.a.object,readOnly:ae.a.bool},gE.defaultProps={querySnippet:null,readOnly:!1};var yE=We(gE);a(1772);function vE(){return(vE=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function OE(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var EE=e=>W.isAdmin||W.id===Object(c.get)(e,"user.id");class jE extends n.a.Component{constructor(){var e;super(...arguments),e=this,OE(this,"listColumns",[gi.custom.sortable((e,t)=>n.a.createElement(fe,{type:"link",className:"table-main-title",onClick:()=>this.showSnippetDialog(t)},t.trigger),{title:"Trigger",field:"trigger",className:"text-nowrap"}),gi.custom.sortable(e=>e,{title:"Description",field:"description",className:"text-nowrap"}),gi.custom(e=>n.a.createElement("code",{className:"snippet-content"},e),{title:"Snippet",field:"snippet"}),gi.avatar({field:"user",className:"p-l-0 p-r-0"},e=>"Created by ".concat(e)),gi.date.sortable({title:"Created At",field:"created_at",className:"text-nowrap",width:"1%"}),gi.custom((e,t)=>EE(t)&&n.a.createElement(f.a,{type:"danger",className:"w-100",onClick:e=>this.deleteQuerySnippet(e,t)},"Delete"),{width:"1%"})]),OE(this,"saveQuerySnippet",e=>(e.id?Hy.save:Hy.create)(e)),OE(this,"deleteQuerySnippet",(e,t)=>{z.a.confirm({title:"Delete Query Snippet",content:"Are you sure you want to delete this query snippet?",okText:"Yes",okType:"danger",cancelText:"No",onOk:()=>{Hy.delete(t).then(()=>{en.success("Query snippet deleted successfully."),this.props.controller.update()}).catch(()=>{en.error("Failed deleting query snippet.")})}})}),OE(this,"showSnippetDialog",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,a=!t||EE(t);ct("query_snippets/"+Object(c.get)(t,"id","new"),!0);var r=()=>ct("query_snippets",!0);yE.showModal({querySnippet:t,readOnly:!a}).onClose(t=>e.saveQuerySnippet(t).then(()=>{e.props.controller.update(),r()})).onDismiss(r)}))}componentDidMount(){var e=this.props.controller.params,t=e.isNewOrEditPage,a=e.querySnippetId;t&&("new"===a?Z.isCreateQuerySnippetEnabled()?this.showSnippetDialog():ct("query_snippets",!0):Hy.get({id:a}).then(this.showSnippetDialog).catch(e=>{this.props.controller.handleError(e)}))}render(){var e=this.props.controller;return n.a.createElement("div",null,n.a.createElement("div",{className:"m-b-15"},n.a.createElement(f.a,{type:"primary",onClick:()=>this.showSnippetDialog(),disabled:!Z.isCreateQuerySnippetEnabled()},n.a.createElement("i",{className:"fa fa-plus m-r-5","aria-hidden":"true"}),"New Query Snippet")),!e.isLoaded&&n.a.createElement(Ts,{className:""}),e.isLoaded&&e.isEmpty&&n.a.createElement("div",{className:"text-center"},"There are no query snippets yet.",Z.isCreateQuerySnippetEnabled()&&n.a.createElement("div",{className:"m-t-5"},n.a.createElement(fe,{type:"link",onClick:()=>this.showSnippetDialog()},"Click here")," ","to add one.")),e.isLoaded&&!e.isEmpty&&n.a.createElement("div",{className:"table-responsive query-snippets-table"},n.a.createElement(yi,{items:e.pageItems,columns:this.listColumns,context:this.actions,orderByField:e.orderByField,orderByReverse:e.orderByReverse,toggleSorting:e.toggleSorting}),n.a.createElement(Ui,{showPageSizeSelect:!0,totalCount:e.totalItemsCount,pageSize:e.itemsPerPage,onPageSizeChange:t=>e.updatePagination({itemsPerPage:t}),page:e.page,onChange:t=>e.updatePagination({page:t})})))}}OE(jE,"propTypes",{controller:ds.isRequired});var wE=zf("QuerySnippets.List",{permission:"create_query",title:"Query Snippets",path:"query_snippets",order:5},ms(jE,()=>new Ns({isPlainList:!0,getRequest:()=>({}),getResource:()=>Hy.query.bind(Hy)}),()=>new As({orderByField:"trigger",itemsPerPage:10})));pn.register("QuerySnippets.List",zr({path:"/query_snippets",title:"Query Snippets",render:e=>n.a.createElement(wE,vE({},e,{currentPage:"query_snippets"}))})),pn.register("QuerySnippets.NewOrEdit",zr({path:"/query_snippets/:querySnippetId",title:"Query Snippets",render:e=>n.a.createElement(wE,vE({},e,{currentPage:"query_snippets",isNewOrEditPage:!0}))}));a(1773);function SE(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function PE(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?SE(Object(a),!0).forEach((function(t){CE(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):SE(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function CE(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function NE(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);r=!0);}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return kE(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return kE(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function kE(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function xE(e){var t=e.onError,a=NE(Object(r.useState)({}),2),n=a[0],i=a[1],s=NE(Object(r.useState)({}),2),o=s[0],l=s[1],u=NE(Object(r.useState)(!0),2),d=u[0],m=u[1],p=NE(Object(r.useState)(!1),2),h=p[0],f=p[1],b=sd(t);Object(r.useEffect)(()=>{mt("view","page","org_settings");var e=!1;return tn().then(t=>{if(!e){var a=Object(c.get)(t,"settings");i(a),l(PE({},a)),m(!1)}}).catch(t=>{e||b(t)}),()=>{e=!0}},[b]);var g=Object(r.useCallback)(e=>{l(t=>PE(PE({},t),e))},[]),y=Object(r.useCallback)(()=>{h||(f(!0),an(o).then(e=>{var t,a=Object(c.get)(e,"settings");i(a),l(PE({},a)),t={dateFormat:o.date_format,timeFormat:o.time_format,dateTimeFormat:"".concat(o.date_format," ").concat(o.time_format)},Object(c.extend)(H,t)}).catch(b).finally(()=>f(!1)))},[h,o,b]);return{settings:n,currentValues:o,isLoading:d,isSaving:h,handleSubmit:y,handleChange:g}}var AE={settings:ae.a.object,values:ae.a.object,onChange:ae.a.func,loading:ae.a.bool},_E={settings:{},values:{},onChange:()=>{},loading:!1};function qE(){return(qE=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function TE(e){var t=e.values,a=e.onChange,r=e.loading;return n.a.createElement(le,qE({name:"OrganizationSettings.FormatSettings"},e),n.a.createElement(co.a.Item,{label:"Date Format"},r?n.a.createElement(Dn.a.Input,{style:{width:300},active:!0}):n.a.createElement(Li.a,{value:t.date_format,onChange:e=>a({date_format:e}),"data-test":"DateFormatSelect"},H.dateFormatList.map(e=>n.a.createElement(Li.a.Option,{key:e,"data-test":"DateFormatSelect:".concat(e)},e)))),n.a.createElement(co.a.Item,{label:"Time Format"},r?n.a.createElement(Dn.a.Input,{style:{width:300},active:!0}):n.a.createElement(Li.a,{value:t.time_format,onChange:e=>a({time_format:e}),"data-test":"TimeFormatSelect"},H.timeFormatList.map(e=>n.a.createElement(Li.a.Option,{key:e},e)))))}function IE(){return(IE=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function DE(e){var t=e.values,a=e.onChange,r=e.loading;return n.a.createElement(le,IE({name:"OrganizationSettings.PlotlySettings"},e),n.a.createElement(co.a.Item,{label:"Chart Visualization"},r?n.a.createElement(Dn.a,{title:{width:300},paragraph:!1,active:!0}):n.a.createElement(Vl.a,{name:"hide_plotly_mode_bar",checked:t.hide_plotly_mode_bar,onChange:e=>a({hide_plotly_mode_bar:e.target.checked})},"Hide Plotly mode bar")))}TE.propTypes=AE,TE.defaultProps=_E,DE.propTypes=AE,DE.defaultProps=_E;var RE=a(194),ME=a.n(RE);function zE(){return(zE=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function FE(e){var t=e.values,a=e.onChange,r=e.loading;return n.a.createElement(le,zE({name:"OrganizationSettings.FeatureFlagsSettings"},e),n.a.createElement(co.a.Item,{label:"Feature Flags"},r?n.a.createElement(n.a.Fragment,null,n.a.createElement(ME.a,null,n.a.createElement(Dn.a,{title:!1,paragraph:{width:[300,300,300],rows:3},active:!0}))):n.a.createElement(n.a.Fragment,null,n.a.createElement(le,zE({name:"OrganizationSettings.FeatureFlagsSettings.PermissionsControl"},e),n.a.createElement(ME.a,null,n.a.createElement(Vl.a,{name:"feature_show_permissions_control",checked:t.feature_show_permissions_control,onChange:e=>a({feature_show_permissions_control:e.target.checked})},"Enable experimental multiple owners support"))),n.a.createElement(ME.a,null,n.a.createElement(Vl.a,{name:"send_email_on_failed_scheduled_queries",checked:t.send_email_on_failed_scheduled_queries,onChange:e=>a({send_email_on_failed_scheduled_queries:e.target.checked})},"Email query owners when scheduled queries fail")),n.a.createElement(ME.a,null,n.a.createElement(Vl.a,{name:"multi_byte_search_enabled",checked:t.multi_byte_search_enabled,onChange:e=>a({multi_byte_search_enabled:e.target.checked})},"Enable multi-byte (Chinese, Japanese, and Korean) search for query names and descriptions (slower)")))))}function UE(){return(UE=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function VE(e){var t=e.values,a=e.onChange,r=e.loading;return n.a.createElement(le,UE({name:"OrganizationSettings.BeaconConsentSettings"},e),n.a.createElement(co.a.Item,{label:n.a.createElement("span",null,"Anonymous Usage Data Sharing",n.a.createElement(Me,{className:"m-l-5 m-r-5",type:"USAGE_DATA_SHARING"}))},r?n.a.createElement(Dn.a,{title:{width:300},paragraph:!1,active:!0}):n.a.createElement(Vl.a,{name:"beacon_consent",checked:t.beacon_consent,onChange:e=>a({beacon_consent:e.target.checked})},"Help Redash improve by automatically sending anonymous usage data")))}function LE(){return(LE=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function BE(e){return n.a.createElement(le,LE({name:"OrganizationSettings.GeneralSettings"},e),n.a.createElement("h3",{className:"m-t-0"},"General"),n.a.createElement("hr",null),n.a.createElement(TE,e),n.a.createElement(DE,e),n.a.createElement(FE,e),n.a.createElement(VE,e))}function QE(){return(QE=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function WE(e){var t=e.settings,a=e.values,r=e.onChange,i=e.loading,s=!H.googleLoginEnabled&&!H.ldapLoginEnabled&&!a.auth_saml_enabled;return n.a.createElement(le,QE({name:"OrganizationSettings.PasswordLoginSettings"},e),!i&&!t.auth_password_login_enabled&&n.a.createElement(p.a,{message:"Password based login is currently disabled and users will be able to login only with the enabled SSO options.",type:"warning",className:"m-t-15 m-b-15"}),n.a.createElement(co.a.Item,{label:"Password Login"},i?n.a.createElement(Dn.a,{title:{width:300},paragraph:!1,active:!0}):n.a.createElement(Vl.a,{checked:a.auth_password_login_enabled,disabled:s,onChange:e=>r({auth_password_login_enabled:e.target.checked})},n.a.createElement(Oe,{title:s?"Password login can be disabled only if another login method is enabled.":null,placement:"right"},"Password Login Enabled"))))}function HE(){return(HE=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function GE(e){var t=e.values,a=e.onChange;return H.googleLoginEnabled?n.a.createElement(le,HE({name:"OrganizationSettings.GoogleLoginSettings"},e),n.a.createElement("h4",null,"Google Login"),n.a.createElement(co.a.Item,{label:"Allowed Google Apps Domains"},n.a.createElement(Li.a,{mode:"tags",value:t.auth_google_apps_domains,onChange:e=>a({auth_google_apps_domains:e})}),!Object(c.isEmpty)(t.auth_google_apps_domains)&&n.a.createElement(p.a,{message:n.a.createElement("p",null,"Any user registered with a ",n.a.createElement("strong",null,Object(c.join)(t.auth_google_apps_domains,", "))," Google Apps account will be able to login. If they don't have an existing user, a new user will be created and join the ",n.a.createElement("strong",null,"Default")," group."),className:"m-t-15"}))):null}function KE(){return(KE=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function YE(e){var t=e.values,a=e.onChange,r=e.loading;return n.a.createElement(le,KE({name:"OrganizationSettings.SAMLSettings"},e),n.a.createElement("h4",null,"SAML"),n.a.createElement(co.a.Item,{label:"SAML Enabled"},r?n.a.createElement(Dn.a,{title:{width:300},paragraph:!1,active:!0}):n.a.createElement(Td.a.Group,{onChange:e=>{var t={auth_saml_enabled:!!e.target.value};e.target.value&&(t.auth_saml_type=e.target.value),a(t)},value:t.auth_saml_enabled&&(t.auth_saml_type||"dynamic")},n.a.createElement(Td.a,{value:!1},"Disabled"),n.a.createElement(Td.a,{value:"static"},"Enabled (Static)"),n.a.createElement(Td.a,{value:"dynamic"},"Enabled (Dynamic)"))),t.auth_saml_enabled&&n.a.createElement(n.a.Fragment,null,"static"===t.auth_saml_type&&n.a.createElement(n.a.Fragment,null,n.a.createElement(co.a.Item,{label:"SAML Single Sign-on URL"},n.a.createElement(Fe.a,{value:t.auth_saml_sso_url,onChange:e=>a({auth_saml_sso_url:e.target.value})})),n.a.createElement(co.a.Item,{label:"SAML Entity ID"},n.a.createElement(Fe.a,{value:t.auth_saml_entity_id,onChange:e=>a({auth_saml_entity_id:e.target.value})})),n.a.createElement(co.a.Item,{label:"SAML x509 cert"},n.a.createElement(Fe.a,{value:t.auth_saml_x509_cert,onChange:e=>a({auth_saml_x509_cert:e.target.value})}))),"dynamic"===t.auth_saml_type&&n.a.createElement(n.a.Fragment,null,n.a.createElement(co.a.Item,{label:"SAML Metadata URL"},n.a.createElement(Fe.a,{value:t.auth_saml_metadata_url,onChange:e=>a({auth_saml_metadata_url:e.target.value})})),n.a.createElement(co.a.Item,{label:"SAML Entity ID"},n.a.createElement(Fe.a,{value:t.auth_saml_entity_id,onChange:e=>a({auth_saml_entity_id:e.target.value})})),n.a.createElement(co.a.Item,{label:"SAML NameID Format"},n.a.createElement(Fe.a,{value:t.auth_saml_nameid_format,onChange:e=>a({auth_saml_nameid_format:e.target.value})})))))}function $E(){return($E=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function JE(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function XE(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?JE(Object(a),!0).forEach((function(t){ZE(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):JE(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function ZE(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function ej(e){var t=e.values,a=e.onChange,i=Object(r.useCallback)(e=>{var r=XE(XE({},t),e);!H.googleLoginEnabled&&!H.ldapLoginEnabled&&!r.auth_saml_enabled&&(e=XE(XE({},e),{},{auth_password_login_enabled:!0})),a(e)},[t,a]);return n.a.createElement(le,$E({name:"OrganizationSettings.AuthSettings"},e),n.a.createElement("h3",{className:"m-t-0"},"Authentication ",n.a.createElement(Me,{type:"AUTHENTICATION_OPTIONS"})),n.a.createElement("hr",null),n.a.createElement(WE,$E({},e,{onChange:i})),n.a.createElement(GE,$E({},e,{onChange:i})),n.a.createElement(YE,$E({},e,{onChange:i})))}function tj(){return(tj=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function aj(e){var t=xE(e.onError),a=t.settings,r=t.currentValues,i=t.isLoading,s=t.isSaving,o=t.handleSubmit,l=t.handleChange;return n.a.createElement("div",{className:"row","data-test":"OrganizationSettings"},n.a.createElement("div",{className:"m-r-20 m-l-20"},n.a.createElement(co.a,tj({},{labelCol:{xs:{span:24},sm:{span:6},lg:{span:4}},wrapperCol:{xs:{span:24},sm:{span:12},lg:{span:10}},layout:"horizontal",className:"ant-form-horizontal--labels-left"},{onFinish:o}),n.a.createElement(BE,{loading:i,settings:a,values:r,onChange:l}),n.a.createElement(ej,{loading:i,settings:a,values:r,onChange:l}),n.a.createElement(co.a.Item,{wrapperCol:{xs:{span:24},sm:{span:12,offset:6},lg:{span:12,offset:4}}},i?n.a.createElement(Dn.a.Button,{active:!0}):n.a.createElement(f.a,{type:"primary",htmlType:"submit",loading:s,"data-test":"OrganizationSettingsSaveButton"},"Save")))))}FE.propTypes=AE,FE.defaultProps=_E,VE.propTypes=AE,VE.defaultProps=_E,WE.propTypes=AE,WE.defaultProps=_E,GE.propTypes=AE,GE.defaultProps=_E,YE.propTypes=AE,YE.defaultProps=_E,ej.propTypes=AE,ej.defaultProps=_E,aj.propTypes={onError:ae.a.func},aj.defaultProps={onError:()=>{}};var rj=zf("Settings.Organization",{permission:"admin",title:"General",path:"settings/general",order:6},aj);function nj(e){var t=new URL(e,window.location);return t.protocol=window.location.protocol,t.host=window.location.host,t.toString()}function ij(){return(ij=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function sj(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);r=!0);}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return oj(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return oj(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function oj(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}pn.register("Settings.Organization",zr({path:"/settings/general",title:"General Settings",render:e=>n.a.createElement(rj,e)}));var lj=[{required:!0,name:"name",title:"Name",type:"text",autoFocus:!0},{required:!0,name:"email",title:"Email",type:"email"}];function cj(e){var t=e.dialog,a=sj(Object(r.useState)(null),2),i=a[0],s=a[1];Object(r.useEffect)(()=>{mt("view","page","users/new")},[]);var o=Object(r.useCallback)(e=>t.close(e).catch(s),[t]),l=Pe("userForm");return n.a.createElement(z.a,ij({},t.props,{title:"Create a New User",footer:[n.a.createElement(f.a,ij({key:"cancel"},t.props.cancelButtonProps,{onClick:t.dismiss}),"Cancel"),n.a.createElement(f.a,ij({key:"submit"},t.props.okButtonProps,{htmlType:"submit",type:"primary",form:l,"data-test":"SaveUserButton"}),"Create")],wrapProps:{"data-test":"CreateUserDialog"}}),n.a.createElement(kf,{id:l,fields:lj,onSubmit:o,hideSubmitButton:!0}),i&&n.a.createElement(p.a,{message:i.message,type:"error",showIcon:!0,"data-test":"CreateUserErrorAlert"}))}cj.propTypes={dialog:Qe.isRequired};var uj=We(cj);function dj(){return(dj=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function mj(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function pj(e){var t=e.user,a=e.enableUser,r=e.disableUser,i=e.deleteUser;return t.id===W.id?null:t.is_invitation_pending?n.a.createElement(f.a,{type:"danger",className:"w-100",onClick:e=>i(e,t)},"Delete"):t.is_disabled?n.a.createElement(f.a,{type:"primary",className:"w-100",onClick:e=>a(e,t)},"Enable"):n.a.createElement(f.a,{className:"w-100",onClick:e=>r(e,t)},"Disable")}pj.propTypes={user:ae.a.shape({id:ae.a.number,is_invitation_pending:ae.a.bool,is_disabled:ae.a.bool}).isRequired,enableUser:ae.a.func.isRequired,disableUser:ae.a.func.isRequired,deleteUser:ae.a.func.isRequired};class hj extends n.a.Component{constructor(){super(...arguments),mj(this,"sidebarMenu",[{key:"active",href:"users",title:"Active Users"},{key:"pending",href:"users/pending",title:"Pending Invitations"},{key:"disabled",href:"users/disabled",title:"Disabled Users",isAvailable:()=>Z.canCreateUser()}]),mj(this,"listColumns",[gi.custom.sortable((e,t)=>n.a.createElement(lp,{user:t,withLink:!0}),{title:"Name",field:"name",width:null}),gi.custom.sortable((e,t)=>Object(c.map)(t.groups,e=>n.a.createElement(O,{key:"group"+e.id,className:"label label-tag",href:"groups/"+e.id},e.name)),{title:"Groups",field:"groups"}),gi.timeAgo.sortable({title:"Joined",field:"created_at",className:"text-nowrap",width:"1%"}),gi.timeAgo.sortable({title:"Last Active At",field:"active_at",className:"text-nowrap",width:"1%"}),gi.custom((e,t)=>n.a.createElement(pj,{user:t,enableUser:this.enableUser,disableUser:this.disableUser,deleteUser:this.deleteUser}),{width:"1%",isAvailable:()=>Z.canCreateUser()})]),mj(this,"createUser",e=>fp.create(e).then(e=>{en.success("Saved."),e.invite_link&&z.a.warning({title:"Email not sent!",content:n.a.createElement(n.a.Fragment,null,n.a.createElement("p",null,"The mail server is not configured, please send the following link to ",n.a.createElement("b",null,e.name),":"),n.a.createElement(Np,{value:nj(e.invite_link),"aria-label":"Invite link",readOnly:!0}))})}).catch(e=>{var t=Object(c.find)([Object(c.get)(e,"response.data.message"),Object(c.get)(e,"message"),"Failed saving."],c.isString);return Promise.reject(new Error(t))})),mj(this,"showCreateUserDialog",()=>{if(Z.isCreateUserEnabled()){var e=()=>{this.props.controller.params.isNewUserPage&&ct("users")};uj.showModal().onClose(t=>this.createUser(t).then(()=>{this.props.controller.update(),e()})).onDismiss(e)}}),mj(this,"enableUser",(e,t)=>fp.enableUser(t).then(()=>this.props.controller.update())),mj(this,"disableUser",(e,t)=>fp.disableUser(t).then(()=>this.props.controller.update())),mj(this,"deleteUser",(e,t)=>fp.deleteUser(t).then(()=>this.props.controller.update()))}componentDidMount(){this.props.controller.params.isNewUserPage&&this.showCreateUserDialog()}renderPageHeader(){return Z.canCreateUser()?n.a.createElement("div",{className:"m-b-15"},n.a.createElement(f.a,{type:"primary",disabled:!Z.isCreateUserEnabled(),onClick:this.showCreateUserDialog},n.a.createElement("i",{className:"fa fa-plus m-r-5","aria-hidden":"true"}),"New User"),n.a.createElement(le,{name:"UsersListExtra"})):null}render(){var e=this.props.controller;return n.a.createElement(n.a.Fragment,null,this.renderPageHeader(),n.a.createElement(Xl,null,n.a.createElement(Xl.Sidebar,{className:"m-b-0"},n.a.createElement(Dl,{value:e.searchTerm,onChange:e.updateSearch,label:"Search users"}),n.a.createElement(Rl,{items:this.sidebarMenu,selected:e.params.currentPage})),n.a.createElement(Xl.Content,null,!e.isLoaded&&n.a.createElement(Ts,{className:""}),e.isLoaded&&e.isEmpty&&n.a.createElement(xh,{className:""}),e.isLoaded&&!e.isEmpty&&n.a.createElement("div",{className:"table-responsive","data-test":"UserList"},n.a.createElement(yi,{items:e.pageItems,columns:this.listColumns,context:this.actions,orderByField:e.orderByField,orderByReverse:e.orderByReverse,toggleSorting:e.toggleSorting}),n.a.createElement(Ui,{showPageSizeSelect:!0,totalCount:e.totalItemsCount,pageSize:e.itemsPerPage,onPageSizeChange:t=>e.updatePagination({itemsPerPage:t}),page:e.page,onChange:t=>e.updatePagination({page:t})})))))}}mj(hj,"propTypes",{controller:ds.isRequired});var fj=zf("Users.List",{permission:"list_users",title:"Users",path:"users",isActive:e=>e.startsWith("/users")&&"/users/me"!==e,order:2},ms(hj,()=>new Ns({getRequest(e,t){switch(t.params.currentPage){case"active":e.pending=!1;break;case"pending":e.pending=!0;break;case"disabled":e.disabled=!0}return e},getResource:()=>fp.query.bind(fp)}),()=>new _s({orderByField:"created_at",orderByReverse:!0})));pn.register("Users.New",zr({path:"/users/new",title:"Users",render:e=>n.a.createElement(fj,dj({},e,{currentPage:"active",isNewUserPage:!0}))})),pn.register("Users.List",zr({path:"/users",title:"Users",render:e=>n.a.createElement(fj,dj({},e,{currentPage:"active"}))})),pn.register("Users.Pending",zr({path:"/users/pending",title:"Pending Invitations",render:e=>n.a.createElement(fj,dj({},e,{currentPage:"pending"}))})),pn.register("Users.Disabled",zr({path:"/users/disabled",title:"Disabled Users",render:e=>n.a.createElement(fj,dj({},e,{currentPage:"disabled"}))}));a(1774);function bj(){return(bj=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function gj(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},i=Object.keys(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function yj(e){var t=e.groups,a=e.linkGroups,r=gj(e,["groups","linkGroups"]);return n.a.createElement("div",bj({className:"user-groups"},r),Object(c.map)(t,e=>n.a.createElement(_d.a,{key:e.id},a?n.a.createElement(O,{href:"groups/".concat(e.id)},e.name):e.name)))}function vj(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);r=!0);}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Oj(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Oj(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Oj(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function Ej(e){var t=vj(Object(r.useState)([]),2),a=t[0],n=t[1],i=vj(Object(r.useState)(!0),2),s=i[0],o=i[1],l=Object(r.useMemo)(()=>Object(c.filter)(a,t=>Object(c.includes)(e.groupIds,t.id)),[a,e]);return Object(r.useEffect)(()=>{lb.query().then(e=>{n(Object(c.isArray)(e)?e:[]),o(!1)})},[]),Object(r.useMemo)(()=>({groups:l,allGroups:a,isLoading:s}),[l,a,s])}function jj(){return(jj=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function wj(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function Sj(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?wj(Object(a),!0).forEach((function(t){Pj(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):wj(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Pj(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function Cj(e){var t=e.user,a=e.onChange,i=Ej(t),s=i.groups,o=i.allGroups,l=i.isLoading,u=sd(a),d=Object(r.useCallback)((e,a,r)=>{var n=Sj(Sj({},e),{},{id:t.id});fp.save(n).then(e=>{a("Saved."),u(fp.convertUserInfo(e))}).catch(e=>{r(Object(c.get)(e,"response.data.message","Failed saving."))})},[t,u]),m=Object(r.useMemo)(()=>Object(c.map)([{name:"name",title:"Name",type:"text",initialValue:t.name},{name:"email",title:"Email",type:"email",initialValue:t.email},t.isDisabled||W.id===t.id?{name:"group_ids",title:"Groups",type:"content",required:!1,content:l?"Loading...":n.a.createElement(yj,{"data-test":"Groups",groups:s})}:{name:"group_ids",title:"Groups",type:"select",mode:"multiple",options:Object(c.map)(o,e=>({name:e.name,value:e.id})),initialValue:t.groupIds,loading:l,placeholder:l?"Loading...":""}],e=>Sj({readOnly:t.isDisabled,required:!0},e)),[t,s,o,l]);return n.a.createElement(le,jj({name:"UserProfile.UserInfoForm"},e),n.a.createElement(kf,{fields:m,onSubmit:d,hideSubmitButton:t.isDisabled}))}function Nj(){return(Nj=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function kj(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function xj(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?kj(Object(a),!0).forEach((function(t){Aj(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):kj(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Aj(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function _j(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);r=!0);}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return qj(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return qj(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function qj(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function Tj(e){var t=e.user,a=e.onChange,i=_j(Object(r.useState)(!1),2),s=i[0],o=i[1],l=sd(a),c=Pe("apiKey"),u=Object(r.useCallback)(()=>{z.a.confirm({title:"Regenerate API Key",content:"Are you sure you want to regenerate?",okText:"Regenerate",onOk:()=>{o(!0),fp.regenerateApiKey(t).then(e=>{e&&l(xj(xj({},t),{},{apiKey:e}))}).finally(()=>{o(!1)})},maskClosable:!0,autoFocusButton:null})},[t,l]);return n.a.createElement(le,Nj({name:"UserProfile.ApiKeyForm"},e),n.a.createElement(co.a,{layout:"vertical"},n.a.createElement("hr",null),n.a.createElement(co.a.Item,{label:"API Key",className:"m-b-10"},n.a.createElement(Np,{id:c,className:"hide-in-percy",value:t.apiKey,"data-test":"ApiKey",readOnly:!0})),n.a.createElement(f.a,{className:"w-100",onClick:u,loading:s,"data-test":"RegenerateApiKey"},"Regenerate")))}function Ij(){return(Ij=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Dj(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function Rj(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Dj(Object(a),!0).forEach((function(t){Mj(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Dj(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Mj(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}yj.propTypes={groups:ae.a.arrayOf(ae.a.shape({id:ae.a.oneOfType([ae.a.number,ae.a.string]).isRequired,name:ae.a.string})),linkGroups:ae.a.bool},yj.defaultProps={groups:[],linkGroups:!0},Cj.propTypes={user:Vn.isRequired,onChange:ae.a.func},Cj.defaultProps={onChange:()=>{}},Tj.propTypes={user:Vn.isRequired,onChange:ae.a.func},Tj.defaultProps={onChange:()=>{}};class zj extends n.a.Component{constructor(e){super(e),Mj(this,"fieldError",(e,t)=>0===t.length?"This field is required.":"currentPassword"!==e&&t.length<6?"This field is too short.":"repeatPassword"===e&&t!==this.state.newPassword.value?"Passwords don't match":null),Mj(this,"validateFields",e=>{var t=this.state,a=t.currentPassword,r=t.newPassword,n=t.repeatPassword,i={currentPassword:this.fieldError("currentPassword",a.value),newPassword:this.fieldError("newPassword",r.value),repeatPassword:this.fieldError("repeatPassword",n.value)};this.setState({currentPassword:Rj(Rj({},a),{},{error:i.currentPassword}),newPassword:Rj(Rj({},r),{},{error:i.newPassword}),repeatPassword:Rj(Rj({},n),{},{error:i.repeatPassword})}),Object(c.isFunction)(e)&&e(i.currentPassword||i.newPassword||i.repeatPassword?i:null)}),Mj(this,"updatePassword",()=>{var e=this.state,t=e.currentPassword,a=e.newPassword;e.updatingPassword||this.validateFields(e=>{if(e)this.setState(e=>({currentPassword:Rj(Rj({},e.currentPassword),{},{touched:!0}),newPassword:Rj(Rj({},e.newPassword),{},{touched:!0}),repeatPassword:Rj(Rj({},e.repeatPassword),{},{touched:!0})}));else{var r={id:this.props.user.id,old_password:t.value,password:a.value};this.setState({updatingPassword:!0}),fp.save(r).then(()=>{en.success("Saved."),this.props.dialog.close({success:!0})}).catch(e=>{en.error(Object(c.get)(e,"response.data.message","Failed saving.")),this.setState({updatingPassword:!1})})}})}),Mj(this,"handleChange",e=>{var t=e.target,a=t.name,r=t.value,n=this.state[a].error;this.setState({[a]:{value:r,error:n,touched:!0}},()=>{this.validateFields()})}),this.state={currentPassword:{value:"",error:null,touched:!1},newPassword:{value:"",error:null,touched:!1},repeatPassword:{value:"",error:null,touched:!1},updatingPassword:!1}}render(){var e=this.props.dialog,t=this.state,a=t.currentPassword,r=t.newPassword,i=t.repeatPassword,s=t.updatingPassword,o={className:"m-b-10",required:!0},l={onChange:this.handleChange,onPressEnter:this.updatePassword};return n.a.createElement(z.a,Ij({},e.props,{okButtonProps:{loading:s},onOk:this.updatePassword,title:"Change Password"}),n.a.createElement(co.a,{layout:"vertical"},n.a.createElement(co.a.Item,Ij({},o,{validateStatus:a.touched&&a.error?"error":null,help:a.touched?a.error:null,label:"Current Password"}),n.a.createElement(Fe.a.Password,Ij({},l,{name:"currentPassword","data-test":"CurrentPassword",autoFocus:!0}))),n.a.createElement(co.a.Item,Ij({},o,{validateStatus:r.touched&&r.error?"error":null,help:r.touched?r.error:null,label:"New Password"}),n.a.createElement(Fe.a.Password,Ij({},l,{name:"newPassword","data-test":"NewPassword"}))),n.a.createElement(co.a.Item,Ij({},o,{validateStatus:i.touched&&i.error?"error":null,help:i.touched?i.error:null,label:"Repeat New Password"}),n.a.createElement(Fe.a.Password,Ij({},l,{name:"repeatPassword","data-test":"RepeatPassword"})))))}}Mj(zj,"propTypes",{user:Vn.isRequired,dialog:Qe.isRequired});var Fj=We(zj);function Uj(){return(Uj=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Vj(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},i=Object.keys(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function Lj(e){var t=e.user,a=e.passwordLink,r=Vj(e,["user","passwordLink"]);return Object(c.isString)(a)?n.a.createElement(le,Uj({name:"UserProfile.PasswordLinkAlert"},e),n.a.createElement(p.a,Uj({message:"Email not sent!",description:n.a.createElement(n.a.Fragment,null,n.a.createElement("p",null,"The mail server is not configured, please send the following link to ",n.a.createElement("b",null,t.name),":"),n.a.createElement(Np,{value:nj(a),"aria-label":"Password link",readOnly:!0})),type:"warning",className:"m-t-20",closable:!0},r))):null}function Bj(){return(Bj=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Qj(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);r=!0);}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Wj(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Wj(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Wj(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function Hj(e){var t=e.user,a=Qj(Object(r.useState)(!1),2),i=a[0],s=a[1],o=Qj(Object(r.useState)(null),2),l=o[0],c=o[1],u=Object(r.useCallback)(()=>{s(!0),fp.sendPasswordReset(t).then(e=>{c(e)}).finally(()=>{s(!1)})},[t]);return n.a.createElement(le,Bj({name:"UserProfile.PasswordResetForm"},e),n.a.createElement(f.a,{className:"w-100 m-t-10",onClick:u,loading:i},"Send Password Reset Email"),n.a.createElement(Lj,{user:t,passwordLink:l,afterClose:()=>c(null)}))}function Gj(){return(Gj=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Kj(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);r=!0);}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Yj(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Yj(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Yj(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function $j(e){var t=e.user,a=Kj(Object(r.useState)(!1),2),i=a[0],s=a[1],o=Kj(Object(r.useState)(null),2),l=o[0],c=o[1],u=Object(r.useCallback)(()=>{s(!0),fp.resendInvitation(t).then(e=>{c(e)}).finally(()=>{s(!1)})},[t]);return n.a.createElement(le,Gj({name:"UserProfile.ResendInvitationForm"},e),n.a.createElement(f.a,{className:"w-100 m-t-10",onClick:u,loading:i},"Resend Invitation"),n.a.createElement(Lj,{user:t,passwordLink:l,afterClose:()=>c(null)}))}function Jj(){return(Jj=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Xj(e){var t=e.user,a=Object(r.useCallback)(()=>{Fj.showModal({user:t})},[t]);return n.a.createElement(le,Jj({name:"UserProfile.PasswordForm"},e),n.a.createElement("h5",null,"Password"),t.id===W.id&&n.a.createElement(f.a,{className:"w-100 m-t-10",onClick:a,"data-test":"ChangePassword"},"Change Password"),t.id!==W.id&&W.isAdmin&&n.a.createElement(n.a.Fragment,null,t.isInvitationPending?n.a.createElement($j,{user:t}):n.a.createElement(Hj,{user:t})))}function Zj(){return(Zj=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function ew(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);r=!0);}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return tw(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return tw(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function tw(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function aw(e){var t=e.user,a=e.onChange,i=ew(Object(r.useState)(!1),2),s=i[0],o=i[1],l=sd(a),c=Object(r.useCallback)(()=>{var e=t.isDisabled?fp.enableUser:fp.disableUser;o(!0),e(t).then(e=>{e&&l(fp.convertUserInfo(e))}).finally(()=>{o(!1)})},[t,l]);if(!W.isAdmin||t.id===W.id)return null;var u={type:t.isDisabled?"primary":"danger",children:t.isDisabled?"Enable User":"Disable User"};return n.a.createElement(le,{name:"UserProfile.ToggleUserForm"},n.a.createElement(f.a,Zj({className:"w-100 m-t-10",onClick:c,loading:s},u)))}function rw(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);r=!0);}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return nw(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return nw(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function nw(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function iw(e){var t=rw(Object(r.useState)(e.user),2),a=t[0],i=t[1];return Object(r.useEffect)(()=>{i(e.user)},[e.user]),n.a.createElement("div",{className:"col-md-4 col-md-offset-4"},n.a.createElement("img",{alt:"Profile",src:a.profileImageUrl,className:"profile__image",width:"40"}),n.a.createElement("h3",{className:"profile__h3"},a.name),n.a.createElement("hr",null),n.a.createElement(Cj,{user:a,onChange:i}),!a.isDisabled&&n.a.createElement(n.a.Fragment,null,n.a.createElement(Tj,{user:a,onChange:i}),n.a.createElement("hr",null),n.a.createElement(Xj,{user:a})),n.a.createElement("hr",null),n.a.createElement(aw,{user:a,onChange:i}))}function sw(e){var t=e.user,a=Ej(t),r=a.groups,i=a.isLoading;return n.a.createElement("div",{className:"col-md-4 col-md-offset-4 profile__container"},n.a.createElement("img",{alt:"profile",src:t.profileImageUrl,className:"profile__image",width:"40"}),n.a.createElement("h3",{className:"profile__h3"},t.name),n.a.createElement("hr",null),n.a.createElement("dl",{className:"profile__dl"},n.a.createElement("dt",null,"Name:"),n.a.createElement("dd",null,t.name),n.a.createElement("dt",null,"Email:"),n.a.createElement("dd",null,t.email),n.a.createElement("dt",{className:"m-b-5"},"Groups:"),n.a.createElement("dd",null,i?"Loading...":n.a.createElement(yj,{groups:r}))))}Lj.propTypes={user:Vn.isRequired,passwordLink:ae.a.string},Lj.defaultProps={passwordLink:null},Hj.propTypes={user:Vn.isRequired},$j.propTypes={user:Vn.isRequired},Xj.propTypes={user:Vn.isRequired},aw.propTypes={user:Vn.isRequired,onChange:ae.a.func},aw.defaultProps={onChange:()=>{}},iw.propTypes={user:Vn.isRequired},sw.propTypes={user:Vn.isRequired};a(1775);function ow(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);r=!0);}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return lw(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return lw(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function lw(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function cw(e){var t=e.userId,a=e.onError,i=ow(Object(r.useState)(null),2),s=i[0],o=i[1],l=sd(a);Object(r.useEffect)(()=>{var e=!1;return fp.get({id:t||W.id}).then(t=>{e||o(fp.convertUserInfo(t))}).catch(t=>{e||l(t)}),()=>{e=!0}},[t,l]);var c=s&&(W.isAdmin||W.id===s.id);return n.a.createElement(n.a.Fragment,null,n.a.createElement(Xo,{featureName:"invite emails",className:"m-b-20",adminOnly:!0}),n.a.createElement("div",{className:"row"},!s&&n.a.createElement(Ts,{className:""}),s&&n.a.createElement(le,{name:"UserProfile",user:s},!c&&n.a.createElement(sw,{user:s}),c&&n.a.createElement(iw,{user:s}))))}cw.propTypes={userId:ae.a.string,onError:ae.a.func},cw.defaultProps={userId:null,onError:()=>{}};var uw,dw,mw=zf("Users.Account",{title:"Account",path:"users/me",order:7},cw);function pw(e){for(var t=e.target;t&&"A"!==t.tagName;)t=t.parentNode;if(t&&t.hasAttribute("href")&&!t.hasAttribute("download")&&!t.dataset.skipRouter&&!(e.altKey||e.ctrlKey||e.metaKey||e.shiftKey)){var a=t.getAttribute("target");Object(c.isString)(a)&&"_blank"===a.toLowerCase()||(e.preventDefault(),ct(t.href))}}function hw(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);r=!0);}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return fw(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return fw(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function fw(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}pn.register("Users.Account",zr({path:"/users/me",title:"Account",render:e=>n.a.createElement(mw,e)})),pn.register("Users.ViewOrEdit",zr({path:"/users/:userId",title:"Users",render:e=>n.a.createElement(mw,e)})),_n.a.setDefaultIndicator(n.a.createElement("span",{role:"status","aria-live":"polite","aria-relevant":"additions removals"},n.a.createElement("i",{className:"fa fa-spinner fa-pulse","aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},"Loading..."))),l.a.updateLocale("en",{relativeTime:{future:"%s",past:"%s",s:"just now",m:"a minute ago",mm:"%d minutes ago",h:"an hour ago",hh:"%d hours ago",d:"a day ago",dd:"%d days ago",M:"a month ago",MM:"%d months ago",y:"a year ago",yy:"%d years ago"}}),(uw=a(1776)).keys().forEach(uw),(dw=a(1861)).keys().map(dw).map(e=>e.default).filter(c.isFunction).filter(e=>e.init).map(e=>e());var bw={init(){window.addEventListener("offline",()=>{var e;en.warning("Please check your Internet connection.",null,{key:"connectionNotification",duration:null}),e="connectionNotification",window.addEventListener("online",(function t(){en.close(e),window.removeEventListener("online",t)}))})}};s.a.render(n.a.createElement((function(){var e=hw(Object(r.useState)(null),2),t=e[0],a=e[1],i=hw(Object(r.useState)(null),2),s=i[0],o=i[1];return Object(r.useEffect)(()=>{t&&t.title&&(document.title=t.title)},[t]),Object(r.useEffect)(()=>{function e(e){e.preventDefault(),o(e.error)}return document.body.addEventListener("click",pw,!1),window.addEventListener("error",e,!1),()=>{document.body.removeEventListener("click",pw,!1),window.removeEventListener("error",e,!1)}},[]),s?n.a.createElement(et,{error:s}):n.a.createElement(lt,{routes:pn.items,onRouteChange:a})}),null),document.getElementById("application-root"),()=>{bw.init()})},419:function(e){e.exports=JSON.parse('"2589bef1f21b7c84e4ceacdf5cd2c620bdedb111"')},437:function(e,t,a){e.exports=a.p+"images/avatar.svg"},622:function(e,t,a){},632:function(e,t,a){},713:function(e,t,a){a(1866),a(1862),e.exports=a(1863)},728:function(e,t,a){var r={"./en-SG":430,"./en-SG.js":430,"./en-au":431,"./en-au.js":431,"./en-ca":432,"./en-ca.js":432,"./en-gb":433,"./en-gb.js":433,"./en-ie":434,"./en-ie.js":434,"./en-il":435,"./en-il.js":435,"./en-nz":436,"./en-nz.js":436};function n(e){var t=i(e);return a(t)}function i(e){if(!a.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}n.keys=function(){return Object.keys(r)},n.resolve=i,e.exports=n,n.id=728},909:function(e,t){}});
//# sourceMappingURL=app.101c1284c4a7520ca61d.js.map